import{a as Rv}from"./chunk-TIWCUDTS.js";import{a as Nv}from"./chunk-L2BUTPUO.js";import{C as Pv,J as Iv,L as Ov,M as of,a as nf,b as sf,d as wv,f as Cv,h as Ev,i as _v,l as Tv,m as Av,s as Dv,w as $o,x as Fv}from"./chunk-GRQJSV6A.js";import{$ as cv,Cb as X,Da as uv,E as sv,Eb as G,Ec as Sv,Fc as Zd,Hc as wn,Ib as Sr,Jb as wr,Jc as ef,Kb as Cr,Kc as tf,Lb as ae,Lc as Ko,Mb as re,Mc as rf,Nb as ms,O as ov,Ob as Oi,Pb as gs,Qa as hv,Qb as Wc,R as bn,Ra as Wo,Rb as gv,Sb as vv,Ta as H,U as av,Ua as Ie,V as en,W as ds,Y as Yd,Ya as dv,Yb as yv,_ as fs,_b as Ni,ab as fv,cb as pv,da as xn,ea as Sn,f as Ir,fa as ps,g as Vc,ga as Ii,hc as bv,jb as ft,kb as Ce,lb as Y,ma as Uc,mb as Vt,na as K,nb as Rt,oa as $,ob as Gc,oc as xv,pa as ge,pb as mv,pc as vs,qa as vt,qc as Ri,rc as Kc,sc as $c,ta as lv,tc as Jc,ub as k,uc as Qd,v as iv,vb as j,wa as tn,wb as oe,wc as Un,xa as ct,xb as lt,yb as ut,zb as $e}from"./chunk-DAEDL4JP.js";import{a as Go,d as J,e as R,f as Pi,g as ye,h as Ht,i as qr,j as y}from"./chunk-SO6VPFYA.js";function C(r,e){if(!r)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}var ta=J(()=>{});function cr(r,e){switch(e){case"base64":return Zc.fromByteArray(r);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(r);default:throw new Error("invalid/unsupported encoding")}}function bf(r){let e=r;return r instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}var Zc,Er,Gn,kt,xf=J(()=>{Zc=ye(Rv());ta();Er=(r,e)=>kt.from(r,e).buffer,Gn=(r,e)=>kt.from(r).toString(e);kt=class r extends Uint8Array{toString(e){return cr(this,e)}static from(e,t,n){if(typeof e=="string")return r.fromString(e,t);if(e!==null&&typeof e=="object"&&bf(e.buffer))return C(e.byteOffset===0,0),C(e.byteLength===e.buffer.byteLength,1),r.fromArrayBuffer(e.buffer,t,n);if(bf(e))return r.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){let i=t??0,s=n??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new r(e,i,s)}static fromString(e,t){switch(t){case"base64":{let n=this.sanitizeBase64(e),i=Zc.toByteArray(n);return new r(i.buffer)}case"utf8":case"utf-8":case void 0:{let n=new TextEncoder().encode(e);return new r(n.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}}});function MD(r,e){return y(this,null,function*(){let t=yield crypto.subtle.digest(e,r);return new Uint8Array(t)})}function BD(r,e){switch(e){case"hex":return Array.prototype.map.call(r,n=>n.toString(16).padStart(2,"0")).join("");case"base64":return ny.fromByteArray(r)}}function iy(r,e="SHA-1",t="hex"){return y(this,null,function*(){if(crypto.subtle===void 0)return import("./chunk-KRUCD4QG.js").then(i=>y(this,null,function*(){return i.hashFile(r,e,t)}));let n=yield MD(r,e);return BD(n,t)})}function Sf(r){return y(this,null,function*(){let t=`blob ${r.byteLength.toString()}\0`,n=kt.from(t+r.toString());return iy(n)})}var ny,sy=J(()=>{ny=ye(Rv());xf();});var le,oy=J(()=>{le=window.performance});var el=J(()=>{xf();sy();oy();});var wf,ra,qD,ay=J(()=>{el();wf=r=>kt.from(r,"base64").toString("utf-8"),ra=r=>kt.from(r,"utf8").toString("base64"),qD=(r,e)=>{switch(e){case"utf8":case"utf-8":return r;default:return kt.from(r,e).toString()}}});var Cf,cy=J(()=>{Cf=class{constructor(e,t=100){this.process=e,this.maxBatchSize=t,this.pendingWork=new Map}add(e,t){this.pendingWork.has(e)||this.pendingWork.set(e,[]),this.pendingWork.get(e).push(t),this.pendingWork.get(e).length>=this.maxBatchSize?(this.pendingTimer!==void 0&&clearTimeout(this.pendingTimer),this.pendingTimer=void 0,this.startWork()):this.pendingTimer===void 0&&(this.pendingTimer=setTimeout(()=>{this.pendingTimer=void 0,this.startWork()},0))}drain(){this.startWork()}startWork(){let e=this.pendingWork;this.pendingWork=new Map;for(let[t,n]of e)this.process(t,n)}}});function Bi(r,e){return(...t)=>{if(r.disposed)throw new Error("Already disposed");return e(...t)}}var ly=J(()=>{});var Wn=R((HU,Ef)=>{"use strict";var ws=typeof Reflect=="object"?Reflect:null,uy=ws&&typeof ws.apply=="function"?ws.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},tl;ws&&typeof ws.ownKeys=="function"?tl=ws.ownKeys:Object.getOwnPropertySymbols?tl=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:tl=function(e){return Object.getOwnPropertyNames(e)};function LD(r){console&&console.warn&&console.warn(r)}var dy=Number.isNaN||function(e){return e!==e};function Ge(){Ge.init.call(this)}Ef.exports=Ge;Ef.exports.once=VD;Ge.EventEmitter=Ge;Ge.prototype._events=void 0;Ge.prototype._eventsCount=0;Ge.prototype._maxListeners=void 0;var hy=10;function rl(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Ge,"defaultMaxListeners",{enumerable:!0,get:function(){return hy},set:function(r){if(typeof r!="number"||r<0||dy(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");hy=r}});Ge.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ge.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||dy(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function fy(r){return r._maxListeners===void 0?Ge.defaultMaxListeners:r._maxListeners}Ge.prototype.getMaxListeners=function(){return fy(this)};Ge.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")uy(c,this,t);else for(var l=c.length,d=yy(c,l),n=0;n<l;++n)uy(d[n],this,t);return!0};function py(r,e,t,n){var i,s,o;if(rl(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=fy(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,LD(a)}return r}Ge.prototype.addListener=function(e,t){return py(this,e,t,!1)};Ge.prototype.on=Ge.prototype.addListener;Ge.prototype.prependListener=function(e,t){return py(this,e,t,!0)};function jD(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function my(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=jD.bind(n);return i.listener=t,n.wrapFn=i,i}Ge.prototype.once=function(e,t){return rl(t),this.on(e,my(this,e,t)),this};Ge.prototype.prependOnceListener=function(e,t){return rl(t),this.prependListener(e,my(this,e,t)),this};Ge.prototype.removeListener=function(e,t){var n,i,s,o,a;if(rl(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():zD(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};Ge.prototype.off=Ge.prototype.removeListener;Ge.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function gy(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?HD(i):yy(i,i.length)}Ge.prototype.listeners=function(e){return gy(this,e,!0)};Ge.prototype.rawListeners=function(e){return gy(this,e,!1)};Ge.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):vy.call(r,e)};Ge.prototype.listenerCount=vy;function vy(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Ge.prototype.eventNames=function(){return this._eventsCount>0?tl(this._events):[]};function yy(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function zD(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function HD(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function VD(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}by(r,e,s,{once:!0}),e!=="error"&&UD(r,i,{once:!0})})}function UD(r,e,t){typeof r.on=="function"&&by(r,"error",e,t)}function by(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var xy,be,_f=J(()=>{xy=ye(Wn());be=class extends xy.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}});var Kn,Sy=J(()=>{_f();Kn=(()=>{class r extends be{constructor(t){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,t!==void 0){let n=s=>this.unforwardEvent(t,s),i=s=>this.forwardEvent(t,s);this.on(r.removeListenerEvent,n),this.on(r.newListenerEvent,i)}}static isEmitterEvent(t){return t===r.newListenerEvent||t===r.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(let t of this.forwardingEvents.values())for(let n of t.values())try{n()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(t,...n){for(let i of n)if(t!==void 0&&i!==void 0&&!r.isEmitterEvent(i)){let s=this.forwardingEvents.get(i);if(s===void 0&&(s=new Map,this.forwardingEvents.set(i,s)),!s.has(t)){let o=(...a)=>this.emit(i,...a);s.set(t,()=>t.off(i,o)),t.on(i,o)}}}unforwardEvent(t,...n){for(let i of n)if(i!==void 0&&!r.isEmitterEvent(i)){let s=this.forwardingEvents.get(i);if(s?.has(t)&&this.listenerCount(i)===0){let o=s.get(t);o!==void 0&&o(),s.delete(t),s.size===0&&this.forwardingEvents.delete(i)}}}}return r.newListenerEvent="newListener",r.removeListenerEvent="removeListener",r})()});var GD,Tf,wy=J(()=>{GD={compare:(r,e)=>r-e,min:Number.MIN_VALUE},Tf=class{constructor(e){this.comp=e,this.L=[{value:e.min,position:0}]}peek(){return this.L[1]}get(){this.swap(1,this.count());let e=this.L.pop();return this.fixdown(1),e.value}add(e){let t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}update(e){let t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}remove(e){let t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}count(){return this.L.length-1}fixup(e){let t=e;for(;this.isGreaterThanParent(t);){let n=t>>1;this.swap(t,n),t=n}}isGreaterThanParent(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}fixdown(e){let t=e;for(;t<<1<=this.count();){let n=t<<1;if(n<this.count()&&this.comp.compare(this.L[n].value,this.L[n+1].value)>0&&n++,this.comp.compare(this.L[t].value,this.L[n].value)<=0)break;this.swap(t,n),t=n}}swap(e,t){let n=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=n,this.L[t].position=t}}});function Af(r){let e=s=>s!==null&&!Array.isArray(s)&&typeof s=="object",t=(s,o)=>{let a=s.split(`
`);return a.shift(),o!==void 0&&a.unshift(o),a.join(`
`)},i={message:typeof r?.message=="string"?r.message:String(r)};if(e(r)){let{errorType:s,stack:o,name:a}=r;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){let c=typeof a=="string"?a:void 0;i.stack=t(o,c)}}return i}var na,ia,Cy=J(()=>{na=class{send(e){}},ia=class{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}});var Df,Ff,Ey=J(()=>{Df=class{constructor(e,t){this.expiry=e,this.cleanup=t,this.gcTimeouts=new Map}schedule(e){this.expiry.policy!=="indefinite"&&this.gcTimeouts.set(e,setTimeout(()=>{this.cleanup(e),this.cancel(e)},this.expiry.durationMs))}cancel(e){let t=this.gcTimeouts.get(e);t!==void 0&&(clearTimeout(t),this.gcTimeouts.delete(e))}update(e){this.expiry.policy==="sliding"&&(this.cancel(e),this.schedule(e))}},Ff=class{constructor({expiry:e={policy:"indefinite"},removeOnError:t=()=>!0}={}){this.cache=new Map,this.removeOnError=t,this.gc=new Df(e,n=>this.remove(n))}has(e){return this.cache.has(e)}get(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}remove(e){return this.gc.cancel(e),this.cache.delete(e)}addOrGet(e,t){return y(this,null,function*(){let n=this.get(e);return n===void 0&&(n=y(this,null,function*(){return t()}),this.cache.set(e,n),n.catch(s=>{this.removeOnError(s)&&this.remove(e)}),this.gc.schedule(e)),n})}add(e,t){let n=this.has(e);return this.addOrGet(e,t).catch(()=>{}),!n}addValueOrGet(e,t){return y(this,null,function*(){return this.addOrGet(e,()=>y(this,null,function*(){return t}))})}addValue(e,t){return this.add(e,()=>y(this,null,function*(){return t}))}}});var Ee,At,Pf=J(()=>{Ee=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},At=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}then(n,i){return y(this,arguments,function*(e,t){return this.getPromise().then(...arguments)})}catch(t){return y(this,arguments,function*(e){return this.getPromise().catch(...arguments)})}finally(t){return y(this,arguments,function*(e){return this.getPromise().finally(...arguments)})}getPromise(){return y(this,null,function*(){return this.result===void 0&&(this.result=this.execute()),this.result})}}});var Ty=R((QU,_y)=>{function WD(){this.__data__=[],this.size=0}_y.exports=WD});var sa=R((ZU,Ay)=>{function KD(r,e){return r===e||r!==r&&e!==e}Ay.exports=KD});var oa=R((eG,Dy)=>{var $D=sa();function JD(r,e){for(var t=r.length;t--;)if($D(r[t][0],e))return t;return-1}Dy.exports=JD});var Py=R((tG,Fy)=>{var XD=oa(),YD=Array.prototype,QD=YD.splice;function ZD(r){var e=this.__data__,t=XD(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():QD.call(e,t,1),--this.size,!0}Fy.exports=ZD});var Oy=R((rG,Iy)=>{var eF=oa();function tF(r){var e=this.__data__,t=eF(e,r);return t<0?void 0:e[t][1]}Iy.exports=tF});var Ry=R((nG,Ny)=>{var rF=oa();function nF(r){return rF(this.__data__,r)>-1}Ny.exports=nF});var My=R((iG,ky)=>{var iF=oa();function sF(r,e){var t=this.__data__,n=iF(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}ky.exports=sF});var aa=R((sG,By)=>{var oF=Ty(),aF=Py(),cF=Oy(),lF=Ry(),uF=My();function Cs(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Cs.prototype.clear=oF;Cs.prototype.delete=aF;Cs.prototype.get=cF;Cs.prototype.has=lF;Cs.prototype.set=uF;By.exports=Cs});var Ly=R((oG,qy)=>{var hF=aa();function dF(){this.__data__=new hF,this.size=0}qy.exports=dF});var zy=R((aG,jy)=>{function fF(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}jy.exports=fF});var Vy=R((cG,Hy)=>{function pF(r){return this.__data__.get(r)}Hy.exports=pF});var Gy=R((lG,Uy)=>{function mF(r){return this.__data__.has(r)}Uy.exports=mF});var If=R((uG,Wy)=>{var gF=typeof global=="object"&&global&&global.Object===Object&&global;Wy.exports=gF});var Hr=R((hG,Ky)=>{var vF=If(),yF=typeof self=="object"&&self&&self.Object===Object&&self,bF=vF||yF||Function("return this")();Ky.exports=bF});var nl=R((dG,$y)=>{var xF=Hr(),SF=xF.Symbol;$y.exports=SF});var Qy=R((fG,Yy)=>{var Jy=nl(),Xy=Object.prototype,wF=Xy.hasOwnProperty,CF=Xy.toString,ca=Jy?Jy.toStringTag:void 0;function EF(r){var e=wF.call(r,ca),t=r[ca];try{r[ca]=void 0;var n=!0}catch{}var i=CF.call(r);return n&&(e?r[ca]=t:delete r[ca]),i}Yy.exports=EF});var e1=R((pG,Zy)=>{var _F=Object.prototype,TF=_F.toString;function AF(r){return TF.call(r)}Zy.exports=AF});var Es=R((mG,n1)=>{var t1=nl(),DF=Qy(),FF=e1(),PF="[object Null]",IF="[object Undefined]",r1=t1?t1.toStringTag:void 0;function OF(r){return r==null?r===void 0?IF:PF:r1&&r1 in Object(r)?DF(r):FF(r)}n1.exports=OF});var En=R((gG,i1)=>{function NF(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}i1.exports=NF});var il=R((vG,s1)=>{var RF=Es(),kF=En(),MF="[object AsyncFunction]",BF="[object Function]",qF="[object GeneratorFunction]",LF="[object Proxy]";function jF(r){if(!kF(r))return!1;var e=RF(r);return e==BF||e==qF||e==MF||e==LF}s1.exports=jF});var a1=R((yG,o1)=>{var zF=Hr(),HF=zF["__core-js_shared__"];o1.exports=HF});var u1=R((bG,l1)=>{var Of=a1(),c1=function(){var r=/[^.]+$/.exec(Of&&Of.keys&&Of.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function VF(r){return!!c1&&c1 in r}l1.exports=VF});var Nf=R((xG,h1)=>{var UF=Function.prototype,GF=UF.toString;function WF(r){if(r!=null){try{return GF.call(r)}catch{}try{return r+""}catch{}}return""}h1.exports=WF});var f1=R((SG,d1)=>{var KF=il(),$F=u1(),JF=En(),XF=Nf(),YF=/[\\^$.*+?()[\]{}|]/g,QF=/^\[object .+?Constructor\]$/,ZF=Function.prototype,eP=Object.prototype,tP=ZF.toString,rP=eP.hasOwnProperty,nP=RegExp("^"+tP.call(rP).replace(YF,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function iP(r){if(!JF(r)||$F(r))return!1;var e=KF(r)?nP:QF;return e.test(XF(r))}d1.exports=iP});var m1=R((wG,p1)=>{function sP(r,e){return r?.[e]}p1.exports=sP});var $n=R((CG,g1)=>{var oP=f1(),aP=m1();function cP(r,e){var t=aP(r,e);return oP(t)?t:void 0}g1.exports=cP});var sl=R((EG,v1)=>{var lP=$n(),uP=Hr(),hP=lP(uP,"Map");v1.exports=hP});var la=R((_G,y1)=>{var dP=$n(),fP=dP(Object,"create");y1.exports=fP});var S1=R((TG,x1)=>{var b1=la();function pP(){this.__data__=b1?b1(null):{},this.size=0}x1.exports=pP});var C1=R((AG,w1)=>{function mP(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}w1.exports=mP});var _1=R((DG,E1)=>{var gP=la(),vP="__lodash_hash_undefined__",yP=Object.prototype,bP=yP.hasOwnProperty;function xP(r){var e=this.__data__;if(gP){var t=e[r];return t===vP?void 0:t}return bP.call(e,r)?e[r]:void 0}E1.exports=xP});var A1=R((FG,T1)=>{var SP=la(),wP=Object.prototype,CP=wP.hasOwnProperty;function EP(r){var e=this.__data__;return SP?e[r]!==void 0:CP.call(e,r)}T1.exports=EP});var F1=R((PG,D1)=>{var _P=la(),TP="__lodash_hash_undefined__";function AP(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=_P&&e===void 0?TP:e,this}D1.exports=AP});var I1=R((IG,P1)=>{var DP=S1(),FP=C1(),PP=_1(),IP=A1(),OP=F1();function _s(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}_s.prototype.clear=DP;_s.prototype.delete=FP;_s.prototype.get=PP;_s.prototype.has=IP;_s.prototype.set=OP;P1.exports=_s});var R1=R((OG,N1)=>{var O1=I1(),NP=aa(),RP=sl();function kP(){this.size=0,this.__data__={hash:new O1,map:new(RP||NP),string:new O1}}N1.exports=kP});var M1=R((NG,k1)=>{function MP(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}k1.exports=MP});var ua=R((RG,B1)=>{var BP=M1();function qP(r,e){var t=r.__data__;return BP(e)?t[typeof e=="string"?"string":"hash"]:t.map}B1.exports=qP});var L1=R((kG,q1)=>{var LP=ua();function jP(r){var e=LP(this,r).delete(r);return this.size-=e?1:0,e}q1.exports=jP});var z1=R((MG,j1)=>{var zP=ua();function HP(r){return zP(this,r).get(r)}j1.exports=HP});var V1=R((BG,H1)=>{var VP=ua();function UP(r){return VP(this,r).has(r)}H1.exports=UP});var G1=R((qG,U1)=>{var GP=ua();function WP(r,e){var t=GP(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}U1.exports=WP});var K1=R((LG,W1)=>{var KP=R1(),$P=L1(),JP=z1(),XP=V1(),YP=G1();function Ts(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ts.prototype.clear=KP;Ts.prototype.delete=$P;Ts.prototype.get=JP;Ts.prototype.has=XP;Ts.prototype.set=YP;W1.exports=Ts});var J1=R((jG,$1)=>{var QP=aa(),ZP=sl(),e6=K1(),t6=200;function r6(r,e){var t=this.__data__;if(t instanceof QP){var n=t.__data__;if(!ZP||n.length<t6-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new e6(n)}return t.set(r,e),this.size=t.size,this}$1.exports=r6});var Rf=R((zG,X1)=>{var n6=aa(),i6=Ly(),s6=zy(),o6=Vy(),a6=Gy(),c6=J1();function As(r){var e=this.__data__=new n6(r);this.size=e.size}As.prototype.clear=i6;As.prototype.delete=s6;As.prototype.get=o6;As.prototype.has=a6;As.prototype.set=c6;X1.exports=As});var Q1=R((HG,Y1)=>{function l6(r,e){for(var t=-1,n=r==null?0:r.length;++t<n&&e(r[t],t,r)!==!1;);return r}Y1.exports=l6});var kf=R((VG,Z1)=>{var u6=$n(),h6=function(){try{var r=u6(Object,"defineProperty");return r({},"",{}),r}catch{}}();Z1.exports=h6});var ol=R((UG,tb)=>{var eb=kf();function d6(r,e,t){e=="__proto__"&&eb?eb(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}tb.exports=d6});var Mf=R((GG,rb)=>{var f6=ol(),p6=sa(),m6=Object.prototype,g6=m6.hasOwnProperty;function v6(r,e,t){var n=r[e];(!(g6.call(r,e)&&p6(n,t))||t===void 0&&!(e in r))&&f6(r,e,t)}rb.exports=v6});var Ds=R((WG,nb)=>{var y6=Mf(),b6=ol();function x6(r,e,t,n){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=n?n(t[a],r[a],a,t,r):void 0;c===void 0&&(c=r[a]),i?b6(t,a,c):y6(t,a,c)}return t}nb.exports=x6});var sb=R((KG,ib)=>{function S6(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}ib.exports=S6});var Jn=R(($G,ob)=>{function w6(r){return r!=null&&typeof r=="object"}ob.exports=w6});var cb=R((JG,ab)=>{var C6=Es(),E6=Jn(),_6="[object Arguments]";function T6(r){return E6(r)&&C6(r)==_6}ab.exports=T6});var Bf=R((XG,hb)=>{var lb=cb(),A6=Jn(),ub=Object.prototype,D6=ub.hasOwnProperty,F6=ub.propertyIsEnumerable,P6=lb(function(){return arguments}())?lb:function(r){return A6(r)&&D6.call(r,"callee")&&!F6.call(r,"callee")};hb.exports=P6});var ha=R((YG,db)=>{var I6=Array.isArray;db.exports=I6});var pb=R((QG,fb)=>{function O6(){return!1}fb.exports=O6});var al=R((da,Fs)=>{var N6=Hr(),R6=pb(),vb=typeof da=="object"&&da&&!da.nodeType&&da,mb=vb&&typeof Fs=="object"&&Fs&&!Fs.nodeType&&Fs,k6=mb&&mb.exports===vb,gb=k6?N6.Buffer:void 0,M6=gb?gb.isBuffer:void 0,B6=M6||R6;Fs.exports=B6});var qf=R((ZG,yb)=>{var q6=9007199254740991,L6=/^(?:0|[1-9]\d*)$/;function j6(r,e){var t=typeof r;return e=e??q6,!!e&&(t=="number"||t!="symbol"&&L6.test(r))&&r>-1&&r%1==0&&r<e}yb.exports=j6});var Lf=R((eW,bb)=>{var z6=9007199254740991;function H6(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=z6}bb.exports=H6});var Sb=R((tW,xb)=>{var V6=Es(),U6=Lf(),G6=Jn(),W6="[object Arguments]",K6="[object Array]",$6="[object Boolean]",J6="[object Date]",X6="[object Error]",Y6="[object Function]",Q6="[object Map]",Z6="[object Number]",eI="[object Object]",tI="[object RegExp]",rI="[object Set]",nI="[object String]",iI="[object WeakMap]",sI="[object ArrayBuffer]",oI="[object DataView]",aI="[object Float32Array]",cI="[object Float64Array]",lI="[object Int8Array]",uI="[object Int16Array]",hI="[object Int32Array]",dI="[object Uint8Array]",fI="[object Uint8ClampedArray]",pI="[object Uint16Array]",mI="[object Uint32Array]",it={};it[aI]=it[cI]=it[lI]=it[uI]=it[hI]=it[dI]=it[fI]=it[pI]=it[mI]=!0;it[W6]=it[K6]=it[sI]=it[$6]=it[oI]=it[J6]=it[X6]=it[Y6]=it[Q6]=it[Z6]=it[eI]=it[tI]=it[rI]=it[nI]=it[iI]=!1;function gI(r){return G6(r)&&U6(r.length)&&!!it[V6(r)]}xb.exports=gI});var cl=R((rW,wb)=>{function vI(r){return function(e){return r(e)}}wb.exports=vI});var ll=R((fa,Ps)=>{var yI=If(),Cb=typeof fa=="object"&&fa&&!fa.nodeType&&fa,pa=Cb&&typeof Ps=="object"&&Ps&&!Ps.nodeType&&Ps,bI=pa&&pa.exports===Cb,jf=bI&&yI.process,xI=function(){try{var r=pa&&pa.require&&pa.require("util").types;return r||jf&&jf.binding&&jf.binding("util")}catch{}}();Ps.exports=xI});var zf=R((nW,Tb)=>{var SI=Sb(),wI=cl(),Eb=ll(),_b=Eb&&Eb.isTypedArray,CI=_b?wI(_b):SI;Tb.exports=CI});var Hf=R((iW,Ab)=>{var EI=sb(),_I=Bf(),TI=ha(),AI=al(),DI=qf(),FI=zf(),PI=Object.prototype,II=PI.hasOwnProperty;function OI(r,e){var t=TI(r),n=!t&&_I(r),i=!t&&!n&&AI(r),s=!t&&!n&&!i&&FI(r),o=t||n||i||s,a=o?EI(r.length,String):[],c=a.length;for(var l in r)(e||II.call(r,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||DI(l,c)))&&a.push(l);return a}Ab.exports=OI});var ul=R((sW,Db)=>{var NI=Object.prototype;function RI(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||NI;return r===t}Db.exports=RI});var Vf=R((oW,Fb)=>{function kI(r,e){return function(t){return r(e(t))}}Fb.exports=kI});var Ib=R((aW,Pb)=>{var MI=Vf(),BI=MI(Object.keys,Object);Pb.exports=BI});var Nb=R((cW,Ob)=>{var qI=ul(),LI=Ib(),jI=Object.prototype,zI=jI.hasOwnProperty;function HI(r){if(!qI(r))return LI(r);var e=[];for(var t in Object(r))zI.call(r,t)&&t!="constructor"&&e.push(t);return e}Ob.exports=HI});var ma=R((lW,Rb)=>{var VI=il(),UI=Lf();function GI(r){return r!=null&&UI(r.length)&&!VI(r)}Rb.exports=GI});var hl=R((uW,kb)=>{var WI=Hf(),KI=Nb(),$I=ma();function JI(r){return $I(r)?WI(r):KI(r)}kb.exports=JI});var Bb=R((hW,Mb)=>{var XI=Ds(),YI=hl();function QI(r,e){return r&&XI(e,YI(e),r)}Mb.exports=QI});var Lb=R((dW,qb)=>{function ZI(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}qb.exports=ZI});var zb=R((fW,jb)=>{var eO=En(),tO=ul(),rO=Lb(),nO=Object.prototype,iO=nO.hasOwnProperty;function sO(r){if(!eO(r))return rO(r);var e=tO(r),t=[];for(var n in r)n=="constructor"&&(e||!iO.call(r,n))||t.push(n);return t}jb.exports=sO});var Is=R((pW,Hb)=>{var oO=Hf(),aO=zb(),cO=ma();function lO(r){return cO(r)?oO(r,!0):aO(r)}Hb.exports=lO});var Ub=R((mW,Vb)=>{var uO=Ds(),hO=Is();function dO(r,e){return r&&uO(e,hO(e),r)}Vb.exports=dO});var Uf=R((ga,Os)=>{var fO=Hr(),$b=typeof ga=="object"&&ga&&!ga.nodeType&&ga,Gb=$b&&typeof Os=="object"&&Os&&!Os.nodeType&&Os,pO=Gb&&Gb.exports===$b,Wb=pO?fO.Buffer:void 0,Kb=Wb?Wb.allocUnsafe:void 0;function mO(r,e){if(e)return r.slice();var t=r.length,n=Kb?Kb(t):new r.constructor(t);return r.copy(n),n}Os.exports=mO});var Gf=R((gW,Jb)=>{function gO(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}Jb.exports=gO});var Yb=R((vW,Xb)=>{function vO(r,e){for(var t=-1,n=r==null?0:r.length,i=0,s=[];++t<n;){var o=r[t];e(o,t,r)&&(s[i++]=o)}return s}Xb.exports=vO});var Wf=R((yW,Qb)=>{function yO(){return[]}Qb.exports=yO});var dl=R((bW,ex)=>{var bO=Yb(),xO=Wf(),SO=Object.prototype,wO=SO.propertyIsEnumerable,Zb=Object.getOwnPropertySymbols,CO=Zb?function(r){return r==null?[]:(r=Object(r),bO(Zb(r),function(e){return wO.call(r,e)}))}:xO;ex.exports=CO});var rx=R((xW,tx)=>{var EO=Ds(),_O=dl();function TO(r,e){return EO(r,_O(r),e)}tx.exports=TO});var Kf=R((SW,nx)=>{function AO(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}nx.exports=AO});var fl=R((wW,ix)=>{var DO=Vf(),FO=DO(Object.getPrototypeOf,Object);ix.exports=FO});var $f=R((CW,sx)=>{var PO=Kf(),IO=fl(),OO=dl(),NO=Wf(),RO=Object.getOwnPropertySymbols,kO=RO?function(r){for(var e=[];r;)PO(e,OO(r)),r=IO(r);return e}:NO;sx.exports=kO});var ax=R((EW,ox)=>{var MO=Ds(),BO=$f();function qO(r,e){return MO(r,BO(r),e)}ox.exports=qO});var Jf=R((_W,cx)=>{var LO=Kf(),jO=ha();function zO(r,e,t){var n=e(r);return jO(r)?n:LO(n,t(r))}cx.exports=zO});var ux=R((TW,lx)=>{var HO=Jf(),VO=dl(),UO=hl();function GO(r){return HO(r,UO,VO)}lx.exports=GO});var dx=R((AW,hx)=>{var WO=Jf(),KO=$f(),$O=Is();function JO(r){return WO(r,$O,KO)}hx.exports=JO});var px=R((DW,fx)=>{var XO=$n(),YO=Hr(),QO=XO(YO,"DataView");fx.exports=QO});var gx=R((FW,mx)=>{var ZO=$n(),eN=Hr(),tN=ZO(eN,"Promise");mx.exports=tN});var yx=R((PW,vx)=>{var rN=$n(),nN=Hr(),iN=rN(nN,"Set");vx.exports=iN});var xx=R((IW,bx)=>{var sN=$n(),oN=Hr(),aN=sN(oN,"WeakMap");bx.exports=aN});var pl=R((OW,Ax)=>{var Xf=px(),Yf=sl(),Qf=gx(),Zf=yx(),ep=xx(),Tx=Es(),Ns=Nf(),Sx="[object Map]",cN="[object Object]",wx="[object Promise]",Cx="[object Set]",Ex="[object WeakMap]",_x="[object DataView]",lN=Ns(Xf),uN=Ns(Yf),hN=Ns(Qf),dN=Ns(Zf),fN=Ns(ep),qi=Tx;(Xf&&qi(new Xf(new ArrayBuffer(1)))!=_x||Yf&&qi(new Yf)!=Sx||Qf&&qi(Qf.resolve())!=wx||Zf&&qi(new Zf)!=Cx||ep&&qi(new ep)!=Ex)&&(qi=function(r){var e=Tx(r),t=e==cN?r.constructor:void 0,n=t?Ns(t):"";if(n)switch(n){case lN:return _x;case uN:return Sx;case hN:return wx;case dN:return Cx;case fN:return Ex}return e});Ax.exports=qi});var Fx=R((NW,Dx)=>{var pN=Object.prototype,mN=pN.hasOwnProperty;function gN(r){var e=r.length,t=new r.constructor(e);return e&&typeof r[0]=="string"&&mN.call(r,"index")&&(t.index=r.index,t.input=r.input),t}Dx.exports=gN});var Ix=R((RW,Px)=>{var vN=Hr(),yN=vN.Uint8Array;Px.exports=yN});var ml=R((kW,Nx)=>{var Ox=Ix();function bN(r){var e=new r.constructor(r.byteLength);return new Ox(e).set(new Ox(r)),e}Nx.exports=bN});var kx=R((MW,Rx)=>{var xN=ml();function SN(r,e){var t=e?xN(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.byteLength)}Rx.exports=SN});var Bx=R((BW,Mx)=>{var wN=/\w*$/;function CN(r){var e=new r.constructor(r.source,wN.exec(r));return e.lastIndex=r.lastIndex,e}Mx.exports=CN});var Hx=R((qW,zx)=>{var qx=nl(),Lx=qx?qx.prototype:void 0,jx=Lx?Lx.valueOf:void 0;function EN(r){return jx?Object(jx.call(r)):{}}zx.exports=EN});var tp=R((LW,Vx)=>{var _N=ml();function TN(r,e){var t=e?_N(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}Vx.exports=TN});var Gx=R((jW,Ux)=>{var AN=ml(),DN=kx(),FN=Bx(),PN=Hx(),IN=tp(),ON="[object Boolean]",NN="[object Date]",RN="[object Map]",kN="[object Number]",MN="[object RegExp]",BN="[object Set]",qN="[object String]",LN="[object Symbol]",jN="[object ArrayBuffer]",zN="[object DataView]",HN="[object Float32Array]",VN="[object Float64Array]",UN="[object Int8Array]",GN="[object Int16Array]",WN="[object Int32Array]",KN="[object Uint8Array]",$N="[object Uint8ClampedArray]",JN="[object Uint16Array]",XN="[object Uint32Array]";function YN(r,e,t){var n=r.constructor;switch(e){case jN:return AN(r);case ON:case NN:return new n(+r);case zN:return DN(r,t);case HN:case VN:case UN:case GN:case WN:case KN:case $N:case JN:case XN:return IN(r,t);case RN:return new n;case kN:case qN:return new n(r);case MN:return FN(r);case BN:return new n;case LN:return PN(r)}}Ux.exports=YN});var $x=R((zW,Kx)=>{var QN=En(),Wx=Object.create,ZN=function(){function r(){}return function(e){if(!QN(e))return{};if(Wx)return Wx(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();Kx.exports=ZN});var rp=R((HW,Jx)=>{var eR=$x(),tR=fl(),rR=ul();function nR(r){return typeof r.constructor=="function"&&!rR(r)?eR(tR(r)):{}}Jx.exports=nR});var Yx=R((VW,Xx)=>{var iR=pl(),sR=Jn(),oR="[object Map]";function aR(r){return sR(r)&&iR(r)==oR}Xx.exports=aR});var tS=R((UW,eS)=>{var cR=Yx(),lR=cl(),Qx=ll(),Zx=Qx&&Qx.isMap,uR=Zx?lR(Zx):cR;eS.exports=uR});var nS=R((GW,rS)=>{var hR=pl(),dR=Jn(),fR="[object Set]";function pR(r){return dR(r)&&hR(r)==fR}rS.exports=pR});var aS=R((WW,oS)=>{var mR=nS(),gR=cl(),iS=ll(),sS=iS&&iS.isSet,vR=sS?gR(sS):mR;oS.exports=vR});var dS=R((KW,hS)=>{var yR=Rf(),bR=Q1(),xR=Mf(),SR=Bb(),wR=Ub(),CR=Uf(),ER=Gf(),_R=rx(),TR=ax(),AR=ux(),DR=dx(),FR=pl(),PR=Fx(),IR=Gx(),OR=rp(),NR=ha(),RR=al(),kR=tS(),MR=En(),BR=aS(),qR=hl(),LR=Is(),jR=1,zR=2,HR=4,cS="[object Arguments]",VR="[object Array]",UR="[object Boolean]",GR="[object Date]",WR="[object Error]",lS="[object Function]",KR="[object GeneratorFunction]",$R="[object Map]",JR="[object Number]",uS="[object Object]",XR="[object RegExp]",YR="[object Set]",QR="[object String]",ZR="[object Symbol]",e8="[object WeakMap]",t8="[object ArrayBuffer]",r8="[object DataView]",n8="[object Float32Array]",i8="[object Float64Array]",s8="[object Int8Array]",o8="[object Int16Array]",a8="[object Int32Array]",c8="[object Uint8Array]",l8="[object Uint8ClampedArray]",u8="[object Uint16Array]",h8="[object Uint32Array]",Ye={};Ye[cS]=Ye[VR]=Ye[t8]=Ye[r8]=Ye[UR]=Ye[GR]=Ye[n8]=Ye[i8]=Ye[s8]=Ye[o8]=Ye[a8]=Ye[$R]=Ye[JR]=Ye[uS]=Ye[XR]=Ye[YR]=Ye[QR]=Ye[ZR]=Ye[c8]=Ye[l8]=Ye[u8]=Ye[h8]=!0;Ye[WR]=Ye[lS]=Ye[e8]=!1;function gl(r,e,t,n,i,s){var o,a=e&jR,c=e&zR,l=e&HR;if(t&&(o=i?t(r,n,i,s):t(r)),o!==void 0)return o;if(!MR(r))return r;var d=NR(r);if(d){if(o=PR(r),!a)return ER(r,o)}else{var h=FR(r),u=h==lS||h==KR;if(RR(r))return CR(r,a);if(h==uS||h==cS||u&&!i){if(o=c||u?{}:OR(r),!a)return c?TR(r,wR(o,r)):_R(r,SR(o,r))}else{if(!Ye[h])return i?r:{};o=IR(r,h,a)}}s||(s=new yR);var f=s.get(r);if(f)return f;s.set(r,o),BR(r)?r.forEach(function(b){o.add(gl(b,e,t,b,r,s))}):kR(r)&&r.forEach(function(b,v){o.set(v,gl(b,e,t,v,r,s))});var g=l?c?DR:AR:c?LR:qR,m=d?void 0:g(r);return bR(m||r,function(b,v){m&&(v=b,b=r[v]),xR(o,v,gl(b,e,t,v,r,s))}),o}hS.exports=gl});var vl=R(($W,fS)=>{var d8=dS(),f8=1,p8=4;function m8(r){return d8(r,f8|p8)}fS.exports=m8});var np,ip,pS=J(()=>{np=ye(vl());ta();ip=class{constructor(e,t){typeof e=="number"?(this.ranges=[{length:0,primary:e,secondary:t}],this.lastPrimary=e,this.lastSecondary=t):(this.ranges=(0,np.default)(e.ranges),this.lastPrimary=e.lastPrimary,this.lastSecondary=e.lastSecondary)}get base(){return this.ranges[0].primary}get primaryHead(){return this.lastPrimary}get secondaryHead(){return this.lastSecondary}serialize(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:(0,np.default)(this.ranges)}}add(e,t){C(e>=this.lastPrimary,3),this.lastSecondary!==void 0&&C(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;let n=this.ranges[this.ranges.length-1],i=n.primary+n.length,s=n.secondary+n.length;t!==s&&(e===i?n.length===0?n.secondary=t:(n.length--,this.ranges.push({length:0,primary:e,secondary:t})):i+1===e&&s+1===t?n.length++:this.ranges.push({length:0,primary:e,secondary:t}))}get(e){C(e>=this.ranges[0].primary,5);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);C(e>=this.ranges[t-1].primary,6);let n=this.ranges[t-1];return Math.min(e-n.primary,n.length)+n.secondary}updateBase(e){C(e>=this.ranges[0].primary,7);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);C(e>=this.ranges[t-1].primary,8);let n=this.ranges[t-1],i=e-n.primary;n.secondary=n.secondary+Math.min(i,n.length),n.length=Math.max(n.length-i,0),n.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,C(e===this.ranges[0].primary,9)}}});var sp,mS=J(()=>{sp=class{constructor(e){this.windowMSec=e,this.requestMap=new Map}filter(e,t){let n=[],i=Date.now();for(let s of t){let o=`${e}/${s}`;if(!this.requestMap.has(o))this.requestMap.set(o,i),n.push(s);else{if(this.requestMap.get(o)+this.windowMSec>i)continue;this.requestMap.set(o,i),n.push(s)}}return n}}});function g8(r){let e;try{e=JSON.parse(r)}catch{}return e}var gS=J(()=>{});var Zt,va,vS=J(()=>{ta();Pf();Zt=class{constructor(e,t,n=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=n}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var n,i;if(!this.runningState)this.start(e,t);else{let s=e??this.runningState.intendedDuration,o=(i=t??((n=this.runningState.restart)===null||n===void 0?void 0:n.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,n){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:n,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){C(!!this.runningState,10);let e=this.runningState.restart;if(e!==void 0){let t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{let t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){let t=this.getCurrentTick()-e.startTick;return e.duration-t}},va=class{constructor(e,t){this.timer=new Zt(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}start(e,t){return y(this,null,function*(){return this.clear(),this.deferred=new Ee,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise})}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),C(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}});var Rs,yS=J(()=>{el();Rs=class r{constructor(e){this.startTick=e,this.lastTick=e}static start(){let e=le.now();return new r(e)}trace(){let e=le.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}});function ot(r,e="Unreachable Case"){throw new Error(e)}var bS=J(()=>{});var lr,xS=J(()=>{lr=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}});var SS=J(()=>{});var ya,wS=J(()=>{ya=r=>y(void 0,null,function*(){return new Promise(e=>setTimeout(()=>e(),r))})});function op(r){return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}var CS=J(()=>{});var ba={};Pi(ba,{BaseTelemetryNullLogger:()=>na,BatchManager:()=>Cf,Deferred:()=>Ee,EventForwarder:()=>Kn,Heap:()=>Tf,IsoBuffer:()=>kt,Lazy:()=>lr,LazyPromise:()=>At,NumberComparer:()=>GD,PromiseCache:()=>Ff,PromiseTimer:()=>va,RangeTracker:()=>ip,RateLimiter:()=>sp,TelemetryNullLogger:()=>ia,Timer:()=>Zt,Trace:()=>Rs,TypedEventEmitter:()=>be,Uint8ArrayToArrayBuffer:()=>op,Uint8ArrayToString:()=>cr,assert:()=>C,bufferToString:()=>Gn,delay:()=>ya,doIfNotDisposed:()=>Bi,extractLogSafeErrorProperties:()=>Af,fromBase64ToUtf8:()=>wf,fromUtf8ToBase64:()=>ra,gitHashFile:()=>Sf,hashFile:()=>iy,isArrayBuffer:()=>bf,performance:()=>le,safelyParseJSON:()=>g8,stringToBuffer:()=>Er,toUtf8:()=>qD,unreachableCase:()=>ot});var te=J(()=>{ta();el();ay();cy();ly();Sy();wy();Cy();Ey();Pf();pS();mS();gS();vS();yS();_f();bS();xS();SS();wS();CS();});var TS=R((JK,_S)=>{var ks=1e3,Ms=ks*60,Bs=Ms*60,ji=Bs*24,v8=ji*7,y8=ji*365.25;_S.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return b8(r);if(t==="number"&&isFinite(r))return e.long?S8(r):x8(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function b8(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*y8;case"weeks":case"week":case"w":return t*v8;case"days":case"day":case"d":return t*ji;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Bs;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ms;case"seconds":case"second":case"secs":case"sec":case"s":return t*ks;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function x8(r){var e=Math.abs(r);return e>=ji?Math.round(r/ji)+"d":e>=Bs?Math.round(r/Bs)+"h":e>=Ms?Math.round(r/Ms)+"m":e>=ks?Math.round(r/ks)+"s":r+"ms"}function S8(r){var e=Math.abs(r);return e>=ji?xl(r,e,ji,"day"):e>=Bs?xl(r,e,Bs,"hour"):e>=Ms?xl(r,e,Ms,"minute"):e>=ks?xl(r,e,ks,"second"):r+" ms"}function xl(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var DS=R((XK,AS)=>{function w8(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=TS(),t.destroy=l,Object.keys(r).forEach(d=>{t[d]=r[d]}),t.names=[],t.skips=[],t.formatters={};function e(d){let h=0;for(let u=0;u<d.length;u++)h=(h<<5)-h+d.charCodeAt(u),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(d){let h,u=null,f,g;function m(...b){if(!m.enabled)return;let v=m,x=Number(new Date),_=x-(h||x);v.diff=_,v.prev=h,v.curr=x,h=x,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let A=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(O,M)=>{if(O==="%%")return"%";A++;let S=t.formatters[M];if(typeof S=="function"){let E=b[A];O=S.call(v,E),b.splice(A,1),A--}return O}),t.formatArgs.call(v,b),(v.log||t.log).apply(v,b)}return m.namespace=d,m.useColors=t.useColors(),m.color=t.selectColor(d),m.extend=n,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(f!==t.namespaces&&(f=t.namespaces,g=t.enabled(d)),g),set:b=>{u=b}}),typeof t.init=="function"&&t.init(m),m}function n(d,h){let u=t(this.namespace+(typeof h>"u"?":":h)+d);return u.log=this.log,u}function i(d){t.save(d),t.namespaces=d,t.names=[],t.skips=[];let h,u=(typeof d=="string"?d:"").split(/[\s,]+/),f=u.length;for(h=0;h<f;h++)u[h]&&(d=u[h].replace(/\*/g,".*?"),d[0]==="-"?t.skips.push(new RegExp("^"+d.slice(1)+"$")):t.names.push(new RegExp("^"+d+"$")))}function s(){let d=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),d}function o(d){if(d[d.length-1]==="*")return!0;let h,u;for(h=0,u=t.skips.length;h<u;h++)if(t.skips[h].test(d))return!1;for(h=0,u=t.names.length;h<u;h++)if(t.names[h].test(d))return!0;return!1}function a(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function c(d){return d instanceof Error?d.stack||d.message:d}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}AS.exports=w8});var cp=R((_r,Sl)=>{_r.formatArgs=E8;_r.save=_8;_r.load=T8;_r.useColors=C8;_r.storage=A8();_r.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();_r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function C8(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function E8(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Sl.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}_r.log=console.debug||console.log||(()=>{});function _8(r){try{r?_r.storage.setItem("debug",r):_r.storage.removeItem("debug")}catch{}}function T8(){let r;try{r=_r.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function A8(){try{return localStorage}catch{}}Sl.exports=DS()(_r);var{formatters:D8}=Sl.exports;D8.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});function FS(r){switch(r){case"boolean":case"number":case"string":return!0;default:return!1}}function PS(r){let e=r,t;if(typeof r=="string")try{e=JSON.parse(r),t={raw:r,string:r}}catch{}if(e===void 0)return t;let n=typeof e;if(FS(n))return Object.assign(Object.assign({},t),{raw:r,[n]:e});if(Array.isArray(e)){let i=typeof e[0];if(!FS(i))return t;for(let s of e)if(typeof s!==i)return t;return Object.assign(Object.assign({},t),{raw:r,[`${i}[]`]:e})}return t}function wl(r){let e=r;return IS(e?.config)&&e?.logger!==void 0}function ur(r){return wl(r)?r:zi(r,Ca.value)}function zi(r,...e){if(wl(r))throw new Error("Logger is already a monitoring context");let t=r;return t.config=new qs(...e),t.logger=r,t}function IS(r){let e=r;return typeof e?.getRawConfig=="function"}var Ca,F8,P8,I8,qs,lp=J(()=>{te();Ca=new lr(()=>P8(I8())),F8={getRawConfig:()=>{}},P8=r=>r!=null?new qs({getRawConfig:e=>{var t,n;try{return(n=PS((t=r.getItem(e))!==null&&t!==void 0?t:void 0))===null||n===void 0?void 0:n.raw}catch{}}}):F8;I8=()=>{try{return sessionStorage!==null?sessionStorage:void 0}catch{return}},qs=class r{constructor(...e){this.configCache=new Map,this.orderedBaseProviders=[];let t=new Set,n=[...e];for(;n.length>0;){let i=n.shift();i!==void 0&&IS(i)&&!t.has(i)&&(t.add(i),i instanceof r?n.push(...i.orderedBaseProviders):this.orderedBaseProviders.push(i))}}getBoolean(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.boolean}getNumber(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.number}getString(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.string}getBooleanArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["boolean[]"]}getNumberArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["number[]"]}getStringArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["string[]"]}getRawConfig(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.raw}getCacheEntry(e){if(!this.configCache.has(e)){for(let t of this.orderedBaseProviders){let n=PS(t?.getRawConfig(e));if(n!==void 0)return this.configCache.set(e,n),n}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}});function Ea(){if(!Cl&&(Cl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Cl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Cl(O8)}var Cl,O8,up=J(()=>{O8=new Uint8Array(16)});var OS,NS=J(()=>{OS=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i});function N8(r){return typeof r=="string"&&OS.test(r)}var Qn,_a=J(()=>{NS();Qn=N8});function R8(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Mt[r[e+0]]+Mt[r[e+1]]+Mt[r[e+2]]+Mt[r[e+3]]+"-"+Mt[r[e+4]]+Mt[r[e+5]]+"-"+Mt[r[e+6]]+Mt[r[e+7]]+"-"+Mt[r[e+8]]+Mt[r[e+9]]+"-"+Mt[r[e+10]]+Mt[r[e+11]]+Mt[r[e+12]]+Mt[r[e+13]]+Mt[r[e+14]]+Mt[r[e+15]]).toLowerCase();if(!Qn(t))throw TypeError("Stringified UUID is invalid");return t}var Mt,El,Zn,Ta=J(()=>{_a();Mt=[];for(El=0;El<256;++El)Mt.push((El+256).toString(16).substr(1));Zn=R8});function k8(r,e,t){var n=e&&t||0,i=e||new Array(16);r=r||{};var s=r.node||RS,o=r.clockseq!==void 0?r.clockseq:hp;if(s==null||o==null){var a=r.random||(r.rng||Ea)();s==null&&(s=RS=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),o==null&&(o=hp=(a[6]<<8|a[7])&16383)}var c=r.msecs!==void 0?r.msecs:Date.now(),l=r.nsecs!==void 0?r.nsecs:fp+1,d=c-dp+(l-fp)/1e4;if(d<0&&r.clockseq===void 0&&(o=o+1&16383),(d<0||c>dp)&&r.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");dp=c,fp=l,hp=o,c+=122192928e5;var h=((c&268435455)*1e4+l)%4294967296;i[n++]=h>>>24&255,i[n++]=h>>>16&255,i[n++]=h>>>8&255,i[n++]=h&255;var u=c/4294967296*1e4&268435455;i[n++]=u>>>8&255,i[n++]=u&255,i[n++]=u>>>24&15|16,i[n++]=u>>>16&255,i[n++]=o>>>8|128,i[n++]=o&255;for(var f=0;f<6;++f)i[n+f]=s[f];return e||Zn(i)}var RS,hp,dp,fp,kS,MS=J(()=>{up();Ta();dp=0,fp=0;kS=k8});function M8(r){if(!Qn(r))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var _l,pp=J(()=>{_a();_l=M8});function B8(r){r=unescape(encodeURIComponent(r));for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}function Tl(r,e,t){function n(i,s,o,a){if(typeof i=="string"&&(i=B8(i)),typeof s=="string"&&(s=_l(s)),s.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(var l=0;l<16;++l)o[a+l]=c[l];return o}return Zn(c)}try{n.name=r}catch{}return n.DNS=q8,n.URL=L8,n}var q8,L8,mp=J(()=>{Ta();pp();q8="6ba7b810-9dad-11d1-80b4-00c04fd430c8",L8="6ba7b811-9dad-11d1-80b4-00c04fd430c8"});function j8(r){if(typeof r=="string"){var e=unescape(encodeURIComponent(r));r=new Uint8Array(e.length);for(var t=0;t<e.length;++t)r[t]=e.charCodeAt(t)}return z8(H8(V8(r),r.length*8))}function z8(r){for(var e=[],t=r.length*32,n="0123456789abcdef",i=0;i<t;i+=8){var s=r[i>>5]>>>i%32&255,o=parseInt(n.charAt(s>>>4&15)+n.charAt(s&15),16);e.push(o)}return e}function BS(r){return(r+64>>>9<<4)+14+1}function H8(r,e){r[e>>5]|=128<<e%32,r[BS(e)-1]=e;for(var t=1732584193,n=-271733879,i=-1732584194,s=271733878,o=0;o<r.length;o+=16){var a=t,c=n,l=i,d=s;t=Ut(t,n,i,s,r[o],7,-680876936),s=Ut(s,t,n,i,r[o+1],12,-389564586),i=Ut(i,s,t,n,r[o+2],17,606105819),n=Ut(n,i,s,t,r[o+3],22,-1044525330),t=Ut(t,n,i,s,r[o+4],7,-176418897),s=Ut(s,t,n,i,r[o+5],12,1200080426),i=Ut(i,s,t,n,r[o+6],17,-1473231341),n=Ut(n,i,s,t,r[o+7],22,-45705983),t=Ut(t,n,i,s,r[o+8],7,1770035416),s=Ut(s,t,n,i,r[o+9],12,-1958414417),i=Ut(i,s,t,n,r[o+10],17,-42063),n=Ut(n,i,s,t,r[o+11],22,-1990404162),t=Ut(t,n,i,s,r[o+12],7,1804603682),s=Ut(s,t,n,i,r[o+13],12,-40341101),i=Ut(i,s,t,n,r[o+14],17,-1502002290),n=Ut(n,i,s,t,r[o+15],22,1236535329),t=Gt(t,n,i,s,r[o+1],5,-165796510),s=Gt(s,t,n,i,r[o+6],9,-1069501632),i=Gt(i,s,t,n,r[o+11],14,643717713),n=Gt(n,i,s,t,r[o],20,-373897302),t=Gt(t,n,i,s,r[o+5],5,-701558691),s=Gt(s,t,n,i,r[o+10],9,38016083),i=Gt(i,s,t,n,r[o+15],14,-660478335),n=Gt(n,i,s,t,r[o+4],20,-405537848),t=Gt(t,n,i,s,r[o+9],5,568446438),s=Gt(s,t,n,i,r[o+14],9,-1019803690),i=Gt(i,s,t,n,r[o+3],14,-187363961),n=Gt(n,i,s,t,r[o+8],20,1163531501),t=Gt(t,n,i,s,r[o+13],5,-1444681467),s=Gt(s,t,n,i,r[o+2],9,-51403784),i=Gt(i,s,t,n,r[o+7],14,1735328473),n=Gt(n,i,s,t,r[o+12],20,-1926607734),t=Wt(t,n,i,s,r[o+5],4,-378558),s=Wt(s,t,n,i,r[o+8],11,-2022574463),i=Wt(i,s,t,n,r[o+11],16,1839030562),n=Wt(n,i,s,t,r[o+14],23,-35309556),t=Wt(t,n,i,s,r[o+1],4,-1530992060),s=Wt(s,t,n,i,r[o+4],11,1272893353),i=Wt(i,s,t,n,r[o+7],16,-155497632),n=Wt(n,i,s,t,r[o+10],23,-1094730640),t=Wt(t,n,i,s,r[o+13],4,681279174),s=Wt(s,t,n,i,r[o],11,-358537222),i=Wt(i,s,t,n,r[o+3],16,-722521979),n=Wt(n,i,s,t,r[o+6],23,76029189),t=Wt(t,n,i,s,r[o+9],4,-640364487),s=Wt(s,t,n,i,r[o+12],11,-421815835),i=Wt(i,s,t,n,r[o+15],16,530742520),n=Wt(n,i,s,t,r[o+2],23,-995338651),t=Kt(t,n,i,s,r[o],6,-198630844),s=Kt(s,t,n,i,r[o+7],10,1126891415),i=Kt(i,s,t,n,r[o+14],15,-1416354905),n=Kt(n,i,s,t,r[o+5],21,-57434055),t=Kt(t,n,i,s,r[o+12],6,1700485571),s=Kt(s,t,n,i,r[o+3],10,-1894986606),i=Kt(i,s,t,n,r[o+10],15,-1051523),n=Kt(n,i,s,t,r[o+1],21,-2054922799),t=Kt(t,n,i,s,r[o+8],6,1873313359),s=Kt(s,t,n,i,r[o+15],10,-30611744),i=Kt(i,s,t,n,r[o+6],15,-1560198380),n=Kt(n,i,s,t,r[o+13],21,1309151649),t=Kt(t,n,i,s,r[o+4],6,-145523070),s=Kt(s,t,n,i,r[o+11],10,-1120210379),i=Kt(i,s,t,n,r[o+2],15,718787259),n=Kt(n,i,s,t,r[o+9],21,-343485551),t=ei(t,a),n=ei(n,c),i=ei(i,l),s=ei(s,d)}return[t,n,i,s]}function V8(r){if(r.length===0)return[];for(var e=r.length*8,t=new Uint32Array(BS(e)),n=0;n<e;n+=8)t[n>>5]|=(r[n/8]&255)<<n%32;return t}function ei(r,e){var t=(r&65535)+(e&65535),n=(r>>16)+(e>>16)+(t>>16);return n<<16|t&65535}function U8(r,e){return r<<e|r>>>32-e}function Al(r,e,t,n,i,s){return ei(U8(ei(ei(e,r),ei(n,s)),i),t)}function Ut(r,e,t,n,i,s,o){return Al(e&t|~e&n,r,e,i,s,o)}function Gt(r,e,t,n,i,s,o){return Al(e&n|t&~n,r,e,i,s,o)}function Wt(r,e,t,n,i,s,o){return Al(e^t^n,r,e,i,s,o)}function Kt(r,e,t,n,i,s,o){return Al(t^(e|~n),r,e,i,s,o)}var qS,LS=J(()=>{qS=j8});var G8,jS,zS=J(()=>{mp();LS();G8=Tl("v3",48,qS),jS=G8});function W8(r,e,t){r=r||{};var n=r.random||(r.rng||Ea)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return Zn(n)}var Te,HS=J(()=>{up();Ta();Te=W8});function K8(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function gp(r,e){return r<<e|r>>>32-e}function $8(r){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var i=0;i<n.length;++i)r.push(n.charCodeAt(i))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var s=r.length/4+2,o=Math.ceil(s/16),a=new Array(o),c=0;c<o;++c){for(var l=new Uint32Array(16),d=0;d<16;++d)l[d]=r[c*64+d*4]<<24|r[c*64+d*4+1]<<16|r[c*64+d*4+2]<<8|r[c*64+d*4+3];a[c]=l}a[o-1][14]=(r.length-1)*8/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=(r.length-1)*8&4294967295;for(var h=0;h<o;++h){for(var u=new Uint32Array(80),f=0;f<16;++f)u[f]=a[h][f];for(var g=16;g<80;++g)u[g]=gp(u[g-3]^u[g-8]^u[g-14]^u[g-16],1);for(var m=t[0],b=t[1],v=t[2],x=t[3],_=t[4],A=0;A<80;++A){var D=Math.floor(A/20),O=gp(m,5)+K8(D,b,v,x)+_+e[D]+u[A]>>>0;_=x,x=v,v=gp(b,30)>>>0,b=m,m=O}t[0]=t[0]+m>>>0,t[1]=t[1]+b>>>0,t[2]=t[2]+v>>>0,t[3]=t[3]+x>>>0,t[4]=t[4]+_>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var VS,US=J(()=>{VS=$8});var J8,GS,WS=J(()=>{mp();US();J8=Tl("v5",80,VS),GS=J8});var KS,$S=J(()=>{KS="00000000-0000-0000-0000-000000000000"});function X8(r){if(!Qn(r))throw TypeError("Invalid UUID");return parseInt(r.substr(14,1),16)}var JS,XS=J(()=>{_a();JS=X8});var Aa={};Pi(Aa,{NIL:()=>KS,parse:()=>_l,stringify:()=>Zn,v1:()=>kS,v3:()=>jS,v4:()=>Te,v5:()=>GS,validate:()=>Qn,version:()=>JS});var Dt=J(()=>{MS();zS();HS();WS();$S();XS();_a();Ta();pp()});function Da(r){return typeof r?.errorType=="string"&&typeof r?.message=="string"&&Dl(r)&&YS(r)}function Fl(r){return typeof r?.errorType=="string"&&typeof r?.message=="string"&&YS(r)}var YS,Dl,vp=J(()=>{YS=r=>typeof r?.getTelemetryProperties=="function"&&typeof r?.addTelemetryProperties=="function",Dl=r=>typeof r?.errorInstanceId=="string"});function Fa(r,e){let t=(s,o)=>{if(!e)return s;let a=s.split(`
`);return a.shift(),o!==void 0&&a.unshift(o),a.join(`
`)},i={message:typeof r?.message=="string"?r.message:String(r)};if(Y8(r)){let{errorType:s,stack:o,name:a}=r;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){let c=typeof a=="string"?a:void 0;i.stack=t(o,c)}}return i}function Q8(r,e){for(let t of Object.keys(e))r[t]===void 0&&(r[t]=e[t])}function Z8(r){let e=r;e.errorInstanceId===void 0&&(e.errorInstanceId=Te())}function $t(r,e={}){var t;if(Fl(r)&&Z8(r),Da(r))return r.addTelemetryProperties((t=e.props)!==null&&t!==void 0?t:{}),r;let{message:n,stack:i}=Fa(r,!1),s=new ew({message:n,stack:i});if(typeof r=="object"&&r!==null){let{canRetry:a,retryAfterSeconds:c}=r;Object.assign($t,{canRetry:a,retryAfterSeconds:c})}typeof r!="object"&&s.addTelemetryProperties({typeofError:typeof r});let o=Pa(r)?r.getTelemetryProperties():{};return s.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},o),e.props),{untrustedOrigin:1})),s}function Ls(){let r=new Error("<<generated stack>>");if(yp===void 0&&(yp=r.stack!==void 0),yp)return r;try{throw r}catch(e){return e}}function bp(){return Ls().stack}function ti(r,e){let{message:t,stack:n}=Fa(r,!1),i=e(t);return n!==void 0&&QS(i,n),Pl(r)&&i.addTelemetryProperties({untrustedOrigin:1}),Dl(r)&&(i.overwriteErrorInstanceId(r.errorInstanceId),i.addTelemetryProperties({innerErrorInstanceId:r.errorInstanceId})),Pa(r)&&i.addTelemetryProperties(r.getTelemetryProperties()),i}function Ia(r,e,t){let n=ti(r,e),i=n.errorInstanceId,s=i;return t.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:i,wrappedByErrorInstanceId:s},r),n}function QS(r,e){try{Object.assign(r,{stack:e})}catch{r.addTelemetryProperties({stack2:e})}}function Pl(r){return!Fl(r)||r.getTelemetryProperties().untrustedOrigin===1&&r.errorType===ew.normalizedErrorType}function ZS(r){return typeof r?.value!="object"&&typeof r?.tag=="string"}function ek(r,e){let t={};for(let n of Object.keys(r)){if(e.has(n))continue;let i=r[n];switch(typeof i){case"string":case"number":case"boolean":case"undefined":t[n]=i;break;default:{ZS(i)?t[n]=i:t[n]="REDACTED (arbitrary object)";break}}}return t}var Y8,Pa,yp,xp,Re,ew,Sp=J(()=>{Dt();vp();Y8=r=>r!==null&&!Array.isArray(r)&&typeof r=="object";Pa=r=>typeof r?.getTelemetryProperties=="function";xp=()=>{let r=new WeakSet;return(e,t)=>{if(typeof t=="object"&&t!==null){if(r.has(t))return"<removed/circular>";r.add(t)}return t}},Re=class extends Error{constructor(e,t,n=new Set){super(e),this.omitPropsFromLogging=n,this._errorInstanceId=Te(),this.fluidErrorCode="-",n.add("omitPropsFromLogging"),n.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(e){this._errorInstanceId=e}addTelemetryProperties(e){Q8(this,e)}getTelemetryProperties(){let e=ek(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}},ew=(()=>{class r extends Re{constructor(t){super(t.message),this.errorType=r.normalizedErrorType,t.stack!==void 0&&QS(this,t.stack)}}return r.normalizedErrorType="genericError",r})()});var Ne,Qe,Oa,ue,Na,ce,wp,Il=J(()=>{te();lp();Sp();Ne=function(r){return r.PackageData="PackageData",r.CodeArtifact="CodeArtifact",r.UserData="UserData",r}(Ne||{}),Qe=(()=>{class r{constructor(t,n){this.namespace=t,this.properties=n}static formatTick(t){return Math.floor(t)}static numberFromString(t){if(t==null)return;let n=Number(t);return Number.isNaN(n)?t:n}static sanitizePkgName(t){return t.replace("@","").replace("/","-")}static prepareErrorObject(t,n,i){let{message:s,errorType:o,stack:a}=Fa(n,!0);if(t.stack=a,t.error=s,t.errorType=o,Pa(n)){let c=n.getTelemetryProperties();for(let l of Object.keys(c))t[l]===void 0&&(t[l]=c[l])}t.stack===void 0&&i&&(t.stack=bp())}sendTelemetryEvent(t,n){var i;this.sendTelemetryEventCore(Object.assign(Object.assign({},t),{category:(i=t.category)!==null&&i!==void 0?i:"generic"}),n)}sendTelemetryEventCore(t,n){let i=Object.assign({},t);n!==void 0&&r.prepareErrorObject(i,n,!1),typeof i.duration=="number"&&(i.duration=r.formatTick(i.duration)),this.send(i)}sendErrorEvent(t,n){this.sendTelemetryEventCore(Object.assign(Object.assign({error:t.eventName},t),{category:"error"}),n)}sendPerformanceEvent(t,n){var i;let s=Object.assign(Object.assign({},t),{category:(i=t.category)!==null&&i!==void 0?i:"performance"});this.sendTelemetryEventCore(s,n)}prepareEvent(t){let n=t.category==="error"||t.error!==void 0,i=Object.assign({},t);if(this.namespace!==void 0&&(i.eventName=`${this.namespace}${r.eventNamespaceSeparator}${i.eventName}`),this.properties){let s=[];s.push(this.properties.all),n&&s.push(this.properties.error);for(let o of s)if(o!==void 0)for(let a of Object.keys(o)){if(t[a]!==void 0)continue;let c=o[a],l=typeof c=="function"?c():c;l!==void 0&&(i[a]=l)}}return i}}return r.eventNamespaceSeparator=":",r})(),Oa=class{constructor(e){this.logger=e}send(e){let t={category:e.category,eventName:e.eventName};for(let n of Object.keys(e)){let i=e[n],{value:s,tag:o}=typeof i=="object"?i:{value:i,tag:void 0};switch(o){case void 0:t[n]=s;break;case Ne.PackageData:t[n]=s;break;case Ne.UserData:t[n]="REDACTED (UserData)";break;default:t[n]="REDACTED (unknown tag)";break}}this.logger.send(t)}},ue=class r extends Qe{constructor(e,t,n){super(t,n),this.baseLogger=e,wl(e)&&zi(this,new qs(e.config))}static create(e,t,n){if(e instanceof r){let i={};for(let o of[e.properties,n])o!==void 0&&(o.all!==void 0&&(i.all=Object.assign(Object.assign({},i.all),o.all)),o.error!==void 0&&(i.error=Object.assign(Object.assign({},i.error),o.error)));let s=e.namespace===void 0?t:t===void 0?e.namespace:`${e.namespace}${Qe.eventNamespaceSeparator}${t}`;return new r(e.baseLogger,s,i)}return new r(e||new na,t,n)}send(e){this.baseLogger.send(this.prepareEvent(e))}},Na=class extends Qe{constructor(e,t){super(e,t),this.loggers=[]}addLogger(e){e!=null&&this.loggers.push(e)}send(e){let t=this.prepareEvent(e);this.loggers.forEach(n=>{n.send(t)})}},ce=class r{constructor(e,t,n={end:!0,cancel:"generic"}){this.logger=e,this.markers=n,this.startTime=le.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),typeof window=="object"&&window!=null&&window.performance&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}static start(e,t,n){return new r(e,t,n)}static timedExec(e,t,n,i){let s=r.start(e,t,i);try{let o=n(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}}static timedExecAsync(e,t,n,i){return y(this,null,function*(){let s=r.start(e,t,i);try{let o=yield n(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}})}get duration(){return le.now()-this.startTime}reportProgress(e,t="update"){this.reportEvent(t,e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){let e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){this.markers.cancel!==void 0&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,n){if(!this.event)return;let i=Object.assign(Object.assign({},this.event),t);i.eventName=`${i.eventName}_${e}`,e!=="start"&&(i.duration=this.duration),this.logger.sendPerformanceEvent(i,n)}},wp=class{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){this.reportError("errorEvent in UT logger!",e,t)}sendPerformanceEvent(e,t){}logGenericError(e,t){this.reportError("genericError in UT logger!",{eventName:e},t)}logException(e,t){this.reportError("exception in UT logger!",e,t)}debugAssert(e,t){this.reportError("debugAssert in UT logger!")}shipAssert(e,t){this.reportError("shipAssert in UT logger!")}reportError(e,t,n){let i=new Error(e);throw i.error=i,i.event=t,console.error(e),console.error(i),i}}});var Cp,Ra,tw=J(()=>{te();Cp=ye(cp());Il();Ra=class r extends Qe{constructor(e,t,n){super(void 0,n),this.debug=e,this.debugErr=t}static create(e,t){let n=(0,Cp.debug)(e),i=(0,Cp.debug)(e);return i.log=console.error.bind(console),i.enabled=!0,new r(n,i,t)}static mixinDebugLogger(e,t,n){if(!t)return r.create(e,n);let i=new Na(void 0,n);return i.addLogger(r.create(e,this.tryGetBaseLoggerProps(t))),i.addLogger(ue.create(t,e)),i}static tryGetBaseLoggerProps(e){if(e instanceof Qe)return e.properties}send(e){let t=this.prepareEvent(e),n=t.category==="error",i=n?this.debugErr:this.debug,s=e.eventName.lastIndexOf(Qe.eventNamespaceSeparator),o=e.eventName.substring(s+1);s>0&&(i=i.extend(e.eventName.substring(0,s))),t.eventName=void 0;let a="";a=`tick=${Qe.formatTick(le.now())}`;let c=t.stack?t.stack:"";t.stack=void 0;let l;try{l=JSON.stringify(t)}catch{t.error=void 0,l=JSON.stringify(t)}l==="{}"&&(l=""),n&&(i.enabled=!0),i(`${o} ${l} ${a} ${c}`)}}});var _n,rw=J(()=>{te();_n=class extends be{constructor(e){super(),this.errorHandler=e}emit(e,...t){try{return super.emit(e,...t)}catch(n){return this.errorHandler(e,n),!0}}}});function Ep(r,e,t,...n){try{r.emit(t,...n)}catch(i){e.sendErrorEvent({eventName:"RaiseEventError",event:t},i)}}function Hi(r,e,t,n){try{t?e.emit(Ol,n):e.emit(Nl)}catch(i){r.sendErrorEvent({eventName:"RaiseConnectedEventError"},i)}}var Ol,Nl,nw=J(()=>{Ol="connected",Nl="disconnected"});var _p,iw=J(()=>{Il();_p=class r extends Qe{constructor(){super(),this.events=[]}clear(){this.events=[]}send(e){this.events.push(e)}matchEvents(e){let t=this.getMatchedEventsCount(e);return e.length-t===0}assertMatch(e,t){let n=this.events;if(!this.matchEvents(e))throw new Error(`${t}
expected:
${JSON.stringify(e)}

actual:
${JSON.stringify(n)}`)}matchAnyEvent(e){return this.getMatchedEventsCount(e)>0}assertMatchAny(e,t){let n=this.events;if(!this.matchAnyEvent(e))throw new Error(`${t}
expected:
${JSON.stringify(e)}

actual:
${JSON.stringify(n)}`)}getMatchedEventsCount(e){let t=0;return this.events.forEach(n=>{t<e.length&&r.eventsMatch(n,e[t])&&++t}),this.events=[],t}static eventsMatch(e,t){let n=Object.assign(Object.assign({},e),t);return JSON.stringify(n)===JSON.stringify(e)}}});var Vi,sw=J(()=>{Vi=class{constructor(e,t,n=e){this.threshold=e,this.logger=t,this.thresholdMultiple=n}send(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}sendIfMultiple(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=this.thresholdMultiple*2)}}});function Tp(r,e,t){if(r)return!0;let n=typeof t=="string"?{eventName:t,category:"error"}:Object.assign({category:"error"},t);return e.send(n),!1}var ow=J(()=>{});var js,aw=J(()=>{te();js=class{constructor(e,t,n,i=!1,s=new Map){this.eventBase=e,this.logger=t,this.sampleThreshold=n,this.includeAggregateMetrics=i,this.perBucketProperties=s,this.disposed=!1,this.measurementsMap=new Map}measure(e,t=""){var n,i,s;let o=le.now(),a=e(),c=le.now()-o,l=this.measurementsMap.get(t);return l===void 0&&(l={count:0,duration:-1},this.measurementsMap.set(t,l)),l.count++,l.duration=c,this.includeAggregateMetrics&&(l.totalDuration=((n=l.totalDuration)!==null&&n!==void 0?n:0)+c,l.minDuration=Math.min((i=l.minDuration)!==null&&i!==void 0?i:c,c),l.maxDuration=Math.max((s=l.maxDuration)!==null&&s!==void 0?s:0,c)),l.count>=this.sampleThreshold&&this.flushBucket(t),a}flushBucket(e){let t=this.measurementsMap.get(e);if(t!==void 0&&t.count!==0){let n=this.perBucketProperties.get(e),i=Object.assign(Object.assign(Object.assign({},this.eventBase),n),t);this.logger.sendPerformanceEvent(i),this.measurementsMap.delete(e)}}dispose(e){this.measurementsMap.forEach((t,n)=>this.flushBucket(n))}}});var Ap={};Pi(Ap,{ChildLogger:()=>ue,DebugLogger:()=>Ra,EventEmitterWithErrorHandling:()=>_n,LoggingError:()=>Re,MockLogger:()=>_p,MultiSinkLogger:()=>Na,PerformanceEvent:()=>ce,SampledTelemetryHelper:()=>js,TaggedLoggerAdapter:()=>Oa,TelemetryDataTag:()=>Ne,TelemetryLogger:()=>Qe,TelemetryUTLogger:()=>wp,ThresholdCounter:()=>Vi,connectedEventName:()=>Ol,disconnectedEventName:()=>Nl,extractLogSafeErrorProperties:()=>Fa,generateErrorWithStack:()=>Ls,generateStack:()=>bp,getCircularReplacer:()=>xp,hasErrorInstanceId:()=>Dl,isExternalError:()=>Pl,isFluidError:()=>Da,isILoggingError:()=>Pa,isTaggedTelemetryPropertyValue:()=>ZS,isValidLegacyError:()=>Fl,logIfFalse:()=>Tp,loggerToMonitoringContext:()=>ur,mixinMonitoringContext:()=>zi,normalizeError:()=>$t,raiseConnectedEvent:()=>Hi,safeRaiseEvent:()=>Ep,sessionStorageConfigProvider:()=>Ca,wrapError:()=>ti,wrapErrorAndLog:()=>Ia});var xe=J(()=>{tw();Sp();rw();nw();vp();Il();iw();sw();ow();aw();lp();});var cw=J(()=>{});var lw=J(()=>{});var uw=J(()=>{});var ri,hw=J(()=>{ri=function(r){return r.NoOp="noop",r.ClientJoin="join",r.ClientLeave="leave",r.Propose="propose",r.Reject="reject",r.Summarize="summarize",r.SummaryAck="summaryAck",r.SummaryNack="summaryNack",r.Operation="op",r.RemoteHelp="remoteHelp",r.NoClient="noClient",r.RoundTrip="tripComplete",r.Control="control",r}(ri||{})});var Ui,ka,dw=J(()=>{Ui=function(r){return r.File="100644",r.Executable="100755",r.Directory="040000",r.Symlink="120000",r}(Ui||{}),ka=function(r){return r.Blob="Blob",r.Tree="Tree",r.Attachment="Attachment",r}(ka||{})});var nn,fw=J(()=>{nn=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(nn||{})});var pw=J(()=>{});var mw=J(()=>{});var gw=J(()=>{});var vw=J(()=>{});var Dp=J(()=>{cw();lw();uw();hw();dw();fw();pw();mw();gw();vw();});function yw(r){let e=r.type===nn.Handle?r.handleType:r.type;switch(e){case nn.Blob:case nn.Attachment:return Ui.File;case nn.Tree:return Ui.Directory;default:ot(e,`Unknown type: ${e}`)}}function Ml(r){let e=r.type===nn.Handle?r.handleType:r.type;switch(e){case nn.Blob:case nn.Attachment:return"blob";case nn.Tree:return"tree";default:ot(e,`Unknown type: ${e}`)}}function Hs(r,e=new Map,t=!1){let n={},i={id:r.sha,blobs:{},trees:{}};n[""]=i;for(let s of r.tree){let o=t?s.path.replace(/^\.app\//,""):s.path,a=o.lastIndexOf("/"),c=o.slice(0,Math.max(0,a)),l=o.slice(a+1),d=n[c];if(s.type==="tree"){let h={id:s.sha,blobs:{},commits:{},trees:{}};d.trees[decodeURIComponent(l)]=h,n[o]=h}else if(s.type==="blob")d.blobs[decodeURIComponent(l)]=s.sha,e.set(s.sha,`/${o}`);else throw new Error("Unknown entry type!!")}return i}var zs,Rl,kl,bw=J(()=>{Dp();te();zs=class{constructor(e,t,n="utf-8"){this.path=e,this.mode=Ui.File,this.type=ka.Blob,this.value={contents:t,encoding:n}}},Rl=class{constructor(e,t){this.path=e,this.value=t,this.mode=Ui.Directory,this.type=ka.Tree}},kl=class{constructor(e,t){this.path=e,this.id=t,this.mode=Ui.File,this.type=ka.Attachment,this.value={id:t}}}});var xw,Bl,ql,Fp,Pp,Ll,Ip=J(()=>{xw=ye(Wn()),Bl=ye(vl());te();ql=class{constructor(e,t,n,i){this.sequenceNumber=e,this.key=t,this.value=n,this.local=i}},Fp=class extends be{constructor(e){super(),this.isDisposed=!1,this.members=new Map(e),this.snapshotCache=e}get disposed(){return this.isDisposed}snapshot(){var e;return(e=this.snapshotCache)!==null&&e!==void 0||(this.snapshotCache=(0,Bl.default)(Array.from(this.members))),this.snapshotCache}addMember(e,t){C(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}removeMember(e){C(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}dispose(){this.isDisposed=!0}},Pp=class extends be{constructor(e,t){super(),this.sendProposal=t,this.isDisposed=!1,this.stateEvents=new xw.EventEmitter,this.proposals=new Map(e.proposals.map(([,n])=>[n.sequenceNumber,new ql(n.sequenceNumber,n.key,n.value,!1)])),this.values=new Map(e.values),this.proposalsSnapshotCache=e.proposals,this.valuesSnapshotCache=e.values}get disposed(){return this.isDisposed}snapshot(){var e,t;return(e=this.proposalsSnapshotCache)!==null&&e!==void 0||(this.proposalsSnapshotCache=Array.from(this.proposals).map(([n,i])=>[n,{sequenceNumber:n,key:i.key,value:i.value},[]])),(t=this.valuesSnapshotCache)!==null&&t!==void 0||(this.valuesSnapshotCache=(0,Bl.default)(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(e){return this.values.has(e)}get(e){var t;return(t=this.values.get(e))===null||t===void 0?void 0:t.value}getApprovalData(e){let t=this.values.get(e);return t?(0,Bl.default)(t):void 0}propose(e,t){return y(this,null,function*(){let n=this.sendProposal(e,t);if(n<0)throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:e}),new Error("Can't propose in disconnected state");return new Promise((i,s)=>{let o,a=(u,f)=>{u===n&&(o=f,this.stateEvents.off("localProposalSequenced",a),this.stateEvents.off("disconnected",l),this.stateEvents.on("localProposalApproved",c))},c=u=>{u===o&&(i(),h())},l=()=>{o===void 0&&this.stateEvents.once("connected",()=>{o===void 0&&(s(new Error("Client disconnected without successfully sending proposal")),h())})},d=()=>{s(new Error("QuorumProposals was disposed")),h()},h=()=>{this.stateEvents.off("localProposalSequenced",a),this.stateEvents.off("localProposalApproved",c),this.stateEvents.off("disconnected",l),this.stateEvents.off("disposed",d)};this.stateEvents.on("localProposalSequenced",a),this.stateEvents.on("disconnected",l),this.stateEvents.on("disposed",d)})})}addProposal(e,t,n,i,s){C(!this.proposals.has(n),464);let o=new ql(n,e,t,i);this.proposals.set(n,o),this.emit("addProposal",o),i&&this.stateEvents.emit("localProposalSequenced",s,n),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(e){let t=e.minimumSequenceNumber,n=[];for(let[i,s]of this.proposals)i<=t&&n.push(s);n.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);for(let i of n){let s={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:i.key,sequenceNumber:i.sequenceNumber,value:i.value};this.values.set(s.key,s),this.valuesSnapshotCache=void 0,this.emit("approveProposal",s.sequenceNumber,s.key,s.value,s.approvalSequenceNumber),this.proposals.delete(i.sequenceNumber),this.proposalsSnapshotCache=void 0,i.local&&this.stateEvents.emit("localProposalApproved",i.sequenceNumber)}}setConnectionState(e){e?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}},Ll=class extends be{constructor(e,t,n,i){super(),this.isDisposed=!1,this.quorumClients=new Fp(e),this.quorumClients.on("addMember",(s,o)=>{this.emit("addMember",s,o)}),this.quorumClients.on("removeMember",s=>{this.emit("removeMember",s)}),this.quorumProposals=new Pp({proposals:t,values:n},i),this.quorumProposals.on("addProposal",s=>{this.emit("addProposal",s)}),this.quorumProposals.on("approveProposal",(s,o,a,c)=>{this.emit("approveProposal",s,o,a,c)})}get disposed(){return this.isDisposed}close(){this.removeAllListeners()}snapshot(){let e=this.quorumClients.snapshot(),{proposals:t,values:n}=this.quorumProposals.snapshot();return{members:e,proposals:t,values:n}}has(e){return this.quorumProposals.has(e)}get(e){return this.quorumProposals.get(e)}getApprovalData(e){return this.quorumProposals.getApprovalData(e)}addMember(e,t){this.quorumClients.addMember(e,t)}removeMember(e){this.quorumClients.removeMember(e)}getMembers(){return this.quorumClients.getMembers()}getMember(e){return this.quorumClients.getMember(e)}propose(e,t){return y(this,null,function*(){return this.quorumProposals.propose(e,t)})}addProposal(e,t,n,i,s){return this.quorumProposals.addProposal(e,t,n,i,s)}updateMinimumSequenceNumber(e){this.quorumProposals.updateMinimumSequenceNumber(e)}setConnectionState(e,t){this.quorumProposals.setConnectionState(e)}dispose(){throw new Error("Not implemented.")}}});var Op,jl,Sw=J(()=>{Dp();Ip();Op=class{constructor(e,t,n,i,s,o,a){this.minimumSequenceNumber=e,this.sequenceNumber=t,this.term=n??1,this._quorum=new Ll(i,s,o,a)}get quorum(){return this._quorum}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}setConnectionState(e,t){this._quorum.setConnectionState(e,t)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${e.sequenceNumber}`);this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;let n=!1;switch(e.type){case ri.ClientJoin:let i=e,s=JSON.parse(i.data),o={client:s.detail,sequenceNumber:i.sequenceNumber};this._quorum.addMember(s.clientId,o);break;case ri.ClientLeave:let c=JSON.parse(e.data);this._quorum.removeMember(c);break;case ri.Propose:let l=e.contents;this._quorum.addProposal(l.key,l.value,e.sequenceNumber,t,e.clientSequenceNumber),n=!0;break;case ri.Reject:throw new Error("Quorum rejection is removed.");default:}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:n}}getProtocolState(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}},jl=class extends Op{processMessage(e,t){let n=this._quorum.getMember(e.clientId);if(e.clientId!=null){if(n===void 0&&e.type!==ri.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if(n?.shouldHaveLeft===!0&&e.type!==ri.NoOp)throw new Error("Remote message's clientId already should have left")}return super.processMessage(e,t)}}});var ww=J(()=>{});var Cw=J(()=>{});var Tn=J(()=>{bw();Sw();Ip();ww();Cw();});var _w=R((Vs,Us)=>{(function(r){var e=typeof Vs=="object"&&Vs&&!Vs.nodeType&&Vs,t=typeof Us=="object"&&Us&&!Us.nodeType&&Us,n=typeof global=="object"&&global;(n.global===n||n.window===n||n.self===n)&&(r=n);var i,s=2147483647,o=36,a=1,c=26,l=38,d=700,h=72,u=128,f="-",g=/^xn--/,m=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=o-a,_=Math.floor,A=String.fromCharCode,D;function O(z){throw new RangeError(v[z])}function M(z,V){for(var W=z.length,ie=[];W--;)ie[W]=V(z[W]);return ie}function S(z,V){var W=z.split("@"),ie="";W.length>1&&(ie=W[0]+"@",z=W[1]),z=z.replace(b,".");var ne=z.split("."),me=M(ne,V).join(".");return ie+me}function E(z){for(var V=[],W=0,ie=z.length,ne,me;W<ie;)ne=z.charCodeAt(W++),ne>=55296&&ne<=56319&&W<ie?(me=z.charCodeAt(W++),(me&64512)==56320?V.push(((ne&1023)<<10)+(me&1023)+65536):(V.push(ne),W--)):V.push(ne);return V}function w(z){return M(z,function(V){var W="";return V>65535&&(V-=65536,W+=A(V>>>10&1023|55296),V=56320|V&1023),W+=A(V),W}).join("")}function T(z){return z-48<10?z-22:z-65<26?z-65:z-97<26?z-97:o}function F(z,V){return z+22+75*(z<26)-((V!=0)<<5)}function N(z,V,W){var ie=0;for(z=W?_(z/d):z>>1,z+=_(z/V);z>x*c>>1;ie+=o)z=_(z/x);return _(ie+(x+1)*z/(z+l))}function P(z){var V=[],W=z.length,ie,ne=0,me=u,fe=h,Xe,Le,je,Ve,Pe,de,_e,Se,ze;for(Xe=z.lastIndexOf(f),Xe<0&&(Xe=0),Le=0;Le<Xe;++Le)z.charCodeAt(Le)>=128&&O("not-basic"),V.push(z.charCodeAt(Le));for(je=Xe>0?Xe+1:0;je<W;){for(Ve=ne,Pe=1,de=o;je>=W&&O("invalid-input"),_e=T(z.charCodeAt(je++)),(_e>=o||_e>_((s-ne)/Pe))&&O("overflow"),ne+=_e*Pe,Se=de<=fe?a:de>=fe+c?c:de-fe,!(_e<Se);de+=o)ze=o-Se,Pe>_(s/ze)&&O("overflow"),Pe*=ze;ie=V.length+1,fe=N(ne-Ve,ie,Ve==0),_(ne/ie)>s-me&&O("overflow"),me+=_(ne/ie),ne%=ie,V.splice(ne++,0,me)}return w(V)}function I(z){var V,W,ie,ne,me,fe,Xe,Le,je,Ve,Pe,de=[],_e,Se,ze,xt;for(z=E(z),_e=z.length,V=u,W=0,me=h,fe=0;fe<_e;++fe)Pe=z[fe],Pe<128&&de.push(A(Pe));for(ie=ne=de.length,ne&&de.push(f);ie<_e;){for(Xe=s,fe=0;fe<_e;++fe)Pe=z[fe],Pe>=V&&Pe<Xe&&(Xe=Pe);for(Se=ie+1,Xe-V>_((s-W)/Se)&&O("overflow"),W+=(Xe-V)*Se,V=Xe,fe=0;fe<_e;++fe)if(Pe=z[fe],Pe<V&&++W>s&&O("overflow"),Pe==V){for(Le=W,je=o;Ve=je<=me?a:je>=me+c?c:je-me,!(Le<Ve);je+=o)xt=Le-Ve,ze=o-Ve,de.push(A(F(Ve+xt%ze,0))),Le=_(xt/ze);de.push(A(F(Le,0))),me=N(W,Se,ie==ne),W=0,++ie}++W,++V}return de.join("")}function B(z){return S(z,function(V){return g.test(V)?P(V.slice(4).toLowerCase()):V})}function q(z){return S(z,function(V){return m.test(V)?"xn--"+I(V):V})}if(i={version:"1.4.1",ucs2:{decode:E,encode:w},decode:P,encode:I,toASCII:q,toUnicode:B},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return i});else if(e&&t)if(Us.exports==e)t.exports=i;else for(D in i)i.hasOwnProperty(D)&&(e[D]=i[D]);else r.punycode=i})(Vs)});var Aw=R((YJ,Tw)=>{"use strict";Tw.exports=Error});var Fw=R((QJ,Dw)=>{"use strict";Dw.exports=EvalError});var Iw=R((ZJ,Pw)=>{"use strict";Pw.exports=RangeError});var Nw=R((eX,Ow)=>{"use strict";Ow.exports=ReferenceError});var Np=R((tX,Rw)=>{"use strict";Rw.exports=SyntaxError});var Gs=R((rX,kw)=>{"use strict";kw.exports=TypeError});var Bw=R((nX,Mw)=>{"use strict";Mw.exports=URIError});var Lw=R((iX,qw)=>{"use strict";qw.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var s=Object.getOwnPropertySymbols(e);if(s.length!==1||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==i||o.enumerable!==!0)return!1}return!0}});var Hw=R((sX,zw)=>{"use strict";var jw=typeof Symbol<"u"&&Symbol,rk=Lw();zw.exports=function(){return typeof jw!="function"||typeof Symbol!="function"||typeof jw("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:rk()}});var Uw=R((oX,Vw)=>{"use strict";var Rp={__proto__:null,foo:{}},nk=Object;Vw.exports=function(){return{__proto__:Rp}.foo===Rp.foo&&!(Rp instanceof nk)}});var Kw=R((aX,Ww)=>{"use strict";var ik="Function.prototype.bind called on incompatible ",sk=Object.prototype.toString,ok=Math.max,ak="[object Function]",Gw=function(e,t){for(var n=[],i=0;i<e.length;i+=1)n[i]=e[i];for(var s=0;s<t.length;s+=1)n[s+e.length]=t[s];return n},ck=function(e,t){for(var n=[],i=t||0,s=0;i<e.length;i+=1,s+=1)n[s]=e[i];return n},lk=function(r,e){for(var t="",n=0;n<r.length;n+=1)t+=r[n],n+1<r.length&&(t+=e);return t};Ww.exports=function(e){var t=this;if(typeof t!="function"||sk.apply(t)!==ak)throw new TypeError(ik+t);for(var n=ck(arguments,1),i,s=function(){if(this instanceof i){var d=t.apply(this,Gw(n,arguments));return Object(d)===d?d:this}return t.apply(e,Gw(n,arguments))},o=ok(0,t.length-n.length),a=[],c=0;c<o;c++)a[c]="$"+c;if(i=Function("binder","return function ("+lk(a,",")+"){ return binder.apply(this,arguments); }")(s),t.prototype){var l=function(){};l.prototype=t.prototype,i.prototype=new l,l.prototype=null}return i}});var Hl=R((cX,$w)=>{"use strict";var uk=Kw();$w.exports=Function.prototype.bind||uk});var Xw=R((lX,Jw)=>{"use strict";var hk=Function.prototype.call,dk=Object.prototype.hasOwnProperty,fk=Hl();Jw.exports=fk.call(hk,dk)});var Ki=R((uX,t2)=>{"use strict";var Ae,pk=Aw(),mk=Fw(),gk=Iw(),vk=Nw(),Js=Np(),$s=Gs(),yk=Bw(),e2=Function,kp=function(r){try{return e2('"use strict"; return ('+r+").constructor;")()}catch{}},Gi=Object.getOwnPropertyDescriptor;if(Gi)try{Gi({},"")}catch{Gi=null}var Mp=function(){throw new $s},bk=Gi?function(){try{return arguments.callee,Mp}catch{try{return Gi(arguments,"callee").get}catch{return Mp}}}():Mp,Ws=Hw()(),xk=Uw()(),Ft=Object.getPrototypeOf||(xk?function(r){return r.__proto__}:null),Ks={},Sk=typeof Uint8Array>"u"||!Ft?Ae:Ft(Uint8Array),Wi={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Ae:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Ae:ArrayBuffer,"%ArrayIteratorPrototype%":Ws&&Ft?Ft([][Symbol.iterator]()):Ae,"%AsyncFromSyncIteratorPrototype%":Ae,"%AsyncFunction%":Ks,"%AsyncGenerator%":Ks,"%AsyncGeneratorFunction%":Ks,"%AsyncIteratorPrototype%":Ks,"%Atomics%":typeof Atomics>"u"?Ae:Atomics,"%BigInt%":typeof BigInt>"u"?Ae:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Ae:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Ae:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Ae:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":pk,"%eval%":eval,"%EvalError%":mk,"%Float32Array%":typeof Float32Array>"u"?Ae:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Ae:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Ae:FinalizationRegistry,"%Function%":e2,"%GeneratorFunction%":Ks,"%Int8Array%":typeof Int8Array>"u"?Ae:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Ae:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Ae:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ws&&Ft?Ft(Ft([][Symbol.iterator]())):Ae,"%JSON%":typeof JSON=="object"?JSON:Ae,"%Map%":typeof Map>"u"?Ae:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ws||!Ft?Ae:Ft(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Ae:Promise,"%Proxy%":typeof Proxy>"u"?Ae:Proxy,"%RangeError%":gk,"%ReferenceError%":vk,"%Reflect%":typeof Reflect>"u"?Ae:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Ae:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ws||!Ft?Ae:Ft(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Ae:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ws&&Ft?Ft(""[Symbol.iterator]()):Ae,"%Symbol%":Ws?Symbol:Ae,"%SyntaxError%":Js,"%ThrowTypeError%":bk,"%TypedArray%":Sk,"%TypeError%":$s,"%Uint8Array%":typeof Uint8Array>"u"?Ae:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Ae:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Ae:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Ae:Uint32Array,"%URIError%":yk,"%WeakMap%":typeof WeakMap>"u"?Ae:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Ae:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Ae:WeakSet};if(Ft)try{null.error}catch(r){Yw=Ft(Ft(r)),Wi["%Error.prototype%"]=Yw}var Yw,wk=function r(e){var t;if(e==="%AsyncFunction%")t=kp("async function () {}");else if(e==="%GeneratorFunction%")t=kp("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=kp("async function* () {}");else if(e==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=r("%AsyncGenerator%");i&&Ft&&(t=Ft(i.prototype))}return Wi[e]=t,t},Qw={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ma=Hl(),Vl=Xw(),Ck=Ma.call(Function.call,Array.prototype.concat),Ek=Ma.call(Function.apply,Array.prototype.splice),Zw=Ma.call(Function.call,String.prototype.replace),Ul=Ma.call(Function.call,String.prototype.slice),_k=Ma.call(Function.call,RegExp.prototype.exec),Tk=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ak=/\\(\\)?/g,Dk=function(e){var t=Ul(e,0,1),n=Ul(e,-1);if(t==="%"&&n!=="%")throw new Js("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&t!=="%")throw new Js("invalid intrinsic syntax, expected opening `%`");var i=[];return Zw(e,Tk,function(s,o,a,c){i[i.length]=a?Zw(c,Ak,"$1"):o||s}),i},Fk=function(e,t){var n=e,i;if(Vl(Qw,n)&&(i=Qw[n],n="%"+i[0]+"%"),Vl(Wi,n)){var s=Wi[n];if(s===Ks&&(s=wk(n)),typeof s>"u"&&!t)throw new $s("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:s}}throw new Js("intrinsic "+e+" does not exist!")};t2.exports=function(e,t){if(typeof e!="string"||e.length===0)throw new $s("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new $s('"allowMissing" argument must be a boolean');if(_k(/^%?[^%]*%?$/,e)===null)throw new Js("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Dk(e),i=n.length>0?n[0]:"",s=Fk("%"+i+"%",t),o=s.name,a=s.value,c=!1,l=s.alias;l&&(i=l[0],Ek(n,Ck([0,1],l)));for(var d=1,h=!0;d<n.length;d+=1){var u=n[d],f=Ul(u,0,1),g=Ul(u,-1);if((f==='"'||f==="'"||f==="`"||g==='"'||g==="'"||g==="`")&&f!==g)throw new Js("property names with quotes must have matching quotes");if((u==="constructor"||!h)&&(c=!0),i+="."+u,o="%"+i+"%",Vl(Wi,o))a=Wi[o];else if(a!=null){if(!(u in a)){if(!t)throw new $s("base intrinsic for "+e+" exists, but the property is not available.");return}if(Gi&&d+1>=n.length){var m=Gi(a,u);h=!!m,h&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[u]}else h=Vl(a,u),a=a[u];h&&!c&&(Wi[o]=a)}}return a}});var Wl=R((hX,r2)=>{"use strict";var Pk=Ki(),Gl=Pk("%Object.defineProperty%",!0)||!1;if(Gl)try{Gl({},"a",{value:1})}catch{Gl=!1}r2.exports=Gl});var Bp=R((dX,n2)=>{"use strict";var Ik=Ki(),Kl=Ik("%Object.getOwnPropertyDescriptor%",!0);if(Kl)try{Kl([],"length")}catch{Kl=null}n2.exports=Kl});var a2=R((fX,o2)=>{"use strict";var i2=Wl(),Ok=Np(),Xs=Gs(),s2=Bp();o2.exports=function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new Xs("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new Xs("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Xs("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Xs("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Xs("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Xs("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,c=!!s2&&s2(e,t);if(i2)i2(e,t,{configurable:o===null&&c?c.configurable:!o,enumerable:i===null&&c?c.enumerable:!i,value:n,writable:s===null&&c?c.writable:!s});else if(a||!i&&!s&&!o)e[t]=n;else throw new Ok("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}});var u2=R((pX,l2)=>{"use strict";var qp=Wl(),c2=function(){return!!qp};c2.hasArrayLengthDefineBug=function(){if(!qp)return null;try{return qp([],"length",{value:1}).length!==1}catch{return!0}};l2.exports=c2});var m2=R((mX,p2)=>{"use strict";var Nk=Ki(),h2=a2(),Rk=u2()(),d2=Bp(),f2=Gs(),kk=Nk("%Math.floor%");p2.exports=function(e,t){if(typeof e!="function")throw new f2("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||kk(t)!==t)throw new f2("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,s=!0;if("length"in e&&d2){var o=d2(e,"length");o&&!o.configurable&&(i=!1),o&&!o.writable&&(s=!1)}return(i||s||!n)&&(Rk?h2(e,"length",t,!0,!0):h2(e,"length",t)),e}});var S2=R((gX,$l)=>{"use strict";var Lp=Hl(),Jl=Ki(),Mk=m2(),Bk=Gs(),y2=Jl("%Function.prototype.apply%"),b2=Jl("%Function.prototype.call%"),x2=Jl("%Reflect.apply%",!0)||Lp.call(b2,y2),g2=Wl(),qk=Jl("%Math.max%");$l.exports=function(e){if(typeof e!="function")throw new Bk("a function is required");var t=x2(Lp,b2,arguments);return Mk(t,1+qk(0,e.length-(arguments.length-1)),!0)};var v2=function(){return x2(Lp,y2,arguments)};g2?g2($l.exports,"apply",{value:v2}):$l.exports.apply=v2});var _2=R((vX,E2)=>{"use strict";var w2=Ki(),C2=S2(),Lk=C2(w2("String.prototype.indexOf"));E2.exports=function(e,t){var n=w2(e,!!t);return typeof n=="function"&&Lk(e,".prototype.")>-1?C2(n):n}});var T2=R(()=>{});var W2=R((xX,G2)=>{var Jp=typeof Map=="function"&&Map.prototype,jp=Object.getOwnPropertyDescriptor&&Jp?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Yl=Jp&&jp&&typeof jp.get=="function"?jp.get:null,A2=Jp&&Map.prototype.forEach,Xp=typeof Set=="function"&&Set.prototype,zp=Object.getOwnPropertyDescriptor&&Xp?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ql=Xp&&zp&&typeof zp.get=="function"?zp.get:null,D2=Xp&&Set.prototype.forEach,jk=typeof WeakMap=="function"&&WeakMap.prototype,qa=jk?WeakMap.prototype.has:null,zk=typeof WeakSet=="function"&&WeakSet.prototype,La=zk?WeakSet.prototype.has:null,Hk=typeof WeakRef=="function"&&WeakRef.prototype,F2=Hk?WeakRef.prototype.deref:null,Vk=Boolean.prototype.valueOf,Uk=Object.prototype.toString,Gk=Function.prototype.toString,Wk=String.prototype.match,Yp=String.prototype.slice,ii=String.prototype.replace,Kk=String.prototype.toUpperCase,P2=String.prototype.toLowerCase,L2=RegExp.prototype.test,I2=Array.prototype.concat,sn=Array.prototype.join,$k=Array.prototype.slice,O2=Math.floor,Up=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Hp=Object.getOwnPropertySymbols,Gp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ys=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Jt=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ys||!0)?Symbol.toStringTag:null,j2=Object.prototype.propertyIsEnumerable,N2=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function R2(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||L2.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var n=r<0?-O2(-r):O2(r);if(n!==r){var i=String(n),s=Yp.call(e,i.length+1);return ii.call(i,t,"$&_")+"."+ii.call(ii.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return ii.call(e,t,"$&_")}var Wp=T2(),k2=Wp.custom,M2=H2(k2)?k2:null;G2.exports=function r(e,t,n,i){var s=t||{};if(ni(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ni(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=ni(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ni(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ni(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return U2(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var c=String(e);return a?R2(e,c):c}if(typeof e=="bigint"){var l=String(e)+"n";return a?R2(e,l):l}var d=typeof s.depth>"u"?5:s.depth;if(typeof n>"u"&&(n=0),n>=d&&d>0&&typeof e=="object")return Kp(e)?"[Array]":"[Object]";var h=dM(s,n);if(typeof i>"u")i=[];else if(V2(i,e)>=0)return"[Circular]";function u(N,P,I){if(P&&(i=$k.call(i),i.push(P)),I){var B={depth:s.depth};return ni(s,"quoteStyle")&&(B.quoteStyle=s.quoteStyle),r(N,B,n+1,i)}return r(N,s,n+1,i)}if(typeof e=="function"&&!B2(e)){var f=nM(e),g=Xl(e,u);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(g.length>0?" { "+sn.call(g,", ")+" }":"")}if(H2(e)){var m=Ys?ii.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Gp.call(e);return typeof e=="object"&&!Ys?Ba(m):m}if(lM(e)){for(var b="<"+P2.call(String(e.nodeName)),v=e.attributes||[],x=0;x<v.length;x++)b+=" "+v[x].name+"="+z2(Jk(v[x].value),"double",s);return b+=">",e.childNodes&&e.childNodes.length&&(b+="..."),b+="</"+P2.call(String(e.nodeName))+">",b}if(Kp(e)){if(e.length===0)return"[]";var _=Xl(e,u);return h&&!hM(_)?"["+$p(_,h)+"]":"[ "+sn.call(_,", ")+" ]"}if(Yk(e)){var A=Xl(e,u);return!("cause"in Error.prototype)&&"cause"in e&&!j2.call(e,"cause")?"{ ["+String(e)+"] "+sn.call(I2.call("[cause]: "+u(e.cause),A),", ")+" }":A.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+sn.call(A,", ")+" }"}if(typeof e=="object"&&o){if(M2&&typeof e[M2]=="function"&&Wp)return Wp(e,{depth:d-n});if(o!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(iM(e)){var D=[];return A2&&A2.call(e,function(N,P){D.push(u(P,e,!0)+" => "+u(N,e))}),q2("Map",Yl.call(e),D,h)}if(aM(e)){var O=[];return D2&&D2.call(e,function(N){O.push(u(N,e))}),q2("Set",Ql.call(e),O,h)}if(sM(e))return Vp("WeakMap");if(cM(e))return Vp("WeakSet");if(oM(e))return Vp("WeakRef");if(Zk(e))return Ba(u(Number(e)));if(tM(e))return Ba(u(Up.call(e)));if(eM(e))return Ba(Vk.call(e));if(Qk(e))return Ba(u(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===global)return"{ [object globalThis] }";if(!Xk(e)&&!B2(e)){var M=Xl(e,u),S=N2?N2(e)===Object.prototype:e instanceof Object||e.constructor===Object,E=e instanceof Object?"":"null prototype",w=!S&&Jt&&Object(e)===e&&Jt in e?Yp.call(si(e),8,-1):E?"Object":"",T=S||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",F=T+(w||E?"["+sn.call(I2.call([],w||[],E||[]),": ")+"] ":"");return M.length===0?F+"{}":h?F+"{"+$p(M,h)+"}":F+"{ "+sn.call(M,", ")+" }"}return String(e)};function z2(r,e,t){var n=(t.quoteStyle||e)==="double"?'"':"'";return n+r+n}function Jk(r){return ii.call(String(r),/"/g,"&quot;")}function Kp(r){return si(r)==="[object Array]"&&(!Jt||!(typeof r=="object"&&Jt in r))}function Xk(r){return si(r)==="[object Date]"&&(!Jt||!(typeof r=="object"&&Jt in r))}function B2(r){return si(r)==="[object RegExp]"&&(!Jt||!(typeof r=="object"&&Jt in r))}function Yk(r){return si(r)==="[object Error]"&&(!Jt||!(typeof r=="object"&&Jt in r))}function Qk(r){return si(r)==="[object String]"&&(!Jt||!(typeof r=="object"&&Jt in r))}function Zk(r){return si(r)==="[object Number]"&&(!Jt||!(typeof r=="object"&&Jt in r))}function eM(r){return si(r)==="[object Boolean]"&&(!Jt||!(typeof r=="object"&&Jt in r))}function H2(r){if(Ys)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Gp)return!1;try{return Gp.call(r),!0}catch{}return!1}function tM(r){if(!r||typeof r!="object"||!Up)return!1;try{return Up.call(r),!0}catch{}return!1}var rM=Object.prototype.hasOwnProperty||function(r){return r in this};function ni(r,e){return rM.call(r,e)}function si(r){return Uk.call(r)}function nM(r){if(r.name)return r.name;var e=Wk.call(Gk.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function V2(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,n=r.length;t<n;t++)if(r[t]===e)return t;return-1}function iM(r){if(!Yl||!r||typeof r!="object")return!1;try{Yl.call(r);try{Ql.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function sM(r){if(!qa||!r||typeof r!="object")return!1;try{qa.call(r,qa);try{La.call(r,La)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function oM(r){if(!F2||!r||typeof r!="object")return!1;try{return F2.call(r),!0}catch{}return!1}function aM(r){if(!Ql||!r||typeof r!="object")return!1;try{Ql.call(r);try{Yl.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function cM(r){if(!La||!r||typeof r!="object")return!1;try{La.call(r,La);try{qa.call(r,qa)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function lM(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function U2(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,n="... "+t+" more character"+(t>1?"s":"");return U2(Yp.call(r,0,e.maxStringLength),e)+n}var i=ii.call(ii.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,uM);return z2(i,"single",e)}function uM(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+Kk.call(e.toString(16))}function Ba(r){return"Object("+r+")"}function Vp(r){return r+" { ? }"}function q2(r,e,t,n){var i=n?$p(t,n):sn.call(t,", ");return r+" ("+e+") {"+i+"}"}function hM(r){for(var e=0;e<r.length;e++)if(V2(r[e],`
`)>=0)return!1;return!0}function dM(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=sn.call(Array(r.indent+1)," ");else return null;return{base:t,prev:sn.call(Array(e+1),t)}}function $p(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+sn.call(r,","+t)+`
`+e.prev}function Xl(r,e){var t=Kp(r),n=[];if(t){n.length=r.length;for(var i=0;i<r.length;i++)n[i]=ni(r,i)?e(r[i],r):""}var s=typeof Hp=="function"?Hp(r):[],o;if(Ys){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var c in r)ni(r,c)&&(t&&String(Number(c))===c&&c<r.length||Ys&&o["$"+c]instanceof Symbol||(L2.call(/[^\w$]/,c)?n.push(e(c,r)+": "+e(r[c],r)):n.push(c+": "+e(r[c],r))));if(typeof Hp=="function")for(var l=0;l<s.length;l++)j2.call(r,s[l])&&n.push("["+e(s[l])+"]: "+e(r[s[l]],r));return n}});var J2=R((SX,$2)=>{"use strict";var K2=Ki(),Qs=_2(),fM=W2(),pM=Gs(),Zl=K2("%WeakMap%",!0),eu=K2("%Map%",!0),mM=Qs("WeakMap.prototype.get",!0),gM=Qs("WeakMap.prototype.set",!0),vM=Qs("WeakMap.prototype.has",!0),yM=Qs("Map.prototype.get",!0),bM=Qs("Map.prototype.set",!0),xM=Qs("Map.prototype.has",!0),Qp=function(r,e){for(var t=r,n;(n=t.next)!==null;t=n)if(n.key===e)return t.next=n.next,n.next=r.next,r.next=n,n},SM=function(r,e){var t=Qp(r,e);return t&&t.value},wM=function(r,e,t){var n=Qp(r,e);n?n.value=t:r.next={key:e,next:r.next,value:t}},CM=function(r,e){return!!Qp(r,e)};$2.exports=function(){var e,t,n,i={assert:function(s){if(!i.has(s))throw new pM("Side channel does not contain "+fM(s))},get:function(s){if(Zl&&s&&(typeof s=="object"||typeof s=="function")){if(e)return mM(e,s)}else if(eu){if(t)return yM(t,s)}else if(n)return SM(n,s)},has:function(s){if(Zl&&s&&(typeof s=="object"||typeof s=="function")){if(e)return vM(e,s)}else if(eu){if(t)return xM(t,s)}else if(n)return CM(n,s);return!1},set:function(s,o){Zl&&s&&(typeof s=="object"||typeof s=="function")?(e||(e=new Zl),gM(e,s,o)):eu?(t||(t=new eu),bM(t,s,o)):(n||(n={key:{},next:null}),wM(n,s,o))}};return i}});var tu=R((wX,X2)=>{"use strict";var EM=String.prototype.replace,_M=/%20/g,Zp={RFC1738:"RFC1738",RFC3986:"RFC3986"};X2.exports={default:Zp.RFC3986,formatters:{RFC1738:function(r){return EM.call(r,_M,"+")},RFC3986:function(r){return String(r)}},RFC1738:Zp.RFC1738,RFC3986:Zp.RFC3986}});var rm=R((CX,Q2)=>{"use strict";var TM=tu(),em=Object.prototype.hasOwnProperty,$i=Array.isArray,on=function(){for(var r=[],e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r}(),AM=function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if($i(n)){for(var i=[],s=0;s<n.length;++s)typeof n[s]<"u"&&i.push(n[s]);t.obj[t.prop]=i}}},Y2=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)typeof e[i]<"u"&&(n[i]=e[i]);return n},DM=function r(e,t,n){if(!t)return e;if(typeof t!="object"){if($i(e))e.push(t);else if(e&&typeof e=="object")(n&&(n.plainObjects||n.allowPrototypes)||!em.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var i=e;return $i(e)&&!$i(t)&&(i=Y2(e,n)),$i(e)&&$i(t)?(t.forEach(function(s,o){if(em.call(e,o)){var a=e[o];a&&typeof a=="object"&&s&&typeof s=="object"?e[o]=r(a,s,n):e.push(s)}else e[o]=s}),e):Object.keys(t).reduce(function(s,o){var a=t[o];return em.call(s,o)?s[o]=r(s[o],a,n):s[o]=a,s},i)},FM=function(e,t){return Object.keys(t).reduce(function(n,i){return n[i]=t[i],n},e)},PM=function(r,e,t){var n=r.replace(/\+/g," ");if(t==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},tm=1024,IM=function(e,t,n,i,s){if(e.length===0)return e;var o=e;if(typeof e=="symbol"?o=Symbol.prototype.toString.call(e):typeof e!="string"&&(o=String(e)),n==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(f){return"%26%23"+parseInt(f.slice(2),16)+"%3B"});for(var a="",c=0;c<o.length;c+=tm){for(var l=o.length>=tm?o.slice(c,c+tm):o,d=[],h=0;h<l.length;++h){var u=l.charCodeAt(h);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===TM.RFC1738&&(u===40||u===41)){d[d.length]=l.charAt(h);continue}if(u<128){d[d.length]=on[u];continue}if(u<2048){d[d.length]=on[192|u>>6]+on[128|u&63];continue}if(u<55296||u>=57344){d[d.length]=on[224|u>>12]+on[128|u>>6&63]+on[128|u&63];continue}h+=1,u=65536+((u&1023)<<10|l.charCodeAt(h)&1023),d[d.length]=on[240|u>>18]+on[128|u>>12&63]+on[128|u>>6&63]+on[128|u&63]}a+=d.join("")}return a},OM=function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],i=0;i<t.length;++i)for(var s=t[i],o=s.obj[s.prop],a=Object.keys(o),c=0;c<a.length;++c){var l=a[c],d=o[l];typeof d=="object"&&d!==null&&n.indexOf(d)===-1&&(t.push({obj:o,prop:l}),n.push(d))}return AM(t),e},NM=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},RM=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},kM=function(e,t){return[].concat(e,t)},MM=function(e,t){if($i(e)){for(var n=[],i=0;i<e.length;i+=1)n.push(t(e[i]));return n}return t(e)};Q2.exports={arrayToObject:Y2,assign:FM,combine:kM,compact:OM,decode:PM,encode:IM,isBuffer:RM,isRegExp:NM,maybeMap:MM,merge:DM}});var iC=R((EX,nC)=>{"use strict";var eC=J2(),ru=rm(),ja=tu(),BM=Object.prototype.hasOwnProperty,tC={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},an=Array.isArray,qM=Array.prototype.push,rC=function(r,e){qM.apply(r,an(e)?e:[e])},LM=Date.prototype.toISOString,Z2=ja.default,wt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:ru.encode,encodeValuesOnly:!1,format:Z2,formatter:ja.formatters[Z2],indices:!1,serializeDate:function(e){return LM.call(e)},skipNulls:!1,strictNullHandling:!1},jM=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},nm={},zM=function r(e,t,n,i,s,o,a,c,l,d,h,u,f,g,m,b,v,x){for(var _=e,A=x,D=0,O=!1;(A=A.get(nm))!==void 0&&!O;){var M=A.get(e);if(D+=1,typeof M<"u"){if(M===D)throw new RangeError("Cyclic object value");O=!0}typeof A.get(nm)>"u"&&(D=0)}if(typeof d=="function"?_=d(t,_):_ instanceof Date?_=f(_):n==="comma"&&an(_)&&(_=ru.maybeMap(_,function(W){return W instanceof Date?f(W):W})),_===null){if(o)return l&&!b?l(t,wt.encoder,v,"key",g):t;_=""}if(jM(_)||ru.isBuffer(_)){if(l){var S=b?t:l(t,wt.encoder,v,"key",g);return[m(S)+"="+m(l(_,wt.encoder,v,"value",g))]}return[m(t)+"="+m(String(_))]}var E=[];if(typeof _>"u")return E;var w;if(n==="comma"&&an(_))b&&l&&(_=ru.maybeMap(_,l)),w=[{value:_.length>0?_.join(",")||null:void 0}];else if(an(d))w=d;else{var T=Object.keys(_);w=h?T.sort(h):T}var F=c?t.replace(/\./g,"%2E"):t,N=i&&an(_)&&_.length===1?F+"[]":F;if(s&&an(_)&&_.length===0)return N+"[]";for(var P=0;P<w.length;++P){var I=w[P],B=typeof I=="object"&&typeof I.value<"u"?I.value:_[I];if(!(a&&B===null)){var q=u&&c?I.replace(/\./g,"%2E"):I,z=an(_)?typeof n=="function"?n(N,q):N:N+(u?"."+q:"["+q+"]");x.set(e,D);var V=eC();V.set(nm,x),rC(E,r(B,z,n,i,s,o,a,c,n==="comma"&&b&&an(_)?null:l,d,h,u,f,g,m,b,v,V))}}return E},HM=function(e){if(!e)return wt;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||wt.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=ja.default;if(typeof e.format<"u"){if(!BM.call(ja.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var i=ja.formatters[n],s=wt.filter;(typeof e.filter=="function"||an(e.filter))&&(s=e.filter);var o;if(e.arrayFormat in tC?o=e.arrayFormat:"indices"in e?o=e.indices?"indices":"repeat":o=wt.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof e.allowDots>"u"?e.encodeDotInKeys===!0?!0:wt.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:wt.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:wt.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:wt.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?wt.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:wt.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:wt.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:wt.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:wt.encodeValuesOnly,filter:s,format:n,formatter:i,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:wt.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:wt.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:wt.strictNullHandling}};nC.exports=function(r,e){var t=r,n=HM(e),i,s;typeof n.filter=="function"?(s=n.filter,t=s("",t)):an(n.filter)&&(s=n.filter,i=s);var o=[];if(typeof t!="object"||t===null)return"";var a=tC[n.arrayFormat],c=a==="comma"&&n.commaRoundTrip;i||(i=Object.keys(t)),n.sort&&i.sort(n.sort);for(var l=eC(),d=0;d<i.length;++d){var h=i[d];n.skipNulls&&t[h]===null||rC(o,zM(t[h],h,a,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}var u=o.join(n.delimiter),f=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),u.length>0?f+u:""}});var aC=R((_X,oC)=>{"use strict";var Zs=rm(),im=Object.prototype.hasOwnProperty,VM=Array.isArray,pt={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Zs.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},UM=function(r){return r.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},sC=function(r,e){return r&&typeof r=="string"&&e.comma&&r.indexOf(",")>-1?r.split(","):r},GM="utf8=%26%2310003%3B",WM="utf8=%E2%9C%93",KM=function(e,t){var n={__proto__:null},i=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,s=t.parameterLimit===1/0?void 0:t.parameterLimit,o=i.split(t.delimiter,s),a=-1,c,l=t.charset;if(t.charsetSentinel)for(c=0;c<o.length;++c)o[c].indexOf("utf8=")===0&&(o[c]===WM?l="utf-8":o[c]===GM&&(l="iso-8859-1"),a=c,c=o.length);for(c=0;c<o.length;++c)if(c!==a){var d=o[c],h=d.indexOf("]="),u=h===-1?d.indexOf("="):h+1,f,g;u===-1?(f=t.decoder(d,pt.decoder,l,"key"),g=t.strictNullHandling?null:""):(f=t.decoder(d.slice(0,u),pt.decoder,l,"key"),g=Zs.maybeMap(sC(d.slice(u+1),t),function(b){return t.decoder(b,pt.decoder,l,"value")})),g&&t.interpretNumericEntities&&l==="iso-8859-1"&&(g=UM(g)),d.indexOf("[]=")>-1&&(g=VM(g)?[g]:g);var m=im.call(n,f);m&&t.duplicates==="combine"?n[f]=Zs.combine(n[f],g):(!m||t.duplicates==="last")&&(n[f]=g)}return n},$M=function(r,e,t,n){for(var i=n?e:sC(e,t),s=r.length-1;s>=0;--s){var o,a=r[s];if(a==="[]"&&t.parseArrays)o=t.allowEmptyArrays&&i===""?[]:[].concat(i);else{o=t.plainObjects?Object.create(null):{};var c=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=t.decodeDotInKeys?c.replace(/%2E/g,"."):c,d=parseInt(l,10);!t.parseArrays&&l===""?o={0:i}:!isNaN(d)&&a!==l&&String(d)===l&&d>=0&&t.parseArrays&&d<=t.arrayLimit?(o=[],o[d]=i):l!=="__proto__"&&(o[l]=i)}i=o}return i},JM=function(e,t,n,i){if(e){var s=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,c=n.depth>0&&o.exec(s),l=c?s.slice(0,c.index):s,d=[];if(l){if(!n.plainObjects&&im.call(Object.prototype,l)&&!n.allowPrototypes)return;d.push(l)}for(var h=0;n.depth>0&&(c=a.exec(s))!==null&&h<n.depth;){if(h+=1,!n.plainObjects&&im.call(Object.prototype,c[1].slice(1,-1))&&!n.allowPrototypes)return;d.push(c[1])}return c&&d.push("["+s.slice(c.index)+"]"),$M(d,t,n,i)}},XM=function(e){if(!e)return pt;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&typeof e.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(e.decoder!==null&&typeof e.decoder<"u"&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=typeof e.charset>"u"?pt.charset:e.charset,n=typeof e.duplicates>"u"?pt.duplicates:e.duplicates;if(n!=="combine"&&n!=="first"&&n!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var i=typeof e.allowDots>"u"?e.decodeDotInKeys===!0?!0:pt.allowDots:!!e.allowDots;return{allowDots:i,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:pt.allowEmptyArrays,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:pt.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:pt.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:pt.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:pt.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:pt.comma,decodeDotInKeys:typeof e.decodeDotInKeys=="boolean"?e.decodeDotInKeys:pt.decodeDotInKeys,decoder:typeof e.decoder=="function"?e.decoder:pt.decoder,delimiter:typeof e.delimiter=="string"||Zs.isRegExp(e.delimiter)?e.delimiter:pt.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:pt.depth,duplicates:n,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:pt.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:pt.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:pt.plainObjects,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:pt.strictNullHandling}};oC.exports=function(r,e){var t=XM(e);if(r===""||r===null||typeof r>"u")return t.plainObjects?Object.create(null):{};for(var n=typeof r=="string"?KM(r,t):r,i=t.plainObjects?Object.create(null):{},s=Object.keys(n),o=0;o<s.length;++o){var a=s[o],c=JM(a,n[a],t,typeof r=="string");i=Zs.merge(i,c,t)}return t.allowSparse===!0?i:Zs.compact(i)}});var lC=R((TX,cC)=>{"use strict";var YM=iC(),QM=aC(),ZM=tu();cC.exports={formats:ZM,parse:QM,stringify:YM}});var cm=R(to=>{"use strict";var eB=_w();function Nr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var tB=/^([a-z0-9.+-]+:)/i,rB=/:[0-9]*$/,nB=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,iB=["<",">",'"',"`"," ","\r",`
`,"	"],sB=["{","}","|","\\","^","`"].concat(iB),sm=["'"].concat(sB),uC=["%","/","?",";","#"].concat(sm),hC=["/","?","#"],oB=255,dC=/^[+a-z0-9A-Z_-]{0,63}$/,aB=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,cB={javascript:!0,"javascript:":!0},om={javascript:!0,"javascript:":!0},eo={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},am=lC();function za(r,e,t){if(r&&typeof r=="object"&&r instanceof Nr)return r;var n=new Nr;return n.parse(r,e,t),n}Nr.prototype.parse=function(r,e,t){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var n=r.indexOf("?"),i=n!==-1&&n<r.indexOf("#")?"?":"#",s=r.split(i),o=/\\/g;s[0]=s[0].replace(o,"/"),r=s.join(i);var a=r;if(a=a.trim(),!t&&r.split("#").length===1){var c=nB.exec(a);if(c)return this.path=a,this.href=a,this.pathname=c[1],c[2]?(this.search=c[2],e?this.query=am.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=tB.exec(a);if(l){l=l[0];var d=l.toLowerCase();this.protocol=d,a=a.substr(l.length)}if(t||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var h=a.substr(0,2)==="//";h&&!(l&&om[l])&&(a=a.substr(2),this.slashes=!0)}if(!om[l]&&(h||l&&!eo[l])){for(var u=-1,f=0;f<hC.length;f++){var g=a.indexOf(hC[f]);g!==-1&&(u===-1||g<u)&&(u=g)}var m,b;u===-1?b=a.lastIndexOf("@"):b=a.lastIndexOf("@",u),b!==-1&&(m=a.slice(0,b),a=a.slice(b+1),this.auth=decodeURIComponent(m)),u=-1;for(var f=0;f<uC.length;f++){var g=a.indexOf(uC[f]);g!==-1&&(u===-1||g<u)&&(u=g)}u===-1&&(u=a.length),this.host=a.slice(0,u),a=a.slice(u),this.parseHost(),this.hostname=this.hostname||"";var v=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!v)for(var x=this.hostname.split(/\./),f=0,_=x.length;f<_;f++){var A=x[f];if(A&&!A.match(dC)){for(var D="",O=0,M=A.length;O<M;O++)A.charCodeAt(O)>127?D+="x":D+=A[O];if(!D.match(dC)){var S=x.slice(0,f),E=x.slice(f+1),w=A.match(aB);w&&(S.push(w[1]),E.unshift(w[2])),E.length&&(a="/"+E.join(".")+a),this.hostname=S.join(".");break}}}this.hostname.length>oB?this.hostname="":this.hostname=this.hostname.toLowerCase(),v||(this.hostname=eB.toASCII(this.hostname));var T=this.port?":"+this.port:"",F=this.hostname||"";this.host=F+T,this.href+=this.host,v&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!cB[d])for(var f=0,_=sm.length;f<_;f++){var N=sm[f];if(a.indexOf(N)!==-1){var P=encodeURIComponent(N);P===N&&(P=escape(N)),a=a.split(N).join(P)}}var I=a.indexOf("#");I!==-1&&(this.hash=a.substr(I),a=a.slice(0,I));var B=a.indexOf("?");if(B!==-1?(this.search=a.substr(B),this.query=a.substr(B+1),e&&(this.query=am.parse(this.query)),a=a.slice(0,B)):e&&(this.search="",this.query={}),a&&(this.pathname=a),eo[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var T=this.pathname||"",q=this.search||"";this.path=T+q}return this.href=this.format(),this};function lB(r){return typeof r=="string"&&(r=za(r)),r instanceof Nr?r.format():Nr.prototype.format.call(r)}Nr.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var e=this.protocol||"",t=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=r+this.host:this.hostname&&(i=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=am.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||eo[e])&&i!==!1?(i="//"+(i||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):i||(i=""),n&&n.charAt(0)!=="#"&&(n="#"+n),o&&o.charAt(0)!=="?"&&(o="?"+o),t=t.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+i+t+o+n};function uB(r,e){return za(r,!1,!0).resolve(e)}Nr.prototype.resolve=function(r){return this.resolveObject(za(r,!1,!0)).format()};function hB(r,e){return r?za(r,!1,!0).resolveObject(e):e}Nr.prototype.resolveObject=function(r){if(typeof r=="string"){var e=new Nr;e.parse(r,!1,!0),r=e}for(var t=new Nr,n=Object.keys(this),i=0;i<n.length;i++){var s=n[i];t[s]=this[s]}if(t.hash=r.hash,r.href==="")return t.href=t.format(),t;if(r.slashes&&!r.protocol){for(var o=Object.keys(r),a=0;a<o.length;a++){var c=o[a];c!=="protocol"&&(t[c]=r[c])}return eo[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(r.protocol&&r.protocol!==t.protocol){if(!eo[r.protocol]){for(var l=Object.keys(r),d=0;d<l.length;d++){var h=l[d];t[h]=r[h]}return t.href=t.format(),t}if(t.protocol=r.protocol,!r.host&&!om[r.protocol]){for(var _=(r.pathname||"").split("/");_.length&&!(r.host=_.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),_[0]!==""&&_.unshift(""),_.length<2&&_.unshift(""),t.pathname=_.join("/")}else t.pathname=r.pathname;if(t.search=r.search,t.query=r.query,t.host=r.host||"",t.auth=r.auth,t.hostname=r.hostname||r.host,t.port=r.port,t.pathname||t.search){var u=t.pathname||"",f=t.search||"";t.path=u+f}return t.slashes=t.slashes||r.slashes,t.href=t.format(),t}var g=t.pathname&&t.pathname.charAt(0)==="/",m=r.host||r.pathname&&r.pathname.charAt(0)==="/",b=m||g||t.host&&r.pathname,v=b,x=t.pathname&&t.pathname.split("/")||[],_=r.pathname&&r.pathname.split("/")||[],A=t.protocol&&!eo[t.protocol];if(A&&(t.hostname="",t.port=null,t.host&&(x[0]===""?x[0]=t.host:x.unshift(t.host)),t.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(_[0]===""?_[0]=r.host:_.unshift(r.host)),r.host=null),b=b&&(_[0]===""||x[0]==="")),m)t.host=r.host||r.host===""?r.host:t.host,t.hostname=r.hostname||r.hostname===""?r.hostname:t.hostname,t.search=r.search,t.query=r.query,x=_;else if(_.length)x||(x=[]),x.pop(),x=x.concat(_),t.search=r.search,t.query=r.query;else if(r.search!=null){if(A){t.host=x.shift(),t.hostname=t.host;var D=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;D&&(t.auth=D.shift(),t.hostname=D.shift(),t.host=t.hostname)}return t.search=r.search,t.query=r.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!x.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var O=x.slice(-1)[0],M=(t.host||r.host||x.length>1)&&(O==="."||O==="..")||O==="",S=0,E=x.length;E>=0;E--)O=x[E],O==="."?x.splice(E,1):O===".."?(x.splice(E,1),S++):S&&(x.splice(E,1),S--);if(!b&&!v)for(;S--;S)x.unshift("..");b&&x[0]!==""&&(!x[0]||x[0].charAt(0)!=="/")&&x.unshift(""),M&&x.join("/").substr(-1)!=="/"&&x.push("");var w=x[0]===""||x[0]&&x[0].charAt(0)==="/";if(A){t.hostname=w?"":x.length?x.shift():"",t.host=t.hostname;var D=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;D&&(t.auth=D.shift(),t.hostname=D.shift(),t.host=t.hostname)}return b=b||t.host&&x.length,b&&!w&&x.unshift(""),x.length>0?t.pathname=x.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=r.auth||t.auth,t.slashes=t.slashes||r.slashes,t.href=t.format(),t};Nr.prototype.parseHost=function(){var r=this.host,e=rB.exec(r);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),r=r.substr(0,r.length-e.length)),r&&(this.hostname=r)};to.parse=za;to.resolve=uB;to.resolveObject=hB;to.format=lB;to.Url=Nr});var lm=R((IX,fC)=>{"use strict";fC.exports=function(e,t){return function(){return e.apply(t,arguments)}}});var bt=R((OX,vC)=>{"use strict";var dB=lm(),dm=Object.prototype.toString,fm=function(r){return function(e){var t=dm.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())}}(Object.create(null));function ci(r){return r=r.toLowerCase(),function(t){return fm(t)===r}}function iu(r){return Array.isArray(r)}function um(r){return typeof r>"u"}function fB(r){return r!==null&&!um(r)&&r.constructor!==null&&!um(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}var pC=ci("ArrayBuffer");function pB(r){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&pC(r.buffer),e}function mB(r){return typeof r=="string"}function mC(r){return typeof r=="number"}function gC(r){return r!==null&&typeof r=="object"}function nu(r){if(fm(r)!=="object")return!1;var e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}function gB(r){return r&&Object.keys(r).length===0&&Object.getPrototypeOf(r)===Object.prototype}var vB=ci("Date"),yB=ci("File"),bB=ci("Blob"),xB=ci("FileList");function pm(r){return dm.call(r)==="[object Function]"}function SB(r){return gC(r)&&pm(r.pipe)}function wB(r){var e="[object FormData]";return r&&(typeof FormData=="function"&&r instanceof FormData||dm.call(r)===e||pm(r.toString)&&r.toString()===e)}var CB=ci("URLSearchParams");function EB(r){return r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function _B(){var r;return typeof navigator<"u"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window<"u"&&typeof document<"u"}function mm(r,e){if(!(r===null||typeof r>"u"))if(typeof r!="object"&&(r=[r]),iu(r))for(var t=0,n=r.length;t<n;t++)e.call(null,r[t],t,r);else for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.call(null,r[i],i,r)}function hm(){var r={};function e(i,s){nu(r[s])&&nu(i)?r[s]=hm(r[s],i):nu(i)?r[s]=hm({},i):iu(i)?r[s]=i.slice():r[s]=i}for(var t=0,n=arguments.length;t<n;t++)mm(arguments[t],e);return r}function TB(r,e,t){return mm(e,function(i,s){t&&typeof i=="function"?r[s]=dB(i,t):r[s]=i}),r}function AB(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}function DB(r,e,t,n){r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,t&&Object.assign(r.prototype,t)}function FB(r,e,t,n){var i,s,o,a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!n||n(o,r,e))&&!a[o]&&(e[o]=r[o],a[o]=!0);r=t!==!1&&Object.getPrototypeOf(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e}function PB(r,e,t){r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return n!==-1&&n===t}function IB(r){if(!r)return null;if(iu(r))return r;var e=r.length;if(!mC(e))return null;for(var t=new Array(e);e-- >0;)t[e]=r[e];return t}var OB=function(r){return function(e){return r&&e instanceof r}}(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array));function NB(r,e){for(var t=r&&r[Symbol.iterator],n=t.call(r),i;(i=n.next())&&!i.done;){var s=i.value;e.call(r,s[0],s[1])}}function RB(r,e){for(var t,n=[];(t=r.exec(e))!==null;)n.push(t);return n}var kB=ci("HTMLFormElement"),MB=function(e){return function(t,n){return e.call(t,n)}}(Object.prototype.hasOwnProperty);vC.exports={isArray:iu,isArrayBuffer:pC,isBuffer:fB,isFormData:wB,isArrayBufferView:pB,isString:mB,isNumber:mC,isObject:gC,isPlainObject:nu,isEmptyObject:gB,isUndefined:um,isDate:vB,isFile:yB,isBlob:bB,isFunction:pm,isStream:SB,isURLSearchParams:CB,isStandardBrowserEnv:_B,forEach:mm,merge:hm,extend:TB,trim:EB,stripBOM:AB,inherits:DB,toFlatObject:FB,kindOf:fm,kindOfTest:ci,endsWith:PB,toArray:IB,isTypedArray:OB,isFileList:xB,forEachEntry:NB,matchAll:RB,isHTMLForm:kB,hasOwnProperty:MB}});var li=R((NX,SC)=>{"use strict";var yC=bt();function ro(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}yC.inherits(ro,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var bC=ro.prototype,xC={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(function(r){xC[r]={value:r}});Object.defineProperties(ro,xC);Object.defineProperty(bC,"isAxiosError",{value:!0});ro.from=function(r,e,t,n,i,s){var o=Object.create(bC);return yC.toFlatObject(r,o,function(c){return c!==Error.prototype}),ro.call(o,r.message,e,t,n,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};SC.exports=ro});var CC=R((RX,wC)=>{wC.exports=typeof self=="object"?self.FormData:window.FormData});var _C=R((kX,EC)=>{EC.exports=CC()});var Ha=R((MX,DC)=>{"use strict";var Ze=bt(),BB=li(),qB=_C();function gm(r){return Ze.isPlainObject(r)||Ze.isArray(r)}function AC(r){return Ze.endsWith(r,"[]")?r.slice(0,-2):r}function TC(r,e,t){return r?r.concat(e).map(function(i,s){return i=AC(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function LB(r){return Ze.isArray(r)&&!r.some(gm)}var jB=Ze.toFlatObject(Ze,{},null,function(e){return/^is[A-Z]/.test(e)});function zB(r){return r&&Ze.isFunction(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator]}function HB(r,e,t){if(!Ze.isObject(r))throw new TypeError("target must be an object");e=e||new(qB||FormData),t=Ze.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,b){return!Ze.isUndefined(b[m])});var n=t.metaTokens,i=t.visitor||d,s=t.dots,o=t.indexes,a=t.Blob||typeof Blob<"u"&&Blob,c=a&&zB(e);if(!Ze.isFunction(i))throw new TypeError("visitor must be a function");function l(g){if(g===null)return"";if(Ze.isDate(g))return g.toISOString();if(!c&&Ze.isBlob(g))throw new BB("Blob is not supported. Use a Buffer instead.");return Ze.isArrayBuffer(g)||Ze.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function d(g,m,b){var v=g;if(g&&!b&&typeof g=="object"){if(Ze.endsWith(m,"{}"))m=n?m:m.slice(0,-2),g=JSON.stringify(g);else if(Ze.isArray(g)&&LB(g)||Ze.isFileList(g)||Ze.endsWith(m,"[]")&&(v=Ze.toArray(g)))return m=AC(m),v.forEach(function(_,A){!Ze.isUndefined(_)&&e.append(o===!0?TC([m],A,s):o===null?m:m+"[]",l(_))}),!1}return gm(g)?!0:(e.append(TC(b,m,s),l(g)),!1)}var h=[],u=Object.assign(jB,{defaultVisitor:d,convertValue:l,isVisitable:gm});function f(g,m){if(!Ze.isUndefined(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+m.join("."));h.push(g),Ze.forEach(g,function(v,x){var _=!Ze.isUndefined(v)&&i.call(e,v,Ze.isString(x)?x.trim():x,m,u);_===!0&&f(v,m?m.concat(x):[x])}),h.pop()}}if(!Ze.isObject(r))throw new TypeError("data must be an object");return f(r),e}DC.exports=HB});var vm=R((BX,OC)=>{"use strict";var VB=Ha();function FC(r){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'\(\)~]|%20|%00/g,function(n){return e[n]})}function PC(r,e){this._pairs=[],r&&VB(r,this,e)}var IC=PC.prototype;IC.append=function(e,t){this._pairs.push([e,t])};IC.toString=function(e){var t=e?function(n){return e.call(this,n,FC)}:FC;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};OC.exports=PC});var ym=R((qX,NC)=>{"use strict";var UB=bt(),GB=vm();function WB(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}NC.exports=function(e,t,n){if(!t)return e;var i=e.indexOf("#");i!==-1&&(e=e.slice(0,i));var s=n&&n.encode||WB,o=n&&n.serialize,a;return o?a=o(t,n):a=UB.isURLSearchParams(t)?t.toString():new GB(t,n).toString(s),a&&(e+=(e.indexOf("?")===-1?"?":"&")+a),e}});var kC=R((LX,RC)=>{"use strict";var KB=bt();function Va(){this.handlers=[]}Va.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1};Va.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};Va.prototype.clear=function(){this.handlers&&(this.handlers=[])};Va.prototype.forEach=function(e){KB.forEach(this.handlers,function(n){n!==null&&e(n)})};RC.exports=Va});var bm=R((jX,MC)=>{"use strict";var $B=bt();MC.exports=function(e,t){$B.forEach(e,function(i,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=i,delete e[s])})}});var xm=R((zX,BC)=>{"use strict";BC.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}});var LC=R((HX,qC)=>{"use strict";var JB=vm();qC.exports=typeof URLSearchParams<"u"?URLSearchParams:JB});var zC=R((VX,jC)=>{"use strict";jC.exports=FormData});var VC=R((UX,HC)=>{"use strict";HC.exports={isBrowser:!0,classes:{URLSearchParams:LC(),FormData:zC(),Blob},protocols:["http","https","file","blob","url","data"]}});var su=R((GX,UC)=>{"use strict";UC.exports=VC()});var KC=R((WX,WC)=>{"use strict";var XB=bt(),YB=Ha(),GC=su();WC.exports=function(e,t){return YB(e,new GC.classes.URLSearchParams,Object.assign({visitor:function(n,i,s,o){return GC.isNode&&XB.isBuffer(n)?(this.append(i,n.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}});var Sm=R((KX,$C)=>{"use strict";var ui=bt();function QB(r){return ui.matchAll(/\w+|\[(\w*)]/g,r).map(function(e){return e[0]==="[]"?"":e[1]||e[0]})}function ZB(r){var e={},t=Object.keys(r),n,i=t.length,s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function e9(r){function e(n,i,s,o){var a=n[o++],c=Number.isFinite(+a),l=o>=n.length;if(a=!a&&ui.isArray(s)?s.length:a,l)return ui.hasOwnProperty(s,a)?s[a]=[s[a],i]:s[a]=i,!c;(!s[a]||!ui.isObject(s[a]))&&(s[a]=[]);var d=e(n,i,s[a],o);return d&&ui.isArray(s[a])&&(s[a]=ZB(s[a])),!c}if(ui.isFormData(r)&&ui.isFunction(r.entries)){var t={};return ui.forEachEntry(r,function(n,i){e(QB(n),i,t,0)}),t}return null}$C.exports=e9});var XC=R(($X,JC)=>{"use strict";var wm=li();JC.exports=function(e,t,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):t(new wm("Request failed with status code "+n.status,[wm.ERR_BAD_REQUEST,wm.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}});var QC=R((JX,YC)=>{"use strict";var ou=bt();YC.exports=ou.isStandardBrowserEnv()?function(){return{write:function(t,n,i,s,o,a){var c=[];c.push(t+"="+encodeURIComponent(n)),ou.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),ou.isString(s)&&c.push("path="+s),ou.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){var n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()});var eE=R((XX,ZC)=>{"use strict";ZC.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}});var rE=R((YX,tE)=>{"use strict";tE.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}});var Cm=R((QX,nE)=>{"use strict";var t9=eE(),r9=rE();nE.exports=function(e,t){return e&&!t9(t)?r9(e,t):t}});var sE=R((ZX,iE)=>{"use strict";var Em=bt(),n9=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];iE.exports=function(e){var t={},n,i,s;return e&&Em.forEach(e.split(`
`),function(a){if(s=a.indexOf(":"),n=Em.trim(a.slice(0,s)).toLowerCase(),i=Em.trim(a.slice(s+1)),n){if(t[n]&&n9.indexOf(n)>=0)return;n==="set-cookie"?t[n]=(t[n]?t[n]:[]).concat([i]):t[n]=t[n]?t[n]+", "+i:i}}),t}});var cE=R((eY,aE)=>{"use strict";var oE=bt();aE.exports=oE.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),n;function i(s){var o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(o){var a=oE.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}()});var Ua=R((tY,uE)=>{"use strict";var _m=li(),i9=bt();function lE(r,e,t){_m.call(this,r??"canceled",_m.ERR_CANCELED,e,t),this.name="CanceledError"}i9.inherits(lE,_m,{__CANCEL__:!0});uE.exports=lE});var dE=R((rY,hE)=>{"use strict";hE.exports=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}});var Tm=R((nY,fE)=>{"use strict";var no=bt(),s9=XC(),o9=QC(),a9=ym(),c9=Cm(),l9=sE(),u9=cE(),h9=xm(),An=li(),d9=Ua(),f9=dE(),p9=su();fE.exports=function(e){return new Promise(function(n,i){var s=e.data,o=e.headers,a=e.responseType,c=e.withXSRFToken,l;function d(){e.cancelToken&&e.cancelToken.unsubscribe(l),e.signal&&e.signal.removeEventListener("abort",l)}no.isFormData(s)&&no.isStandardBrowserEnv()&&delete o["Content-Type"];var h=new XMLHttpRequest;if(e.auth){var u=e.auth.username||"",f=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(u+":"+f)}var g=c9(e.baseURL,e.url);h.open(e.method.toUpperCase(),a9(g,e.params,e.paramsSerializer),!0),h.timeout=e.timeout;function m(){if(h){var x="getAllResponseHeaders"in h?l9(h.getAllResponseHeaders()):null,_=!a||a==="text"||a==="json"?h.responseText:h.response,A={data:_,status:h.status,statusText:h.statusText,headers:x,config:e,request:h};s9(function(O){n(O),d()},function(O){i(O),d()},A),h=null}}if("onloadend"in h?h.onloadend=m:h.onreadystatechange=function(){!h||h.readyState!==4||h.status===0&&!(h.responseURL&&h.responseURL.indexOf("file:")===0)||setTimeout(m)},h.onabort=function(){h&&(i(new An("Request aborted",An.ECONNABORTED,e,h)),h=null)},h.onerror=function(){i(new An("Network Error",An.ERR_NETWORK,e,h)),h=null},h.ontimeout=function(){var _=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",A=e.transitional||h9;e.timeoutErrorMessage&&(_=e.timeoutErrorMessage),i(new An(_,A.clarifyTimeoutError?An.ETIMEDOUT:An.ECONNABORTED,e,h)),h=null},no.isStandardBrowserEnv()&&(c&&no.isFunction(c)&&(c=c(e)),c||c!==!1&&u9(g))){var b=e.xsrfHeaderName&&e.xsrfCookieName&&o9.read(e.xsrfCookieName);b&&(o[e.xsrfHeaderName]=b)}"setRequestHeader"in h&&no.forEach(o,function(_,A){typeof s>"u"&&A.toLowerCase()==="content-type"?delete o[A]:h.setRequestHeader(A,_)}),no.isUndefined(e.withCredentials)||(h.withCredentials=!!e.withCredentials),a&&a!=="json"&&(h.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&h.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&h.upload&&h.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(l=function(x){h&&(i(!x||x.type?new d9(null,e,h):x),h.abort(),h=null)},e.cancelToken&&e.cancelToken.subscribe(l),e.signal&&(e.signal.aborted?l():e.signal.addEventListener("abort",l))),!s&&s!==!1&&s!==0&&s!==""&&(s=null);var v=f9(g);if(v&&p9.protocols.indexOf(v)===-1){i(new An("Unsupported protocol "+v+":",An.ERR_BAD_REQUEST,e));return}h.send(s)})}});var cu=R((iY,yE)=>{"use strict";var Ct=bt(),pE=bm(),mE=li(),m9=xm(),g9=Ha(),v9=KC(),gE=su(),y9=Sm(),b9={"Content-Type":"application/x-www-form-urlencoded"};function vE(r,e){!Ct.isUndefined(r)&&Ct.isUndefined(r["Content-Type"])&&(r["Content-Type"]=e)}function x9(){var r;return typeof XMLHttpRequest<"u"?r=Tm():typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]"&&(r=Tm()),r}function S9(r,e,t){if(Ct.isString(r))try{return(e||JSON.parse)(r),Ct.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}var au={transitional:m9,adapter:x9(),transformRequest:[function(e,t){pE(t,"Accept"),pE(t,"Content-Type");var n=t&&t["Content-Type"]||"",i=n.indexOf("application/json")>-1,s=Ct.isObject(e);s&&Ct.isHTMLForm(e)&&(e=new FormData(e));var o=Ct.isFormData(e);if(o)return i?JSON.stringify(y9(e)):e;if(Ct.isArrayBuffer(e)||Ct.isBuffer(e)||Ct.isStream(e)||Ct.isFile(e)||Ct.isBlob(e))return e;if(Ct.isArrayBufferView(e))return e.buffer;if(Ct.isURLSearchParams(e))return vE(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var a;if(s){if(n.indexOf("application/x-www-form-urlencoded")!==-1)return v9(e,this.formSerializer).toString();if((a=Ct.isFileList(e))||n.indexOf("multipart/form-data")>-1){var c=this.env&&this.env.FormData;return g9(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(vE(t,"application/json"),S9(e)):e}],transformResponse:[function(e){var t=this.transitional||au.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&Ct.isString(e)&&(n&&!this.responseType||i)){var s=t&&t.silentJSONParsing,o=!s&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?mE.from(a,mE.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:gE.classes.FormData,Blob:gE.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ct.forEach(["delete","get","head"],function(e){au.headers[e]={}});Ct.forEach(["post","put","patch"],function(e){au.headers[e]=Ct.merge(b9)});yE.exports=au});var xE=R((sY,bE)=>{"use strict";var w9=bt(),C9=cu();bE.exports=function(e,t,n,i){var s=this||C9;return w9.forEach(i,function(a){e=a.call(s,e,t,n)}),e}});var Am=R((oY,SE)=>{"use strict";SE.exports=function(e){return!!(e&&e.__CANCEL__)}});var _E=R((aY,EE)=>{"use strict";var wE=bt(),Dm=xE(),E9=Am(),_9=cu(),T9=Ua(),CE=bm();function Fm(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new T9}EE.exports=function(e){Fm(e),e.headers=e.headers||{},e.data=Dm.call(e,e.data,e.headers,null,e.transformRequest),CE(e.headers,"Accept"),CE(e.headers,"Content-Type"),e.headers=wE.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),wE.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var t=e.adapter||_9.adapter;return t(e).then(function(i){return Fm(e),i.data=Dm.call(e,i.data,i.headers,i.status,e.transformResponse),i},function(i){return E9(i)||(Fm(e),i&&i.response&&(i.response.data=Dm.call(e,i.response.data,i.response.headers,i.response.status,e.transformResponse))),Promise.reject(i)})}});var Pm=R((cY,TE)=>{"use strict";var er=bt();TE.exports=function(e,t){t=t||{};var n={};function i(d,h){return er.isPlainObject(d)&&er.isPlainObject(h)?er.merge(d,h):er.isEmptyObject(h)?er.merge({},d):er.isPlainObject(h)?er.merge({},h):er.isArray(h)?h.slice():h}function s(d){if(er.isUndefined(t[d])){if(!er.isUndefined(e[d]))return i(void 0,e[d])}else return i(e[d],t[d])}function o(d){if(!er.isUndefined(t[d]))return i(void 0,t[d])}function a(d){if(er.isUndefined(t[d])){if(!er.isUndefined(e[d]))return i(void 0,e[d])}else return i(void 0,t[d])}function c(d){if(d in t)return i(e[d],t[d]);if(d in e)return i(void 0,e[d])}var l={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return er.forEach(Object.keys(e).concat(Object.keys(t)),function(h){var u=l[h]||s,f=u(h);er.isUndefined(f)&&u!==c||(n[h]=f)}),n}});var Im=R((lY,AE)=>{AE.exports={version:"0.28.1"}});var PE=R((uY,FE)=>{"use strict";var A9=Im().version,hi=li(),Om={};["object","boolean","number","function","string","symbol"].forEach(function(r,e){Om[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});var DE={};Om.transitional=function(e,t,n){function i(s,o){return"[Axios v"+A9+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return function(s,o,a){if(e===!1)throw new hi(i(o," has been removed"+(t?" in "+t:"")),hi.ERR_DEPRECATED);return t&&!DE[o]&&(DE[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function D9(r,e,t){if(typeof r!="object")throw new hi("options must be an object",hi.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(r),i=n.length;i-- >0;){var s=n[i],o=e[s];if(o){var a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new hi("option "+s+" must be "+c,hi.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new hi("Unknown option "+s,hi.ERR_BAD_OPTION)}}FE.exports={assertOptions:D9,validators:Om}});var RE=R((hY,NE)=>{"use strict";var Rm=bt(),F9=ym(),IE=kC(),OE=_E(),lu=Pm(),P9=Cm(),Nm=PE(),di=Nm.validators;function io(r){this.defaults=r,this.interceptors={request:new IE,response:new IE}}io.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=lu(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;n!==void 0&&Nm.assertOptions(n,{silentJSONParsing:di.transitional(di.boolean),forcedJSONParsing:di.transitional(di.boolean),clarifyTimeoutError:di.transitional(di.boolean)},!1);var i=t.paramsSerializer;i!==void 0&&Nm.assertOptions(i,{encode:di.function,serialize:di.function},!0),Rm.isFunction(i)&&(t.paramsSerializer={serialize:i});var s=[],o=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(o=o&&g.synchronous,s.unshift(g.fulfilled,g.rejected))});var a=[];this.interceptors.response.forEach(function(g){a.push(g.fulfilled,g.rejected)});var c;if(!o){var l=[OE,void 0];for(Array.prototype.unshift.apply(l,s),l=l.concat(a),c=Promise.resolve(t);l.length;)c=c.then(l.shift(),l.shift());return c}for(var d=t;s.length;){var h=s.shift(),u=s.shift();try{d=h(d)}catch(f){u(f);break}}try{c=OE(d)}catch(f){return Promise.reject(f)}for(;a.length;)c=c.then(a.shift(),a.shift());return c};io.prototype.getUri=function(e){e=lu(this.defaults,e);var t=P9(e.baseURL,e.url);return F9(t,e.params,e.paramsSerializer)};Rm.forEach(["delete","get","head","options"],function(e){io.prototype[e]=function(t,n){return this.request(lu(n||{},{method:e,url:t,data:(n||{}).data}))}});Rm.forEach(["post","put","patch"],function(e){function t(n){return function(s,o,a){return this.request(lu(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}io.prototype[e]=t(),io.prototype[e+"Form"]=t(!0)});NE.exports=io});var ME=R((dY,kE)=>{"use strict";var I9=Ua();function so(r){if(typeof r!="function")throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(i){e=i});var t=this;this.promise.then(function(n){if(t._listeners){for(var i=t._listeners.length;i-- >0;)t._listeners[i](n);t._listeners=null}}),this.promise.then=function(n){var i,s=new Promise(function(o){t.subscribe(o),i=o}).then(n);return s.cancel=function(){t.unsubscribe(i)},s},r(function(i,s,o){t.reason||(t.reason=new I9(i,s,o),e(t.reason))})}so.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};so.prototype.subscribe=function(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]};so.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}};so.source=function(){var e,t=new so(function(i){e=i});return{token:t,cancel:e}};kE.exports=so});var qE=R((fY,BE)=>{"use strict";BE.exports=function(e){return function(n){return e.apply(null,n)}}});var jE=R((pY,LE)=>{"use strict";var O9=bt();LE.exports=function(e){return O9.isObject(e)&&e.isAxiosError===!0}});var HE=R((mY,Mm)=>{"use strict";var km=bt(),N9=lm(),uu=RE(),R9=Pm(),k9=cu(),M9=Sm();function zE(r){var e=new uu(r),t=N9(uu.prototype.request,e);return km.extend(t,uu.prototype,e),km.extend(t,e),t.create=function(i){return zE(R9(r,i))},t}var tr=zE(k9);tr.Axios=uu;tr.CanceledError=Ua();tr.CancelToken=ME();tr.isCancel=Am();tr.VERSION=Im().version;tr.toFormData=Ha();tr.AxiosError=li();tr.Cancel=tr.CanceledError;tr.all=function(e){return Promise.all(e)};tr.spread=qE();tr.isAxiosError=jE();tr.formToJSON=function(r){return M9(km.isHTMLForm(r)?new FormData(r):r)};Mm.exports=tr;Mm.exports.default=tr});var UE=R((gY,VE)=>{VE.exports=HE()});function Vr(r,e){if(r==="")return e===void 0?"":e.absolutePath;{let t=r.startsWith("/")?r.slice(1):r;return t=t.endsWith("/")?t.slice(0,-1):t,e===void 0?`/${t}`:`${e.absolutePath==="/"?"":e.absolutePath}/${t}`}}var ZE=J(()=>{});function mi(r){if(r!==null&&typeof r=="object"&&r.errorFromRequestFluidObject===!0){let n=r;return{mimeType:"text/plain",status:n.code,value:n.message,get stack(){return n.stack}}}let t=Ls();return{mimeType:"text/plain",status:500,value:`${r}`,get stack(){var n;return(n=r?.stack)!==null&&n!==void 0?n:t.stack}}}function gi(r,e){let t=r.value,n=Ls();return{errorFromRequestFluidObject:!0,message:t,name:"Error",code:r.status,get stack(){var s;return(s=r.stack)!==null&&s!==void 0?s:n.stack}}}function un(r,e){return y(this,null,function*(){let t=typeof e=="string"?{url:e}:e,n=yield r.request(t);if(n.status!==200||n.mimeType!=="fluid/object")throw gi(n,t);return C(n.value,410),n.value})}function gu(r,e,t){var n;C(r!==200,411);let i=(n=t.url)===null||n===void 0?void 0:n.split("?")[0],s=Ls();return{mimeType:"text/plain",status:r,value:i===void 0?e:`${e}: ${i}`,get stack(){return s.stack}}}function z9(r,e){return{type:r,get IFluidDataStoreFactory(){return this},get IFluidDataStoreRegistry(){return this},instantiateDataStore:(t,n)=>y(this,null,function*(){return(yield e).instantiateDataStore(t,n)}),get:t=>y(this,null,function*(){var n;return(n=(yield e).IFluidDataStoreRegistry)===null||n===void 0?void 0:n.get(t)})}}var Et,e_=J(()=>{te();xe();Et=r=>gu(404,"not found",r)});var Wm,t_=J(()=>{te();Wm=class{constructor(e,t){this.storage=e,this.path=t,C(!t.endsWith("/"),412)}readBlob(e){return y(this,null,function*(){return this.storage.readBlob(`${this.path}/${e}`)})}contains(e){return y(this,null,function*(){return this.storage.contains(`${this.path}/${e}`)})}list(e){return y(this,null,function*(){return this.storage.list(`${this.path}/${e}`)})}}});function vu(r){let e=r;return e.startsWith("/")&&(e=e.substr(1)),e.endsWith("/")&&(e=e.substr(0,e.length-1)),e.length>0?e.split("/"):[]}function H9(r,e){return y(this,null,function*(){let t=vu(e),n=r;for(;n?.entries!==void 0&&t.length>0;){let i=t.shift(),s=n.entries.find(o=>o.type==="Tree"&&o.path===i);s?.type==="Tree"?n=s.value:n=void 0}if(n?.entries===void 0||t.length!==0)throw new Error("path does not exist");return n.entries.filter(i=>i.type==="Blob").map(i=>i.path)})}var r_=J(()=>{});var hr,n_=J(()=>{hr=class r{constructor(e){this.request=e;let t=this.request.url.indexOf("?");t>=0?this.query=this.request.url.substring(t):this.query=""}static getPathParts(e){let t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce((n,i)=>(i!==void 0&&i.length>0&&n.push(decodeURIComponent(i)),n),[])}static create(e){return e instanceof r?e:new r(e)}get url(){return this.request.url}get headers(){return this.request.headers}get pathParts(){return this.requestPathParts===void 0&&(this.requestPathParts=r.getPathParts(this.url)),this.requestPathParts}isLeaf(e){return this.query===""&&this.pathParts.length===e}createSubRequest(e){let t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};let n=`/${this.pathParts.slice(e).join("/")}`;return{url:this.query===""?n:`${n}/${this.query}`,headers:this.headers}}}});var Xa,i_=J(()=>{Xa=class{get IRuntimeFactory(){return this}instantiateRuntime(e,t){return y(this,null,function*(){let n=t===void 0?e.existing===!0:t,i=yield this.preInitialize(e,n);return n?yield this.instantiateFromExisting(i):yield this.instantiateFirstTime(i),yield this.hasInitialized(i),i})}instantiateFirstTime(e){return y(this,null,function*(){})}instantiateFromExisting(e){return y(this,null,function*(){})}hasInitialized(e){return y(this,null,function*(){})}}});var s_=R(yu=>{"use strict";Object.defineProperty(yu,"__esModule",{value:!0});yu.IFluidDataStoreFactory=void 0;yu.IFluidDataStoreFactory="IFluidDataStoreFactory"});var o_=R(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});bu.IFluidDataStoreRegistry=void 0;bu.IFluidDataStoreRegistry="IFluidDataStoreRegistry"});var a_=R(Yi=>{"use strict";Object.defineProperty(Yi,"__esModule",{value:!0});Yi.VisibilityState=Yi.FlushMode=void 0;var V9;(function(r){r[r.Immediate=0]="Immediate",r[r.TurnBased=1]="TurnBased"})(V9=Yi.FlushMode||(Yi.FlushMode={}));Yi.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}});var c_=R(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});xu.gcBlobKey=void 0;xu.gcBlobKey="gc"});var u_=R(l_=>{"use strict";Object.defineProperty(l_,"__esModule",{value:!0})});var h_=R(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.totalBlobSizePropertyName=Ur.blobCountPropertyName=Ur.channelsTreeName=Ur.CreateSummarizerNodeSource=void 0;var U9;(function(r){r[r.FromSummary=0]="FromSummary",r[r.FromAttach=1]="FromAttach",r[r.Local=2]="Local"})(U9=Ur.CreateSummarizerNodeSource||(Ur.CreateSummarizerNodeSource={}));Ur.channelsTreeName=".channels";Ur.blobCountPropertyName="BlobCount";Ur.totalBlobSizePropertyName="TotalBlobSize"});var Tr=R(Rr=>{"use strict";var G9=Rr&&Rr.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),lo=Rr&&Rr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&G9(e,r,t)};Object.defineProperty(Rr,"__esModule",{value:!0});lo(s_(),Rr);lo(o_(),Rr);lo(a_(),Rr);lo(c_(),Rr);lo(u_(),Rr);lo(h_(),Rr)});var d_=J(()=>{});var f_=J(()=>{});var p_=J(()=>{});var m_=J(()=>{});var Ya,g_=J(()=>{Ya=function(r){return r.Blob="Blob",r.Tree="Tree",r.Attachment="Attachment",r}(Ya||{})});var ht,v_=J(()=>{ht=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(ht||{})});var y_=J(()=>{});var b_=J(()=>{});var x_=J(()=>{});var S_=J(()=>{});var Su=J(()=>{d_();f_();p_();m_();g_();v_();y_();b_();x_();S_();});function Gr(...r){let e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(let t of r)e.treeNodeCount+=t.treeNodeCount,e.blobNodeCount+=t.blobNodeCount,e.handleNodeCount+=t.handleNodeCount,e.totalBlobSize+=t.totalBlobSize,e.unreferencedBlobSize+=t.unreferencedBlobSize;return e}function w_(r){let e=r.length;for(let t=r.length-1;t>=0;t--){let n=r.charCodeAt(t);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&t--}return e}function Km(r){return typeof r=="string"?w_(r):r.byteLength}function C_(r,e){switch(r.type){case ht.Tree:{e.treeNodeCount++;for(let t of Object.values(r.tree))C_(t,e);return}case ht.Handle:{e.handleNodeCount++;return}case ht.Blob:{e.blobNodeCount++,e.totalBlobSize+=Km(r.content);return}default:return}}function Za(r){let e=Gr();return C_(r,e),e}function dr(r,e,t){let n={type:ht.Blob,content:t};r.summary.tree[e]=n,r.stats.blobNodeCount++,r.stats.totalBlobSize+=Km(t)}function $m(r,e,t){r.summary.tree[e]=t.summary,r.stats=Gr(r.stats,t.stats)}function Jm(r,e,t){r.summary.tree[e]=t.summary,r.stats=Gr(r.stats,t.stats)}function E_(r,e=!1){let t=new mt;for(let i of r.entries)switch(i.type){case Ya.Blob:{let s=i.value,o;s.encoding==="base64"?o=kt.from(s.contents,"base64"):o=s.contents,t.addBlob(i.path,o);break}case Ya.Tree:{let s=uo(i.value,e);t.addWithStats(i.path,s);break}case Ya.Attachment:{let s=i.value.id;t.addAttachment(s);break}default:throw new Error("Unexpected TreeEntry type")}let n=t.getSummaryTree();return n.summary.unreferenced=r.unreferenced,n}function uo(r,e=!1){if(r.id&&!e){let t=Gr();return t.handleNodeCount++,{summary:{handle:r.id,handleType:ht.Tree,type:ht.Handle},stats:t}}else return E_(r,e)}function ho(r){let e=new mt;for(let[n,i]of Object.entries(r.blobs)){let s;if(r.blobsContents!==void 0){let o=r.blobsContents[i];o!==void 0&&(s=Gn(o,"utf-8"))}else r.blobs[i]!==void 0&&(s=wf(r.blobs[i]));s!==void 0&&e.addBlob(n,s)}for(let[n,i]of Object.entries(r.trees)){let s=ho(i);e.addWithStats(n,s)}let t=e.getSummaryTree();return t.summary.unreferenced=r.unreferenced,t}function fo(r){let e=[];for(let[t,n]of Object.entries(r.tree))switch(n.type){case ht.Blob:{let i,s="utf-8";typeof n.content=="string"?i=n.content:(i=cr(n.content,"base64"),s="base64"),e.push(new zs(t,i,s));break}case ht.Tree:{e.push(new Rl(t,fo(n)));break}case ht.Attachment:{e.push(new kl(t,n.id));break}case ht.Handle:throw new Error("Should not have Handle type in summary tree");default:ot(n,"Unexpected summary tree type")}return{entries:e,unreferenced:r.unreferenced}}var mt,Qa,wu=J(()=>{te();Tn();Su();mt=class{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=Gr(),this.summaryStats.treeNodeCount++}get summary(){return{type:ht.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(e,t){dr({summary:{type:ht.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}addHandle(e,t,n){this.summaryTree[e]={type:ht.Handle,handleType:t,handle:n},this.summaryStats.handleNodeCount++}addWithStats(e,t){this.summaryTree[e]=t.summary,this.summaryStats=Gr(this.summaryStats,t.stats)}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:ht.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}};Qa=class{constructor(){this.telemetry=new Map}set(e,t,n){this.telemetry.set(`${e}${t}`,n)}get(e,t){return this.telemetry.get(`${e}${t}`)}serialize(){let e={};return this.telemetry.forEach((t,n)=>{e[n]=t}),JSON.stringify(e)}}});function Xm(r,e){let t=r,n=[],i=[];for(let s=0;;s++){s>__&&e.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:__});let o=t.blobs[T_],a=t.trees[ec];if(o===void 0&&a===void 0){let c;return{baseSummary:t,pathParts:n,getOutstandingOps(l){return y(this,null,function*(){let d=[];for(let h of i){let u=yield l(h);if(d.length>0&&u.length>0){let f=d[d.length-1].sequenceNumber,g=u[0].sequenceNumber;if(g<=f)for(e.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:`newEarliestSeq <= latestSeq in decodeSummary: ${g} <= ${f}`});u.length>0&&u[0].sequenceNumber<=f;)u.shift()}d=d.concat(u)}return d})}}}C(!!o,431),C(a!==void 0,432),t=a,n.push(ec),i.unshift(o)}}function A_(r,e){let t=fr.create(ec),n=new mt;if(n.addBlob(T_,JSON.stringify(e)),r.fromSummary){let s=r.summaryNode;s.additionalPath!==void 0&&(t=t.concat(s.additionalPath)),n.addHandle(ec,ht.Tree,s.fullPath.path)}else n.addWithStats(ec,r.initialSummary);let i=n.getSummaryTree();return Object.assign(Object.assign({},i),{additionalPath:t})}function Cu(r){let e=r.trees[tc.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:tc.channelsTreeName}:{childrenTree:r,childrenPathPart:void 0}}function D_(r){let e=r.tree[tc.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:tc.channelsTreeName}:{childrenTree:r,childrenPathPart:void 0}}var tc,ec,T_,__,fr,hn,Ym=J(()=>{te();Su();tc=ye(Tr());wu();ec="_baseSummary",T_="_outstandingOps",__=100,fr=class r{constructor(e){this.path=e}static create(e){return new r(encodeURIComponent(e))}static createAndConcat(e){var t;let n=r.create((t=e[0])!==null&&t!==void 0?t:"");for(let i=1;i<e.length;i++)n=n.concat(r.create(e[i]));return n}toString(){return this.path}concat(e){return new r(`${this.path}/${e.path}`)}},hn=class r{constructor(e){this.summary=e}static createForRoot(e){return new r({referenceSequenceNumber:e,basePath:void 0,localPath:fr.create("")})}get referenceSequenceNumber(){return this.summary.referenceSequenceNumber}get basePath(){return this.summary.basePath}get localPath(){return this.summary.localPath}get additionalPath(){return this.summary.additionalPath}set additionalPath(e){this.summary.additionalPath=e}get fullPath(){var e,t;return(t=(e=this.basePath)===null||e===void 0?void 0:e.concat(this.localPath))!==null&&t!==void 0?t:this.localPath}get fullPathForChildren(){return this.additionalPath!==void 0?this.fullPath.concat(this.additionalPath):this.fullPath}createForChild(e){return new r({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:fr.create(e)})}}});var rc,nc,F_,Qm=J(()=>{rc=ye(Tr());Su();te();wu();Ym();nc=class r{constructor(e,t,n,i,s,o,a){var c;this.defaultLogger=e,this.summarizeInternalFn=t,this._changeSequenceNumber=i,this._latestSummary=s,this.initialSummary=o,this.wipSummaryLogger=a,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=(c=n.canReuseHandle)!==null&&c!==void 0?c:!0,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}get referenceSequenceNumber(){var e,t;return(t=(e=this._latestSummary)===null||e===void 0?void 0:e.referenceSequenceNumber)!==null&&t!==void 0?t:0}startSummary(e,t){C(this.wipSummaryLogger===void 0,415),C(this.wipReferenceSequenceNumber===void 0,416),this.wipSummaryLogger=t;for(let n of this.children.values())n.startSummary(e,this.wipSummaryLogger);this.wipReferenceSequenceNumber=e}summarize(e,t=!0,n){return y(this,null,function*(){if(C(this.isTrackingInProgress(),417),C(this.wipSummaryLogger!==void 0,418),this.canReuseHandle&&!e&&!this.hasChanged()){let i=this._latestSummary;if(i!==void 0){this.wipLocalPaths={localPath:i.localPath,additionalPath:i.additionalPath},this.wipSkipRecursion=!0;let s=Gr();return s.handleNodeCount++,{summary:{type:ht.Handle,handle:i.fullPath.path,handleType:ht.Tree},stats:s}}}try{let i=yield this.summarizeInternalFn(e,!0,n);return this.wipLocalPaths={localPath:fr.create(i.id)},i.pathPartsForChildren!==void 0&&(this.wipLocalPaths.additionalPath=fr.createAndConcat(i.pathPartsForChildren)),{summary:i.summary,stats:i.stats}}catch(i){if(this.throwOnError||this.trackingSequenceNumber<this._changeSequenceNumber)throw i;let s=this._latestSummary,o=this.initialSummary,a,c;if(s!==void 0)a={fromSummary:!0,summaryNode:s},c=s.localPath;else if(o?.summary!==void 0)a={fromSummary:!1,initialSummary:o.summary},c=fr.create(o.id);else throw i;this.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},i);let l=A_(a,this.outstandingOps);return this.wipLocalPaths={localPath:c,additionalPath:l.additionalPath},this.wipSkipRecursion=!0,{summary:l.summary,stats:l.stats}}})}completeSummary(e){this.completeSummaryCore(e,void 0,!1)}completeSummaryCore(e,t,n){C(this.wipSummaryLogger!==void 0,419),C(this.wipReferenceSequenceNumber!==void 0,420);let i=this.wipLocalPaths;if(n){let a=this._latestSummary;if(a!==void 0)i={localPath:a.localPath,additionalPath:a.additionalPath};else{this.clearSummary();return}}C(!!i,421);let s=new hn(Object.assign(Object.assign({},i),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),o=s.fullPathForChildren;for(let a of this.children.values())a.completeSummaryCore(e,o,this.wipSkipRecursion||n);this.pendingSummaries.set(e,s),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(let e of this.children.values())e.clearSummary()}refreshLatestSummary(e,t,n,i,s){return y(this,null,function*(){if(e!==void 0){let a=this.pendingSummaries.get(e);if(a!==void 0)return this.refreshLatestSummaryFromPending(e,a.referenceSequenceNumber),{latestSummaryUpdated:!0,wasSummaryTracked:!0}}if(this.referenceSequenceNumber>=t)return{latestSummaryUpdated:!1};let o=yield n();return yield this.refreshLatestSummaryFromSnapshot(t,o,void 0,fr.create(""),s,i),{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:o}})}refreshLatestSummaryFromPending(e,t){let n=this.pendingSummaries.get(e);if(n===void 0){C(this._latestSummary===void 0,422);return}else C(t===n.referenceSequenceNumber,423),this.pendingSummaries.delete(e);this.refreshLatestSummaryCore(t),this._latestSummary=n;for(let i of this.children.values())i.refreshLatestSummaryFromPending(e,t)}refreshLatestSummaryFromSnapshot(e,t,n,i,s,o){return y(this,null,function*(){if(this.referenceSequenceNumber>=e)return;this.refreshLatestSummaryCore(e);let{baseSummary:a,pathParts:c}=Xm(t,s);this._latestSummary=new hn({referenceSequenceNumber:e,basePath:n,localPath:i});let{childrenTree:l,childrenPathPart:d}=Cu(a);d!==void 0&&c.push(d),c.length>0&&(this._latestSummary.additionalPath=fr.createAndConcat(c));let h=this._latestSummary.fullPathForChildren;yield Promise.all(Array.from(this.children).filter(([u])=>l.trees[u]!==void 0).map(g=>y(this,[g],function*([u,f]){return f.refreshLatestSummaryFromSnapshot(e,l.trees[u],h,fr.create(u),s,o)})))})}refreshLatestSummaryCore(e){for(let[t,n]of this.pendingSummaries)n.referenceSequenceNumber<e&&this.pendingSummaries.delete(t);for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}loadBaseSummaryWithoutDifferential(e){let{childrenPathPart:t}=Cu(e);t!==void 0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=fr.create(t))}loadBaseSummary(e,t){return y(this,null,function*(){let n=Xm(e,this.defaultLogger),i=yield n.getOutstandingOps(t),{childrenPathPart:s}=Cu(n.baseSummary);if(s!==void 0&&n.pathParts.push(s),n.pathParts.length>0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=fr.createAndConcat(n.pathParts)),i.length>0){let o=i[i.length-1].sequenceNumber;C(o<=this.trackingSequenceNumber,425)}return{baseSummary:n.baseSummary,outstandingOps:i}})}recordChange(e){let t=this.outstandingOps[this.outstandingOps.length-1];t!==void 0&&C(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}invalidate(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}get latestSummary(){return this._latestSummary}createChild(e,t,n,i={}){C(!this.children.has(t),427);let s=this.getCreateDetailsForChild(t,n),o=new r(this.defaultLogger,e,i,s.changeSequenceNumber,s.latestSummary,s.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(o),this.children.set(t,o),o}getChild(e){return this.children.get(e)}getCreateDetailsForChild(e,t){var n;let i,s,o,a=this._latestSummary;switch(t.type){case rc.CreateSummarizerNodeSource.FromAttach:{if(a!==void 0&&t.sequenceNumber<=a.referenceSequenceNumber)s=a.createForChild(e);else{let c=uo(t.snapshot);i={sequenceNumber:t.sequenceNumber,id:e,summary:c}}o=t.sequenceNumber;break}case rc.CreateSummarizerNodeSource.FromSummary:this.initialSummary===void 0&&C(!!a,428);case rc.CreateSummarizerNodeSource.Local:{let c=this.initialSummary;if(c!==void 0){let l;if(c.summary!==void 0){let{childrenTree:h}=D_(c.summary.summary);C(h.type===ht.Tree,470),l=h.tree[e]}t.type===rc.CreateSummarizerNodeSource.FromSummary&&C(!!l,429);let d;l!==void 0&&(C(l.type===ht.Tree,430),d={summary:l,stats:Za(l)}),i={sequenceNumber:c.sequenceNumber,id:e,summary:d}}s=a?.createForChild(e),o=(n=a?.referenceSequenceNumber)!==null&&n!==void 0?n:-1;break}default:{let c=t.type;ot(t,`Unexpected CreateSummarizerNodeSource: ${c}`)}}return{initialSummary:i,latestSummary:s,changeSequenceNumber:o}}maybeUpdateChildState(e){if(this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),e._latestSummary!==void 0)for(let[t,n]of this.pendingSummaries.entries()){let i=new hn({referenceSequenceNumber:n.referenceSequenceNumber,basePath:e._latestSummary.basePath,localPath:e._latestSummary.localPath});e.addPendingSummary(t,i)}}addPendingSummary(e,t){this.pendingSummaries.set(e,t)}isTrackingInProgress(){return this.wipReferenceSequenceNumber!==void 0}},F_=(r,e,t,n,i={})=>new nc(r,e,i,t,n===void 0?void 0:hn.createForRoot(n))});function Eu(r,e){let t=new Set,n=[...e];for(let o of n){if(t.has(o))continue;t.add(o);let a=r[o];a!==void 0&&n.push(...a)}let i=[],s=[];for(let o of Object.keys(r))t.has(o)?i.push(o):s.push(o);return{referencedNodeIds:i,deletedNodeIds:s}}var P_=J(()=>{});function I_(r){return r.replace(/^\/+|\/+$/g,"")}function W9(r){return r.replace(/^\/+/g,"")}function K9(r){return r.replace(/\/+$/g,"")}function Qi(r){let e={};for(let[t,n]of Object.entries(r.gcNodes))e[t]=Array.from(n);return{gcNodes:e}}function _u(r){let e=new Map;if(r.gcData===void 0)return e;let t=r.gcData.gcNodes;delete t["/"];for(let[i,s]of Object.entries(t)){C(i.startsWith("/"),686);let o=i.split("/")[1],a=i.slice(o.length+1);a===""&&(a="/");let c=e.get(o);c===void 0&&(c={gcData:{gcNodes:{}},usedRoutes:[]}),C(c.gcData!==void 0,687),c.gcData.gcNodes[a]=[...new Set(s)],e.set(o,c)}if(r.usedRoutes===void 0)return e;let n=r.usedRoutes.filter(i=>i!==""&&i!=="/");for(let i of n){C(i.startsWith("/"),688);let s=i.split("/")[1],o=i.slice(s.length+1),a=e.get(s);C(a?.usedRoutes!==void 0,689),a.usedRoutes.push(o),e.set(s,a)}return e}function Tu(r){let e=r.filter(n=>n!==""&&n!=="/"),t=new Map;for(let n of e){C(n.startsWith("/"),408);let i=n.split("/")[1],s=n.slice(i.length+1),o=t.get(i);o!==void 0?o.push(s):t.set(i,[s])}return t}function O_(r,e){let t=Object.entries(r);for(let[n,i]of t){let s=new Set(i);s.delete(e),r[n]=[...s]}}function N_(r,e){var t;let n={};for(let[i,s]of Object.entries(r.gcNodes))n[i]={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs};for(let[i,s]of Object.entries(e.gcNodes)){let o=n[i];o===void 0?o={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs}:(s.unreferencedTimestampMs!==void 0&&o.unreferencedTimestampMs!==void 0&&C(s.unreferencedTimestampMs===o.unreferencedTimestampMs,690),o={outboundRoutes:[...new Set([...s.outboundRoutes,...o.outboundRoutes])],unreferencedTimestampMs:(t=s.unreferencedTimestampMs)!==null&&t!==void 0?t:o.unreferencedTimestampMs}),n[i]=o}return{gcNodes:n}}function R_(r,e){let t=Qi(r);for(let[n,i]of Object.entries(e.gcNodes))if(t.gcNodes[n]===void 0)t.gcNodes[n]=Array.from(i);else{let s=[...i,...t.gcNodes[n]];t.gcNodes[n]=[...new Set(s)]}return t}var vi,k_=J(()=>{te();vi=class{constructor(){this.gcNodesSet={}}get gcNodes(){let e={};for(let[t,n]of Object.entries(this.gcNodesSet))e[t]=[...n];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(let[n,i]of Object.entries(t)){let s=W9(n);s=`/${e}/${s}`,s=K9(s),this.gcNodesSet[s]=new Set(i)}}addNodes(e){for(let[t,n]of Object.entries(e))this.gcNodesSet[t]=new Set(n)}addRouteToAllNodes(e){for(let t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}});var M_=J(()=>{});var po=J(()=>{P_();k_();M_();});var B_,Zm,eg,Au,q_=J(()=>{te();po();B_=ye(Tr());Qm();Ym();Zm=class extends hn{constructor(e,t){super(t),this.serializedUsedRoutes=e}},eg=class r extends nc{constructor(e,t,n,i,s,o,a,c,l){super(e,(d,h,u)=>y(this,null,function*(){return t(d,!0,u)}),n,i,s,o,a),this.summarizeFn=t,this.getGCDataFn=c,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=n.gcDisabled===!0,this.baseGCDetailsP=new At(()=>y(this,null,function*(){var d;return(d=yield l?.())!==null&&d!==void 0?d:{usedRoutes:[]}}))}getGCSummaryDetails(){return this.getBaseGCDetails()}getBaseGCDetails(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}loadBaseGCDetails(){return y(this,null,function*(){var e;let t=yield this.baseGCDetailsP;this.baseGCDetailsLoaded||(this.baseGCDetailsLoaded=!0,t.gcData!==void 0&&(this.gcData=Qi(t.gcData)),this.referenceUsedRoutes=(e=t.usedRoutes)===null||e===void 0?void 0:e.sort(),this.unreferencedTimestampMs=t.unrefTimestamp)})}summarize(e,t=!0,n){return y(this,null,function*(){return!this.gcDisabled&&this.isTrackingInProgress()&&C(this.wipSerializedUsedRoutes!==void 0,433),t?qr(r.prototype,this,"summarize").call(this,e,!0,n):this.summarizeFn(e,t,n)})}getGCData(e=!1){return y(this,null,function*(){if(C(!this.gcDisabled,434),C(this.getGCDataFn!==void 0,435),yield this.loadBaseGCDetails(),!e&&!this.hasDataChanged()&&this.gcData!==void 0)return Qi(this.gcData);let t=yield this.getGCDataFn(e);return this.gcData=Qi(t),t})}startSummary(e,t){this.gcDisabled||C(this.wipSerializedUsedRoutes===void 0,436),super.startSummary(e,t)}completeSummaryCore(e,t,n){let i;if(this.gcDisabled||(i=this.wipSerializedUsedRoutes,C(i!==void 0,437)),super.completeSummaryCore(e,t,n),!this.gcDisabled){let s=this.pendingSummaries.get(e);if(s!==void 0){let o=new Zm(i,s);this.pendingSummaries.set(e,o)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(e,t){if(!this.gcDisabled){let n=this.pendingSummaries.get(e);n!==void 0&&(this.referenceUsedRoutes=JSON.parse(n.serializedUsedRoutes))}return super.refreshLatestSummaryFromPending(e,t)}refreshLatestSummaryFromSnapshot(e,t,n,i,s,o){return y(this,null,function*(){if(!this.gcDisabled){let a=t.blobs[B_.gcBlobKey];if(a!==void 0){let c=yield o(a);if(this.referenceSequenceNumber>=e)return;this.referenceUsedRoutes=c.usedRoutes}}return qr(r.prototype,this,"refreshLatestSummaryFromSnapshot").call(this,e,t,n,i,s,o)})}createChild(e,t,n,i={},s,o){var a;C(!this.children.has(t),438);let c=this.getCreateDetailsForChild(t,n),l=new r(this.defaultLogger,e,Object.assign(Object.assign({},i),{gcDisabled:(a=i.gcDisabled)!==null&&a!==void 0?a:this.gcDisabled}),c.changeSequenceNumber,c.latestSummary,c.initialSummary,this.wipSummaryLogger,s,o);return this.maybeUpdateChildState(l),this.children.set(t,l),l}deleteChild(e){this.children.delete(e)}getChild(e){return this.children.get(e)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(e,t){if(this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()){this.unreferencedTimestampMs=void 0;return}this.unreferencedTimestampMs===void 0&&(this.unreferencedTimestampMs=t)}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return this.gcDisabled?!1:this.referenceUsedRoutes===void 0||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes)}},Au=(r,e,t,n,i={},s,o)=>new eg(r,e,i,t,n===void 0?void 0:hn.createForRoot(n),void 0,void 0,s,o)});var L_=J(()=>{Qm();q_();});function tg(r,e){return y(this,null,function*(){let t=r.trees[".protocol"].blobs.attributes;return(yield e(t)).sequenceNumber})}var j_=J(()=>{});var rg={};Pi(rg,{ObjectStoragePartition:()=>Wm,RequestParser:()=>hr,RuntimeFactoryHelper:()=>Xa,SummaryTreeBuilder:()=>mt,TelemetryContext:()=>Qa,addBlobToSummary:()=>dr,addSummarizeResultToSummary:()=>Jm,addTreeToSummary:()=>$m,calculateStats:()=>Za,convertSnapshotTreeToSummaryTree:()=>ho,convertSummaryTreeToITree:()=>fo,convertToSummaryTree:()=>uo,convertToSummaryTreeWithStats:()=>E_,create404Response:()=>Et,createDataStoreFactory:()=>z9,createResponseError:()=>gu,createRootSummarizerNode:()=>F_,createRootSummarizerNodeWithGC:()=>Au,exceptionToResponse:()=>mi,generateHandleContextPath:()=>Vr,getBlobSize:()=>Km,getNormalizedObjectStoragePathParts:()=>vu,listBlobsAtTreePath:()=>H9,mergeStats:()=>Gr,requestFluidObject:()=>un,responseToException:()=>gi,seqFromTree:()=>tg,utf8ByteLength:()=>w_});var at=J(()=>{ZE();e_();t_();r_();n_();i_();L_();wu();j_();});var z_=J(()=>{});var mo,Du,$9,ng=J(()=>{mo=r=>typeof r=="object"&&typeof r?.name=="string"&&typeof r?.fluid=="object",Du=r=>{let e=r;return typeof e=="object"&&(typeof e?.package=="string"||mo(e?.package))&&(e?.config===void 0||typeof e?.config=="object")},$9="IFluidCodeDetailsComparer"});var J9,H_=J(()=>{ng();J9=r=>{var e,t,n,i,s,o;return mo(r)&&typeof((n=(t=(e=r?.fluid)===null||e===void 0?void 0:e.browser)===null||t===void 0?void 0:t.umd)===null||n===void 0?void 0:n.library)=="string"&&Array.isArray((o=(s=(i=r?.fluid)===null||i===void 0?void 0:i.browser)===null||s===void 0?void 0:s.umd)===null||o===void 0?void 0:o.files)}});var V_=J(()=>{});var yi,U_=J(()=>{yi=function(r){return r.genericError="genericError",r.throttlingError="throttlingError",r.dataCorruptionError="dataCorruptionError",r.dataProcessingError="dataProcessingError",r.usageError="usageError",r.clientSessionExpiredError="clientSessionExpiredError",r}(yi||{})});var et,G_=J(()=>{et=function(r){return r.cache="fluid-cache",r.clientDetails="fluid-client-details",r.loadMode="loadMode",r.reconnect="fluid-reconnect",r.sequenceNumber="fluid-sequence-number",r.version="version",r}(et||{})});var W_=J(()=>{});var se,nr,X9,K_=J(()=>{se=function(r){return r.Detached="Detached",r.Attaching="Attaching",r.Attached="Attached",r}(se||{}),nr=function(r){return r.NotBound="NotBound",r.Binding="Binding",r.Bound="Bound",r}(nr||{}),X9="IRuntimeFactory"});var Y9,$_=J(()=>{Y9="IFluidTokenProvider"});var ig={};Pi(ig,{AttachState:()=>se,BindState:()=>nr,ContainerErrorType:()=>yi,IFluidCodeDetailsComparer:()=>$9,IFluidTokenProvider:()=>Y9,IRuntimeFactory:()=>X9,LoaderHeader:()=>et,isFluidBrowserPackage:()=>J9,isFluidCodeDetails:()=>Du,isFluidPackage:()=>mo});var Pt=J(()=>{z_();H_();V_();U_();G_();W_();ng();K_();$_();});var ug=R((jte,o4)=>{"use strict";function Be(r){if(this._capacity=s4(r),this._length=0,this._front=0,i4(r)){for(var e=r.length,t=0;t<e;++t)this[t]=r[t];this._length=e}}Be.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,i=this._capacity,s=0;s<e;++s)t[s]=this[n+s&i-1];return t};Be.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var i=this._capacity;if(n+t>i){for(var o=0;o<t;++o){this._checkCapacity(n+1);var s=this._front+n&this._capacity-1;this[s]=arguments[o],n++,this._length=n}return n}else{for(var s=this._front,o=0;o<t;++o)this[s+n&i-1]=arguments[o],s++;return this._length=n+t,n+t}}if(t===0)return n;this._checkCapacity(n+1);var o=this._front+n&this._capacity-1;return this[o]=e,this._length=n+1,n+1};Be.prototype.pop=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}};Be.prototype.shift=function(){var e=this._length;if(e!==0){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}};Be.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){var o=this._capacity;if(t+n>o){for(var a=n-1;a>=0;a--){this._checkCapacity(t+1);var o=this._capacity,i=(this._front-1&o-1^o)-o;this[i]=arguments[a],t++,this._length=t,this._front=i}return t}else{for(var s=this._front,a=n-1;a>=0;a--){var i=(s-1&o-1^o)-o;this[i]=arguments[a],s=i}return this._front=s,this._length=t+n,t+n}}if(n===0)return t;this._checkCapacity(t+1);var o=this._capacity,a=(this._front-1&o-1^o)-o;return this[a]=e,this._length=t+1,this._front=a,t+1};Be.prototype.peekBack=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1;return this[t]}};Be.prototype.peekFront=function(){if(this._length!==0)return this[this._front]};Be.prototype.get=function(e){var t=e;if(t===(t|0)){var n=this._length;if(t<0&&(t=t+n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}};Be.prototype.isEmpty=function(){return this._length===0};Be.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,i=0;i<e;++i)this[t+i&n-1]=void 0;this._length=0,this._front=0};Be.prototype.toString=function(){return this.toArray().toString()};Be.prototype.valueOf=Be.prototype.toString;Be.prototype.removeFront=Be.prototype.shift;Be.prototype.removeBack=Be.prototype.pop;Be.prototype.insertFront=Be.prototype.unshift;Be.prototype.insertBack=Be.prototype.push;Be.prototype.enqueue=Be.prototype.push;Be.prototype.dequeue=Be.prototype.shift;Be.prototype.toJSON=Be.prototype.toArray;Object.defineProperty(Be.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}});Be.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(s4(this._capacity*1.5+16))};Be.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,i=this._length;if(n+i>t){var s=n+i&t-1;iq(this,0,this,t,s)}};var i4=Array.isArray;function iq(r,e,t,n,i){for(var s=0;s<i;++s)t[s+n]=r[s+e],r[s+e]=void 0}function sq(r){return r=r>>>0,r=r-1,r=r|r>>1,r=r|r>>2,r=r|r>>4,r=r|r>>8,r=r|r>>16,r+1}function s4(r){if(typeof r!="number")if(i4(r))r=r.length;else return 16;return sq(Math.min(Math.max(16,r),1073741824))}o4.exports=Be});var D4=R((Vie,A4)=>{"use strict";function mn(r){if(typeof r!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(r))}function T4(r,e){for(var t="",n=0,i=-1,s=0,o,a=0;a<=r.length;++a){if(a<r.length)o=r.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(t.length<2||n!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var c=t.lastIndexOf("/");if(c!==t.length-1){c===-1?(t="",n=0):(t=t.slice(0,c),n=t.length-1-t.lastIndexOf("/")),i=a,s=0;continue}}else if(t.length===2||t.length===1){t="",n=0,i=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",n=2)}else t.length>0?t+="/"+r.slice(i+1,a):t=r.slice(i+1,a),n=a-i-1;i=a,s=0}else o===46&&s!==-1?++s:s=-1}return t}function Fq(r,e){var t=e.dir||e.root,n=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+n:t+r+n:n}var _o={resolve:function(){for(var e="",t=!1,n,i=arguments.length-1;i>=-1&&!t;i--){var s;i>=0?s=arguments[i]:(n===void 0&&(n=process.cwd()),s=n),mn(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=T4(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(mn(e),e.length===0)return".";var t=e.charCodeAt(0)===47,n=e.charCodeAt(e.length-1)===47;return e=T4(e,!t),e.length===0&&!t&&(e="."),e.length>0&&n&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return mn(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];mn(n),n.length>0&&(e===void 0?e=n:e+="/"+n)}return e===void 0?".":_o.normalize(e)},relative:function(e,t){if(mn(e),mn(t),e===t||(e=_o.resolve(e),t=_o.resolve(t),e===t))return"";for(var n=1;n<e.length&&e.charCodeAt(n)===47;++n);for(var i=e.length,s=i-n,o=1;o<t.length&&t.charCodeAt(o)===47;++o);for(var a=t.length,c=a-o,l=s<c?s:c,d=-1,h=0;h<=l;++h){if(h===l){if(c>l){if(t.charCodeAt(o+h)===47)return t.slice(o+h+1);if(h===0)return t.slice(o+h)}else s>l&&(e.charCodeAt(n+h)===47?d=h:h===0&&(d=0));break}var u=e.charCodeAt(n+h),f=t.charCodeAt(o+h);if(u!==f)break;u===47&&(d=h)}var g="";for(h=n+d+1;h<=i;++h)(h===i||e.charCodeAt(h)===47)&&(g.length===0?g+="..":g+="/..");return g.length>0?g+t.slice(o+d):(o+=d,t.charCodeAt(o)===47&&++o,t.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(mn(e),e.length===0)return".";for(var t=e.charCodeAt(0),n=t===47,i=-1,s=!0,o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),t===47){if(!s){i=o;break}}else s=!1;return i===-1?n?"/":".":n&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');mn(e);var n=0,i=-1,s=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,c=-1;for(o=e.length-1;o>=0;--o){var l=e.charCodeAt(o);if(l===47){if(!s){n=o+1;break}}else c===-1&&(s=!1,c=o+1),a>=0&&(l===t.charCodeAt(a)?--a===-1&&(i=o):(a=-1,i=c))}return n===i?i=c:i===-1&&(i=e.length),e.slice(n,i)}else{for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!s){n=o+1;break}}else i===-1&&(s=!1,i=o+1);return i===-1?"":e.slice(n,i)}},extname:function(e){mn(e);for(var t=-1,n=0,i=-1,s=!0,o=0,a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(c===47){if(!s){n=a+1;break}continue}i===-1&&(s=!1,i=a+1),c===46?t===-1?t=a:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||i===-1||o===0||o===1&&t===i-1&&t===n+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Fq("/",e)},parse:function(e){mn(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var n=e.charCodeAt(0),i=n===47,s;i?(t.root="/",s=1):s=0;for(var o=-1,a=0,c=-1,l=!0,d=e.length-1,h=0;d>=s;--d){if(n=e.charCodeAt(d),n===47){if(!l){a=d+1;break}continue}c===-1&&(l=!1,c=d+1),n===46?o===-1?o=d:h!==1&&(h=1):o!==-1&&(h=-1)}return o===-1||c===-1||h===0||h===1&&o===c-1&&o===a+1?c!==-1&&(a===0&&i?t.base=t.name=e.slice(1,c):t.base=t.name=e.slice(a,c)):(a===0&&i?(t.name=e.slice(1,o),t.base=e.slice(1,c)):(t.name=e.slice(a,o),t.base=e.slice(a,c)),t.ext=e.slice(o,c)),a>0?t.dir=e.slice(0,a-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};_o.posix=_o;A4.exports=_o});var z4=R(wh=>{"use strict";Object.defineProperty(wh,"__esModule",{value:!0});wh.IContainerRuntime=void 0;wh.IContainerRuntime="IContainerRuntime"});var H4=R(rs=>{"use strict";var Iq=rs&&rs.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Oq=rs&&rs.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Iq(e,r,t)};Object.defineProperty(rs,"__esModule",{value:!0});Oq(z4(),rs)});var kg=R((ooe,K4)=>{var Nq=ol(),Rq=sa();function kq(r,e,t){(t!==void 0&&!Rq(r[e],t)||t===void 0&&!(e in r))&&Nq(r,e,t)}K4.exports=kq});var J4=R((aoe,$4)=>{function Mq(r){return function(e,t,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var c=o[r?a:++i];if(t(s[c],c,s)===!1)break}return e}}$4.exports=Mq});var Y4=R((coe,X4)=>{var Bq=J4(),qq=Bq();X4.exports=qq});var Z4=R((loe,Q4)=>{var Lq=ma(),jq=Jn();function zq(r){return jq(r)&&Lq(r)}Q4.exports=zq});var r3=R((uoe,t3)=>{var Hq=Es(),Vq=fl(),Uq=Jn(),Gq="[object Object]",Wq=Function.prototype,Kq=Object.prototype,e3=Wq.toString,$q=Kq.hasOwnProperty,Jq=e3.call(Object);function Xq(r){if(!Uq(r)||Hq(r)!=Gq)return!1;var e=Vq(r);if(e===null)return!0;var t=$q.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&e3.call(t)==Jq}t3.exports=Xq});var Mg=R((hoe,n3)=>{function Yq(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}n3.exports=Yq});var s3=R((doe,i3)=>{var Qq=Ds(),Zq=Is();function e7(r){return Qq(r,Zq(r))}i3.exports=e7});var h3=R((foe,u3)=>{var o3=kg(),t7=Uf(),r7=tp(),n7=Gf(),i7=rp(),a3=Bf(),c3=ha(),s7=Z4(),o7=al(),a7=il(),c7=En(),l7=r3(),u7=zf(),l3=Mg(),h7=s3();function d7(r,e,t,n,i,s,o){var a=l3(r,t),c=l3(e,t),l=o.get(c);if(l){o3(r,t,l);return}var d=s?s(a,c,t+"",r,e,o):void 0,h=d===void 0;if(h){var u=c3(c),f=!u&&o7(c),g=!u&&!f&&u7(c);d=c,u||f||g?c3(a)?d=a:s7(a)?d=n7(a):f?(h=!1,d=t7(c,!0)):g?(h=!1,d=r7(c,!0)):d=[]:l7(c)||a3(c)?(d=a,a3(a)?d=h7(a):(!c7(a)||a7(a))&&(d=i7(c))):h=!1}h&&(o.set(c,d),i(d,c,n,s,o),o.delete(c)),o3(r,t,d)}u3.exports=d7});var p3=R((poe,f3)=>{var f7=Rf(),p7=kg(),m7=Y4(),g7=h3(),v7=En(),y7=Is(),b7=Mg();function d3(r,e,t,n,i){r!==e&&m7(e,function(s,o){if(i||(i=new f7),v7(s))g7(r,e,o,t,d3,n,i);else{var a=n?n(b7(r,o),s,o+"",r,e,i):void 0;a===void 0&&(a=s),p7(r,o,a)}},y7)}f3.exports=d3});var Bg=R((moe,m3)=>{function x7(r){return r}m3.exports=x7});var v3=R((goe,g3)=>{function S7(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}g3.exports=S7});var x3=R((voe,b3)=>{var w7=v3(),y3=Math.max;function C7(r,e,t){return e=y3(e===void 0?r.length-1:e,0),function(){for(var n=arguments,i=-1,s=y3(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=t(o),w7(r,this,a)}}b3.exports=C7});var w3=R((yoe,S3)=>{function E7(r){return function(){return r}}S3.exports=E7});var _3=R((boe,E3)=>{var _7=w3(),C3=kf(),T7=Bg(),A7=C3?function(r,e){return C3(r,"toString",{configurable:!0,enumerable:!1,value:_7(e),writable:!0})}:T7;E3.exports=A7});var A3=R((xoe,T3)=>{var D7=800,F7=16,P7=Date.now;function I7(r){var e=0,t=0;return function(){var n=P7(),i=F7-(n-t);if(t=n,i>0){if(++e>=D7)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}T3.exports=I7});var F3=R((Soe,D3)=>{var O7=_3(),N7=A3(),R7=N7(O7);D3.exports=R7});var I3=R((woe,P3)=>{var k7=Bg(),M7=x3(),B7=F3();function q7(r,e){return B7(M7(r,e,k7),r+"")}P3.exports=q7});var N3=R((Coe,O3)=>{var L7=sa(),j7=ma(),z7=qf(),H7=En();function V7(r,e,t){if(!H7(t))return!1;var n=typeof e;return(n=="number"?j7(t)&&z7(e,t.length):n=="string"&&e in t)?L7(t[e],r):!1}O3.exports=V7});var k3=R((Eoe,R3)=>{var U7=I3(),G7=N3();function W7(r){return U7(function(e,t){var n=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=r.length>3&&typeof s=="function"?(i--,s):void 0,o&&G7(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=t[n];a&&r(e,a,n,s)}return e})}R3.exports=W7});var B3=R((_oe,M3)=>{var K7=p3(),$7=k3(),J7=$7(function(r,e,t){K7(r,e,t)});M3.exports=J7});var qg=R((qoe,Ph)=>{"use strict";var{AbortController:j3,AbortSignal:Y7}=typeof self<"u"?self:typeof window<"u"?window:void 0;Ph.exports=j3;Ph.exports.AbortSignal=Y7;Ph.exports.default=j3});var ST=R(Z=>{var bc={};bc.userAgent=!1;var Do={},uL="11.1.0",hL="jsrsasign(all) 11.1.0 (2024-02-01) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license";var ee=ee||function(r,e){var t={},n=t.lib={},i=n.Base=function(){function f(){}return{extend:function(g){f.prototype=this;var m=new f;return g&&m.mixIn(g),m.hasOwnProperty("init")||(m.init=function(){m.$super.init.apply(this,arguments)}),m.init.prototype=m,m.$super=this,m},create:function(){var g=this.extend();return g.init.apply(g,arguments),g},init:function(){},mixIn:function(g){for(var m in g)g.hasOwnProperty(m)&&(this[m]=g[m]);g.hasOwnProperty("toString")&&(this.toString=g.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=n.WordArray=i.extend({init:function(f,g){f=this.words=f||[],g!=e?this.sigBytes=g:this.sigBytes=f.length*4},toString:function(f){return(f||a).stringify(this)},concat:function(f){var g=this.words,m=f.words,b=this.sigBytes,v=f.sigBytes;if(this.clamp(),b%4)for(var x=0;x<v;x++){var _=m[x>>>2]>>>24-x%4*8&255;g[b+x>>>2]|=_<<24-(b+x)%4*8}else for(var x=0;x<v;x+=4)g[b+x>>>2]=m[x>>>2];return this.sigBytes+=v,this},clamp:function(){var f=this.words,g=this.sigBytes;f[g>>>2]&=4294967295<<32-g%4*8,f.length=r.ceil(g/4)},clone:function(){var f=i.clone.call(this);return f.words=this.words.slice(0),f},random:function(f){for(var g=[],m=0;m<f;m+=4)g.push(r.random()*4294967296|0);return new s.init(g,f)}}),o=t.enc={},a=o.Hex={stringify:function(f){for(var g=f.words,m=f.sigBytes,b=[],v=0;v<m;v++){var x=g[v>>>2]>>>24-v%4*8&255;b.push((x>>>4).toString(16)),b.push((x&15).toString(16))}return b.join("")},parse:function(f){for(var g=f.length,m=[],b=0;b<g;b+=2)m[b>>>3]|=parseInt(f.substr(b,2),16)<<24-b%8*4;return new s.init(m,g/2)}},c=o.Latin1={stringify:function(f){for(var g=f.words,m=f.sigBytes,b=[],v=0;v<m;v++){var x=g[v>>>2]>>>24-v%4*8&255;b.push(String.fromCharCode(x))}return b.join("")},parse:function(f){for(var g=f.length,m=[],b=0;b<g;b++)m[b>>>2]|=(f.charCodeAt(b)&255)<<24-b%4*8;return new s.init(m,g)}},l=o.Utf8={stringify:function(f){try{return decodeURIComponent(escape(c.stringify(f)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(f){return c.parse(unescape(encodeURIComponent(f)))}},d=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(f){typeof f=="string"&&(f=l.parse(f)),this._data.concat(f),this._nDataBytes+=f.sigBytes},_process:function(f){var g=this._data,m=g.words,b=g.sigBytes,v=this.blockSize,x=v*4,_=b/x;f?_=r.ceil(_):_=r.max((_|0)-this._minBufferSize,0);var A=_*v,D=r.min(A*4,b);if(A){for(var O=0;O<A;O+=v)this._doProcessBlock(m,O);var M=m.splice(0,A);g.sigBytes-=D}return new s.init(M,D)},clone:function(){var f=i.clone.call(this);return f._data=this._data.clone(),f},_minBufferSize:0}),h=n.Hasher=d.extend({cfg:i.extend(),init:function(f){this.cfg=this.cfg.extend(f),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(f){return this._append(f),this._process(),this},finalize:function(f){f&&this._append(f);var g=this._doFinalize();return g},blockSize:512/32,_createHelper:function(f){return function(g,m){return new f.init(m).finalize(g)}},_createHmacHelper:function(f){return function(g,m){return new u.HMAC.init(f,m).finalize(g)}}}),u=t.algo={};return t}(Math);(function(r){var i=ee,e=i.lib,t=e.Base,n=e.WordArray,i=i.x64={};i.Word=t.extend({init:function(s,o){this.high=s,this.low=o}}),i.WordArray=t.extend({init:function(s,o){s=this.words=s||[],this.sigBytes=o!=r?o:8*s.length},toX32:function(){for(var s=this.words,o=s.length,a=[],c=0;c<o;c++){var l=s[c];a.push(l.high),a.push(l.low)}return n.create(a,this.sigBytes)},clone:function(){for(var s=t.clone.call(this),o=s.words=this.words.slice(0),a=o.length,c=0;c<a;c++)o[c]=o[c].clone();return s}})})();ee.lib.Cipher||function(r){var f=ee,e=f.lib,t=e.Base,n=e.WordArray,i=e.BufferedBlockAlgorithm,s=f.enc.Base64,o=f.algo.EvpKDF,a=e.Cipher=i.extend({cfg:t.extend(),createEncryptor:function(m,b){return this.create(this._ENC_XFORM_MODE,m,b)},createDecryptor:function(m,b){return this.create(this._DEC_XFORM_MODE,m,b)},init:function(m,b,v){this.cfg=this.cfg.extend(v),this._xformMode=m,this._key=b,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(m){return this._append(m),this._process()},finalize:function(m){return m&&this._append(m),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(m){return{encrypt:function(b,v,x){return(typeof v=="string"?g:u).encrypt(m,b,v,x)},decrypt:function(b,v,x){return(typeof v=="string"?g:u).decrypt(m,b,v,x)}}}});e.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=f.mode={},c=function(m,b,v){var x=this._iv;x?this._iv=r:x=this._prevBlock;for(var _=0;_<v;_++)m[b+_]^=x[_]},l=(e.BlockCipherMode=t.extend({createEncryptor:function(m,b){return this.Encryptor.create(m,b)},createDecryptor:function(m,b){return this.Decryptor.create(m,b)},init:function(m,b){this._cipher=m,this._iv=b}})).extend();l.Encryptor=l.extend({processBlock:function(m,b){var v=this._cipher,x=v.blockSize;c.call(this,m,b,x),v.encryptBlock(m,b),this._prevBlock=m.slice(b,b+x)}}),l.Decryptor=l.extend({processBlock:function(m,b){var v=this._cipher,x=v.blockSize,_=m.slice(b,b+x);v.decryptBlock(m,b),c.call(this,m,b,x),this._prevBlock=_}}),h=h.CBC=l,l=(f.pad={}).Pkcs7={pad:function(m,b){for(var v=4*b,v=v-m.sigBytes%v,x=v<<24|v<<16|v<<8|v,_=[],A=0;A<v;A+=4)_.push(x);v=n.create(_,v),m.concat(v)},unpad:function(m){m.sigBytes-=m.words[m.sigBytes-1>>>2]&255}},e.BlockCipher=a.extend({cfg:a.cfg.extend({mode:h,padding:l}),reset:function(){a.reset.call(this);var b=this.cfg,m=b.iv,b=b.mode;if(this._xformMode==this._ENC_XFORM_MODE)var v=b.createEncryptor;else v=b.createDecryptor,this._minBufferSize=1;this._mode=v.call(b,this,m&&m.words)},_doProcessBlock:function(m,b){this._mode.processBlock(m,b)},_doFinalize:function(){var m=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){m.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),m.unpad(b);return b},blockSize:4});var d=e.CipherParams=t.extend({init:function(m){this.mixIn(m)},toString:function(m){return(m||this.formatter).stringify(this)}}),h=(f.format={}).OpenSSL={stringify:function(m){var b=m.ciphertext;return m=m.salt,(m?n.create([1398893684,1701076831]).concat(m).concat(b):b).toString(s)},parse:function(m){m=s.parse(m);var b=m.words;if(b[0]==1398893684&&b[1]==1701076831){var v=n.create(b.slice(2,4));b.splice(0,4),m.sigBytes-=16}return d.create({ciphertext:m,salt:v})}},u=e.SerializableCipher=t.extend({cfg:t.extend({format:h}),encrypt:function(m,b,v,x){x=this.cfg.extend(x);var _=m.createEncryptor(v,x);return b=_.finalize(b),_=_.cfg,d.create({ciphertext:b,key:v,iv:_.iv,algorithm:m,mode:_.mode,padding:_.padding,blockSize:m.blockSize,formatter:x.format})},decrypt:function(m,b,v,x){return x=this.cfg.extend(x),b=this._parse(b,x.format),m.createDecryptor(v,x).finalize(b.ciphertext)},_parse:function(m,b){return typeof m=="string"?b.parse(m,this):m}}),f=(f.kdf={}).OpenSSL={execute:function(m,b,v,x){return x||(x=n.random(8)),m=o.create({keySize:b+v}).compute(m,x),v=n.create(m.words.slice(b),4*v),m.sigBytes=4*b,d.create({key:m,iv:v,salt:x})}},g=e.PasswordBasedCipher=u.extend({cfg:u.cfg.extend({kdf:f}),encrypt:function(m,b,v,x){return x=this.cfg.extend(x),v=x.kdf.execute(v,m.keySize,m.ivSize),x.iv=v.iv,m=u.encrypt.call(this,m,b,v.key,x),m.mixIn(v),m},decrypt:function(m,b,v,x){return x=this.cfg.extend(x),b=this._parse(b,x.format),v=x.kdf.execute(v,m.keySize,m.ivSize,b.salt),x.iv=v.iv,u.decrypt.call(this,m,b,v.key,x)}})}();(function(){for(var r=ee,e=r.lib.BlockCipher,O=r.algo,t=[],n=[],i=[],s=[],o=[],a=[],c=[],l=[],d=[],h=[],u=[],f=0;256>f;f++)u[f]=128>f?f<<1:f<<1^283;for(var g=0,m=0,f=0;256>f;f++){var b=m^m<<1^m<<2^m<<3^m<<4,b=b>>>8^b&255^99;t[g]=b,n[b]=g;var v=u[g],x=u[v],_=u[x],A=257*u[b]^16843008*b;i[g]=A<<24|A>>>8,s[g]=A<<16|A>>>16,o[g]=A<<8|A>>>24,a[g]=A,A=16843009*_^65537*x^257*v^16843008*g,c[b]=A<<24|A>>>8,l[b]=A<<16|A>>>16,d[b]=A<<8|A>>>24,h[b]=A,g?(g=v^u[u[u[_^v]]],m^=u[u[m]]):g=m=1}var D=[0,1,2,4,8,16,32,64,128,27,54],O=O.AES=e.extend({_doReset:function(){for(var E=this._key,M=E.words,S=E.sigBytes/4,E=4*((this._nRounds=S+6)+1),w=this._keySchedule=[],T=0;T<E;T++)if(T<S)w[T]=M[T];else{var F=w[T-1];T%S?6<S&&T%S==4&&(F=t[F>>>24]<<24|t[F>>>16&255]<<16|t[F>>>8&255]<<8|t[F&255]):(F=F<<8|F>>>24,F=t[F>>>24]<<24|t[F>>>16&255]<<16|t[F>>>8&255]<<8|t[F&255],F^=D[T/S|0]<<24),w[T]=w[T-S]^F}for(M=this._invKeySchedule=[],S=0;S<E;S++)T=E-S,F=S%4?w[T]:w[T-4],M[S]=4>S||4>=T?F:c[t[F>>>24]]^l[t[F>>>16&255]]^d[t[F>>>8&255]]^h[t[F&255]]},encryptBlock:function(M,S){this._doCryptBlock(M,S,this._keySchedule,i,s,o,a,t)},decryptBlock:function(M,S){var E=M[S+1];M[S+1]=M[S+3],M[S+3]=E,this._doCryptBlock(M,S,this._invKeySchedule,c,l,d,h,n),E=M[S+1],M[S+1]=M[S+3],M[S+3]=E},_doCryptBlock:function(M,S,E,w,T,F,N,P){for(var I=this._nRounds,ne=M[S]^E[0],me=M[S+1]^E[1],fe=M[S+2]^E[2],ie=M[S+3]^E[3],B=4,q=1;q<I;q++)var z=w[ne>>>24]^T[me>>>16&255]^F[fe>>>8&255]^N[ie&255]^E[B++],V=w[me>>>24]^T[fe>>>16&255]^F[ie>>>8&255]^N[ne&255]^E[B++],W=w[fe>>>24]^T[ie>>>16&255]^F[ne>>>8&255]^N[me&255]^E[B++],ie=w[ie>>>24]^T[ne>>>16&255]^F[me>>>8&255]^N[fe&255]^E[B++],ne=z,me=V,fe=W;z=(P[ne>>>24]<<24|P[me>>>16&255]<<16|P[fe>>>8&255]<<8|P[ie&255])^E[B++],V=(P[me>>>24]<<24|P[fe>>>16&255]<<16|P[ie>>>8&255]<<8|P[ne&255])^E[B++],W=(P[fe>>>24]<<24|P[ie>>>16&255]<<16|P[ne>>>8&255]<<8|P[me&255])^E[B++],ie=(P[ie>>>24]<<24|P[ne>>>16&255]<<16|P[me>>>8&255]<<8|P[fe&255])^E[B++],M[S]=z,M[S+1]=V,M[S+2]=W,M[S+3]=ie},keySize:8});r.AES=e._createHelper(O)})();(function(){function r(u,f){var g=(this._lBlock>>>u^this._rBlock)&f;this._rBlock^=g,this._lBlock^=g<<u}function e(u,f){var g=(this._rBlock>>>u^this._lBlock)&f;this._lBlock^=g,this._rBlock^=g<<u}var t=ee,i=t.lib,n=i.WordArray,i=i.BlockCipher,s=t.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=s.DES=i.extend({_doReset:function(){for(var u=this._key.words,f=[],g=0;56>g;g++){var m=o[g]-1;f[g]=u[m>>>5]>>>31-m%32&1}for(u=this._subKeys=[],m=0;16>m;m++){for(var b=u[m]=[],v=c[m],g=0;24>g;g++)b[g/6|0]|=f[(a[g]-1+v)%28]<<31-g%6,b[4+(g/6|0)]|=f[28+(a[g+24]-1+v)%28]<<31-g%6;for(b[0]=b[0]<<1|b[0]>>>31,g=1;7>g;g++)b[g]>>>=4*(g-1)+3;b[7]=b[7]<<5|b[7]>>>27}for(f=this._invSubKeys=[],g=0;16>g;g++)f[g]=u[15-g]},encryptBlock:function(u,f){this._doCryptBlock(u,f,this._subKeys)},decryptBlock:function(u,f){this._doCryptBlock(u,f,this._invSubKeys)},_doCryptBlock:function(u,f,g){this._lBlock=u[f],this._rBlock=u[f+1],r.call(this,4,252645135),r.call(this,16,65535),e.call(this,2,858993459),e.call(this,8,16711935),r.call(this,1,1431655765);for(var m=0;16>m;m++){for(var b=g[m],v=this._lBlock,x=this._rBlock,_=0,A=0;8>A;A++)_|=l[A][((x^b[A])&d[A])>>>0];this._lBlock=x,this._rBlock=v^_}g=this._lBlock,this._lBlock=this._rBlock,this._rBlock=g,r.call(this,1,1431655765),e.call(this,8,16711935),e.call(this,2,858993459),r.call(this,16,65535),r.call(this,4,252645135),u[f]=this._lBlock,u[f+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});t.DES=i._createHelper(h),s=s.TripleDES=i.extend({_doReset:function(){var u=this._key.words;this._des1=h.createEncryptor(n.create(u.slice(0,2))),this._des2=h.createEncryptor(n.create(u.slice(2,4))),this._des3=h.createEncryptor(n.create(u.slice(4,6)))},encryptBlock:function(u,f){this._des1.encryptBlock(u,f),this._des2.decryptBlock(u,f),this._des3.encryptBlock(u,f)},decryptBlock:function(u,f){this._des3.decryptBlock(u,f),this._des2.encryptBlock(u,f),this._des1.decryptBlock(u,f)},keySize:6,ivSize:2,blockSize:2}),t.TripleDES=i._createHelper(s)})();(function(){var r=ee,e=r.lib.WordArray;r.enc.Base64={stringify:function(t){var n=t.words,i=t.sigBytes,s=this._map;t.clamp(),t=[];for(var o=0;o<i;o+=3)for(var a=(n[o>>>2]>>>24-8*(o%4)&255)<<16|(n[o+1>>>2]>>>24-8*((o+1)%4)&255)<<8|n[o+2>>>2]>>>24-8*((o+2)%4)&255,c=0;4>c&&o+.75*c<i;c++)t.push(s.charAt(a>>>6*(3-c)&63));if(n=s.charAt(64))for(;t.length%4;)t.push(n);return t.join("")},parse:function(t){var n=t.length,i=this._map,s=i.charAt(64);s&&(s=t.indexOf(s),s!=-1&&(n=s));for(var s=[],o=0,a=0;a<n;a++)if(a%4){var c=i.indexOf(t.charAt(a-1))<<2*(a%4),l=i.indexOf(t.charAt(a))>>>6-2*(a%4);s[o>>>2]|=(c|l)<<24-8*(o%4),o++}return e.create(s,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(r){function e(h,u,f,g,m,b,v){return h=h+(u&f|~u&g)+m+v,(h<<b|h>>>32-b)+u}function t(h,u,f,g,m,b,v){return h=h+(u&g|f&~g)+m+v,(h<<b|h>>>32-b)+u}function n(h,u,f,g,m,b,v){return h=h+(u^f^g)+m+v,(h<<b|h>>>32-b)+u}function i(h,u,f,g,m,b,v){return h=h+(f^(u|~g))+m+v,(h<<b|h>>>32-b)+u}for(var s=ee,c=s.lib,o=c.WordArray,a=c.Hasher,c=s.algo,l=[],d=0;64>d;d++)l[d]=4294967296*r.abs(r.sin(d+1))|0;c=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(h,u){for(var f=0;16>f;f++){var g=u+f,m=h[g];h[g]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360}var f=this._hash.words,g=h[u+0],m=h[u+1],b=h[u+2],v=h[u+3],x=h[u+4],_=h[u+5],A=h[u+6],D=h[u+7],O=h[u+8],M=h[u+9],S=h[u+10],E=h[u+11],w=h[u+12],T=h[u+13],F=h[u+14],N=h[u+15],P=f[0],q=f[1],B=f[2],I=f[3],P=e(P,q,B,I,g,7,l[0]),I=e(I,P,q,B,m,12,l[1]),B=e(B,I,P,q,b,17,l[2]),q=e(q,B,I,P,v,22,l[3]),P=e(P,q,B,I,x,7,l[4]),I=e(I,P,q,B,_,12,l[5]),B=e(B,I,P,q,A,17,l[6]),q=e(q,B,I,P,D,22,l[7]),P=e(P,q,B,I,O,7,l[8]),I=e(I,P,q,B,M,12,l[9]),B=e(B,I,P,q,S,17,l[10]),q=e(q,B,I,P,E,22,l[11]),P=e(P,q,B,I,w,7,l[12]),I=e(I,P,q,B,T,12,l[13]),B=e(B,I,P,q,F,17,l[14]),q=e(q,B,I,P,N,22,l[15]),P=t(P,q,B,I,m,5,l[16]),I=t(I,P,q,B,A,9,l[17]),B=t(B,I,P,q,E,14,l[18]),q=t(q,B,I,P,g,20,l[19]),P=t(P,q,B,I,_,5,l[20]),I=t(I,P,q,B,S,9,l[21]),B=t(B,I,P,q,N,14,l[22]),q=t(q,B,I,P,x,20,l[23]),P=t(P,q,B,I,M,5,l[24]),I=t(I,P,q,B,F,9,l[25]),B=t(B,I,P,q,v,14,l[26]),q=t(q,B,I,P,O,20,l[27]),P=t(P,q,B,I,T,5,l[28]),I=t(I,P,q,B,b,9,l[29]),B=t(B,I,P,q,D,14,l[30]),q=t(q,B,I,P,w,20,l[31]),P=n(P,q,B,I,_,4,l[32]),I=n(I,P,q,B,O,11,l[33]),B=n(B,I,P,q,E,16,l[34]),q=n(q,B,I,P,F,23,l[35]),P=n(P,q,B,I,m,4,l[36]),I=n(I,P,q,B,x,11,l[37]),B=n(B,I,P,q,D,16,l[38]),q=n(q,B,I,P,S,23,l[39]),P=n(P,q,B,I,T,4,l[40]),I=n(I,P,q,B,g,11,l[41]),B=n(B,I,P,q,v,16,l[42]),q=n(q,B,I,P,A,23,l[43]),P=n(P,q,B,I,M,4,l[44]),I=n(I,P,q,B,w,11,l[45]),B=n(B,I,P,q,N,16,l[46]),q=n(q,B,I,P,b,23,l[47]),P=i(P,q,B,I,g,6,l[48]),I=i(I,P,q,B,D,10,l[49]),B=i(B,I,P,q,F,15,l[50]),q=i(q,B,I,P,_,21,l[51]),P=i(P,q,B,I,w,6,l[52]),I=i(I,P,q,B,v,10,l[53]),B=i(B,I,P,q,S,15,l[54]),q=i(q,B,I,P,m,21,l[55]),P=i(P,q,B,I,O,6,l[56]),I=i(I,P,q,B,N,10,l[57]),B=i(B,I,P,q,A,15,l[58]),q=i(q,B,I,P,T,21,l[59]),P=i(P,q,B,I,x,6,l[60]),I=i(I,P,q,B,E,10,l[61]),B=i(B,I,P,q,b,15,l[62]),q=i(q,B,I,P,M,21,l[63]);f[0]=f[0]+P|0,f[1]=f[1]+q|0,f[2]=f[2]+B|0,f[3]=f[3]+I|0},_doFinalize:function(){var h=this._data,u=h.words,f=8*this._nDataBytes,g=8*h.sigBytes;u[g>>>5]|=128<<24-g%32;var m=r.floor(f/4294967296);for(u[(g+64>>>9<<4)+15]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,u[(g+64>>>9<<4)+14]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,h.sigBytes=4*(u.length+1),this._process(),h=this._hash,u=h.words,f=0;4>f;f++)g=u[f],u[f]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360;return h},clone:function(){var h=a.clone.call(this);return h._hash=this._hash.clone(),h}}),s.MD5=a._createHelper(c),s.HmacMD5=a._createHmacHelper(c)})(Math);(function(){var r=ee,i=r.lib,e=i.WordArray,t=i.Hasher,n=[],i=r.algo.SHA1=t.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(s,o){for(var a=this._hash.words,c=a[0],l=a[1],d=a[2],h=a[3],u=a[4],f=0;80>f;f++){if(16>f)n[f]=s[o+f]|0;else{var g=n[f-3]^n[f-8]^n[f-14]^n[f-16];n[f]=g<<1|g>>>31}g=(c<<5|c>>>27)+u+n[f],g=20>f?g+((l&d|~l&h)+1518500249):40>f?g+((l^d^h)+1859775393):60>f?g+((l&d|l&h|d&h)-1894007588):g+((l^d^h)-899497514),u=h,h=d,d=l<<30|l>>>2,l=c,c=g}a[0]=a[0]+c|0,a[1]=a[1]+l|0,a[2]=a[2]+d|0,a[3]=a[3]+h|0,a[4]=a[4]+u|0},_doFinalize:function(){var s=this._data,o=s.words,a=8*this._nDataBytes,c=8*s.sigBytes;return o[c>>>5]|=128<<24-c%32,o[(c+64>>>9<<4)+14]=Math.floor(a/4294967296),o[(c+64>>>9<<4)+15]=a,s.sigBytes=4*o.length,this._process(),this._hash},clone:function(){var s=t.clone.call(this);return s._hash=this._hash.clone(),s}});r.SHA1=t._createHelper(i),r.HmacSHA1=t._createHmacHelper(i)})();(function(r){for(var e=ee,f=e.lib,t=f.WordArray,n=f.Hasher,f=e.algo,i=[],s=[],o=function(m){return 4294967296*(m-(m|0))|0},a=2,c=0;64>c;){var l;e:{l=a;for(var d=r.sqrt(l),h=2;h<=d;h++)if(!(l%h)){l=!1;break e}l=!0}l&&(8>c&&(i[c]=o(r.pow(a,.5))),s[c]=o(r.pow(a,1/3)),c++),a++}var u=[],f=f.SHA256=n.extend({_doReset:function(){this._hash=new t.init(i.slice(0))},_doProcessBlock:function(g,m){for(var b=this._hash.words,v=b[0],x=b[1],_=b[2],A=b[3],D=b[4],O=b[5],M=b[6],S=b[7],E=0;64>E;E++){if(16>E)u[E]=g[m+E]|0;else{var w=u[E-15],T=u[E-2];u[E]=((w<<25|w>>>7)^(w<<14|w>>>18)^w>>>3)+u[E-7]+((T<<15|T>>>17)^(T<<13|T>>>19)^T>>>10)+u[E-16]}w=S+((D<<26|D>>>6)^(D<<21|D>>>11)^(D<<7|D>>>25))+(D&O^~D&M)+s[E]+u[E],T=((v<<30|v>>>2)^(v<<19|v>>>13)^(v<<10|v>>>22))+(v&x^v&_^x&_),S=M,M=O,O=D,D=A+w|0,A=_,_=x,x=v,v=w+T|0}b[0]=b[0]+v|0,b[1]=b[1]+x|0,b[2]=b[2]+_|0,b[3]=b[3]+A|0,b[4]=b[4]+D|0,b[5]=b[5]+O|0,b[6]=b[6]+M|0,b[7]=b[7]+S|0},_doFinalize:function(){var g=this._data,m=g.words,b=8*this._nDataBytes,v=8*g.sigBytes;return m[v>>>5]|=128<<24-v%32,m[(v+64>>>9<<4)+14]=r.floor(b/4294967296),m[(v+64>>>9<<4)+15]=b,g.sigBytes=4*m.length,this._process(),this._hash},clone:function(){var g=n.clone.call(this);return g._hash=this._hash.clone(),g}});e.SHA256=n._createHelper(f),e.HmacSHA256=n._createHmacHelper(f)})(Math);(function(){var r=ee,e=r.lib.WordArray,n=r.algo,t=n.SHA256,n=n.SHA224=t.extend({_doReset:function(){this._hash=new e.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var i=t._doFinalize.call(this);return i.sigBytes-=4,i}});r.SHA224=t._createHelper(n),r.HmacSHA224=t._createHmacHelper(n)})();(function(){function r(){return n.create.apply(n,arguments)}for(var e=ee,t=e.lib.Hasher,s=e.x64,n=s.Word,i=s.WordArray,s=e.algo,o=[r(1116352408,3609767458),r(1899447441,602891725),r(3049323471,3964484399),r(3921009573,2173295548),r(961987163,4081628472),r(1508970993,3053834265),r(2453635748,2937671579),r(2870763221,3664609560),r(3624381080,2734883394),r(310598401,1164996542),r(607225278,1323610764),r(1426881987,3590304994),r(1925078388,4068182383),r(2162078206,991336113),r(2614888103,633803317),r(3248222580,3479774868),r(3835390401,2666613458),r(4022224774,944711139),r(264347078,2341262773),r(604807628,2007800933),r(770255983,1495990901),r(1249150122,1856431235),r(1555081692,3175218132),r(1996064986,2198950837),r(2554220882,3999719339),r(2821834349,766784016),r(2952996808,2566594879),r(3210313671,3203337956),r(3336571891,1034457026),r(3584528711,2466948901),r(113926993,3758326383),r(338241895,168717936),r(666307205,1188179964),r(773529912,1546045734),r(1294757372,1522805485),r(1396182291,2643833823),r(1695183700,2343527390),r(1986661051,1014477480),r(2177026350,1206759142),r(2456956037,344077627),r(2730485921,1290863460),r(2820302411,3158454273),r(3259730800,3505952657),r(3345764771,106217008),r(3516065817,3606008344),r(3600352804,1432725776),r(4094571909,1467031594),r(275423344,851169720),r(430227734,3100823752),r(506948616,1363258195),r(659060556,3750685593),r(883997877,3785050280),r(958139571,3318307427),r(1322822218,3812723403),r(1537002063,2003034995),r(1747873779,3602036899),r(1955562222,1575990012),r(2024104815,1125592928),r(2227730452,2716904306),r(2361852424,442776044),r(2428436474,593698344),r(2756734187,3733110249),r(3204031479,2999351573),r(3329325298,3815920427),r(3391569614,3928383900),r(3515267271,566280711),r(3940187606,3454069534),r(4118630271,4000239992),r(116418474,1914138554),r(174292421,2731055270),r(289380356,3203993006),r(460393269,320620315),r(685471733,587496836),r(852142971,1086792851),r(1017036298,365543100),r(1126000580,2618297676),r(1288033470,3409855158),r(1501505948,4234509866),r(1607167915,987167468),r(1816402316,1246189591)],a=[],c=0;80>c;c++)a[c]=r();s=s.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new n.init(1779033703,4089235720),new n.init(3144134277,2227873595),new n.init(1013904242,4271175723),new n.init(2773480762,1595750129),new n.init(1359893119,2917565137),new n.init(2600822924,725511199),new n.init(528734635,4215389547),new n.init(1541459225,327033209)])},_doProcessBlock:function(l,d){for(var x=this._hash.words,h=x[0],u=x[1],f=x[2],g=x[3],m=x[4],b=x[5],v=x[6],x=x[7],_=h.high,A=h.low,D=u.high,O=u.low,M=f.high,S=f.low,E=g.high,w=g.low,T=m.high,F=m.low,N=b.high,P=b.low,I=v.high,B=v.low,q=x.high,z=x.low,V=_,W=A,ie=D,ne=O,me=M,fe=S,Xe=E,Le=w,je=T,Ve=F,Pe=N,de=P,_e=I,Se=B,ze=q,xt=z,Ue=0;80>Ue;Ue++){var Vn=a[Ue];if(16>Ue)var ar=Vn.high=l[d+2*Ue]|0,Me=Vn.low=l[d+2*Ue+1]|0;else{var ar=a[Ue-15],Me=ar.high,Qr=ar.low,ar=(Me>>>1|Qr<<31)^(Me>>>8|Qr<<24)^Me>>>7,Qr=(Qr>>>1|Me<<31)^(Qr>>>8|Me<<24)^(Qr>>>7|Me<<25),Fi=a[Ue-2],Me=Fi.high,nt=Fi.low,Fi=(Me>>>19|nt<<13)^(Me<<3|nt>>>29)^Me>>>6,nt=(nt>>>19|Me<<13)^(nt<<3|Me>>>29)^(nt>>>6|Me<<26),Me=a[Ue-7],Uo=Me.high,Hn=a[Ue-16],Zr=Hn.high,Hn=Hn.low,Me=Qr+Me.low,ar=ar+Uo+(Me>>>0<Qr>>>0?1:0),Me=Me+nt,ar=ar+Fi+(Me>>>0<nt>>>0?1:0),Me=Me+Hn,ar=ar+Zr+(Me>>>0<Hn>>>0?1:0);Vn.high=ar,Vn.low=Me}var Uo=je&Pe^~je&_e,Hn=Ve&de^~Ve&Se,Vn=V&ie^V&me^ie&me,bA=W&ne^W&fe^ne&fe,Qr=(V>>>28|W<<4)^(V<<30|W>>>2)^(V<<25|W>>>7),Fi=(W>>>28|V<<4)^(W<<30|V>>>2)^(W<<25|V>>>7),nt=o[Ue],xA=nt.high,nv=nt.low,nt=xt+((Ve>>>14|je<<18)^(Ve>>>18|je<<14)^(Ve<<23|je>>>9)),Zr=ze+((je>>>14|Ve<<18)^(je>>>18|Ve<<14)^(je<<23|Ve>>>9))+(nt>>>0<xt>>>0?1:0),nt=nt+Hn,Zr=Zr+Uo+(nt>>>0<Hn>>>0?1:0),nt=nt+nv,Zr=Zr+xA+(nt>>>0<nv>>>0?1:0),nt=nt+Me,Zr=Zr+ar+(nt>>>0<Me>>>0?1:0),Me=Fi+bA,Vn=Qr+Vn+(Me>>>0<Fi>>>0?1:0),ze=_e,xt=Se,_e=Pe,Se=de,Pe=je,de=Ve,Ve=Le+nt|0,je=Xe+Zr+(Ve>>>0<Le>>>0?1:0)|0,Xe=me,Le=fe,me=ie,fe=ne,ie=V,ne=W,W=nt+Me|0,V=Zr+Vn+(W>>>0<nt>>>0?1:0)|0}A=h.low=A+W,h.high=_+V+(A>>>0<W>>>0?1:0),O=u.low=O+ne,u.high=D+ie+(O>>>0<ne>>>0?1:0),S=f.low=S+fe,f.high=M+me+(S>>>0<fe>>>0?1:0),w=g.low=w+Le,g.high=E+Xe+(w>>>0<Le>>>0?1:0),F=m.low=F+Ve,m.high=T+je+(F>>>0<Ve>>>0?1:0),P=b.low=P+de,b.high=N+Pe+(P>>>0<de>>>0?1:0),B=v.low=B+Se,v.high=I+_e+(B>>>0<Se>>>0?1:0),z=x.low=z+xt,x.high=q+ze+(z>>>0<xt>>>0?1:0)},_doFinalize:function(){var l=this._data,d=l.words,h=8*this._nDataBytes,u=8*l.sigBytes;return d[u>>>5]|=128<<24-u%32,d[(u+128>>>10<<5)+30]=Math.floor(h/4294967296),d[(u+128>>>10<<5)+31]=h,l.sigBytes=4*d.length,this._process(),this._hash.toX32()},clone:function(){var l=t.clone.call(this);return l._hash=this._hash.clone(),l},blockSize:32}),e.SHA512=t._createHelper(s),e.HmacSHA512=t._createHmacHelper(s)})();(function(){var r=ee,i=r.x64,e=i.Word,t=i.WordArray,i=r.algo,n=i.SHA512,i=i.SHA384=n.extend({_doReset:function(){this._hash=new t.init([new e.init(3418070365,3238371032),new e.init(1654270250,914150663),new e.init(2438529370,812702999),new e.init(355462360,4144912697),new e.init(1731405415,4290775857),new e.init(2394180231,1750603025),new e.init(3675008525,1694076839),new e.init(1203062813,3204075428)])},_doFinalize:function(){var s=n._doFinalize.call(this);return s.sigBytes-=16,s}});r.SHA384=n._createHelper(i),r.HmacSHA384=n._createHmacHelper(i)})();(function(){var r=ee,l=r.lib,e=l.WordArray,t=l.Hasher,l=r.algo,n=e.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),i=e.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),s=e.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),o=e.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),a=e.create([0,1518500249,1859775393,2400959708,2840853838]),c=e.create([1352829926,1548603684,1836072691,2053994217,0]),l=l.RIPEMD160=t.extend({_doReset:function(){this._hash=e.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(d,h){for(var u=0;16>u;u++){var f=h+u,g=d[f];d[f]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360}var f=this._hash.words,g=a.words,m=c.words,b=n.words,v=i.words,x=s.words,_=o.words,A,D,O,M,S,E,w,T,F,N;E=A=f[0],w=D=f[1],T=O=f[2],F=M=f[3],N=S=f[4];for(var P,u=0;80>u;u+=1)P=A+d[h+b[u]]|0,P=16>u?P+((D^O^M)+g[0]):32>u?P+((D&O|~D&M)+g[1]):48>u?P+(((D|~O)^M)+g[2]):64>u?P+((D&M|O&~M)+g[3]):P+((D^(O|~M))+g[4]),P|=0,P=P<<x[u]|P>>>32-x[u],P=P+S|0,A=S,S=M,M=O<<10|O>>>22,O=D,D=P,P=E+d[h+v[u]]|0,P=16>u?P+((w^(T|~F))+m[0]):32>u?P+((w&F|T&~F)+m[1]):48>u?P+(((w|~T)^F)+m[2]):64>u?P+((w&T|~w&F)+m[3]):P+((w^T^F)+m[4]),P|=0,P=P<<_[u]|P>>>32-_[u],P=P+N|0,E=N,N=F,F=T<<10|T>>>22,T=w,w=P;P=f[1]+O+F|0,f[1]=f[2]+M+N|0,f[2]=f[3]+S+E|0,f[3]=f[4]+A+w|0,f[4]=f[0]+D+T|0,f[0]=P},_doFinalize:function(){var d=this._data,h=d.words,u=8*this._nDataBytes,f=8*d.sigBytes;for(h[f>>>5]|=128<<24-f%32,h[(f+64>>>9<<4)+14]=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360,d.sigBytes=4*(h.length+1),this._process(),d=this._hash,h=d.words,u=0;5>u;u++)f=h[u],h[u]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360;return d},clone:function(){var d=t.clone.call(this);return d._hash=this._hash.clone(),d}});r.RIPEMD160=t._createHelper(l),r.HmacRIPEMD160=t._createHmacHelper(l)})(Math);(function(){var r=ee,e=r.enc.Utf8;r.algo.HMAC=r.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,typeof n=="string"&&(n=e.parse(n));var i=t.blockSize,s=4*i;n.sigBytes>s&&(n=t.finalize(n)),n.clamp();for(var o=this._oKey=n.clone(),a=this._iKey=n.clone(),c=o.words,l=a.words,d=0;d<i;d++)c[d]^=1549556828,l[d]^=909522486;o.sigBytes=a.sigBytes=s,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var n=this._hasher;return t=n.finalize(t),n.reset(),n.finalize(this._oKey.clone().concat(t))}})})();(function(){var r=ee,n=r.lib,e=n.Base,t=n.WordArray,n=r.algo,i=n.HMAC,s=n.PBKDF2=e.extend({cfg:e.extend({keySize:4,hasher:n.SHA1,iterations:1}),init:function(o){this.cfg=this.cfg.extend(o)},compute:function(o,a){for(var g=this.cfg,c=i.create(g.hasher,o),l=t.create(),d=t.create([1]),h=l.words,u=d.words,f=g.keySize,g=g.iterations;h.length<f;){var m=c.update(a).finalize(d);c.reset();for(var b=m.words,v=b.length,x=m,_=1;_<g;_++){x=c.finalize(x),c.reset();for(var A=x.words,D=0;D<v;D++)b[D]^=A[D]}l.concat(m),u[0]++}return l.sigBytes=4*f,l}});r.PBKDF2=function(o,a,c){return s.create(c).compute(o,a)}})();var Fo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wg="=";function Mn(r){var e,t,n="";for(e=0;e+3<=r.length;e+=3)t=parseInt(r.substring(e,e+3),16),n+=Fo.charAt(t>>6)+Fo.charAt(t&63);if(e+1==r.length?(t=parseInt(r.substring(e,e+1),16),n+=Fo.charAt(t<<2)):e+2==r.length&&(t=parseInt(r.substring(e,e+2),16),n+=Fo.charAt(t>>2)+Fo.charAt((t&3)<<4)),Wg)for(;(n.length&3)>0;)n+=Wg;return n}function Io(r){var e="",t,n=0,i,s;for(t=0;t<r.length&&r.charAt(t)!=Wg;++t)s=Fo.indexOf(r.charAt(t)),!(s<0)&&(n==0?(e+=kn(s>>2),i=s&3,n=1):n==1?(e+=kn(i<<2|s>>4),i=s&15,n=2):n==2?(e+=kn(i),e+=kn(s>>2),i=s&3,n=3):(e+=kn(i<<2|s>>4),e+=kn(s&15),n=0));return n==1&&(e+=kn(i<<2)),e}function tT(r){var e=Io(r),t,n=new Array;for(t=0;2*t<e.length;++t)n[t]=parseInt(e.substring(2*t,2*t+2),16);return n}var _i,dL=0xdeadbeefcafe,Q3=(dL&16777215)==15715070;function L(r,e,t){r!=null&&(typeof r=="number"?this.fromNumber(r,e,t):e==null&&typeof r!="string"?this.fromString(r,256):this.fromString(r,e))}function De(){return new L(null)}function fL(r,e,t,n,i,s){for(;--s>=0;){var o=e*this[r++]+t[n]+i;i=Math.floor(o/67108864),t[n++]=o&67108863}return i}function pL(r,e,t,n,i,s){for(var o=e&32767,a=e>>15;--s>=0;){var c=this[r]&32767,l=this[r++]>>15,d=a*c+l*o;c=o*c+((d&32767)<<15)+t[n]+(i&1073741823),i=(c>>>30)+(d>>>15)+a*l+(i>>>30),t[n++]=c&1073741823}return i}function mL(r,e,t,n,i,s){for(var o=e&16383,a=e>>14;--s>=0;){var c=this[r]&16383,l=this[r++]>>14,d=a*c+l*o;c=o*c+((d&16383)<<14)+t[n]+i,i=(c>>28)+(d>>14)+a*l,t[n++]=c&268435455}return i}Q3&&bc.appName=="Microsoft Internet Explorer"?(L.prototype.am=pL,_i=30):Q3&&bc.appName!="Netscape"?(L.prototype.am=fL,_i=26):(L.prototype.am=mL,_i=28);L.prototype.DB=_i;L.prototype.DM=(1<<_i)-1;L.prototype.DV=1<<_i;var Yg=52;L.prototype.FV=Math.pow(2,Yg);L.prototype.F1=Yg-_i;L.prototype.F2=2*_i-Yg;var gL="0123456789abcdefghijklmnopqrstuvwxyz",Xh=new Array,Oo,Br;Oo=48;for(Br=0;Br<=9;++Br)Xh[Oo++]=Br;Oo=97;for(Br=10;Br<36;++Br)Xh[Oo++]=Br;Oo=65;for(Br=10;Br<36;++Br)Xh[Oo++]=Br;function kn(r){return gL.charAt(r)}function rT(r,e){var t=Xh[r.charCodeAt(e)];return t??-1}function vL(r){for(var e=this.t-1;e>=0;--e)r[e]=this[e];r.t=this.t,r.s=this.s}function yL(r){this.t=1,this.s=r<0?-1:0,r>0?this[0]=r:r<-1?this[0]=r+this.DV:this.t=0}function Ei(r){var e=De();return e.fromInt(r),e}function bL(r,e){var t;if(e==16)t=4;else if(e==8)t=3;else if(e==256)t=8;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else{this.fromRadix(r,e);return}this.t=0,this.s=0;for(var n=r.length,i=!1,s=0;--n>=0;){var o=t==8?r[n]&255:rT(r,n);if(o<0){r.charAt(n)=="-"&&(i=!0);continue}i=!1,s==0?this[this.t++]=o:s+t>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,s+=t,s>=this.DB&&(s-=this.DB)}t==8&&r[0]&128&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&L.ZERO.subTo(this,this)}function xL(){for(var r=this.s&this.DM;this.t>0&&this[this.t-1]==r;)--this.t}function SL(r){if(this.s<0)return"-"+this.negate().toString(r);var e;if(r==16)e=4;else if(r==8)e=3;else if(r==2)e=1;else if(r==32)e=5;else if(r==4)e=2;else return this.toRadix(r);var t=(1<<e)-1,n,i=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(n=this[o]>>a)>0&&(i=!0,s=kn(n));o>=0;)a<e?(n=(this[o]&(1<<a)-1)<<e-a,n|=this[--o]>>(a+=this.DB-e)):(n=this[o]>>(a-=e)&t,a<=0&&(a+=this.DB,--o)),n>0&&(i=!0),i&&(s+=kn(n));return i?s:"0"}function wL(){var r=De();return L.ZERO.subTo(this,r),r}function CL(){return this.s<0?this.negate():this}function EL(r){var e=this.s-r.s;if(e!=0)return e;var t=this.t;if(e=t-r.t,e!=0)return this.s<0?-e:e;for(;--t>=0;)if((e=this[t]-r[t])!=0)return e;return 0}function Yh(r){var e=1,t;return(t=r>>>16)!=0&&(r=t,e+=16),(t=r>>8)!=0&&(r=t,e+=8),(t=r>>4)!=0&&(r=t,e+=4),(t=r>>2)!=0&&(r=t,e+=2),(t=r>>1)!=0&&(r=t,e+=1),e}function _L(){return this.t<=0?0:this.DB*(this.t-1)+Yh(this[this.t-1]^this.s&this.DM)}function TL(r,e){var t;for(t=this.t-1;t>=0;--t)e[t+r]=this[t];for(t=r-1;t>=0;--t)e[t]=0;e.t=this.t+r,e.s=this.s}function AL(r,e){for(var t=r;t<this.t;++t)e[t-r]=this[t];e.t=Math.max(this.t-r,0),e.s=this.s}function DL(r,e){var t=r%this.DB,n=this.DB-t,i=(1<<n)-1,s=Math.floor(r/this.DB),o=this.s<<t&this.DM,a;for(a=this.t-1;a>=0;--a)e[a+s+1]=this[a]>>n|o,o=(this[a]&i)<<t;for(a=s-1;a>=0;--a)e[a]=0;e[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()}function FL(r,e){e.s=this.s;var t=Math.floor(r/this.DB);if(t>=this.t){e.t=0;return}var n=r%this.DB,i=this.DB-n,s=(1<<n)-1;e[0]=this[t]>>n;for(var o=t+1;o<this.t;++o)e[o-t-1]|=(this[o]&s)<<i,e[o-t]=this[o]>>n;n>0&&(e[this.t-t-1]|=(this.s&s)<<i),e.t=this.t-t,e.clamp()}function PL(r,e){for(var t=0,n=0,i=Math.min(r.t,this.t);t<i;)n+=this[t]-r[t],e[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n-=r.s;t<this.t;)n+=this[t],e[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n-=r[t],e[t++]=n&this.DM,n>>=this.DB;n-=r.s}e.s=n<0?-1:0,n<-1?e[t++]=this.DV+n:n>0&&(e[t++]=n),e.t=t,e.clamp()}function IL(r,e){var t=this.abs(),n=r.abs(),i=t.t;for(e.t=i+n.t;--i>=0;)e[i]=0;for(i=0;i<n.t;++i)e[i+t.t]=t.am(0,n[i],e,i,0,t.t);e.s=0,e.clamp(),this.s!=r.s&&L.ZERO.subTo(e,e)}function OL(r){for(var e=this.abs(),t=r.t=2*e.t;--t>=0;)r[t]=0;for(t=0;t<e.t-1;++t){var n=e.am(t,e[t],r,2*t,0,1);(r[t+e.t]+=e.am(t+1,2*e[t],r,2*t+1,n,e.t-t-1))>=e.DV&&(r[t+e.t]-=e.DV,r[t+e.t+1]=1)}r.t>0&&(r[r.t-1]+=e.am(t,e[t],r,2*t,0,1)),r.s=0,r.clamp()}function NL(r,e,t){var n=r.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t){e?.fromInt(0),t!=null&&this.copyTo(t);return}t==null&&(t=De());var s=De(),o=this.s,a=r.s,c=this.DB-Yh(n[n.t-1]);c>0?(n.lShiftTo(c,s),i.lShiftTo(c,t)):(n.copyTo(s),i.copyTo(t));var l=s.t,d=s[l-1];if(d!=0){var h=d*(1<<this.F1)+(l>1?s[l-2]>>this.F2:0),u=this.FV/h,f=(1<<this.F1)/h,g=1<<this.F2,m=t.t,b=m-l,v=e??De();for(s.dlShiftTo(b,v),t.compareTo(v)>=0&&(t[t.t++]=1,t.subTo(v,t)),L.ONE.dlShiftTo(l,v),v.subTo(s,s);s.t<l;)s[s.t++]=0;for(;--b>=0;){var x=t[--m]==d?this.DM:Math.floor(t[m]*u+(t[m-1]+g)*f);if((t[m]+=s.am(0,x,t,b,0,l))<x)for(s.dlShiftTo(b,v),t.subTo(v,t);t[m]<--x;)t.subTo(v,t)}e!=null&&(t.drShiftTo(l,e),o!=a&&L.ZERO.subTo(e,e)),t.t=l,t.clamp(),c>0&&t.rShiftTo(c,t),o<0&&L.ZERO.subTo(t,t)}}}function RL(r){var e=De();return this.abs().divRemTo(r,null,e),this.s<0&&e.compareTo(L.ZERO)>0&&r.subTo(e,e),e}function is(r){this.m=r}function kL(r){return r.s<0||r.compareTo(this.m)>=0?r.mod(this.m):r}function ML(r){return r}function BL(r){r.divRemTo(this.m,null,r)}function qL(r,e,t){r.multiplyTo(e,t),this.reduce(t)}function LL(r,e){r.squareTo(e),this.reduce(e)}is.prototype.convert=kL;is.prototype.revert=ML;is.prototype.reduce=BL;is.prototype.mulTo=qL;is.prototype.sqrTo=LL;function jL(){if(this.t<1)return 0;var r=this[0];if(!(r&1))return 0;var e=r&3;return e=e*(2-(r&15)*e)&15,e=e*(2-(r&255)*e)&255,e=e*(2-((r&65535)*e&65535))&65535,e=e*(2-r*e%this.DV)%this.DV,e>0?this.DV-e:-e}function ss(r){this.m=r,this.mp=r.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<r.DB-15)-1,this.mt2=2*r.t}function zL(r){var e=De();return r.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),r.s<0&&e.compareTo(L.ZERO)>0&&this.m.subTo(e,e),e}function HL(r){var e=De();return r.copyTo(e),this.reduce(e),e}function VL(r){for(;r.t<=this.mt2;)r[r.t++]=0;for(var e=0;e<this.m.t;++e){var t=r[e]&32767,n=t*this.mpl+((t*this.mph+(r[e]>>15)*this.mpl&this.um)<<15)&r.DM;for(t=e+this.m.t,r[t]+=this.m.am(0,n,r,e,0,this.m.t);r[t]>=r.DV;)r[t]-=r.DV,r[++t]++}r.clamp(),r.drShiftTo(this.m.t,r),r.compareTo(this.m)>=0&&r.subTo(this.m,r)}function UL(r,e){r.squareTo(e),this.reduce(e)}function GL(r,e,t){r.multiplyTo(e,t),this.reduce(t)}ss.prototype.convert=zL;ss.prototype.revert=HL;ss.prototype.reduce=VL;ss.prototype.mulTo=GL;ss.prototype.sqrTo=UL;function WL(){return(this.t>0?this[0]&1:this.s)==0}function KL(r,e){if(r>4294967295||r<1)return L.ONE;var t=De(),n=De(),i=e.convert(this),s=Yh(r)-1;for(i.copyTo(t);--s>=0;)if(e.sqrTo(t,n),(r&1<<s)>0)e.mulTo(n,i,t);else{var o=t;t=n,n=o}return e.revert(t)}function $L(r,e){var t;return r<256||e.isEven()?t=new is(e):t=new ss(e),this.exp(r,t)}L.prototype.copyTo=vL;L.prototype.fromInt=yL;L.prototype.fromString=bL;L.prototype.clamp=xL;L.prototype.dlShiftTo=TL;L.prototype.drShiftTo=AL;L.prototype.lShiftTo=DL;L.prototype.rShiftTo=FL;L.prototype.subTo=PL;L.prototype.multiplyTo=IL;L.prototype.squareTo=OL;L.prototype.divRemTo=NL;L.prototype.invDigit=jL;L.prototype.isEven=WL;L.prototype.exp=KL;L.prototype.toString=SL;L.prototype.negate=wL;L.prototype.abs=CL;L.prototype.compareTo=EL;L.prototype.bitLength=_L;L.prototype.mod=RL;L.prototype.modPowInt=$L;L.ZERO=Ei(0);L.ONE=Ei(1);function JL(){var r=De();return this.copyTo(r),r}function XL(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function YL(){return this.t==0?this.s:this[0]<<24>>24}function QL(){return this.t==0?this.s:this[0]<<16>>16}function ZL(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function ej(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function tj(r){if(r==null&&(r=10),this.signum()==0||r<2||r>36)return"0";var e=this.chunkSize(r),t=Math.pow(r,e),n=Ei(t),i=De(),s=De(),o="";for(this.divRemTo(n,i,s);i.signum()>0;)o=(t+s.intValue()).toString(r).substr(1)+o,i.divRemTo(n,i,s);return s.intValue().toString(r)+o}function rj(r,e){this.fromInt(0),e==null&&(e=10);for(var t=this.chunkSize(e),n=Math.pow(e,t),i=!1,s=0,o=0,a=0;a<r.length;++a){var c=rT(r,a);if(c<0){r.charAt(a)=="-"&&this.signum()==0&&(i=!0);continue}o=e*o+c,++s>=t&&(this.dMultiply(n),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(o,0)),i&&L.ZERO.subTo(this,this)}function nj(r,e,t){if(typeof e=="number")if(r<2)this.fromInt(1);else for(this.fromNumber(r,t),this.testBit(r-1)||this.bitwiseTo(L.ONE.shiftLeft(r-1),Qg,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>r&&this.subTo(L.ONE.shiftLeft(r-1),this);else{var n=new Array,i=r&7;n.length=(r>>3)+1,e.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}}function ij(){var r=this.t,e=new Array;e[0]=this.s;var t=this.DB-r*this.DB%8,n,i=0;if(r-- >0)for(t<this.DB&&(n=this[r]>>t)!=(this.s&this.DM)>>t&&(e[i++]=n|this.s<<this.DB-t);r>=0;)t<8?(n=(this[r]&(1<<t)-1)<<8-t,n|=this[--r]>>(t+=this.DB-8)):(n=this[r]>>(t-=8)&255,t<=0&&(t+=this.DB,--r)),n&128&&(n|=-256),i==0&&(this.s&128)!=(n&128)&&++i,(i>0||n!=this.s)&&(e[i++]=n);return e}function sj(r){return this.compareTo(r)==0}function oj(r){return this.compareTo(r)<0?this:r}function aj(r){return this.compareTo(r)>0?this:r}function cj(r,e,t){var n,i,s=Math.min(r.t,this.t);for(n=0;n<s;++n)t[n]=e(this[n],r[n]);if(r.t<this.t){for(i=r.s&this.DM,n=s;n<this.t;++n)t[n]=e(this[n],i);t.t=this.t}else{for(i=this.s&this.DM,n=s;n<r.t;++n)t[n]=e(i,r[n]);t.t=r.t}t.s=e(this.s,r.s),t.clamp()}function lj(r,e){return r&e}function uj(r){var e=De();return this.bitwiseTo(r,lj,e),e}function Qg(r,e){return r|e}function hj(r){var e=De();return this.bitwiseTo(r,Qg,e),e}function nT(r,e){return r^e}function dj(r){var e=De();return this.bitwiseTo(r,nT,e),e}function iT(r,e){return r&~e}function fj(r){var e=De();return this.bitwiseTo(r,iT,e),e}function pj(){for(var r=De(),e=0;e<this.t;++e)r[e]=this.DM&~this[e];return r.t=this.t,r.s=~this.s,r}function mj(r){var e=De();return r<0?this.rShiftTo(-r,e):this.lShiftTo(r,e),e}function gj(r){var e=De();return r<0?this.lShiftTo(-r,e):this.rShiftTo(r,e),e}function vj(r){if(r==0)return-1;var e=0;return r&65535||(r>>=16,e+=16),r&255||(r>>=8,e+=8),r&15||(r>>=4,e+=4),r&3||(r>>=2,e+=2),r&1||++e,e}function yj(){for(var r=0;r<this.t;++r)if(this[r]!=0)return r*this.DB+vj(this[r]);return this.s<0?this.t*this.DB:-1}function bj(r){for(var e=0;r!=0;)r&=r-1,++e;return e}function xj(){for(var r=0,e=this.s&this.DM,t=0;t<this.t;++t)r+=bj(this[t]^e);return r}function Sj(r){var e=Math.floor(r/this.DB);return e>=this.t?this.s!=0:(this[e]&1<<r%this.DB)!=0}function wj(r,e){var t=L.ONE.shiftLeft(r);return this.bitwiseTo(t,e,t),t}function Cj(r){return this.changeBit(r,Qg)}function Ej(r){return this.changeBit(r,iT)}function _j(r){return this.changeBit(r,nT)}function Tj(r,e){for(var t=0,n=0,i=Math.min(r.t,this.t);t<i;)n+=this[t]+r[t],e[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n+=r.s;t<this.t;)n+=this[t],e[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n+=r[t],e[t++]=n&this.DM,n>>=this.DB;n+=r.s}e.s=n<0?-1:0,n>0?e[t++]=n:n<-1&&(e[t++]=this.DV+n),e.t=t,e.clamp()}function Aj(r){var e=De();return this.addTo(r,e),e}function Dj(r){var e=De();return this.subTo(r,e),e}function Fj(r){var e=De();return this.multiplyTo(r,e),e}function Pj(){var r=De();return this.squareTo(r),r}function Ij(r){var e=De();return this.divRemTo(r,e,null),e}function Oj(r){var e=De();return this.divRemTo(r,null,e),e}function Nj(r){var e=De(),t=De();return this.divRemTo(r,e,t),new Array(e,t)}function Rj(r){this[this.t]=this.am(0,r-1,this,0,0,this.t),++this.t,this.clamp()}function kj(r,e){if(r!=0){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=r;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function Sc(){}function sT(r){return r}function Mj(r,e,t){r.multiplyTo(e,t)}function Bj(r,e){r.squareTo(e)}Sc.prototype.convert=sT;Sc.prototype.revert=sT;Sc.prototype.mulTo=Mj;Sc.prototype.sqrTo=Bj;function qj(r){return this.exp(r,new Sc)}function Lj(r,e,t){var n=Math.min(this.t+r.t,e);for(t.s=0,t.t=n;n>0;)t[--n]=0;var i;for(i=t.t-this.t;n<i;++n)t[n+this.t]=this.am(0,r[n],t,n,0,this.t);for(i=Math.min(r.t,e);n<i;++n)this.am(0,r[n],t,n,0,e-n);t.clamp()}function jj(r,e,t){--e;var n=t.t=this.t+r.t-e;for(t.s=0;--n>=0;)t[n]=0;for(n=Math.max(e-this.t,0);n<r.t;++n)t[this.t+n-e]=this.am(e-n,r[n],t,0,0,this.t+n-e);t.clamp(),t.drShiftTo(1,t)}function No(r){this.r2=De(),this.q3=De(),L.ONE.dlShiftTo(2*r.t,this.r2),this.mu=this.r2.divide(r),this.m=r}function zj(r){if(r.s<0||r.t>2*this.m.t)return r.mod(this.m);if(r.compareTo(this.m)<0)return r;var e=De();return r.copyTo(e),this.reduce(e),e}function Hj(r){return r}function Vj(r){for(r.drShiftTo(this.m.t-1,this.r2),r.t>this.m.t+1&&(r.t=this.m.t+1,r.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);r.compareTo(this.r2)<0;)r.dAddOffset(1,this.m.t+1);for(r.subTo(this.r2,r);r.compareTo(this.m)>=0;)r.subTo(this.m,r)}function Uj(r,e){r.squareTo(e),this.reduce(e)}function Gj(r,e,t){r.multiplyTo(e,t),this.reduce(t)}No.prototype.convert=zj;No.prototype.revert=Hj;No.prototype.reduce=Vj;No.prototype.mulTo=Gj;No.prototype.sqrTo=Uj;function Wj(r,e){var t=r.bitLength(),n,i=Ei(1),s;if(t<=0)return i;t<18?n=1:t<48?n=3:t<144?n=4:t<768?n=5:n=6,t<8?s=new is(e):e.isEven()?s=new No(e):s=new ss(e);var o=new Array,a=3,c=n-1,l=(1<<n)-1;if(o[1]=s.convert(this),n>1){var d=De();for(s.sqrTo(o[1],d);a<=l;)o[a]=De(),s.mulTo(d,o[a-2],o[a]),a+=2}var h=r.t-1,u,f=!0,g=De(),m;for(t=Yh(r[h])-1;h>=0;){for(t>=c?u=r[h]>>t-c&l:(u=(r[h]&(1<<t+1)-1)<<c-t,h>0&&(u|=r[h-1]>>this.DB+t-c)),a=n;!(u&1);)u>>=1,--a;if((t-=a)<0&&(t+=this.DB,--h),f)o[u].copyTo(i),f=!1;else{for(;a>1;)s.sqrTo(i,g),s.sqrTo(g,i),a-=2;a>0?s.sqrTo(i,g):(m=i,i=g,g=m),s.mulTo(g,o[u],i)}for(;h>=0&&!(r[h]&1<<t);)s.sqrTo(i,g),m=i,i=g,g=m,--t<0&&(t=this.DB-1,--h)}return s.revert(i)}function Kj(r){var e=this.s<0?this.negate():this.clone(),t=r.s<0?r.negate():r.clone();if(e.compareTo(t)<0){var n=e;e=t,t=n}var i=e.getLowestSetBit(),s=t.getLowestSetBit();if(s<0)return e;for(i<s&&(s=i),s>0&&(e.rShiftTo(s,e),t.rShiftTo(s,t));e.signum()>0;)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),e.compareTo(t)>=0?(e.subTo(t,e),e.rShiftTo(1,e)):(t.subTo(e,t),t.rShiftTo(1,t));return s>0&&t.lShiftTo(s,t),t}function $j(r){if(r<=0)return 0;var e=this.DV%r,t=this.s<0?r-1:0;if(this.t>0)if(e==0)t=this[0]%r;else for(var n=this.t-1;n>=0;--n)t=(e*t+this[n])%r;return t}function Jj(r){var e=r.isEven();if(this.isEven()&&e||r.signum()==0)return L.ZERO;for(var t=r.clone(),n=this.clone(),i=Ei(1),s=Ei(0),o=Ei(0),a=Ei(1);t.signum()!=0;){for(;t.isEven();)t.rShiftTo(1,t),e?((!i.isEven()||!s.isEven())&&(i.addTo(this,i),s.subTo(r,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(r,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),e?((!o.isEven()||!a.isEven())&&(o.addTo(this,o),a.subTo(r,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(r,a),a.rShiftTo(1,a);t.compareTo(n)>=0?(t.subTo(n,t),e&&i.subTo(o,i),s.subTo(a,s)):(n.subTo(t,n),e&&o.subTo(i,o),a.subTo(s,a))}if(n.compareTo(L.ONE)!=0)return L.ZERO;if(a.compareTo(r)>=0)return a.subtract(r);if(a.signum()<0)a.addTo(r,a);else return a;return a.signum()<0?a.add(r):a}var or=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Xj=(1<<26)/or[or.length-1];function Yj(r){var e,t=this.abs();if(t.t==1&&t[0]<=or[or.length-1]){for(e=0;e<or.length;++e)if(t[0]==or[e])return!0;return!1}if(t.isEven())return!1;for(e=1;e<or.length;){for(var n=or[e],i=e+1;i<or.length&&n<Xj;)n*=or[i++];for(n=t.modInt(n);e<i;)if(n%or[e++]==0)return!1}return t.millerRabin(r)}function Qj(r){var e=this.subtract(L.ONE),t=e.getLowestSetBit();if(t<=0)return!1;var n=e.shiftRight(t);r=r+1>>1,r>or.length&&(r=or.length);for(var i=De(),s=0;s<r;++s){i.fromInt(or[Math.floor(Math.random()*or.length)]);var o=i.modPow(n,this);if(o.compareTo(L.ONE)!=0&&o.compareTo(e)!=0){for(var a=1;a++<t&&o.compareTo(e)!=0;)if(o=o.modPowInt(2,this),o.compareTo(L.ONE)==0)return!1;if(o.compareTo(e)!=0)return!1}}return!0}L.prototype.chunkSize=ZL;L.prototype.toRadix=tj;L.prototype.fromRadix=rj;L.prototype.fromNumber=nj;L.prototype.bitwiseTo=cj;L.prototype.changeBit=wj;L.prototype.addTo=Tj;L.prototype.dMultiply=Rj;L.prototype.dAddOffset=kj;L.prototype.multiplyLowerTo=Lj;L.prototype.multiplyUpperTo=jj;L.prototype.modInt=$j;L.prototype.millerRabin=Qj;L.prototype.clone=JL;L.prototype.intValue=XL;L.prototype.byteValue=YL;L.prototype.shortValue=QL;L.prototype.signum=ej;L.prototype.toByteArray=ij;L.prototype.equals=sj;L.prototype.min=oj;L.prototype.max=aj;L.prototype.and=uj;L.prototype.or=hj;L.prototype.xor=dj;L.prototype.andNot=fj;L.prototype.not=pj;L.prototype.shiftLeft=mj;L.prototype.shiftRight=gj;L.prototype.getLowestSetBit=yj;L.prototype.bitCount=xj;L.prototype.testBit=Sj;L.prototype.setBit=Cj;L.prototype.clearBit=Ej;L.prototype.flipBit=_j;L.prototype.add=Aj;L.prototype.subtract=Dj;L.prototype.multiply=Fj;L.prototype.divide=Ij;L.prototype.remainder=Oj;L.prototype.divideAndRemainder=Nj;L.prototype.modPow=Wj;L.prototype.modInverse=Jj;L.prototype.pow=qj;L.prototype.gcd=Kj;L.prototype.isProbablePrime=Yj;L.prototype.square=Pj;function Zg(){this.i=0,this.j=0,this.S=new Array}function Zj(r){var e,t,n;for(e=0;e<256;++e)this.S[e]=e;for(t=0,e=0;e<256;++e)t=t+this.S[e]+r[e%r.length]&255,n=this.S[e],this.S[e]=this.S[t],this.S[t]=n;this.i=0,this.j=0}function ez(){var r;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,r=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=r,this.S[r+this.S[this.i]&255]}Zg.prototype.init=Zj;Zg.prototype.next=ez;function tz(){return new Zg}var Kg=256;var Wh,Dr,Ot;function rz(r){Dr[Ot++]^=r&255,Dr[Ot++]^=r>>8&255,Dr[Ot++]^=r>>16&255,Dr[Ot++]^=r>>24&255,Ot>=Kg&&(Ot-=Kg)}function e0(){rz(new Date().getTime())}if(Dr==null){if(Dr=new Array,Ot=0,Do!==void 0&&(Do.crypto!==void 0||Do.msCrypto!==void 0)){if(Vg=Do.crypto||Do.msCrypto,Vg.getRandomValues)for(Ug=new Uint8Array(32),Vg.getRandomValues(Ug),Mr=0;Mr<32;++Mr)Dr[Ot++]=Ug[Mr];else if(bc.appName=="Netscape"&&bc.appVersion<"5")for(Gg=Do.crypto.random(32),Mr=0;Mr<Gg.length;++Mr)Dr[Ot++]=Gg.charCodeAt(Mr)&255}for(;Ot<Kg;)Mr=Math.floor(65536*Math.random()),Dr[Ot++]=Mr>>>8,Dr[Ot++]=Mr&255;Ot=0,e0()}var Mr,Vg,Ug,Gg;function nz(){if(Wh==null){for(e0(),Wh=tz(),Wh.init(Dr),Ot=0;Ot<Dr.length;++Ot)Dr[Ot]=0;Ot=0}return Wh.next()}function iz(r){var e;for(e=0;e<r.length;++e)r[e]=nz()}function Ro(){}Ro.prototype.nextBytes=iz;function vr(r,e){return new L(r,e)}function pe(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function sz(r,e){if(this.isPublic=!0,this.isPrivate=!1,typeof r!="string")this.n=r,this.e=e;else if(r!=null&&e!=null&&r.length>0&&e.length>0)this.n=vr(r,16),this.e=parseInt(e,16);else throw"Invalid RSA public key"}function oz(r){return r.modPowInt(this.e,this.n)}pe.prototype.doPublic=oz;pe.prototype.setPublic=sz;pe.prototype.type="RSA";function az(r,e,t){if(this.isPrivate=!0,typeof r!="string")this.n=r,this.e=e,this.d=t;else if(r!=null&&e!=null&&r.length>0&&e.length>0)this.n=vr(r,16),this.e=parseInt(e,16),this.d=vr(t,16);else throw"Invalid RSA private key"}function cz(r,e,t,n,i,s,o,a){if(this.isPrivate=!0,this.isPublic=!1,r==null)throw"RSASetPrivateEx N == null";if(e==null)throw"RSASetPrivateEx E == null";if(r.length==0)throw"RSASetPrivateEx N.length == 0";if(e.length==0)throw"RSASetPrivateEx E.length == 0";if(r!=null&&e!=null&&r.length>0&&e.length>0)this.n=vr(r,16),this.e=parseInt(e,16),this.d=vr(t,16),this.p=vr(n,16),this.q=vr(i,16),this.dmp1=vr(s,16),this.dmq1=vr(o,16),this.coeff=vr(a,16);else throw"Invalid RSA private key in RSASetPrivateEx"}function lz(r,e){var t=new Ro,n=r>>1;this.e=parseInt(e,16);for(var i=new L(e,16),s=r/2-100,o=L.ONE.shiftLeft(s);;){for(;this.p=new L(r-n,1,t),!(this.p.subtract(L.ONE).gcd(i).compareTo(L.ONE)==0&&this.p.isProbablePrime(10)););for(;this.q=new L(n,1,t),!(this.q.subtract(L.ONE).gcd(i).compareTo(L.ONE)==0&&this.q.isProbablePrime(10)););if(this.p.compareTo(this.q)<=0){var a=this.p;this.p=this.q,this.q=a}var c=this.q.subtract(this.p).abs();if(!(c.bitLength()<s||c.compareTo(o)<=0)){var l=this.p.subtract(L.ONE),d=this.q.subtract(L.ONE),h=l.multiply(d);if(h.gcd(i).compareTo(L.ONE)==0&&(this.n=this.p.multiply(this.q),this.n.bitLength()==r)){this.d=i.modInverse(h),this.dmp1=this.d.mod(l),this.dmq1=this.d.mod(d),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0}function uz(r){if(this.p==null||this.q==null)return r.modPow(this.d,this.n);for(var e=r.mod(this.p).modPow(this.dmp1,this.p),t=r.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(t)<0;)e=e.add(this.p);return e.subtract(t).multiply(this.coeff).mod(this.p).multiply(this.q).add(t)}pe.prototype.doPrivate=uz;pe.prototype.setPrivate=az;pe.prototype.setPrivateEx=cz;pe.prototype.generate=lz;function Tt(r,e){this.x=e,this.q=r}function hz(r){return r==this?!0:this.q.equals(r.q)&&this.x.equals(r.x)}function dz(){return this.x}function fz(){return new Tt(this.q,this.x.negate().mod(this.q))}function pz(r){return new Tt(this.q,this.x.add(r.toBigInteger()).mod(this.q))}function mz(r){return new Tt(this.q,this.x.subtract(r.toBigInteger()).mod(this.q))}function gz(r){return new Tt(this.q,this.x.multiply(r.toBigInteger()).mod(this.q))}function vz(){return new Tt(this.q,this.x.square().mod(this.q))}function yz(r){return new Tt(this.q,this.x.multiply(r.toBigInteger().modInverse(this.q)).mod(this.q))}Tt.prototype.equals=hz;Tt.prototype.toBigInteger=dz;Tt.prototype.negate=fz;Tt.prototype.add=pz;Tt.prototype.subtract=mz;Tt.prototype.multiply=gz;Tt.prototype.square=vz;Tt.prototype.divide=yz;Tt.prototype.sqrt=function(){return new Tt(this.q,this.x.sqrt().mod(this.q))};function ke(r,e,t,n){this.curve=r,this.x=e,this.y=t,n==null?this.z=L.ONE:this.z=n,this.zinv=null}function bz(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function xz(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function Sz(r){if(r==this)return!0;if(this.isInfinity())return r.isInfinity();if(r.isInfinity())return this.isInfinity();var e,t;return e=r.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(r.z)).mod(this.curve.q),e.equals(L.ZERO)?(t=r.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(r.z)).mod(this.curve.q),t.equals(L.ZERO)):!1}function wz(){return this.x==null&&this.y==null?!0:this.z.equals(L.ZERO)&&!this.y.toBigInteger().equals(L.ZERO)}function Cz(){return new ke(this.curve,this.x,this.y.negate(),this.z)}function Ez(r){if(this.isInfinity())return r;if(r.isInfinity())return this;var e=r.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(r.z)).mod(this.curve.q),t=r.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(r.z)).mod(this.curve.q);if(L.ZERO.equals(t))return L.ZERO.equals(e)?this.twice():this.curve.getInfinity();var n=new L("3"),i=this.x.toBigInteger(),s=this.y.toBigInteger(),o=r.x.toBigInteger(),a=r.y.toBigInteger(),c=t.square(),l=c.multiply(t),d=i.multiply(c),h=e.square().multiply(this.z),u=h.subtract(d.shiftLeft(1)).multiply(r.z).subtract(l).multiply(t).mod(this.curve.q),f=d.multiply(n).multiply(e).subtract(s.multiply(l)).subtract(h.multiply(e)).multiply(r.z).add(e.multiply(l)).mod(this.curve.q),g=l.multiply(this.z).multiply(r.z).mod(this.curve.q);return new ke(this.curve,this.curve.fromBigInteger(u),this.curve.fromBigInteger(f),g)}function _z(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var r=new L("3"),e=this.x.toBigInteger(),t=this.y.toBigInteger(),n=t.multiply(this.z),i=n.multiply(t).mod(this.curve.q),s=this.curve.a.toBigInteger(),o=e.square().multiply(r);L.ZERO.equals(s)||(o=o.add(this.z.square().multiply(s))),o=o.mod(this.curve.q);var a=o.square().subtract(e.shiftLeft(3).multiply(i)).shiftLeft(1).multiply(n).mod(this.curve.q),c=o.multiply(r).multiply(e).subtract(i.shiftLeft(1)).shiftLeft(2).multiply(i).subtract(o.square().multiply(o)).mod(this.curve.q),l=n.square().multiply(n).shiftLeft(3).mod(this.curve.q);return new ke(this.curve,this.curve.fromBigInteger(a),this.curve.fromBigInteger(c),l)}function Tz(r){if(this.isInfinity())return this;if(r.signum()==0)return this.curve.getInfinity();var e=r,t=e.multiply(new L("3")),n=this.negate(),i=this,s=this.curve.q.subtract(r),o=s.multiply(new L("3")),a=new ke(this.curve,this.x,this.y),c=a.negate(),l;for(l=t.bitLength()-2;l>0;--l){i=i.twice();var d=t.testBit(l),h=e.testBit(l);d!=h&&(i=i.add(d?this:n))}for(l=o.bitLength()-2;l>0;--l){a=a.twice();var u=o.testBit(l),f=s.testBit(l);u!=f&&(a=a.add(u?a:c))}return i}function Az(r,e,t){var n;r.bitLength()>t.bitLength()?n=r.bitLength()-1:n=t.bitLength()-1;for(var i=this.curve.getInfinity(),s=this.add(e);n>=0;)i=i.twice(),r.testBit(n)?t.testBit(n)?i=i.add(s):i=i.add(this):t.testBit(n)&&(i=i.add(e)),--n;return i}ke.prototype.getX=bz;ke.prototype.getY=xz;ke.prototype.equals=Sz;ke.prototype.isInfinity=wz;ke.prototype.negate=Cz;ke.prototype.add=Ez;ke.prototype.twice=_z;ke.prototype.multiply=Tz;ke.prototype.multiplyTwo=Az;function Bn(r,e,t){this.q=r,this.a=this.fromBigInteger(e),this.b=this.fromBigInteger(t),this.infinity=new ke(this,null,null)}function Dz(){return this.q}function Fz(){return this.a}function Pz(){return this.b}function Iz(r){return r==this?!0:this.q.equals(r.q)&&this.a.equals(r.a)&&this.b.equals(r.b)}function Oz(){return this.infinity}function Nz(r){return new Tt(this.q,r)}function Rz(r){switch(parseInt(r.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var e=r.substr(0,2),t=r.substr(2),n=this.fromBigInteger(new L(l,16)),i=this.getA(),s=this.getB(),o=n.square().add(i).multiply(n).add(s),a=o.sqrt();return e=="03"&&(a=a.negate()),new ke(this,n,a);case 4:case 6:case 7:var c=(r.length-2)/2,l=r.substr(2,c),d=r.substr(c+2,c);return new ke(this,this.fromBigInteger(new L(l,16)),this.fromBigInteger(new L(d,16)));default:return null}}Bn.prototype.getQ=Dz;Bn.prototype.getA=Fz;Bn.prototype.getB=Pz;Bn.prototype.equals=Iz;Bn.prototype.getInfinity=Oz;Bn.prototype.fromBigInteger=Nz;Bn.prototype.decodePointHex=Rz;Tt.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)};ke.prototype.getEncoded=function(r){var e=function(s,o){var a=s.toByteArrayUnsigned();if(o<a.length)a=a.slice(a.length-o);else for(;o>a.length;)a.unshift(0);return a},t=this.getX().toBigInteger(),n=this.getY().toBigInteger(),i=e(t,32);return r?n.isEven()?i.unshift(2):i.unshift(3):(i.unshift(4),i=i.concat(e(n,32))),i};ke.decodeFrom=function(r,e){var t=e[0],n=e.length-1,i=e.slice(1,1+n/2),s=e.slice(1+n/2,1+n);i.unshift(0),s.unshift(0);var o=new L(i),a=new L(s);return new ke(r,r.fromBigInteger(o),r.fromBigInteger(a))};ke.decodeFromHex=function(r,e){var t=e.substr(0,2),n=e.length-2,i=e.substr(2,n/2),s=e.substr(2+n/2,n/2),o=new L(i,16),a=new L(s,16);return new ke(r,r.fromBigInteger(o),r.fromBigInteger(a))};ke.prototype.add2D=function(r){if(this.isInfinity())return r;if(r.isInfinity())return this;if(this.x.equals(r.x))return this.y.equals(r.y)?this.twice():this.curve.getInfinity();var e=r.x.subtract(this.x),t=r.y.subtract(this.y),n=t.divide(e),i=n.square().subtract(this.x).subtract(r.x),s=n.multiply(this.x.subtract(i)).subtract(this.y);return new ke(this.curve,i,s)};ke.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var r=this.curve.fromBigInteger(L.valueOf(2)),e=this.curve.fromBigInteger(L.valueOf(3)),t=this.x.square().multiply(e).add(this.curve.a).divide(this.y.multiply(r)),n=t.square().subtract(this.x.multiply(r)),i=t.multiply(this.x.subtract(n)).subtract(this.y);return new ke(this.curve,n,i)};ke.prototype.multiply2D=function(r){if(this.isInfinity())return this;if(r.signum()==0)return this.curve.getInfinity();var e=r,t=e.multiply(new L("3")),n=this.negate(),i=this,s;for(s=t.bitLength()-2;s>0;--s){i=i.twice();var o=t.testBit(s),a=e.testBit(s);o!=a&&(i=i.add2D(o?this:n))}return i};ke.prototype.isOnCurve=function(){var r=this.getX().toBigInteger(),e=this.getY().toBigInteger(),t=this.curve.getA().toBigInteger(),n=this.curve.getB().toBigInteger(),i=this.curve.getQ(),s=e.multiply(e).mod(i),o=r.multiply(r).multiply(r).add(t.multiply(r)).add(n).mod(i);return s.equals(o)};ke.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"};ke.prototype.validate=function(){var r=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var e=this.getX().toBigInteger(),t=this.getY().toBigInteger();if(e.compareTo(L.ONE)<0||e.compareTo(r.subtract(L.ONE))>0)throw new Error("x coordinate out of bounds");if(t.compareTo(L.ONE)<0||t.compareTo(r.subtract(L.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(r).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var oT=function(){var r="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",e='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',t='(?:"'+e+'*")',n=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+r+"|"+t+")","g"),i=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),s={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function o(h,u,f){return u?s[u]:String.fromCharCode(parseInt(f,16))}var a=new String(""),c="\\",l={"{":Object,"[":Array},d=Object.hasOwnProperty;return function(h,u){var f=h.match(n),g,m=f[0],b=!1;m==="{"?g={}:m==="["?g=[]:(g=[],b=!0);for(var v,x=[g],_=1-b,A=f.length;_<A;++_){m=f[_];var D;switch(m.charCodeAt(0)){default:D=x[0],D[v||D.length]=+m,v=void 0;break;case 34:if(m=m.substring(1,m.length-1),m.indexOf(c)!==-1&&(m=m.replace(i,o)),D=x[0],!v)if(D instanceof Array)v=D.length;else{v=m||a;break}D[v]=m,v=void 0;break;case 91:D=x[0],x.unshift(D[v||D.length]=[]),v=void 0;break;case 93:x.shift();break;case 102:D=x[0],D[v||D.length]=!1,v=void 0;break;case 110:D=x[0],D[v||D.length]=null,v=void 0;break;case 116:D=x[0],D[v||D.length]=!0,v=void 0;break;case 123:D=x[0],x.unshift(D[v||D.length]={}),v=void 0;break;case 125:x.shift();break}}if(b){if(x.length!==1)throw new Error;g=g[0]}else if(x.length)throw new Error;if(u){var O=function(M,S){var E=M[S];if(E&&typeof E=="object"){var w=null;for(var T in E)if(d.call(E,T)&&E!==M){var F=O(E,T);F!==void 0?E[T]=F:(w||(w=[]),w.push(T))}if(w)for(var N=w.length;--N>=0;)delete E[w[N]]}return u.call(M,S,E)};g=O({"":g},"")}return g}}();(typeof p>"u"||!p)&&(p={});(typeof p.asn1>"u"||!p.asn1)&&(p.asn1={});p.asn1.ASN1Util=new function(){this.integerToByteHex=function(r){var e=r.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(r){return Cc(r)},this.getPEMStringFromHex=function(r,e){return Yt(r,e)},this.newObject=function(r){var e=p,t=e.asn1,n=t.ASN1Object,i=t.DERBoolean,s=t.DERInteger,o=t.DERBitString,a=t.DEROctetString,c=t.DERNull,l=t.DERObjectIdentifier,d=t.DEREnumerated,h=t.DERUTF8String,u=t.DERNumericString,f=t.DERPrintableString,g=t.DERTeletexString,m=t.DERIA5String,b=t.DERUTCTime,v=t.DERGeneralizedTime,x=t.DERVisibleString,_=t.DERBMPString,A=t.DERSequence,D=t.DERSet,O=t.DERTaggedObject,M=t.ASN1Util.newObject;if(r instanceof t.ASN1Object)return r;var S=Object.keys(r);if(S.length!=1)throw new Error("key of param shall be only one.");var E=S[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+E+":")==-1)throw new Error("undefined key: "+E);if(E=="bool")return new i(r[E]);if(E=="int")return new s(r[E]);if(E=="bitstr")return new o(r[E]);if(E=="octstr")return new a(r[E]);if(E=="null")return new c(r[E]);if(E=="oid")return new l(r[E]);if(E=="enum")return new d(r[E]);if(E=="utf8str")return new h(r[E]);if(E=="numstr")return new u(r[E]);if(E=="prnstr")return new f(r[E]);if(E=="telstr")return new g(r[E]);if(E=="ia5str")return new m(r[E]);if(E=="utctime")return new b(r[E]);if(E=="gentime")return new v(r[E]);if(E=="visstr")return new x(r[E]);if(E=="bmpstr")return new _(r[E]);if(E=="asn1")return new n(r[E]);if(E=="seq"){for(var w=r[E],T=[],F=0;F<w.length;F++){var N=M(w[F]);T.push(N)}return new A({array:T})}if(E=="set"){for(var w=r[E],T=[],F=0;F<w.length;F++){var N=M(w[F]);T.push(N)}return new D({array:T})}if(E=="tag"){var P=r[E];if(Object.prototype.toString.call(P)==="[object Array]"&&P.length==3){var I=M(P[2]);return new O({tag:P[0],explicit:P[1],obj:I})}else return new O(P)}},this.jsonToASN1HEX=function(r){var e=this.newObject(r);return e.tohex()}};p.asn1.ASN1Util.oidHexToInt=function(r){for(var i="",e=parseInt(r.substr(0,2),16),t=Math.floor(e/40),n=e%40,i=t+"."+n,s="",o=2;o<r.length;o+=2){var a=parseInt(r.substr(o,2),16),c=("00000000"+a.toString(2)).slice(-8);if(s=s+c.substr(1,7),c.substr(0,1)=="0"){var l=new L(s,2);i=i+"."+l.toString(10),s=""}}return i};p.asn1.ASN1Util.oidIntToHex=function(r){var e=function(a){var c=a.toString(16);return c.length==1&&(c="0"+c),c},t=function(a){var c="",l=new L(a,10),d=l.toString(2),h=7-d.length%7;h==7&&(h=0);for(var u="",f=0;f<h;f++)u+="0";d=u+d;for(var f=0;f<d.length-1;f+=7){var g=d.substr(f,7);f!=d.length-7&&(g="1"+g),c+=e(parseInt(g,2))}return c};if(!r.match(/^[0-9.]+$/))throw"malformed oid string: "+r;var n="",i=r.split("."),s=parseInt(i[0])*40+parseInt(i[1]);n+=e(s),i.splice(0,2);for(var o=0;o<i.length;o++)n+=t(i[o]);return n};p.asn1.ASN1Object=function(r){var e=!0,t=null,n="00",i="00",s="";this.params=null,this.getLengthHexFromValue=function(){if(typeof this.hV>"u"||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+s.length+",v="+this.hV);var o=this.hV.length/2,a=o.toString(16);if(a.length%2==1&&(a="0"+a),o<128)return a;var c=a.length/2;if(c>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+o.toString(16));var l=128+c;return l.toString(16)+a},this.tohex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(o){this.params=o},r!=null&&r.tlv!=null&&(this.hTLV=r.tlv,this.isModified=!1)};p.asn1.DERAbstractString=function(r){p.asn1.DERAbstractString.superclass.constructor.call(this);var e=null,t=null;this.getString=function(){return this.s},this.setString=function(n){this.hTLV=null,this.isModified=!0,this.s=n,this.hV=Zh(this.s).toLowerCase()},this.setStringHex=function(n){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=n},this.getFreshValueHex=function(){return this.hV},typeof r<"u"&&(typeof r=="string"?this.setString(r):typeof r.str<"u"?this.setString(r.str):typeof r.hex<"u"&&this.setStringHex(r.hex))};U(p.asn1.DERAbstractString,p.asn1.ASN1Object);p.asn1.DERAbstractTime=function(r){p.asn1.DERAbstractTime.superclass.constructor.call(this);var e=null,t=null;this.localDateToUTC=function(n){var i=n.getTime()+n.getTimezoneOffset()*6e4,s=new Date(i);return s},this.formatDate=function(n,i,s){var o=this.zeroPadding,a=this.localDateToUTC(n),c=String(a.getFullYear());i=="utc"&&(c=c.substr(2,2));var l=o(String(a.getMonth()+1),2),d=o(String(a.getDate()),2),h=o(String(a.getHours()),2),u=o(String(a.getMinutes()),2),f=o(String(a.getSeconds()),2),g=c+l+d+h+u+f;if(s===!0){var m=a.getMilliseconds();if(m!=0){var b=o(String(m),3);b=b.replace(/[0]+$/,""),g=g+"."+b}}return g+"Z"},this.zeroPadding=function(n,i){return n.length>=i?n:new Array(i-n.length+1).join("0")+n},this.setByParam=function(n){this.hV=null,this.hTLV=null,this.params=n},this.getString=function(){},this.setString=function(n){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.str=n},this.setByDate=function(n){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.date=n},this.setByDateValue=function(n,i,s,o,a,c){var l=new Date(Date.UTC(n,i-1,s,o,a,c,0));this.setByDate(l)},this.getFreshValueHex=function(){return this.hV}};U(p.asn1.DERAbstractTime,p.asn1.ASN1Object);p.asn1.DERAbstractStructured=function(r){p.asn1.DERAbstractString.superclass.constructor.call(this);var e=null;this.setByASN1ObjectArray=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array=t},this.appendASN1Object=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array.push(t)},this.asn1Array=new Array,typeof r<"u"&&typeof r.array<"u"&&(this.asn1Array=r.array)};U(p.asn1.DERAbstractStructured,p.asn1.ASN1Object);p.asn1.DERBoolean=function(r){p.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",r==!1?this.hTLV="010100":this.hTLV="0101ff"};U(p.asn1.DERBoolean,p.asn1.ASN1Object);p.asn1.DERInteger=function(r){p.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var e=Cc;this.setByBigInteger=function(t){this.isModified=!0,this.params={bigint:t}},this.setByInteger=function(t){this.isModified=!0,this.params=t},this.setValueHex=function(t){this.isModified=!0,this.params={hex:t}},this.getFreshValueHex=function(){var t=this.params,n=null;if(t==null)throw new Error("value not set");if(typeof t=="object"&&t.hex!=null)return this.hV=t.hex,this.hV;if(typeof t=="number")n=new L(String(t),10);else if(t.int!=null)n=new L(String(t.int),10);else if(t.bigint!=null)n=t.bigint;else throw new Error("wrong parameter");return this.hV=e(n),this.hV},r!=null&&(this.params=r)};U(p.asn1.DERInteger,p.asn1.ASN1Object);p.asn1.DERBitString=function(r){if(r!==void 0&&typeof r.obj<"u"){var e=p.asn1.ASN1Util.newObject(r.obj);r.hex="00"+e.tohex()}p.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(t){this.hTLV=null,this.isModified=!0,this.hV=t},this.setUnusedBitsAndHexValue=function(t,n){if(t<0||7<t)throw"unused bits shall be from 0 to 7: u = "+t;var i="0"+t;this.hTLV=null,this.isModified=!0,this.hV=i+n},this.setByBinaryString=function(t){t=t.replace(/0+$/,"");var n=8-t.length%8;n==8&&(n=0),t+="0000000".substr(0,n);for(var i="",s=0;s<t.length-1;s+=8){var o=t.substr(s,8),a=parseInt(o,2).toString(16);a.length==1&&(a="0"+a),i+=a}this.hTLV=null,this.isModified=!0,this.hV="0"+n+i},this.setByBooleanArray=function(t){for(var n="",i=0;i<t.length;i++)t[i]==!0?n+="1":n+="0";this.setByBinaryString(n)},this.newFalseArray=function(t){for(var n=new Array(t),i=0;i<t;i++)n[i]=!1;return n},this.getFreshValueHex=function(){return this.hV},typeof r<"u"&&(typeof r=="string"&&r.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(r):typeof r.hex<"u"?this.setHexValueIncludingUnusedBits(r.hex):typeof r.bin<"u"?this.setByBinaryString(r.bin):typeof r.array<"u"&&this.setByBooleanArray(r.array))};U(p.asn1.DERBitString,p.asn1.ASN1Object);p.asn1.DEROctetString=function(r){if(r!==void 0&&typeof r.obj<"u"){var e=p.asn1.ASN1Util.newObject(r.obj);r.hex=e.tohex()}p.asn1.DEROctetString.superclass.constructor.call(this,r),this.hT="04"};U(p.asn1.DEROctetString,p.asn1.DERAbstractString);p.asn1.DERNull=function(){p.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"};U(p.asn1.DERNull,p.asn1.ASN1Object);p.asn1.DERObjectIdentifier=function(r){p.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){var t=fT(e);if(t==null)throw new Error("malformed oid string: "+e);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueName=function(e){var t=p.asn1.x509.OID.name2oid(e);if(t!=="")this.setValueOidString(t);else throw new Error("DERObjectIdentifier oidName undefined: "+e)},this.setValueNameOrOid=function(e){e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(e){typeof e=="string"?this.setValueNameOrOid(e):e.oid!==void 0?this.setValueNameOrOid(e.oid):e.name!==void 0?this.setValueNameOrOid(e.name):e.hex!==void 0&&this.setValueHex(e.hex)},r!==void 0&&this.setByParam(r)};U(p.asn1.DERObjectIdentifier,p.asn1.ASN1Object);p.asn1.DEREnumerated=function(r){p.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=Cc(e)},this.setByInteger=function(e){var t=new L(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},typeof r<"u"&&(typeof r.int<"u"?this.setByInteger(r.int):typeof r=="number"?this.setByInteger(r):typeof r.hex<"u"&&this.setValueHex(r.hex))};U(p.asn1.DEREnumerated,p.asn1.ASN1Object);p.asn1.DERUTF8String=function(r){p.asn1.DERUTF8String.superclass.constructor.call(this,r),this.hT="0c"};U(p.asn1.DERUTF8String,p.asn1.DERAbstractString);p.asn1.DERNumericString=function(r){p.asn1.DERNumericString.superclass.constructor.call(this,r),this.hT="12"};U(p.asn1.DERNumericString,p.asn1.DERAbstractString);p.asn1.DERPrintableString=function(r){p.asn1.DERPrintableString.superclass.constructor.call(this,r),this.hT="13"};U(p.asn1.DERPrintableString,p.asn1.DERAbstractString);p.asn1.DERTeletexString=function(r){p.asn1.DERTeletexString.superclass.constructor.call(this,r),this.hT="14"};U(p.asn1.DERTeletexString,p.asn1.DERAbstractString);p.asn1.DERIA5String=function(r){p.asn1.DERIA5String.superclass.constructor.call(this,r),this.hT="16"};U(p.asn1.DERIA5String,p.asn1.DERAbstractString);p.asn1.DERVisibleString=function(r){p.asn1.DERIA5String.superclass.constructor.call(this,r),this.hT="1a"};U(p.asn1.DERVisibleString,p.asn1.DERAbstractString);p.asn1.DERBMPString=function(r){p.asn1.DERBMPString.superclass.constructor.call(this,r),this.hT="1e"};U(p.asn1.DERBMPString,p.asn1.DERAbstractString);p.asn1.DERUTCTime=function(r){p.asn1.DERUTCTime.superclass.constructor.call(this,r),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var e=this.params;if(this.params==null&&(e={date:new Date}),typeof e=="string")if(e.match(/^[0-9]{12}Z$/)||e.match(/^[0-9]{12}\.[0-9]+Z$/))this.hV=yr(e);else throw new Error("malformed string for UTCTime: "+e);else if(e.str!=null)this.hV=yr(e.str);else if(e.date==null&&e.millis==!0){var t=new Date;this.hV=yr(this.formatDate(t,"utc",!0))}else if(e.date!=null&&e.date instanceof Date){var n=e.millis===!0;this.hV=yr(this.formatDate(e.date,"utc",n))}else e instanceof Date&&(this.hV=yr(this.formatDate(e,"utc")));if(this.hV==null)throw new Error("parameter not specified properly for UTCTime");return this.hV},r!=null&&this.setByParam(r)};U(p.asn1.DERUTCTime,p.asn1.DERAbstractTime);p.asn1.DERGeneralizedTime=function(r){p.asn1.DERGeneralizedTime.superclass.constructor.call(this,r),this.hT="18",this.params=r,this.getFreshValueHex=function(){var e=this.params;if(this.params==null&&(e={date:new Date}),typeof e=="string")if(e.match(/^[0-9]{14}Z$/)||e.match(/^[0-9]{14}\.[0-9]+Z$/))this.hV=yr(e);else throw new Error("malformed string for GeneralizedTime: "+e);else if(e.str!=null)this.hV=yr(e.str);else if(e.date==null&&e.millis==!0){var t=new Date;this.hV=yr(this.formatDate(t,"gen",!0))}else if(e.date!=null&&e.date instanceof Date){var n=e.millis===!0;this.hV=yr(this.formatDate(e.date,"gen",n))}else e instanceof Date&&(this.hV=yr(this.formatDate(e,"gen")));if(this.hV==null)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},r!=null&&this.setByParam(r)};U(p.asn1.DERGeneralizedTime,p.asn1.DERAbstractTime);p.asn1.DERSequence=function(r){p.asn1.DERSequence.superclass.constructor.call(this,r),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++){var n=this.asn1Array[t];e+=n.tohex()}return this.hV=e,this.hV}};U(p.asn1.DERSequence,p.asn1.DERAbstractStructured);p.asn1.DERSet=function(r){p.asn1.DERSet.superclass.constructor.call(this,r),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var n=this.asn1Array[t];e.push(n.tohex())}return this.sortFlag==!0&&e.sort(),this.hV=e.join(""),this.hV},typeof r<"u"&&typeof r.sortflag<"u"&&r.sortflag==!1&&(this.sortFlag=!1)};U(p.asn1.DERSet,p.asn1.DERAbstractStructured);p.asn1.DERTaggedObject=function(r){p.asn1.DERTaggedObject.superclass.constructor.call(this);var e=p.asn1,t=Q,n=t.getV,i=t.isASN1HEX,s=e.ASN1Util.newObject;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(o,a,c){this.params={tag:a,explicit:o,obj:c}},this.getFreshValueHex=function(){var o=this.params;if(o.explicit==null&&(o.explicit=!0),o.tage!=null&&(o.tag=o.tage,o.explicit=!0),o.tagi!=null&&(o.tag=o.tagi,o.explicit=!1),o.str!=null)this.hV=Zh(o.str);else if(o.hex!=null)this.hV=o.hex;else if(o.obj!=null){var a;o.obj instanceof e.ASN1Object?a=o.obj.tohex():typeof o.obj=="object"&&(a=s(o.obj).tohex()),o.explicit?this.hV=a:this.hV=n(a,0)}else throw new Error("str, hex nor obj not specified");return o.tag==null&&(o.tag="a0"),this.hT=o.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(o){this.params=o},r!==void 0&&this.setByParam(r)};U(p.asn1.DERTaggedObject,p.asn1.ASN1Object);var Q=new function(){};Q.getLblen=function(r,e){if(r.substr(e+2,1)!="8")return 1;var t=parseInt(r.substr(e+3,1));return t==0?-1:0<t&&t<10?t+1:-2};Q.getL=function(r,e){var t=Q.getLblen(r,e);return t<1?"":r.substr(e+2,t*2)};Q.getVblen=function(r,e){var t,n;return t=Q.getL(r,e),t==""?-1:(t.substr(0,1)==="8"?n=new L(t.substr(2),16):n=new L(t,16),n.intValue())};Q.getVidx=function(r,e){var t=Q.getLblen(r,e);return t<0?t:e+(t+1)*2};Q.getV=function(r,e){var t=Q.getVidx(r,e),n=Q.getVblen(r,e);return r.substr(t,n*2)};Q.getTLV=function(r,e){return r.substr(e,2)+Q.getL(r,e)+Q.getV(r,e)};Q.getTLVblen=function(r,e){return 2+Q.getLblen(r,e)*2+Q.getVblen(r,e)*2};Q.getNextSiblingIdx=function(r,e){var t=Q.getVidx(r,e),n=Q.getVblen(r,e);return t+n*2};Q.getChildIdx=function(r,e){var t=Q,n=[],i,s,o;i=t.getVidx(r,e),s=t.getVblen(r,e)*2,r.substr(e,2)=="03"&&(i+=2,s-=2),o=0;for(var a=i;o<=s;){var c=t.getTLVblen(r,a);if(o+=c,o<=s&&n.push(a),a+=c,o>=s)break}return n};Q.getNthChildIdx=function(r,e,t){var n=Q.getChildIdx(r,e);return n[t]};Q.getIdxbyList=function(r,e,t,n){var i=Q,s,o;return t.length==0?n!==void 0&&r.substr(e,2)!==n?-1:e:(s=t.shift(),o=i.getChildIdx(r,e),s>=o.length?-1:i.getIdxbyList(r,o[s],t,n))};Q.getIdxbyListEx=function(r,e,t,n){var i=Q,s,o;if(t.length==0)return n!==void 0&&r.substr(e,2)!==n?-1:e;s=t.shift(),o=i.getChildIdx(r,e);for(var a=0,c=0;c<o.length;c++){var l=r.substr(o[c],2);if(typeof s=="number"&&!i.isContextTag(l)&&a==s||typeof s=="string"&&i.isContextTag(l,s))return i.getIdxbyListEx(r,o[c],t,n);i.isContextTag(l)||a++}return-1};Q.getTLVbyList=function(r,e,t,n){var i=Q,s=i.getIdxbyList(r,e,t,n);return s==-1||s>=r.length?null:i.getTLV(r,s)};Q.getTLVbyListEx=function(r,e,t,n){var i=Q,s=i.getIdxbyListEx(r,e,t,n);return s==-1?null:i.getTLV(r,s)};Q.getVbyList=function(r,e,t,n,i){var s=Q,o,a;return o=s.getIdxbyList(r,e,t,n),o==-1||o>=r.length?null:(a=s.getV(r,o),i===!0&&(a=a.substr(2)),a)};Q.getVbyListEx=function(r,e,t,n,i){var s=Q,o,a,c;return o=s.getIdxbyListEx(r,e,t,n),o==-1?null:(c=s.getV(r,o),r.substr(o,2)=="03"&&i!==!1&&(c=c.substr(2)),c)};Q.getInt=function(r,e,t){t==null&&(t=-1);try{var n=r.substr(e,2);if(n!="02"&&n!="03")return t;var i=Q.getV(r,e);return n=="02"?parseInt(i,16):mT(i)}catch{return t}};Q.getOID=function(r,e,t){t==null&&(t=null);try{if(r.substr(e,2)!="06")return t;var n=Q.getV(r,e);return id(n)}catch{return t}};Q.getOIDName=function(r,e,t){t==null&&(t=null);try{var n=Q.getOID(r,e,t);if(n==t)return t;var i=p.asn1.x509.OID.oid2name(n);return i==""?n:i}catch{return t}};Q.getString=function(r,e,t){t==null&&(t=null);try{var n=Q.getV(r,e);return br(n)}catch{return t}};Q.hextooidstr=function(r){var e=function(h,u){return h.length>=u?h:new Array(u-h.length+1).join("0")+h},t=[],n=r.substr(0,2),i=parseInt(n,16);t[0]=new String(Math.floor(i/40)),t[1]=new String(i%40);for(var s=r.substr(2),o=[],a=0;a<s.length/2;a++)o.push(parseInt(s.substr(a*2,2),16));for(var c=[],l="",a=0;a<o.length;a++)o[a]&128?l=l+e((o[a]&127).toString(2),7):(l=l+e((o[a]&127).toString(2),7),c.push(new String(parseInt(l,2))),l="");var d=t.join(".");return c.length>0&&(d=d+"."+c.join(".")),d};Q.dump=function(r,e,t,n){var i=Q,s=i.getV,o=i.dump,a=i.getChildIdx,c=r;r instanceof p.asn1.ASN1Object&&(c=r.tohex());var l=function(M,S){if(M.length<=S*2)return M;var E=M.substr(0,S)+"..(total "+M.length/2+"bytes).."+M.substr(M.length-S,S);return E};e===void 0&&(e={ommit_long_octet:32}),t===void 0&&(t=0),n===void 0&&(n="");var d=e.ommit_long_octet,D=c.substr(t,2);if(D=="01"){var h=s(c,t);return h=="00"?n+`BOOLEAN FALSE
`:n+`BOOLEAN TRUE
`}if(D=="02"){var h=s(c,t);return n+"INTEGER "+l(h,d)+`
`}if(D=="03"){var h=s(c,t);if(i.isASN1HEX(h.substr(2))){var u=n+`BITSTRING, encapsulates
`;return u=u+o(h.substr(2),e,0,n+"  "),u}else return n+"BITSTRING "+l(h,d)+`
`}if(D=="04"){var h=s(c,t);if(i.isASN1HEX(h)){var u=n+`OCTETSTRING, encapsulates
`;return u=u+o(h,e,0,n+"  "),u}else return n+"OCTETSTRING "+l(h,d)+`
`}if(D=="05")return n+`NULL
`;if(D=="06"){var f=s(c,t),g=p.asn1.ASN1Util.oidHexToInt(f),m=p.asn1.x509.OID.oid2name(g),b=g.replace(/\./g," ");return m!=""?n+"ObjectIdentifier "+m+" ("+b+`)
`:n+"ObjectIdentifier ("+b+`)
`}if(D=="0a")return n+"ENUMERATED "+parseInt(s(c,t))+`
`;if(D=="0c")return n+"UTF8String '"+qe(s(c,t))+`'
`;if(D=="13")return n+"PrintableString '"+qe(s(c,t))+`'
`;if(D=="14")return n+"TeletexString '"+qe(s(c,t))+`'
`;if(D=="16")return n+"IA5String '"+qe(s(c,t))+`'
`;if(D=="17")return n+"UTCTime "+qe(s(c,t))+`
`;if(D=="18")return n+"GeneralizedTime "+qe(s(c,t))+`
`;if(D=="1a")return n+"VisualString '"+qe(s(c,t))+`'
`;if(D=="1e")return n+"BMPString '"+i0(s(c,t))+`'
`;if(D=="30"){if(c.substr(t,4)=="3000")return n+`SEQUENCE {}
`;var u=n+`SEQUENCE
`,v=a(c,t),x=e;if((v.length==2||v.length==3)&&c.substr(v[0],2)=="06"&&c.substr(v[v.length-1],2)=="04"){var m=i.oidname(s(c,v[0])),_=JSON.parse(JSON.stringify(e));_.x509ExtName=m,x=_}for(var A=0;A<v.length;A++)u=u+o(c,x,v[A],n+"  ");return u}if(D=="31"){for(var u=n+`SET
`,v=a(c,t),A=0;A<v.length;A++)u=u+o(c,e,v[A],n+"  ");return u}var D=parseInt(D,16);if(D&128){var O=D&31;if(D&32){for(var u=n+"["+O+`]
`,v=a(c,t),A=0;A<v.length;A++)u=u+o(c,e,v[A],n+"  ");return u}else{var h=s(c,t);if(Q.isASN1HEX(h)){var u=n+"["+O+`]
`;return u=u+o(h,e,0,n+"  "),u}else(h.substr(0,8)=="68747470"||e.x509ExtName==="subjectAltName"&&O==2)&&(h=qe(h));var u=n+"["+O+"] "+h+`
`;return u}}return n+"UNKNOWN("+D+") "+s(c,t)+`
`};Q.parse=function(r){var e=Q,t=e.parse,n=e.isASN1HEX,i=e.getV,s=e.getTLV,o=e.getChildIdx,a=p.asn1,c=a.ASN1Util.oidHexToInt,l=a.x509.OID.oid2name,d=qe,h=i0,u=jz,f={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},g=function(E){for(var w=[],T=o(E,0),F=0;F<T.length;F++){var N=T[F],P=s(E,N),I=t(P);w.push(I)}return w},m=r.substr(0,2),b={},v=i(r,0);if(m=="01")return r=="0101ff"?{bool:!0}:{bool:!1};if(m=="02")return{int:{hex:v}};if(m=="03")try{if(v.substr(0,2)!="00")throw"not encap";var x=v.substr(2);if(!n(x))throw"not encap";return{bitstr:{obj:t(x)}}}catch{var _=null;return v.length<=10&&(_=vT(v)),_==null?{bitstr:{hex:v}}:{bitstr:{bin:_}}}else if(m=="04")try{if(!n(v))throw"not encap";return{octstr:{obj:t(v)}}}catch{return{octstr:{hex:v}}}else{if(m=="05")return{null:""};if(m=="06"){var A=c(v),D=l(A);return D==""?{oid:A}:{oid:D}}else{if(m=="0a")return v.length>4?{enum:{hex:v}}:{enum:parseInt(v,16)};if(m=="30"||m=="31")return b[f[m]]=g(r),b;if(m=="14"){var O=u(v);return b[f[m]]={str:O},b}else if(m=="1e"){var O=h(v);return b[f[m]]={str:O},b}else if(":0c:12:13:16:17:18:1a:".indexOf(m)!=-1){var O=d(v);return b[f[m]]={str:O},b}else if(m.match(/^8[0-9]$/)){var O=d(v);return O==null|O==""?{tag:{tag:m,explicit:!1,hex:v}}:O.match(/[\x00-\x1F\x7F-\x9F]/)!=null||O.match(/[\u0000-\u001F\u0080\u009F]/)!=null?{tag:{tag:m,explicit:!1,hex:v}}:{tag:{tag:m,explicit:!1,str:O}}}else if(m.match(/^a[0-9]$/))try{if(!n(v))throw new Error("not encap");return{tag:{tag:m,explicit:!0,obj:t(v)}}}catch{return{tag:{tag:m,explicit:!0,hex:v}}}else{var M=new p.asn1.ASN1Object;M.hV=v;var S=M.getLengthHexFromValue();return{asn1:{tlv:m+S+v}}}}}};Q.isContextTag=function(r,e){r=r.toLowerCase();var t,n;try{t=parseInt(r,16)}catch{return-1}if(e===void 0)return(t&192)==128;try{var i=e.match(/^\[[0-9]+\]$/);return i==null||(n=parseInt(e.substr(1,e.length-1),10),n>31)?!1:(t&192)==128&&(t&31)==n}catch{return!1}};Q.isASN1HEX=function(r){var e=Q;if(r.length%2==1)return!1;var t=e.getVblen(r,0),n=r.substr(0,2),i=e.getL(r,0),s=r.length-n.length-i.length;return s==t*2};Q.checkStrictDER=function(r,e,t,n,i){var s=Q;if(t===void 0){if(typeof r!="string")throw new Error("not hex string");if(r=r.toLowerCase(),!p.lang.String.isHex(r))throw new Error("not hex string");t=r.length,n=r.length/2,n<128?i=1:i=Math.ceil(n.toString(16))+1}var o=s.getL(r,e);if(o.length>i*2)throw new Error("L of TLV too long: idx="+e);var a=s.getVblen(r,e);if(a>n)throw new Error("value of L too long than hex: idx="+e);var c=s.getTLV(r,e),l=c.length-2-s.getL(r,e).length;if(l!==a*2)throw new Error("V string length and L's value not the same:"+l+"/"+a*2);if(e===0&&r.length!=c.length)throw new Error("total length and TLV length unmatch:"+r.length+"!="+c.length);var d=r.substr(e,2);if(d==="02"){var h=s.getVidx(r,e);if(r.substr(h,2)=="00"&&r.charCodeAt(h+2)<56)throw new Error("not least zeros for DER INTEGER")}if(parseInt(d,16)&32){for(var u=s.getVblen(r,e),f=0,g=s.getChildIdx(r,e),m=0;m<g.length;m++){var b=s.getTLV(r,g[m]);f+=b.length,s.checkStrictDER(r,g[m],t,n,i)}if(u*2!=f)throw new Error("sum of children's TLV length and L unmatch: "+u*2+"!="+f)}};Q.oidname=function(r){var e=p.asn1;p.lang.String.isHex(r)&&(r=e.ASN1Util.oidHexToInt(r));var t=e.x509.OID.oid2name(r);return t===""&&(t=r),t};(typeof p>"u"||!p)&&(p={});(typeof p.asn1>"u"||!p.asn1)&&(p.asn1={});(typeof p.asn1.x509>"u"||!p.asn1.x509)&&(p.asn1.x509={});p.asn1.x509.Certificate=function(r){p.asn1.x509.Certificate.superclass.constructor.call(this);var e=p,t=e.asn1,n=t.DERBitString,i=t.DERSequence,s=t.x509,o=s.TBSCertificate,a=s.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(c){this.params=c},this.sign=function(){var c=this.params,l=c.sigalg;c.sigalg.name!=null&&(l=c.sigalg.name);var d=c.tbsobj.tohex(),h=new p.crypto.Signature({alg:l});h.init(c.cakey),h.updateHex(d),c.sighex=h.sign()},this.getPEM=function(){return Yt(this.tohex(),"CERTIFICATE")},this.tohex=function(){var c=this.params;if((c.tbsobj==null||c.tbsobj==null)&&(c.tbsobj=new o(c)),c.sighex==null&&c.cakey!=null&&this.sign(),c.sighex==null)throw new Error("sighex or cakey parameter not defined");var l=[];l.push(c.tbsobj),l.push(new a({name:c.sigalg})),l.push(new n({hex:"00"+c.sighex}));var d=new i({array:l});return d.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&(this.params=r)};U(p.asn1.x509.Certificate,p.asn1.ASN1Object);p.asn1.x509.TBSCertificate=function(r){p.asn1.x509.TBSCertificate.superclass.constructor.call(this);var e=p,t=e.asn1,n=t.x509,i=t.DERTaggedObject,s=t.DERInteger,o=t.DERSequence,a=n.AlgorithmIdentifier,c=n.Time,l=n.X500Name,d=n.Extensions,h=n.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(u){this.params=u},this.tohex=function(){var u=[],f=this.params;if(f.version!=null||f.version!=1){var g=2;f.version!=null&&(g=f.version-1);var m=new i({obj:new s({int:g})});u.push(m)}u.push(new s(f.serial)),u.push(new a({name:f.sigalg})),u.push(new l(f.issuer)),u.push(new o({array:[new c(f.notbefore),new c(f.notafter)]})),u.push(new l(f.subject)),u.push(new h(we.getKey(f.sbjpubkey))),f.ext!==void 0&&f.ext.length>0&&u.push(new i({tag:"a3",obj:new d(f.ext)}));var b=new p.asn1.DERSequence({array:u});return b.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.x509.TBSCertificate,p.asn1.ASN1Object);p.asn1.x509.Extensions=function(r){p.asn1.x509.Extensions.superclass.constructor.call(this);var e=p,t=e.asn1,n=t.DERSequence,i=t.x509;this.aParam=[],this.setByParam=function(s){this.aParam=s},this.tohex=function(){for(var s=[],o=0;o<this.aParam.length;o++){var a=this.aParam[o],c=a.extname,l=null;if(a.extn!=null)l=new i.PrivateExtension(a);else if(c=="subjectKeyIdentifier")l=new i.SubjectKeyIdentifier(a);else if(c=="keyUsage")l=new i.KeyUsage(a);else if(c=="subjectAltName")l=new i.SubjectAltName(a);else if(c=="issuerAltName")l=new i.IssuerAltName(a);else if(c=="basicConstraints")l=new i.BasicConstraints(a);else if(c=="nameConstraints")l=new i.NameConstraints(a);else if(c=="cRLDistributionPoints")l=new i.CRLDistributionPoints(a);else if(c=="certificatePolicies")l=new i.CertificatePolicies(a);else if(c=="policyMappings")l=new i.PolicyMappings(a);else if(c=="policyConstraints")l=new i.PolicyConstraints(a);else if(c=="inhibitAnyPolicy")l=new i.InhibitAnyPolicy(a);else if(c=="authorityKeyIdentifier")l=new i.AuthorityKeyIdentifier(a);else if(c=="extKeyUsage")l=new i.ExtKeyUsage(a);else if(c=="authorityInfoAccess")l=new i.AuthorityInfoAccess(a);else if(c=="cRLNumber")l=new i.CRLNumber(a);else if(c=="cRLReason")l=new i.CRLReason(a);else if(c=="ocspNonce")l=new i.OCSPNonce(a);else if(c=="ocspNoCheck")l=new i.OCSPNoCheck(a);else if(c=="adobeTimeStamp")l=new i.AdobeTimeStamp(a);else if(c=="subjectDirectoryAttributes")l=new i.SubjectDirectoryAttributes(a);else throw new Error("extension not supported:"+JSON.stringify(a));l!=null&&s.push(l)}var d=new n({array:s});return d.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.x509.Extensions,p.asn1.ASN1Object);p.asn1.x509.Extension=function(r){p.asn1.x509.Extension.superclass.constructor.call(this);var e=null,t=p,n=t.asn1,i=n.DERObjectIdentifier,s=n.DEROctetString,o=n.DERBitString,a=n.DERBoolean,c=n.DERSequence;this.tohex=function(){var l=new i({oid:this.oid}),d=new s({hex:this.getExtnValueHex()}),h=new Array;h.push(l),this.critical&&h.push(new a),h.push(d);var u=new c({array:h});return u.tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,r!==void 0&&r.critical!==void 0&&(this.critical=r.critical)};U(p.asn1.x509.Extension,p.asn1.ASN1Object);p.asn1.x509.KeyUsage=function(r){p.asn1.x509.KeyUsage.superclass.constructor.call(this,r);var e=Error,t={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var n=this.getBinValue();return this.asn1ExtnValue=new p.asn1.DERBitString({bin:n}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var n=this.params;if(typeof n!="object"||typeof n.names!="object"&&typeof n.bin!="string")throw new e("parameter not yet set");if(n.names!=null)return Jh(n.names,t);if(n.bin!=null)return n.bin;throw new e("parameter not set properly")},this.oid="2.5.29.15",r!==void 0&&(this.params=r)};U(p.asn1.x509.KeyUsage,p.asn1.x509.Extension);p.asn1.x509.BasicConstraints=function(r){p.asn1.x509.BasicConstraints.superclass.constructor.call(this,r);var e=p.asn1,t=e.DERBoolean,n=e.DERInteger,i=e.DERSequence,s=!1,o=-1;this.getExtnValueHex=function(){var a=new Array;this.cA&&a.push(new t),this.pathLen>-1&&a.push(new n({int:this.pathLen}));var c=new i({array:a});return this.asn1ExtnValue=c,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,r!==void 0&&(r.cA!==void 0&&(this.cA=r.cA),r.pathLen!==void 0&&(this.pathLen=r.pathLen))};U(p.asn1.x509.BasicConstraints,p.asn1.x509.Extension);p.asn1.x509.CRLDistributionPoints=function(r){p.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,r);var e=p,t=e.asn1,n=t.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(i){for(var s=[],o=0;o<i.length;o++)if(i[o]instanceof p.asn1.ASN1Object)s.push(i[o]);else{var a=new n.DistributionPoint(i[o]);s.push(a)}this.asn1ExtnValue=new t.DERSequence({array:s})},this.setByOneURI=function(i){var s=new n.DistributionPoint({fulluri:i});this.setByDPArray([s])},this.oid="2.5.29.31",r!==void 0&&(r.array!==void 0?this.setByDPArray(r.array):r.uri!==void 0&&this.setByOneURI(r.uri))};U(p.asn1.x509.CRLDistributionPoints,p.asn1.x509.Extension);p.asn1.x509.DistributionPoint=function(r){p.asn1.x509.DistributionPoint.superclass.constructor.call(this);var e=null,t=p,n=t.asn1,i=n.x509.DistributionPointName;this.tohex=function(){var s=new n.DERSequence;if(this.asn1DP!=null){var o=new n.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});s.appendASN1Object(o)}return this.hTLV=s.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&(r.dpobj!==void 0?this.asn1DP=r.dpobj:r.dpname!==void 0?this.asn1DP=new i(r.dpname):r.fulluri!==void 0&&(this.asn1DP=new i({full:[{uri:r.fulluri}]})))};U(p.asn1.x509.DistributionPoint,p.asn1.ASN1Object);p.asn1.x509.DistributionPointName=function(r){p.asn1.x509.DistributionPointName.superclass.constructor.call(this);var e=null,t=null,n=null,i=null,s=p,o=s.asn1,a=o.DERTaggedObject;if(this.tohex=function(){if(this.type!="full")throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new a({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0)if(o.x509.GeneralNames.prototype.isPrototypeOf(r))this.type="full",this.tag="a0",this.asn1V=r;else if(r.full!==void 0)this.type="full",this.tag="a0",this.asn1V=new o.x509.GeneralNames(r.full);else throw new Error("This class supports GeneralNames only as argument")};U(p.asn1.x509.DistributionPointName,p.asn1.ASN1Object);p.asn1.x509.CertificatePolicies=function(r){p.asn1.x509.CertificatePolicies.superclass.constructor.call(this,r);var e=p,t=e.asn1,n=t.x509,i=t.DERSequence,s=n.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var o=[],a=0;a<this.params.array.length;a++)o.push(new s(this.params.array[a]));var c=new i({array:o});return this.asn1ExtnValue=c,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",r!==void 0&&(this.params=r)};U(p.asn1.x509.CertificatePolicies,p.asn1.x509.Extension);p.asn1.x509.PolicyInformation=function(r){p.asn1.x509.PolicyInformation.superclass.constructor.call(this,r);var e=p.asn1,t=e.DERSequence,n=e.DERObjectIdentifier,i=e.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(this.params.policyoid===void 0&&this.params.array===void 0)throw new Error("parameter oid and array missing");var s=[new n(this.params.policyoid)];if(this.params.array!==void 0){for(var o=[],a=0;a<this.params.array.length;a++)o.push(new i(this.params.array[a]));o.length>0&&s.push(new t({array:o}))}var c=new t({array:s});return c.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&(this.params=r)};U(p.asn1.x509.PolicyInformation,p.asn1.ASN1Object);p.asn1.x509.PolicyQualifierInfo=function(r){p.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,r);var e=p.asn1,t=e.DERSequence,n=e.DERIA5String,i=e.DERObjectIdentifier,s=e.x509.UserNotice;this.params=null,this.tohex=function(){if(this.params.cps!==void 0){var o=new t({array:[new i({oid:"1.3.6.1.5.5.7.2.1"}),new n({str:this.params.cps})]});return o.tohex()}if(this.params.unotice!=null){var o=new t({array:[new i({oid:"1.3.6.1.5.5.7.2.2"}),new s(this.params.unotice)]});return o.tohex()}},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&(this.params=r)};U(p.asn1.x509.PolicyQualifierInfo,p.asn1.ASN1Object);p.asn1.x509.UserNotice=function(r){p.asn1.x509.UserNotice.superclass.constructor.call(this,r);var e=p.asn1.DERSequence,t=p.asn1.DERInteger,n=p.asn1.x509.DisplayText,i=p.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var s=[];this.params.noticeref!==void 0&&s.push(new i(this.params.noticeref)),this.params.exptext!==void 0&&s.push(new n(this.params.exptext));var o=new e({array:s});return o.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&(this.params=r)};U(p.asn1.x509.UserNotice,p.asn1.ASN1Object);p.asn1.x509.NoticeReference=function(r){p.asn1.x509.NoticeReference.superclass.constructor.call(this,r);var e=p.asn1.DERSequence,t=p.asn1.DERInteger,n=p.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var i=[];if(this.params.org!==void 0&&i.push(new n(this.params.org)),this.params.noticenum!==void 0){for(var s=[],o=this.params.noticenum,a=0;a<o.length;a++)s.push(new t(o[a]));i.push(new e({array:s}))}if(i.length==0)throw new Error("parameter is empty");var c=new e({array:i});return c.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&(this.params=r)};U(p.asn1.x509.NoticeReference,p.asn1.ASN1Object);p.asn1.x509.DisplayText=function(r){p.asn1.x509.DisplayText.superclass.constructor.call(this,r),this.hT="0c",r!==void 0&&(r.type==="ia5"?this.hT="16":r.type==="vis"?this.hT="1a":r.type==="bmp"&&(this.hT="1e"))};U(p.asn1.x509.DisplayText,p.asn1.DERAbstractString);p.asn1.x509.PolicyMappings=function(r){p.asn1.x509.PolicyMappings.superclass.constructor.call(this,r);var e=p,t=e.asn1,n=t.x509,i=t.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){for(var s=this.params,o=[],a=0;a<s.array.length;a++){var c=s.array[a];o.push({seq:[{oid:c[0]},{oid:c[1]}]})}return this.asn1ExtnValue=i({seq:o}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",r!==void 0&&(this.params=r)};U(p.asn1.x509.PolicyMappings,p.asn1.x509.Extension);p.asn1.x509.PolicyConstraints=function(r){p.asn1.x509.PolicyConstraints.superclass.constructor.call(this,r);var e=p,t=e.asn1,n=t.x509,i=t.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){var s=this.params,o=[];return s.reqexp!=null&&o.push({tag:{tagi:"80",obj:{int:s.reqexp}}}),s.inhibit!=null&&o.push({tag:{tagi:"81",obj:{int:s.inhibit}}}),this.asn1ExtnValue=i({seq:o}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",r!==void 0&&(this.params=r)};U(p.asn1.x509.PolicyConstraints,p.asn1.x509.Extension);p.asn1.x509.InhibitAnyPolicy=function(r){p.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,r);var e=p,t=e.asn1,n=t.x509,i=t.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=i({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",r!==void 0&&(this.params=r)};U(p.asn1.x509.InhibitAnyPolicy,p.asn1.x509.Extension);p.asn1.x509.NameConstraints=function(r){p.asn1.x509.NameConstraints.superclass.constructor.call(this,r);var e=p,t=e.asn1,n=t.x509,i=t.ASN1Util.newObject,s=n.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var o=this.params,a=[];if(o.permit!=null&&o.permit.length!=null){for(var c=[],l=0;l<o.permit.length;l++)c.push(new s(o.permit[l]));a.push({tag:{tagi:"a0",obj:{seq:c}}})}if(o.exclude!=null&&o.exclude.length!=null){for(var d=[],l=0;l<o.exclude.length;l++)d.push(new s(o.exclude[l]));a.push({tag:{tagi:"a1",obj:{seq:d}}})}return this.asn1ExtnValue=i({seq:a}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",r!==void 0&&(this.params=r)};U(p.asn1.x509.NameConstraints,p.asn1.x509.Extension);p.asn1.x509.GeneralSubtree=function(r){p.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var e=p.asn1,t=e.x509,n=t.GeneralName,i=e.ASN1Util.newObject;this.params=null,this.setByParam=function(s){this.params=s},this.tohex=function(){var s=this.params,o=[new n(s)];s.min!=null&&o.push({tag:{tagi:"80",obj:{int:s.min}}}),s.max!=null&&o.push({tag:{tagi:"81",obj:{int:s.max}}});var a=i({seq:o});return a.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.x509.GeneralSubtree,p.asn1.ASN1Object);p.asn1.x509.ExtKeyUsage=function(r){p.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,r);var e=p,t=e.asn1;this.setPurposeArray=function(n){this.asn1ExtnValue=new t.DERSequence;for(var i=0;i<n.length;i++){var s=new t.DERObjectIdentifier(n[i]);this.asn1ExtnValue.appendASN1Object(s)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",r!==void 0&&r.array!==void 0&&this.setPurposeArray(r.array)};U(p.asn1.x509.ExtKeyUsage,p.asn1.x509.Extension);p.asn1.x509.AuthorityKeyIdentifier=function(r){p.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,r);var e=p,t=e.asn1,n=t.DERTaggedObject,i=t.x509.GeneralNames,s=e.crypto.Util.isKey;this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var o=new Array;this.asn1KID&&o.push(new n({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&o.push(new n({explicit:!1,tag:"a1",obj:new i([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&o.push(new n({explicit:!1,tag:"82",obj:this.asn1CertSN}));var a=new t.DERSequence({array:o});return this.asn1ExtnValue=a,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(o){if(o.str!==void 0||o.hex!==void 0)this.asn1KID=new p.asn1.DEROctetString(o);else if(typeof o=="object"&&p.crypto.Util.isKey(o)||typeof o=="string"&&o.indexOf("BEGIN ")!=-1){var a=o;typeof o=="string"&&(a=we.getKey(o));var c=we.getKeyID(a);this.asn1KID=new p.asn1.DEROctetString({hex:c})}},this.setCertIssuerByParam=function(o){o.str!==void 0||o.ldapstr!==void 0||o.hex!==void 0||o.certsubject!==void 0||o.certissuer!==void 0?this.asn1CertIssuer=new p.asn1.x509.X500Name(o):typeof o=="string"&&o.indexOf("BEGIN ")!=-1&&o.indexOf("CERTIFICATE")!=-1&&(this.asn1CertIssuer=new p.asn1.x509.X500Name({certissuer:o}))},this.setCertSNByParam=function(o){if(o.str!==void 0||o.bigint!==void 0||o.hex!==void 0)this.asn1CertSN=new p.asn1.DERInteger(o);else if(typeof o=="string"&&o.indexOf("BEGIN ")!=-1&&o.indexOf("CERTIFICATE")){var a=new he;a.readCertPEM(o);var c=a.getSerialNumberHex();this.asn1CertSN=new p.asn1.DERInteger({hex:c})}},this.oid="2.5.29.35",r!==void 0&&(r.kid!==void 0&&this.setKIDByParam(r.kid),r.issuer!==void 0&&this.setCertIssuerByParam(r.issuer),r.sn!==void 0&&this.setCertSNByParam(r.sn),r.issuersn!==void 0&&typeof r.issuersn=="string"&&r.issuersn.indexOf("BEGIN ")!=-1&&r.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(r.issuersn),this.setCertIssuerByParam(r.issuersn)))};U(p.asn1.x509.AuthorityKeyIdentifier,p.asn1.x509.Extension);p.asn1.x509.SubjectKeyIdentifier=function(r){p.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,r);var e=p,t=e.asn1,n=t.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(i){if(i.str!==void 0||i.hex!==void 0)this.asn1KID=new n(i);else if(typeof i=="object"&&p.crypto.Util.isKey(i)||typeof i=="string"&&i.indexOf("BEGIN")!=-1){var s=i;typeof i=="string"&&(s=we.getKey(i));var o=we.getKeyID(s);this.asn1KID=new p.asn1.DEROctetString({hex:o})}},this.oid="2.5.29.14",r!==void 0&&r.kid!==void 0&&this.setKIDByParam(r.kid)};U(p.asn1.x509.SubjectKeyIdentifier,p.asn1.x509.Extension);p.asn1.x509.AuthorityInfoAccess=function(r){p.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,r),this.setAccessDescriptionArray=function(e){for(var t=new Array,n=p,i=n.asn1,s=i.DERSequence,o=i.DERObjectIdentifier,a=i.x509.GeneralName,c=0;c<e.length;c++){var l,d=e[c];if(d.ocsp!==void 0)l=new s({array:[new o({oid:"1.3.6.1.5.5.7.48.1"}),new a({uri:d.ocsp})]});else if(d.caissuer!==void 0)l=new s({array:[new o({oid:"1.3.6.1.5.5.7.48.2"}),new a({uri:d.caissuer})]});else throw new Error("unknown AccessMethod parameter: "+JSON.stringify(d));t.push(l)}this.asn1ExtnValue=new s({array:t})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",r!==void 0&&r.array!==void 0&&this.setAccessDescriptionArray(r.array)};U(p.asn1.x509.AuthorityInfoAccess,p.asn1.x509.Extension);p.asn1.x509.SubjectAltName=function(r){p.asn1.x509.SubjectAltName.superclass.constructor.call(this,r),this.setNameArray=function(e){this.asn1ExtnValue=new p.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",r!==void 0&&r.array!==void 0&&this.setNameArray(r.array)};U(p.asn1.x509.SubjectAltName,p.asn1.x509.Extension);p.asn1.x509.IssuerAltName=function(r){p.asn1.x509.IssuerAltName.superclass.constructor.call(this,r),this.setNameArray=function(e){this.asn1ExtnValue=new p.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",r!==void 0&&r.array!==void 0&&this.setNameArray(r.array)};U(p.asn1.x509.IssuerAltName,p.asn1.x509.Extension);p.asn1.x509.SubjectDirectoryAttributes=function(r){p.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,r);var e=p.asn1,t=e.DERSequence,n=e.ASN1Util.newObject,i=e.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var s=[],o=0;o<this.params.array.length;o++){var a=this.params.array[o];if(a.attr!=null&&a.array!=null){var c={seq:[{oid:a.attr},{set:a.array}]};s.push(n(c));continue}var l={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if(a.attr=="dateOfBirth")l.seq[0].oid=i(a.attr),l.seq[1].set[0]={gentime:a.str};else if(a.attr=="placeOfBirth")l.seq[0].oid=i(a.attr),l.seq[1].set[0]={utf8str:a.str};else if(a.attr=="gender")l.seq[0].oid=i(a.attr),l.seq[1].set[0]={prnstr:a.str};else if(a.attr=="countryOfCitizenship")l.seq[0].oid=i(a.attr),l.seq[1].set[0]={prnstr:a.str};else if(a.attr=="countryOfResidence")l.seq[0].oid=i(a.attr),l.seq[1].set[0]={prnstr:a.str};else throw new Error("unsupported attribute: "+a.attr);s.push(new n(l))}var d=new t({array:s});return this.asn1ExtnValue=d,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",r!==void 0&&(this.params=r)};U(p.asn1.x509.SubjectDirectoryAttributes,p.asn1.x509.Extension);p.asn1.x509.PrivateExtension=function(r){p.asn1.x509.PrivateExtension.superclass.constructor.call(this,r);var e=p,t=e.lang.String.isHex,n=e.asn1,i=n.x509.OID.name2oid,s=n.ASN1Util.newObject;this.params=null,this.setByParam=function(o){this.oid=i(o.extname),this.params=o},this.getExtnValueHex=function(){if(this.params.extname==null||this.params.extn==null)throw new Error("extname or extnhex not specified");var o=this.params.extn;if(typeof o=="string"&&t(o))return o;if(typeof o=="object")try{return s(o).tohex()}catch{}throw new Error("unsupported extn value")},r!=null&&this.setByParam(r)};U(p.asn1.x509.PrivateExtension,p.asn1.x509.Extension);p.asn1.x509.CRL=function(r){p.asn1.x509.CRL.superclass.constructor.call(this);var e=p,t=e.asn1,n=t.DERSequence,i=t.DERBitString,s=t.x509,o=s.AlgorithmIdentifier,a=s.TBSCertList;this.params=void 0,this.setByParam=function(c){this.params=c},this.sign=function(){var c=new a(this.params).tohex(),l=new p.crypto.Signature({alg:this.params.sigalg});l.init(this.params.cakey),l.updateHex(c);var d=l.sign();this.params.sighex=d},this.getPEM=function(){return Yt(this.tohex(),"X509 CRL")},this.tohex=function(){var c=this.params;if(c.tbsobj==null&&(c.tbsobj=new a(c)),c.sighex==null&&c.cakey!=null&&this.sign(),c.sighex==null)throw new Error("sighex or cakey parameter not defined");var l=[];l.push(c.tbsobj),l.push(new o({name:c.sigalg})),l.push(new i({hex:"00"+c.sighex}));var d=new n({array:l});return d.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&(this.params=r)};U(p.asn1.x509.CRL,p.asn1.ASN1Object);p.asn1.x509.TBSCertList=function(r){p.asn1.x509.TBSCertList.superclass.constructor.call(this);var e=p,t=e.asn1,n=t.DERInteger,i=t.DERSequence,s=t.DERTaggedObject,o=t.DERObjectIdentifier,a=t.x509,c=a.AlgorithmIdentifier,l=a.Time,d=a.Extensions,h=a.X500Name;this.params=null,this.setByParam=function(u){this.params=u},this.getRevCertSequence=function(){for(var u=[],f=this.params.revcert,g=0;g<f.length;g++){var m=[new n(f[g].sn),new l(f[g].date)];f[g].ext!=null&&m.push(new d(f[g].ext)),u.push(new i({array:m}))}return new i({array:u})},this.tohex=function(){var u=[],f=this.params;if(f.version!=null){var g=f.version-1,m=new n({int:g});u.push(m)}if(u.push(new c({name:f.sigalg})),u.push(new h(f.issuer)),u.push(new l(f.thisupdate)),f.nextupdate!=null&&u.push(new l(f.nextupdate)),f.revcert!=null&&u.push(this.getRevCertSequence()),f.ext!=null){var b=new d(f.ext);u.push(new s({tag:"a0",explicit:!0,obj:b}))}var v=new i({array:u});return v.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.x509.TBSCertList,p.asn1.ASN1Object);p.asn1.x509.CRLEntry=function(r){p.asn1.x509.CRLEntry.superclass.constructor.call(this);var e=null,t=null,n=p,i=n.asn1;this.setCertSerial=function(s){this.sn=new i.DERInteger(s)},this.setRevocationDate=function(s){this.time=new i.x509.Time(s)},this.tohex=function(){var s=new i.DERSequence({array:[this.sn,this.time]});return this.TLV=s.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&(r.time!==void 0&&this.setRevocationDate(r.time),r.sn!==void 0&&this.setCertSerial(r.sn))};U(p.asn1.x509.CRLEntry,p.asn1.ASN1Object);p.asn1.x509.CRLNumber=function(r){p.asn1.x509.CRLNumber.superclass.constructor.call(this,r),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new p.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",r!=null&&(this.params=r)};U(p.asn1.x509.CRLNumber,p.asn1.x509.Extension);p.asn1.x509.CRLReason=function(r){p.asn1.x509.CRLReason.superclass.constructor.call(this,r),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new p.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",r!=null&&(this.params=r)};U(p.asn1.x509.CRLReason,p.asn1.x509.Extension);p.asn1.x509.OCSPNonce=function(r){p.asn1.x509.OCSPNonce.superclass.constructor.call(this,r),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new p.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",r!=null&&(this.params=r)};U(p.asn1.x509.OCSPNonce,p.asn1.x509.Extension);p.asn1.x509.OCSPNoCheck=function(r){p.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,r),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new p.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",r!=null&&(this.params=r)};U(p.asn1.x509.OCSPNoCheck,p.asn1.x509.Extension);p.asn1.x509.AdobeTimeStamp=function(r){p.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,r);var e=p,t=e.asn1,n=t.DERInteger,i=t.DERBoolean,s=t.DERSequence,o=t.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var a=this.params,c=[new n(1)];return c.push(new o({uri:a.uri})),a.reqauth!=null&&c.push(new i(a.reqauth)),this.asn1ExtnValue=new s({array:c}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",r!==void 0&&this.setByParam(r)};U(p.asn1.x509.AdobeTimeStamp,p.asn1.x509.Extension);p.asn1.x509.X500Name=function(r){p.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var e=p,t=e.asn1,n=t.x509,i=n.RDN,s=dt;this.setByString=function(o,a){a!==void 0&&(this.sRule=a);var c=o.split("/");c.shift();for(var l=[],d=0;d<c.length;d++)if(c[d].match(/^[^=]+=.+$/))l.push(c[d]);else{var h=l.length-1;l[h]=l[h]+"/"+c[d]}for(var d=0;d<l.length;d++)this.asn1Array.push(new i({str:l[d],rule:this.sRule}))},this.setByLdapString=function(o,a){a!==void 0&&(this.sRule=a);var c=n.X500Name.ldapToCompat(o);this.setByString(c,a)},this.setByObject=function(o,a){a!==void 0&&(this.sRule=a);for(var c in o)if(o.hasOwnProperty(c)){var l=new i({str:c+"="+o[c],rule:this.sRule});this.asn1Array?this.asn1Array.push(l):this.asn1Array=[l]}},this.setByParam=function(o){if(o.rule!==void 0&&(this.sRule=o.rule),o.array!==void 0)this.paramArray=o.array;else if(o.str!==void 0)this.setByString(o.str);else if(o.ldapstr!==void 0)this.setByLdapString(o.ldapstr);else if(o.hex!==void 0)this.hTLV=o.hex;else if(o.certissuer!==void 0){var a=new he;a.readCertPEM(o.certissuer),this.hTLV=a.getIssuerHex()}else if(o.certsubject!==void 0){var a=new he;a.readCertPEM(o.certsubject),this.hTLV=a.getSubjectHex()}else typeof o=="object"&&o.certsubject===void 0&&o.certissuer===void 0&&this.setByObject(o)},this.tohex=function(){if(typeof this.hTLV=="string")return this.hTLV;if(this.asn1Array.length==0&&this.paramArray.length>0)for(var o=0;o<this.paramArray.length;o++){var a={array:this.paramArray[o]};this.sRule!="utf8"&&(a.rule=this.sRule);var c=new i(a);this.asn1Array.push(c)}var l=new t.DERSequence({array:this.asn1Array});return this.hTLV=l.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.x509.X500Name,p.asn1.ASN1Object);p.asn1.x509.X500Name.compatToLDAP=function(r){if(r.substr(0,1)!=="/")throw"malformed input";var e="";r=r.substr(1);var t=r.split("/");return t.reverse(),t=t.map(function(n){return n.replace(/,/,"\\,")}),t.join(",")};p.asn1.x509.X500Name.onelineToLDAP=function(r){return p.asn1.x509.X500Name.compatToLDAP(r)};p.asn1.x509.X500Name.ldapToCompat=function(r){for(var e=r.split(","),t=!1,n=[],i=0;e.length>0;i++){var s=e.shift();if(t===!0){var o=n.pop(),a=(o+","+s).replace(/\\,/g,",");n.push(a),t=!1}else n.push(s);s.substr(-1,1)==="\\"&&(t=!0)}return n=n.map(function(c){return c.replace("/","\\/")}),n.reverse(),"/"+n.join("/")};p.asn1.x509.X500Name.ldapToOneline=function(r){return p.asn1.x509.X500Name.ldapToCompat(r)};p.asn1.x509.RDN=function(r){p.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var e=p.asn1.x509.AttributeTypeAndValue;this.setByParam=function(t){t.rule!==void 0&&(this.sRule=t.rule),t.str!==void 0&&this.addByMultiValuedString(t.str),t.array!==void 0&&(this.paramArray=t.array)},this.addByString=function(t){this.asn1Array.push(new p.asn1.x509.AttributeTypeAndValue({str:t,rule:this.sRule}))},this.addByMultiValuedString=function(t){for(var n=p.asn1.x509.RDN.parseString(t),i=0;i<n.length;i++)this.addByString(n[i])},this.tohex=function(){if(this.asn1Array.length==0&&this.paramArray.length>0)for(var t=0;t<this.paramArray.length;t++){var n=this.paramArray[t];n.rule!==void 0&&this.sRule!="utf8"&&(n.rule=this.sRule);var i=new e(n);this.asn1Array.push(i)}var s=new p.asn1.DERSet({array:this.asn1Array});return this.TLV=s.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.x509.RDN,p.asn1.ASN1Object);p.asn1.x509.RDN.parseString=function(r){for(var e=r.split(/\+/),t=!1,n=[],i=0;e.length>0;i++){var s=e.shift();if(t===!0){var o=n.pop(),a=(o+"+"+s).replace(/\\\+/g,"+");n.push(a),t=!1}else n.push(s);s.substr(-1,1)==="\\"&&(t=!0)}for(var c=!1,l=[],i=0;n.length>0;i++){var s=n.shift();if(c===!0){var d=l.pop();if(s.match(/"$/)){var a=(d+"+"+s).replace(/^([^=]+)="(.*)"$/,"$1=$2");l.push(a),c=!1}else l.push(d+"+"+s)}else l.push(s);s.match(/^[^=]+="/)&&(c=!0)}return l};p.asn1.x509.AttributeTypeAndValue=function(r){p.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var e=p,t=e.asn1,n=t.DERSequence,i=t.DERUTF8String,s=t.DERPrintableString,o=t.DERTeletexString,a=t.DERIA5String,c=t.DERVisibleString,l=t.DERBMPString,d=e.lang.String.isMail,h=e.lang.String.isPrintable;this.setByParam=function(u){if(u.rule!==void 0&&(this.sRule=u.rule),u.ds!==void 0&&(this.dsType=u.ds),u.value===void 0&&u.str!==void 0){var f=u.str,g=f.match(/^([^=]+)=(.+)$/);if(g)this.sType=g[1],this.sValue=g[2];else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)}else this.sType=u.type,this.sValue=u.value},this.setByString=function(u,f){f!==void 0&&(this.sRule=f);var g=u.match(/^([^=]+)=(.+)$/);if(g)this.setByAttrTypeAndValueStr(g[1],g[2]);else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)},this._getDsType=function(){var u=this.sType,f=this.sValue,g=this.sRule;return g==="prn"?u=="CN"&&d(f)?"ia5":h(f)?"prn":"utf8":g==="utf8"?u=="CN"&&d(f)?"ia5":u=="C"?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(u,f,g){g!==void 0&&(this.sRule=g),this.sType=u,this.sValue=f},this.getValueObj=function(u,f){if(u=="utf8")return new i({str:f});if(u=="prn")return new s({str:f});if(u=="tel")return new o({str:f});if(u=="ia5")return new a({str:f});if(u=="vis")return new c({str:f});if(u=="bmp")return new l({str:f});throw new Error("unsupported directory string type: type="+u+" value="+f)},this.tohex=function(){this.dsType==null&&(this.dsType=this._getDsType());var u=p.asn1.x509.OID.atype2obj(this.sType),f=this.getValueObj(this.dsType,this.sValue),g=new n({array:[u,f]});return this.TLV=g.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.x509.AttributeTypeAndValue,p.asn1.ASN1Object);p.asn1.x509.SubjectPublicKeyInfo=function(r){p.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var e=null,t=null,n=p,i=n.asn1,s=i.DERInteger,o=i.DERBitString,a=i.DERObjectIdentifier,c=i.DERSequence,l=i.ASN1Util.newObject,d=i.x509,h=d.AlgorithmIdentifier,u=n.crypto,f=u.ECDSA,g=u.DSA;this.getASN1Object=function(){if(this.asn1AlgId==null||this.asn1SubjPKey==null)throw"algId and/or subjPubKey not set";var m=new c({array:[this.asn1AlgId,this.asn1SubjPKey]});return m},this.tohex=function(){var m=this.getASN1Object();return this.hTLV=m.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(m){try{if(m instanceof pe){var b=l({seq:[{int:{bigint:m.n}},{int:{int:m.e}}]}),v=b.tohex();this.asn1AlgId=new h({name:"rsaEncryption"}),this.asn1SubjPKey=new o({hex:"00"+v})}}catch{}try{if(m instanceof p.crypto.ECDSA){var x=new a({name:m.curveName});this.asn1AlgId=new h({name:"ecPublicKey",asn1params:x}),this.asn1SubjPKey=new o({hex:"00"+m.pubKeyHex})}}catch{}try{if(m instanceof p.crypto.DSA){var x=new l({seq:[{int:{bigint:m.p}},{int:{bigint:m.q}},{int:{bigint:m.g}}]});this.asn1AlgId=new h({name:"dsa",asn1params:x});var _=new s({bigint:m.y});this.asn1SubjPKey=new o({hex:"00"+_.tohex()})}}catch{}},r!==void 0&&this.setPubKey(r)};U(p.asn1.x509.SubjectPublicKeyInfo,p.asn1.ASN1Object);p.asn1.x509.Time=function(r){p.asn1.x509.Time.superclass.constructor.call(this);var e=null,t=null,n=p,i=n.asn1,s=i.DERUTCTime,o=i.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(a){this.timeParams=a},this.setByParam=function(a){this.params=a},this.getType=function(a){return a.match(/^[0-9]{12}Z$/)?"utc":a.match(/^[0-9]{14}Z$/)?"gen":a.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":a.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var a=this.params,c=null;if(typeof a=="string"&&(a={str:a}),a!=null&&a.str&&(a.type==null||a.type==null)&&(a.type=this.getType(a.str)),a!=null&&a.str?(a.type=="utc"&&(c=new s(a.str)),a.type=="gen"&&(c=new o(a.str))):this.type=="gen"?c=new o:c=new s,c==null)throw new Error("wrong setting for Time");return this.TLV=c.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};p.asn1.x509.Time_bak=function(r){p.asn1.x509.Time_bak.superclass.constructor.call(this);var e=null,t=null,n=p,i=n.asn1,s=i.DERUTCTime,o=i.DERGeneralizedTime;this.setTimeParams=function(a){this.timeParams=a},this.tohex=function(){var a=null;return this.timeParams!=null?this.type=="utc"?a=new s(this.timeParams):a=new o(this.timeParams):this.type=="utc"?a=new s:a=new o,this.TLV=a.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",r!==void 0&&(r.type!==void 0?this.type=r.type:r.str!==void 0&&(r.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),r.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=r)};U(p.asn1.x509.Time,p.asn1.ASN1Object);p.asn1.x509.AlgorithmIdentifier=function(r){p.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var e=p,t=e.asn1,n=t.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(this.nameAlg===null&&this.asn1Alg===null)throw new Error("algorithm not specified");if(this.nameAlg!==null){var s=null;for(var o in n)o===this.nameAlg&&(s=n[o]);if(s!==null)return this.hTLV=s,this.hTLV}this.nameAlg!==null&&this.asn1Alg===null&&(this.asn1Alg=t.x509.OID.name2obj(this.nameAlg));var a=[this.asn1Alg];this.asn1Params!==null&&a.push(this.asn1Params);var c=new t.DERSequence({array:a});return this.hTLV=c.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&(r.name!==void 0&&(this.nameAlg=r.name),r.asn1params!==void 0&&(this.asn1Params=r.asn1params),r.paramempty!==void 0&&(this.paramEmpty=r.paramempty)),this.asn1Params===null&&this.paramEmpty===!1&&this.nameAlg!==null){this.nameAlg.name!==void 0&&(this.nameAlg=this.nameAlg.name);var i=this.nameAlg.toLowerCase();i.substr(-7,7)!=="withdsa"&&i.substr(-9,9)!=="withecdsa"&&(this.asn1Params=new t.DERNull)}};U(p.asn1.x509.AlgorithmIdentifier,p.asn1.ASN1Object);p.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"};p.asn1.x509.GeneralName=function(r){p.asn1.x509.GeneralName.superclass.constructor.call(this);var e={rfc822:"81",dns:"82",dn:"a4",uri:"86",ip:"87",otherName:"a0"},t=p,n=t.asn1,i=n.x509,s=i.X500Name,o=i.OtherName,a=n.DERIA5String,c=n.DERPrintableString,l=n.DEROctetString,d=n.DERTaggedObject,h=n.ASN1Object,u=Error;this.params=null,this.setByParam=function(f){this.params=f},this.tohex=function(){var f=this.params,g,b,m,b=!1;if(f.other!==void 0)g="a0",m=new o(f.other);else if(f.rfc822!==void 0)g="81",m=new a({str:f.rfc822});else if(f.dns!==void 0)g="82",m=new a({str:f.dns});else if(f.dn!==void 0)g="a4",b=!0,typeof f.dn=="string"?m=new s({str:f.dn}):f.dn instanceof p.asn1.x509.X500Name?m=f.dn:m=new s(f.dn);else if(f.ldapdn!==void 0)g="a4",b=!0,m=new s({ldapstr:f.ldapdn});else if(f.certissuer!==void 0||f.certsubj!==void 0){g="a4",b=!0;var v,x,_=null;if(f.certsubj!==void 0?(v=!1,x=f.certsubj):(v=!0,x=f.certissuer),x.match(/^[0-9A-Fa-f]+$/)&&_==x,x.indexOf("-----BEGIN ")!=-1&&(_=dt(x)),_==null)throw new Error("certsubj/certissuer not cert");var A=new he;A.hex=_;var D;v?D=A.getIssuerHex():D=A.getSubjectHex(),m=new h,m.hTLV=D}else if(f.uri!==void 0)g="86",m=new a({str:f.uri});else if(f.ip!==void 0){g="87";var O,M=f.ip;try{if(M.match(/^[0-9a-f]+$/)){var S=M.length;if(S==8||S==16||S==32||S==64)O=M;else throw"err"}else O=n0(M)}catch(w){throw new u("malformed IP address: "+f.ip+":"+w.message)}m=new l({hex:O})}else throw new u("improper params");var E=new d({tag:g,explicit:b,obj:m});return E.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.x509.GeneralName,p.asn1.ASN1Object);p.asn1.x509.GeneralNames=function(r){p.asn1.x509.GeneralNames.superclass.constructor.call(this);var e=null,t=p,n=t.asn1;this.setByParamArray=function(i){for(var s=0;s<i.length;s++){var o=new n.x509.GeneralName(i[s]);this.asn1Array.push(o)}},this.tohex=function(){var i=new n.DERSequence({array:this.asn1Array});return i.tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,typeof r<"u"&&this.setByParamArray(r)};U(p.asn1.x509.GeneralNames,p.asn1.ASN1Object);p.asn1.x509.OtherName=function(r){p.asn1.x509.OtherName.superclass.constructor.call(this);var e=null,t=null,n=p,i=n.asn1,s=i.DERObjectIdentifier,o=i.DERSequence,a=i.ASN1Util.newObject;this.params=null,this.setByParam=function(c){this.params=c},this.tohex=function(){var c=this.params;if(c.oid==null||c.value==null)throw new Error("oid or value not specified");var l=new s({oid:c.oid}),d=a({tag:{tag:"a0",explicit:!0,obj:c.value}}),h=new o({array:[l,d]});return h.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.x509.OtherName,p.asn1.ASN1Object);p.asn1.x509.OID=new function(){var r=p.asn1.DERObjectIdentifier;this.name2oidList={"aes128-CBC":"2.16.840.1.101.3.4.1.2","aes256-CBC":"2.16.840.1.101.3.4.1.42",sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",hmacWithSHA1:"1.2.840.113549.2.7",hmacWithSHA224:"1.2.840.113549.2.8",hmacWithSHA256:"1.2.840.113549.2.9",hmacWithSHA384:"1.2.840.113549.2.10",hmacWithSHA512:"1.2.840.113549.2.11",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(e){if(typeof this.objCache[e]<"u")return this.objCache[e];if(typeof this.name2oidList[e]>"u")throw"Name of ObjectIdentifier not defined: "+e;var t=this.name2oidList[e],n=new r({oid:t});return this.objCache[e]=n,n},this.atype2obj=function(e){if(this.objCache[e]!==void 0)return this.objCache[e];var t;if(e.match(/^\d+\.\d+\.[0-9.]+$/))t=e;else if(this.atype2oidList[e]!==void 0)t=this.atype2oidList[e];else if(this.name2oidList[e]!==void 0)t=this.name2oidList[e];else throw new Error("AttributeType name undefined: "+e);var n=new r({oid:t});return this.objCache[e]=n,n},this.registerOIDs=function(e){if(this.checkOIDs(e))for(var t in e)this.name2oidList[t]=e[t]},this.checkOIDs=function(e){try{var t=Object.keys(e);return t.length==0?!1:(t.map(function(n,i,s){var o=this[n];if(!o.match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")},e),!0)}catch{return!1}}};p.asn1.x509.OID.oid2name=function(r){var e=p.asn1.x509.OID.name2oidList;for(var t in e)if(e[t]==r)return t;return""};p.asn1.x509.OID.oid2atype=function(r){var e=p.asn1.x509.OID.atype2oidList;for(var t in e)if(e[t]==r)return t;return r};p.asn1.x509.OID.name2oid=function(r){if(r.match(/^[0-9.]+$/))return r;var e=p.asn1.x509.OID.name2oidList;return e[r]===void 0?"":e[r]};p.asn1.x509.X509Util={};p.asn1.x509.X509Util.newCertPEM=function(r){var e=p.asn1.x509,t=e.TBSCertificate,n=e.Certificate,i=new n(r);return i.getPEM()};(typeof p>"u"||!p)&&(p={});(typeof p.asn1>"u"||!p.asn1)&&(p.asn1={});(typeof p.asn1.cms>"u"||!p.asn1.cms)&&(p.asn1.cms={});p.asn1.cms.Attribute=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSequence,s=n.DERSet,o=n.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(a){this.params=a},this.getValueArray=function(){throw new e("not yet implemented abstract")},this.tohex=function(){var a=new o({oid:this.typeOid}),c=new s({array:this.getValueArray()}),l=new i({array:[a,c]});return l.tohex()},this.getEncodedHex=function(){return this.tohex()}};U(p.asn1.cms.Attribute,p.asn1.ASN1Object);p.asn1.cms.ContentType=function(r){var e=p,t=e.asn1;t.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){var n=new t.DERObjectIdentifier(this.params.type);return[n]},r!=null&&this.setByParam(r)};U(p.asn1.cms.ContentType,p.asn1.cms.Attribute);p.asn1.cms.MessageDigest=function(r){var e=p,t=e.asn1,n=t.DEROctetString,i=t.cms;i.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){var s=new n(this.params);return[s]},r!=null&&this.setByParam(r)};U(p.asn1.cms.MessageDigest,p.asn1.cms.Attribute);p.asn1.cms.SigningTime=function(r){var e=p,t=e.asn1;t.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){var n=new t.x509.Time(this.params);return[n]},r!=null&&this.setByParam(r)};U(p.asn1.cms.SigningTime,p.asn1.cms.Attribute);p.asn1.cms.SigningCertificate=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSequence,s=n.cms,o=s.ESSCertID,a=t.crypto;s.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new e("parameter 'array' not specified");for(var c=this.params.array,l=[],d=0;d<c.length;d++){var h=c[d];r.hasis==!1&&typeof h=="string"&&(h.indexOf("-----BEGIN")!=-1||Q.isASN1HEX(h))&&(h={cert:h}),h.hasis!=!1&&r.hasis==!1&&(h.hasis=!1),l.push(new o(h))}var u=new i({array:l}),f=new i({array:[u]});return[f]},r!=null&&this.setByParam(r)};U(p.asn1.cms.SigningCertificate,p.asn1.cms.Attribute);p.asn1.cms.ESSCertID=function(r){p.asn1.cms.ESSCertID.superclass.constructor.call(this);var e=Error,t=p,n=t.asn1,i=n.DEROctetString,s=n.DERSequence,o=n.cms.IssuerSerial;this.params=null,this.getCertHash=function(a,c){if(a.hash!=null)return a.hash;if(typeof a=="string"&&a.indexOf("-----BEGIN")==-1&&!Q.isASN1HEX(a))return a;var l;if(typeof a=="string")l=a;else if(a.cert!=null)l=a.cert;else throw new e("hash nor cert unspecified");var d;l.indexOf("-----BEGIN")!=-1?d=dt(l):d=l,typeof a=="string"&&(a.indexOf("-----BEGIN")!=-1?d=dt(a):Q.isASN1HEX(a)&&(d=a));var h;if(a.alg!=null)h=a.alg;else if(c!=null)h=c;else throw new e("hash alg unspecified");return t.crypto.Util.hashHex(d,h)},this.tohex=function(){var a=this.params,c=this.getCertHash(a,"sha1"),l=[];l.push(new i({hex:c})),(typeof a=="string"&&a.indexOf("-----BEGIN")!=-1||a.cert!=null&&a.hasis!=!1||a.issuer!=null&&a.serial!=null)&&l.push(new o(a));var d=new s({array:l});return d.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.ESSCertID,p.asn1.ASN1Object);p.asn1.cms.SigningCertificateV2=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSequence,s=n.x509,o=n.cms,a=o.ESSCertIDv2,c=t.crypto;o.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new e("parameter 'array' not specified");for(var l=this.params.array,d=[],h=0;h<l.length;h++){var u=l[h];(r.alg!=null||r.hasis==!1)&&typeof u=="string"&&(u.indexOf("-----BEGIN")!=-1||Q.isASN1HEX(u))&&(u={cert:u}),u.alg==null&&r.alg!=null&&(u.alg=r.alg),u.hasis!=!1&&r.hasis==!1&&(u.hasis=!1),d.push(new a(u))}var f=new i({array:d}),g=new i({array:[f]});return[g]},r!=null&&this.setByParam(r)};U(p.asn1.cms.SigningCertificateV2,p.asn1.cms.Attribute);p.asn1.cms.ESSCertIDv2=function(r){p.asn1.cms.ESSCertIDv2.superclass.constructor.call(this);var e=Error,t=p,n=t.asn1,i=n.DEROctetString,s=n.DERSequence,o=n.cms.IssuerSerial,a=n.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var c=this.params,l=this.getCertHash(c,"sha256"),d=[];c.alg!=null&&c.alg!="sha256"&&d.push(new a({name:c.alg})),d.push(new i({hex:l})),(typeof c=="string"&&c.indexOf("-----BEGIN")!=-1||c.cert!=null&&c.hasis!=!1||c.issuer!=null&&c.serial!=null)&&d.push(new o(c));var h=new s({array:d});return h.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.ESSCertIDv2,p.asn1.cms.ESSCertID);p.asn1.cms.IssuerSerial=function(r){var e=Error,t=p,n=t.asn1,i=n.DERInteger,s=n.DERSequence,o=n.cms,a=n.x509,c=a.GeneralNames,l=he;o.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(d){this.params=d},this.tohex=function(){var d=this.params,h,u;if(typeof d=="string"&&d.indexOf("-----BEGIN")!=-1||d.cert!=null){var f;d.cert!=null?f=d.cert:f=d;var g=new l;g.readCertPEM(f),h=g.getIssuer(),u={hex:g.getSerialNumberHex()}}else if(d.issuer!=null&&d.serial)h=d.issuer,u=d.serial;else throw new e("cert or issuer and serial parameter not specified");var m=new c([{dn:h}]),b=new i(u),v=new s({array:[m,b]});return v.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.IssuerSerial,p.asn1.ASN1Object);p.asn1.cms.SignerIdentifier=function(r){var e=p,t=e.asn1,n=t.DERInteger,i=t.DERSequence,s=t.cms,o=s.IssuerAndSerialNumber,a=s.SubjectKeyIdentifier,c=t.x509,l=c.X500Name,d=he,h=Error;s.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var u=this.params;if(u.type=="isssn"){var f=new o(u);return f.tohex()}else if(u.type=="skid"){var g=new a(u);return g.tohex()}else throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.SignerIdentifier,p.asn1.ASN1Object);p.asn1.cms.IssuerAndSerialNumber=function(r){var e=p,t=e.asn1,n=t.DERInteger,i=t.DERSequence,s=t.cms,o=t.x509,a=o.X500Name,c=he,l=Error;s.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var d=this.params,h,u;if(typeof d=="string"&&d.indexOf("-----BEGIN")!=-1||d.cert!=null){var f;d.cert!=null?f=d.cert:f=d;var g=new c;g.readCertPEM(f),h=g.getIssuer(),u={hex:g.getSerialNumberHex()}}else if(d.issuer!=null&&d.serial)h=d.issuer,u=d.serial;else throw new l("cert or issuer and serial parameter not specified");var m=new a(h),b=new n(u),v=new i({array:[m,b]});return v.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(d){this.params=d},r!=null&&this.setByParam(r)};U(p.asn1.cms.IssuerAndSerialNumber,p.asn1.ASN1Object);p.asn1.cms.SubjectKeyIdentifier=function(r){var e=p,t=e.asn1,n=t.DERInteger,i=t.DERSequence,s=t.ASN1Util.newObject,o=t.cms,a=o.IssuerAndSerialName,c=o.SubjectKeyIdentifier,l=t.x509,d=l.X500Name,h=he,u=Error;o.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var f=this.params;if(f.cert==null&&f.skid==null)throw new u("property cert nor skid undefined");var g;if(f.cert!=null){var m=new h(f.cert),b=m.getExtSubjectKeyIdentifier();g=b.kid.hex}else f.skid!=null&&(g=f.skid);var v=s({tag:{tage:"a0",obj:{octstr:{hex:g}}}});return v.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.SubjectKeyIdentifier,p.asn1.ASN1Object);p.asn1.cms.AttributeList=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSet,s=n.cms;s.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(o){this.params=o},this.tohex=function(){var o=this.params;if(this.hTLV!=null)return this.hTLV;var a=!0;o.sortflag!=null&&(a=o.sortflag);for(var c=o.array,l=[],d=0;d<c.length;d++){var h=c[d],u=h.attr;if(u=="contentType")l.push(new s.ContentType(h));else if(u=="messageDigest")l.push(new s.MessageDigest(h));else if(u=="signingTime")l.push(new s.SigningTime(h));else if(u=="signingCertificate")l.push(new s.SigningCertificate(h));else if(u=="signingCertificateV2")l.push(new s.SigningCertificateV2(h));else if(u=="signaturePolicyIdentifier")l.push(new p.asn1.cades.SignaturePolicyIdentifier(h));else if(u=="signatureTimeStamp"||u=="timeStampToken")l.push(new p.asn1.cades.SignatureTimeStamp(h));else throw new e("unknown attr: "+u)}var f=new i({array:l,sortflag:a});return this.hTLV=f.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.AttributeList,p.asn1.ASN1Object);p.asn1.cms.SignerInfo=function(r){var e=Error,t=p,n=t.asn1,i=n.DERInteger,s=n.DEROctetString,o=n.DERSequence,a=n.DERTaggedObject,c=n.cms,l=c.SignerIdentifier,d=c.AttributeList,h=c.ContentType,u=c.EncapsulatedContentInfo,f=c.MessageDigest,g=c.SignedData,m=n.x509,b=m.AlgorithmIdentifier,v=t.crypto,x=we;c.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var _=this.params,A=_.sigalg,D=new d(_.sattrs).tohex(),O=x.getKey(_.signkey),M=new v.Signature({alg:A});M.init(O),M.updateHex(D);var S=M.sign();_.sighex=S},this.tohex=function(){var _=this.params,A=[];if(A.push(new i({int:_.version})),A.push(new l(_.id)),A.push(new b({name:_.hashalg})),_.sattrs!=null){var D=new d(_.sattrs);try{A.push(new a({tag:"a0",explicit:!1,obj:D}))}catch(M){throw new e("si sattr error: "+M)}}if(_.sigalgfield!=null?A.push(new b({name:_.sigalgfield})):A.push(new b({name:_.sigalg})),_.sighex==null&&_.signkey!=null&&this.sign(),A.push(new s({hex:_.sighex})),_.uattrs!=null){var D=new d(_.uattrs);try{A.push(new a({tag:"a1",explicit:!1,obj:D}))}catch(S){throw new e("si uattr error: "+S)}}var O=new o({array:A});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.SignerInfo,p.asn1.ASN1Object);p.asn1.cms.EncapsulatedContentInfo=function(r){var e=p,t=e.asn1,n=t.DERTaggedObject,i=t.DERSequence,s=t.DERObjectIdentifier,o=t.DEROctetString,a=t.cms;a.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var c=this.params,l=[];if(l.push(new s(c.type)),c.content!=null&&(c.content.hex!=null||c.content.str!=null)&&c.isDetached!=!0){var d=new o(c.content),h=new n({tag:"a0",explicit:!0,obj:d});l.push(h)}var u=new i({array:l});return u.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(c){this.params=c},r!=null&&this.setByParam(r)};U(p.asn1.cms.EncapsulatedContentInfo,p.asn1.ASN1Object);p.asn1.cms.ContentInfo=function(r){var e=p,t=e.asn1,n=t.DERTaggedObject,i=t.DERSequence,s=t.DERObjectIdentifier,o=t.x509,a=o.OID.name2obj;p.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var c=this.params,l=[];l.push(new s(c.type));var d=new n({tag:"a0",explicit:!0,obj:c.obj});l.push(d);var h=new i({array:l});return h.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(c){this.params=c},r!=null&&this.setByParam(r)};U(p.asn1.cms.ContentInfo,p.asn1.ASN1Object);p.asn1.cms.SignedData=function(r){var e=Error,t=p,n=t.asn1,i=n.ASN1Object,s=n.DERInteger,o=n.DERSet,a=n.DERSequence,c=n.DERTaggedObject,l=n.cms,d=l.EncapsulatedContentInfo,h=l.SignerInfo,u=l.ContentInfo,f=l.CertificateSet,g=l.RevocationInfoChoices,m=n.x509,b=m.AlgorithmIdentifier;p.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var v=this.params;this._setDigestAlgs(v),this._setContentTypeByEContent(v),this._setMessageDigestByEContent(v),this._setSignerInfoVersion(v),this._setSignedDataVersion(v)},this._setDigestAlgs=function(v){for(var x={},_=v.sinfos,A=0;A<_.length;A++){var D=_[A];x[D.hashalg]=1}v.hashalgs=Object.keys(x).sort()},this._setContentTypeByEContent=function(v){for(var x=v.econtent.type,_=v.sinfos,A=0;A<_.length;A++){var D=_[A],O=this._getAttrParamByName(D,"contentType");O.type=x}},this._setMessageDigestByEContent=function(v){var x=v.econtent,_=v.econtent.type,A=x.content.hex;A==null&&x.type=="data"&&x.content.str!=null&&(A=gn(x.content.str));for(var D=v.sinfos,O=0;O<D.length;O++){var M=D[O],S=M.hashalg,E=this._getAttrParamByName(M,"messageDigest"),w=p.crypto.Util.hashHex(A,S);E.hex=w}},this._getAttrParamByName=function(v,x){for(var _=v.sattrs.array,A=0;A<_.length;A++)if(_[A].attr==x)return _[A]},this._setSignerInfoVersion=function(v){for(var x=v.sinfos,_=0;_<x.length;_++){var A=x[_],D=1;A.id.type=="skid"&&(D=3),A.version=D}},this._setSignedDataVersion=function(v){var x=this._getSignedDataVersion(v);v.version=x},this._getSignedDataVersion=function(v){if(v.revinfos!=null)for(var x=v.revinfos,_=0;_<x.length;_++){var A=x[_];if(A.ocsp!=null)return 5}for(var D=v.sinfos,_=0;_<D.length;_++){var O=v.sinfos[_];if(O.version==3)return 3}return v.econtent.type!="data"?3:1},this.tohex=function(){var v=this.params;this.getEncodedHexPrepare!=null&&this.getEncodedHexPrepare(),v.fixed!=!0&&this.checkAndFixParam();var x=[];x.push(new s({int:v.version}));for(var _=[],A=0;A<v.hashalgs.length;A++){var D=v.hashalgs[A];_.push(new b({name:D}))}x.push(new o({array:_})),x.push(new d(v.econtent)),v.certs!=null&&x.push(new f(v.certs)),v.revinfos!=null&&x.push(new g(v.revinfos));for(var O=[],A=0;A<v.sinfos.length;A++){var M=v.sinfos[A];O.push(new h(M))}x.push(new o({array:O}));var S=new a({array:x});return S.tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){var v=new u({type:"signed-data",obj:this});return v},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.SignedData,p.asn1.ASN1Object);p.asn1.cms.CertificateSet=function(r){p.asn1.cms.CertificateSet.superclass.constructor.call(this);var e=Error,t=p.asn1,n=t.DERTaggedObject,i=t.DERSet,s=t.ASN1Object;this.params=null,this.tohex=function(){var o=this.params,a=[],c;if(o instanceof Array)c=o;else if(o.array!=null)c=o.array;else throw new e("cert array not specified");for(var l=0;l<c.length;l++){var d=c[l],h=dt(d),u=new s;u.hTLV=h,a.push(u)}var f={array:a};o.sortflag==!1&&(f.sortflag=!1);var g=new i(f),m=new n({tag:"a0",explicit:!1,obj:g});return m.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.CertificateSet,p.asn1.ASN1Object);p.asn1.cms.RevocationInfoChoices=function(r){p.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(!e instanceof Array)throw new Error("params is not array");for(var t=[],n=0;n<e.length;n++)t.push(new p.asn1.cms.RevocationInfoChoice(e[n]));var i=p.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:t}}});return i.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.RevocationInfoChoices,p.asn1.ASN1Object);p.asn1.cms.RevocationInfoChoice=function(r){p.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(e.crl!=null&&typeof e.crl=="string"){var t=e.crl;return e.crl.indexOf("-----BEGIN")!=-1&&(t=dt(e.crl)),t}else if(e.ocsp!=null){var n=p.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new p.asn1.cms.OtherRevocationFormat(e)}});return n.tohex()}else throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.RevocationInfoChoice,p.asn1.ASN1Object);p.asn1.cms.OtherRevocationFormat=function(r){p.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var e=Error,t=p,n=t.asn1,i=n.ASN1Util.newObject,s=t.lang.String.isHex;this.params=null,this.tohex=function(){var o=this.params;if(o.ocsp==null)throw new e("property ocsp not specified");if(!s(o.ocsp)||!Q.isASN1HEX(o.ocsp))throw new e("ocsp value not ASN.1 hex string");var a=i({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:o.ocsp}}]});return a.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cms.OtherRevocationFormat,p.asn1.ASN1Object);p.asn1.cms.CMSUtil=new function(){};p.asn1.cms.CMSUtil.newSignedData=function(r){return new p.asn1.cms.SignedData(r)};p.asn1.cms.CMSUtil.verifySignedData=function(r){var e=p,t=e.asn1,n=t.cms,i=n.SignerInfo,s=n.SignedData,o=n.SigningTime,a=n.SigningCertificate,c=n.SigningCertificateV2,l=t.cades,d=l.SignaturePolicyIdentifier,h=e.lang.String.isHex,u=Q,f=u.getVbyList,g=u.getTLVbyList,m=u.getIdxbyList,b=u.getChildIdx,v=u.getTLV,x=u.oidname,_=e.crypto.Util.hashHex;r.cms===void 0&&h(r.cms);var A=r.cms,D=function(I,B){for(var q,z=3;z<6;z++)if(q=m(I,0,[1,0,z]),q!==void 0){var V=I.substr(q,2);V==="a0"&&(B.certsIdx=q),V==="a1"&&(B.revinfosIdx=q),V==="31"&&(B.signerinfosIdx=q)}},O=function(I,B){var q=B.signerinfosIdx;if(q!==void 0){var z=b(I,q);B.signerInfoIdxList=z;for(var V=0;V<z.length;V++){var W=z[V],ie={idx:W};M(I,ie),B.signerInfos.push(ie)}}},M=function(I,B){var q=B.idx;B.signerid_issuer1=g(I,q,[1,0],"30"),B.signerid_serial1=f(I,q,[1,1],"02"),B.hashalg=x(f(I,q,[2,0],"06"));var z=m(I,q,[3],"a0");B.idxSignedAttrs=z,S(I,B,z);var V=b(I,q),W=V.length;if(W<6)throw"malformed SignerInfo";B.sigalg=x(f(I,q,[W-2,0],"06")),B.sigval=f(I,q,[W-1],"04")},S=function(I,B,q){var z=b(I,q);B.signedAttrIdxList=z;for(var V=0;V<z.length;V++){var W=z[V],ie=f(I,W,[0],"06"),ne;ie==="2a864886f70d010905"?(ne=qe(f(I,W,[1,0])),B.saSigningTime=ne):ie==="2a864886f70d010904"&&(ne=f(I,W,[1,0],"04"),B.saMessageDigest=ne)}},E=function(I,B){if(f(I,0,[0],"06")!=="2a864886f70d010702")return B;B.cmsType="signedData",B.econtent=f(I,0,[1,0,2,1,0]),D(I,B),B.signerInfos=[],O(I,B)},w=function(I,B){for(var q=B.parse.signerInfos,z=q.length,V=!0,W=0;W<z;W++){var ie=q[W];F(I,B,ie,W),ie.isValid||(V=!1)}B.isValid=V},T=function(I,B,q,z){var V=B.parse.certsIdx,W;if(B.certs===void 0){W=[],B.certkeys=[];for(var ie=b(I,V),ne=0;ne<ie.length;ne++){var me=v(I,ie[ne]),fe=new he;fe.readCertHex(me),W[ne]=fe,B.certkeys[ne]=fe.getPublicKey()}B.certs=W}else W=B.certs;B.cccc=W.length,B.cccci=ie.length;for(var ne=0;ne<W.length;ne++){var Xe=fe.getIssuerHex(),Le=fe.getSerialNumberHex();q.signerid_issuer1===Xe&&q.signerid_serial1===Le&&(q.certkey_idx=ne)}},F=function(I,B,q,z){q.verifyDetail={};var V=q.verifyDetail,W=B.parse.econtent,ie=q.hashalg,ne=q.saMessageDigest;V.validMessageDigest=!1,_(W,ie)===ne&&(V.validMessageDigest=!0),T(I,B,q,z),V.validSignatureValue=!1;var me=q.sigalg,fe="31"+v(I,q.idxSignedAttrs).substr(2);q.signedattrshex=fe;var Xe=B.certs[q.certkey_idx].getPublicKey(),Le=new p.crypto.Signature({alg:me});Le.init(Xe),Le.updateHex(fe);var je=Le.verify(q.sigval);V.validSignatureValue_isValid=je,je===!0&&(V.validSignatureValue=!0),q.isValid=!1,V.validMessageDigest&&V.validSignatureValue&&(q.isValid=!0)},N=function(){},P={isValid:!1,parse:{}};return E(A,P.parse),w(A,P),P};p.asn1.cms.CMSParser=function(){var r=Error,e=he,t=new e,n=Q,i=n.getV,s=n.getTLV,o=n.getIdxbyList,a=n.getTLVbyList,c=n.getTLVbyListEx,l=n.getVbyList,d=n.getVbyListEx,h=n.getChildIdx;this.getCMSSignedData=function(u){var f=a(u,0,[1,0]),g=this.getSignedData(f);return g},this.getSignedData=function(u){var f=h(u,0),g={},m=i(u,f[0]),b=parseInt(m,16);g.version=b;var v=s(u,f[1]);g.hashalgs=this.getHashAlgArray(v);var x=s(u,f[2]);g.econtent=this.getEContent(x);var _=c(u,0,["[0]"]);_!=null&&(g.certs=this.getCertificateSet(_));var A=c(u,0,["[1]"]);A!=null;var D=c(u,0,[3]);return g.sinfos=this.getSignerInfos(D),g},this.getHashAlgArray=function(u){for(var f=h(u,0),g=new e,m=[],b=0;b<f.length;b++){var v=s(u,f[b]),x=g.getAlgorithmIdentifierName(v);m.push(x)}return m},this.getEContent=function(u){var f={},g=l(u,0,[0]),m=l(u,0,[1,0]);return f.type=p.asn1.x509.OID.oid2name(Q.hextooidstr(g)),f.content={hex:m},f},this.getSignerInfos=function(u){for(var f=[],g=h(u,0),m=0;m<g.length;m++){var b=s(u,g[m]),v=this.getSignerInfo(b);f.push(v)}return f},this.getSignerInfo=function(u){var f={},g=h(u,0),m=n.getInt(u,g[0],-1);m!=-1&&(f.version=m);var b=s(u,g[1]),v=this.getIssuerAndSerialNumber(b);f.id=v;var x=s(u,g[2]),_=t.getAlgorithmIdentifierName(x);f.hashalg=_;var A=c(u,0,["[0]"]);if(A!=null){var D=this.getAttributeList(A);f.sattrs=D}var O=c(u,0,[3]),M=t.getAlgorithmIdentifierName(O);f.sigalg=M;var S=d(u,0,[4]);f.sighex=S;var E=c(u,0,["[1]"]);if(E!=null){var w=this.getAttributeList(E);f.uattrs=w}return f},this.getSignerIdentifier=function(u){if(u.substr(0,2)=="30")return this.getIssuerAndSerialNumber(u);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(u){var f={type:"isssn"},g=h(u,0),m=s(u,g[0]);f.issuer=t.getX500Name(m);var b=i(u,g[1]);return f.serial={hex:b},f},this.getAttributeList=function(u){for(var f=[],g=h(u,0),m=0;m<g.length;m++){var b=s(u,g[m]),v=this.getAttribute(b);f.push(v)}return{array:f}},this.getAttribute=function(u){var f={},g=h(u,0),m=n.getOID(u,g[0]),b=p.asn1.x509.OID.oid2name(m);f.attr=b;var v=s(u,g[1]),x=h(v,0);if(x.length==1)f.valhex=s(v,x[0]);else{for(var _=[],A=0;A<x.length;A++)_.push(s(v,x[A]));f.valhex=_}return b=="contentType"?this.setContentType(f):b=="messageDigest"?this.setMessageDigest(f):b=="signingTime"?this.setSigningTime(f):b=="signingCertificate"?this.setSigningCertificate(f):b=="signingCertificateV2"?this.setSigningCertificateV2(f):b=="signaturePolicyIdentifier"&&this.setSignaturePolicyIdentifier(f),f},this.setContentType=function(u){var f=n.getOIDName(u.valhex,0,null);f!=null&&(u.type=f,delete u.valhex)},this.setSigningTime=function(u){var f=i(u.valhex,0),g=qe(f);u.str=g,delete u.valhex},this.setMessageDigest=function(u){var f=i(u.valhex,0);u.hex=f,delete u.valhex},this.setSigningCertificate=function(u){var f=h(u.valhex,0);if(f.length>0){for(var g=s(u.valhex,f[0]),m=h(g,0),b=[],v=0;v<m.length;v++){var x=s(g,m[v]),_=this.getESSCertID(x);b.push(_)}u.array=b}if(f.length>1){var A=s(u.valhex,f[1]);u.polhex=A}delete u.valhex},this.setSignaturePolicyIdentifier=function(u){var f=h(u.valhex,0);if(f.length>0){var g=n.getOID(u.valhex,f[0]);u.oid=g}if(f.length>1){var m=new e,b=h(u.valhex,f[1]),v=s(u.valhex,b[0]),x=m.getAlgorithmIdentifierName(v);u.alg=x;var _=i(u.valhex,b[1]);u.hash=_}delete u.valhex},this.setSigningCertificateV2=function(u){var f=h(u.valhex,0);if(f.length>0){for(var g=s(u.valhex,f[0]),m=h(g,0),b=[],v=0;v<m.length;v++){var x=s(g,m[v]),_=this.getESSCertIDv2(x);b.push(_)}u.array=b}if(f.length>1){var A=s(u.valhex,f[1]);u.polhex=A}delete u.valhex},this.getESSCertID=function(u){var f={},g=h(u,0);if(g.length>0){var m=i(u,g[0]);f.hash=m}if(g.length>1){var b=s(u,g[1]),v=this.getIssuerSerial(b);v.serial!=null&&(f.serial=v.serial),v.issuer!=null&&(f.issuer=v.issuer)}return f},this.getESSCertIDv2=function(u){var f={},g=h(u,0);if(g.length<1||3<g.length)throw new r("wrong number of elements");var m=0;if(u.substr(g[0],2)=="30"){var b=s(u,g[0]);f.alg=t.getAlgorithmIdentifierName(b),m++}else f.alg="sha256";var v=i(u,g[m]);if(f.hash=v,g.length>m+1){var x=s(u,g[m+1]),_=this.getIssuerSerial(x);f.issuer=_.issuer,f.serial=_.serial}return f},this.getIssuerSerial=function(u){var f={},g=h(u,0),m=s(u,g[0]),b=t.getGeneralNames(m),v=b[0].dn;f.issuer=v;var x=i(u,g[1]);return f.serial={hex:x},f},this.getCertificateSet=function(u){for(var f=h(u,0),g=[],m=0;m<f.length;m++){var b=s(u,f[m]);if(b.substr(0,2)=="30"){var v=Yt(b,"CERTIFICATE");g.push(v)}}return{array:g,sortflag:!1}}};(typeof p>"u"||!p)&&(p={});(typeof p.asn1>"u"||!p.asn1)&&(p.asn1={});(typeof p.asn1.tsp>"u"||!p.asn1.tsp)&&(p.asn1.tsp={});p.asn1.tsp.TimeStampToken=function(r){var e=p,t=e.asn1,n=t.tsp;n.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var i=new n.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=i.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.tsp.TimeStampToken,p.asn1.cms.SignedData);p.asn1.tsp.TSTInfo=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSequence,s=n.DERInteger,o=n.DERBoolean,a=n.DERGeneralizedTime,c=n.DERObjectIdentifier,l=n.DERTaggedObject,d=n.tsp,h=d.MessageImprint,u=d.Accuracy,f=n.x509.X500Name,g=n.x509.GeneralName;if(d.TSTInfo.superclass.constructor.call(this),this.dVersion=new s({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var m=[this.dVersion];if(this.dPolicy==null)throw new Error("policy shall be specified.");if(m.push(this.dPolicy),this.dMessageImprint==null)throw new Error("messageImprint shall be specified.");if(m.push(this.dMessageImprint),this.dSerial==null)throw new Error("serialNumber shall be specified.");if(m.push(this.dSerial),this.dGenTime==null)throw new Error("genTime shall be specified.");m.push(this.dGenTime),this.dAccuracy!=null&&m.push(this.dAccuracy),this.dOrdering!=null&&m.push(this.dOrdering),this.dNonce!=null&&m.push(this.dNonce),this.dTsa!=null&&m.push(this.dTsa);var b=new i({array:m});return this.hTLV=b.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0){if(typeof r.policy=="string"){if(!r.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new c({oid:r.policy})}r.messageImprint!==void 0&&(this.dMessageImprint=new h(r.messageImprint)),r.serial!==void 0&&(this.dSerial=new s(r.serial)),r.genTime!==void 0&&(this.dGenTime=new a(r.genTime)),r.accuracy!==void 0&&(this.dAccuracy=new u(r.accuracy)),r.ordering!==void 0&&r.ordering==!0&&(this.dOrdering=new o),r.nonce!==void 0&&(this.dNonce=new s(r.nonce)),r.tsa!==void 0&&(this.dTsa=new l({tag:"a0",explicit:!0,obj:new g({dn:r.tsa})}))}};U(p.asn1.tsp.TSTInfo,p.asn1.ASN1Object);p.asn1.tsp.Accuracy=function(r){var e=p,t=e.asn1,n=t.ASN1Util.newObject;t.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var i=this.params,s=[];return i.seconds!=null&&typeof i.seconds=="number"&&s.push({int:i.seconds}),i.millis!=null&&typeof i.millis=="number"&&s.push({tag:{tagi:"80",obj:{int:i.millis}}}),i.micros!=null&&typeof i.micros=="number"&&s.push({tag:{tagi:"81",obj:{int:i.micros}}}),n({seq:s}).tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.tsp.Accuracy,p.asn1.ASN1Object);p.asn1.tsp.MessageImprint=function(r){var e=p,t=e.asn1,n=t.DERSequence,i=t.DEROctetString,s=t.x509,o=s.AlgorithmIdentifier;t.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var a=this.params,c=new o({name:a.alg}),l=new i({hex:a.hash}),d=new n({array:[c,l]});return d.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.tsp.MessageImprint,p.asn1.ASN1Object);p.asn1.tsp.TimeStampReq=function(r){var e=p,t=e.asn1,n=t.DERSequence,i=t.DERInteger,s=t.DERBoolean,o=t.ASN1Object,a=t.DERObjectIdentifier,c=t.tsp,l=c.MessageImprint;c.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var d=this.params,h=[];h.push(new i({int:1})),d.messageImprint instanceof p.asn1.ASN1Object?h.push(d.messageImprint):h.push(new l(d.messageImprint)),d.policy!=null&&h.push(new a(d.policy)),d.nonce!=null&&h.push(new i(d.nonce)),d.certreq==!0&&h.push(new s);var u=new n({array:h});return u.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.tsp.TimeStampReq,p.asn1.ASN1Object);p.asn1.tsp.TimeStampResp=function(r){var e=p,t=e.asn1,n=t.DERSequence,i=t.ASN1Object,s=t.tsp,o=s.PKIStatusInfo;s.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var a=this.params,c=[];if(a.econtent!=null||a.tst!=null)if(a.statusinfo!=null?c.push(new o(a.statusinfo)):c.push(new o("granted")),a.econtent!=null)c.push(new s.TimeStampToken(a).getContentInfo());else if(a.tst instanceof t.ASN1Object)c.push(a.tst);else throw new Error("improper member tst value");else if(a.statusinfo!=null)c.push(new o(a.statusinfo));else throw new Error("parameter for token nor statusinfo not specified");var l=new n({array:c});return l.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.tsp.TimeStampResp,p.asn1.ASN1Object);p.asn1.tsp.PKIStatusInfo=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSequence,s=n.tsp,o=s.PKIStatus,a=s.PKIFreeText,c=s.PKIFailureInfo;s.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var l=this.params,d=[];if(typeof l=="string")d.push(new o(l));else{if(l.status==null)throw new e("property 'status' unspecified");d.push(new o(l.status)),l.statusstr!=null&&d.push(new a(l.statusstr)),l.failinfo!=null&&d.push(new c(l.failinfo))}var h=new i({array:d});return h.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.tsp.PKIStatusInfo,p.asn1.ASN1Object);p.asn1.tsp.PKIStatus=function(r){var e=Error,t=p,n=t.asn1,i=n.DERInteger,s=n.tsp;s.PKIStatus.superclass.constructor.call(this);var o={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var a=this.params,c,l;if(typeof a=="string")try{l=o[a]}catch{throw new e("undefined name: "+a)}else if(typeof a=="number")l=a;else throw new e("unsupported params");return new i({int:l}).tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.tsp.PKIStatus,p.asn1.ASN1Object);p.asn1.tsp.PKIFreeText=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSequence,s=n.DERUTF8String,o=n.tsp;o.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var a=this.params;if(!a instanceof Array)throw new e("wrong params: not array");for(var c=[],l=0;l<a.length;l++)c.push(new s({str:a[l]}));var d=new i({array:c});return d.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.tsp.PKIFreeText,p.asn1.ASN1Object);p.asn1.tsp.PKIFailureInfo=function(r){var e=Error,t=p,n=t.asn1,i=n.DERBitString,s=n.tsp,o=s.PKIFailureInfo,a={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};o.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var c=this.params,l=0;if(typeof c=="number"&&0<=c&&c<=25){l|=1<<c;for(var d=l.toString(2),h="",u=d.length-1;u>=0;u--)h+=d[u];return h}else{if(typeof c=="string"&&a[c]!=null)return Jh([c],a);if(typeof c=="object"&&c.length!=null)return Jh(c,a);throw new e("wrong params")}},this.tohex=function(){var c=this.params,l=this.getBinValue();return new i({bin:l}).tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.tsp.PKIFailureInfo,p.asn1.ASN1Object);p.asn1.tsp.AbstractTSAAdapter=function(r){this.getTSTHex=function(e,t){throw"not implemented yet"}};p.asn1.tsp.SimpleTSAAdapter=function(r){var e=p,t=e.asn1,n=t.tsp,i=e.crypto.Util.hashHex;n.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(s,o){var a=i(s,o);this.params.econtent.content.messageImprint={alg:o,hash:a},this.params.econtent.content.serial={int:this.serial++};var c=Math.floor(Math.random()*1e9);this.params.econtent.content.nonce={int:c};var l=new n.TimeStampToken(this.params);return l.getContentInfoEncodedHex()},r!==void 0&&(this.params=r)};U(p.asn1.tsp.SimpleTSAAdapter,p.asn1.tsp.AbstractTSAAdapter);p.asn1.tsp.FixedTSAAdapter=function(r){var e=p,t=e.asn1,n=t.tsp,i=e.crypto.Util.hashHex;n.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(s,o){var a=i(s,o);this.params.econtent.content.messageImprint={alg:o,hash:a};var c=new n.TimeStampToken(this.params);return c.getContentInfoEncodedHex()},r!==void 0&&(this.params=r)};U(p.asn1.tsp.FixedTSAAdapter,p.asn1.tsp.AbstractTSAAdapter);p.asn1.tsp.TSPUtil=new function(){};p.asn1.tsp.TSPUtil.newTimeStampToken=function(r){return new p.asn1.tsp.TimeStampToken(r)};p.asn1.tsp.TSPUtil.parseTimeStampReq=function(r){var e=new p.asn1.tsp.TSPParser;return e.getTimeStampReq(r)};p.asn1.tsp.TSPUtil.parseMessageImprint=function(r){var e=new p.asn1.tsp.TSPParser;return e.getMessageImprint(r)};p.asn1.tsp.TSPParser=function(){var r=Error,e=he,t=new e,n=Q,i=n.getV,s=n.getTLV,o=n.getIdxbyList,a=n.getTLVbyListEx,c=n.getChildIdx,l=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],d={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(h){var u=c(h,0);if(u.length==1)return this.getPKIStatusInfo(s(h,u[0]));if(u.length>1){var f=this.getPKIStatusInfo(s(h,u[0])),g=s(h,u[1]),m=this.getToken(g);return m.statusinfo=f,m}},this.getToken=function(h){var u=new p.asn1.cms.CMSParser,f=u.getCMSSignedData(h);return this.setTSTInfo(f),f},this.setTSTInfo=function(h){var u=h.econtent;if(u.type=="tstinfo"){var f=u.content.hex,g=this.getTSTInfo(f);u.content=g}},this.getTSTInfo=function(h){var u={},f=c(h,0),g=i(h,f[1]);u.policy=id(g);var m=s(h,f[2]);u.messageImprint=this.getMessageImprint(m);var b=i(h,f[3]);u.serial={hex:b};var v=i(h,f[4]);u.genTime={str:qe(v)};var x=0;if(f.length>5&&h.substr(f[5],2)=="30"){var _=s(h,f[5]);u.accuracy=this.getAccuracy(_),x++}if(f.length>5+x&&h.substr(f[5+x],2)=="01"){var A=i(h,f[5+x]);A=="ff"&&(u.ordering=!0),x++}if(f.length>5+x&&h.substr(f[5+x],2)=="02"){var D=i(h,f[5+x]);u.nonce={hex:D},x++}if(f.length>5+x&&h.substr(f[5+x],2)=="a0"){var O=s(h,f[5+x]);O="30"+O.substr(2),pGeneralNames=t.getGeneralNames(O);var M=pGeneralNames[0].dn;u.tsa=M,x++}if(f.length>5+x&&h.substr(f[5+x],2)=="a1"){var S=s(h,f[5+x]);S="30"+S.substr(2);var E=t.getExtParamArray(S);u.ext=E,x++}return u},this.getAccuracy=function(h){for(var u={},f=c(h,0),g=0;g<f.length;g++){var m=h.substr(f[g],2),b=i(h,f[g]),v=parseInt(b,16);m=="02"?u.seconds=v:m=="80"?u.millis=v:m=="81"&&(u.micros=v)}return u},this.getMessageImprint=function(h){if(h.substr(0,2)!="30")throw new Error("head of messageImprint hex shall be x30");var u={},f=c(h,0),g=o(h,0,[0,0]),m=i(h,g),b=n.hextooidstr(m),v=p.asn1.x509.OID.oid2name(b);if(v=="")throw new Error("hashAlg name undefined: "+b);var x=v,_=o(h,0,[1]);return u.alg=x,u.hash=i(h,_),u},this.getPKIStatusInfo=function(h){var u={},f=c(h,0),g=0;try{var m=i(h,f[0]),b=parseInt(m,16);u.status=l[b]}catch{}if(f.length>1&&h.substr(f[1],2)=="30"){var v=s(h,f[1]);u.statusstr=this.getPKIFreeText(v),g++}if(f.length>g&&h.substr(f[1+g],2)=="03"){var x=s(h,f[1+g]);u.failinfo=this.getPKIFailureInfo(x)}return u},this.getPKIFreeText=function(h){for(var u=[],f=c(h,0),g=0;g<f.length;g++)u.push(n.getString(h,f[g]));return u},this.getPKIFailureInfo=function(h){var u=n.getInt(h,0);return d[u]!=null?d[u]:u},this.getTimeStampReq=function(h){var u={};u.certreq=!1;var f=c(h,0);if(f.length<2)throw new Error("TimeStampReq must have at least 2 items");var g=s(h,f[1]);u.messageImprint=p.asn1.tsp.TSPUtil.parseMessageImprint(g);for(var m=2;m<f.length;m++){var b=f[m],v=h.substr(b,2);if(v=="06"){var x=i(h,b);u.policy=n.hextooidstr(x)}v=="02"&&(u.nonce=i(h,b)),v=="01"&&(u.certreq=!0)}return u}};(typeof p>"u"||!p)&&(p={});(typeof p.asn1>"u"||!p.asn1)&&(p.asn1={});(typeof p.asn1.cades>"u"||!p.asn1.cades)&&(p.asn1.cades={});p.asn1.cades.SignaturePolicyIdentifier=function(r){var e=p,t=e.asn1,n=t.cades,i=n.SignaturePolicyId;n.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new i(this.params)]},this.setByParam=function(s){this.params=s},r!=null&&this.setByParam(r)};U(p.asn1.cades.SignaturePolicyIdentifier,p.asn1.cms.Attribute);p.asn1.cades.SignaturePolicyId=function(r){var e=p,t=e.asn1,n=t.DERSequence,i=t.DERObjectIdentifier,s=t.x509,o=s.AlgorithmIdentifier,a=t.cades,c=a.SignaturePolicyId,l=a.OtherHashAlgAndValue;c.superclass.constructor.call(this),this.params=null,this.tohex=function(){var d=this.params,h=[];h.push(new i(d.oid)),h.push(new l(d));var u=new n({array:h});return u.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(d){this.params=d},r!=null&&this.setByParam(r)};U(p.asn1.cades.SignaturePolicyId,p.asn1.ASN1Object);p.asn1.cades.OtherHashAlgAndValue=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSequence,s=n.DEROctetString,o=n.x509,a=o.AlgorithmIdentifier,c=n.cades,l=c.OtherHashAlgAndValue;l.superclass.constructor.call(this),this.params=null,this.tohex=function(){var d=this.params;if(d.alg==null)throw new e("property 'alg' not specified");if(d.hash==null&&d.cert==null)throw new e("property 'hash' nor 'cert' not specified");var h=null;if(d.hash!=null)h=d.hash;else if(d.cert!=null){if(typeof d.cert!="string")throw new e("cert not string");var u=d.cert;d.cert.indexOf("-----BEGIN")!=-1&&(u=dt(d.cert)),h=p.crypto.Util.hashHex(u,d.alg)}var f=[];f.push(new a({name:d.alg})),f.push(new s({hex:h}));var g=new i({array:f});return g.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cades.OtherHashAlgAndValue,p.asn1.ASN1Object);p.asn1.cades.OtherHashValue=function(r){p.asn1.cades.OtherHashValue.superclass.constructor.call(this);var e=Error,t=p,n=t.lang.String.isHex,i=t.asn1,s=i.DEROctetString,o=t.crypto.Util.hashHex;this.params=null,this.tohex=function(){var a=this.params;if(a.hash==null&&a.cert==null)throw new e("hash or cert not specified");var c=null;if(a.hash!=null)c=a.hash;else if(a.cert!=null){if(typeof a.cert!="string")throw new e("cert not string");var l=a.cert;a.cert.indexOf("-----BEGIN")!=-1&&(l=dt(a.cert)),c=p.crypto.Util.hashHex(l,"sha1")}return new s({hex:c}).tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cades.OtherHashValue,p.asn1.ASN1Object);p.asn1.cades.SignatureTimeStamp=function(r){var e=Error,t=p,n=t.lang.String.isHex,i=t.asn1,s=i.ASN1Object,o=i.x509,a=i.cades;a.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var c=this.params;if(c.tst!=null)if(n(c.tst)){var l=new s;return l.hTLV=c.tst,[l]}else{if(c.tst instanceof s)return[c.tst];throw new e("params.tst has wrong value")}else if(c.res!=null){var d=c.res;if(d instanceof s&&(d=d.tohex()),typeof d!="string"||!n(d))throw new e("params.res has wrong value");var h=Q.getTLVbyList(d,0,[1]),l=new s;return l.hTLV=c.tst,[l]}},r!=null&&this.setByParam(r)};U(p.asn1.cades.SignatureTimeStamp,p.asn1.cms.Attribute);p.asn1.cades.CompleteCertificateRefs=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSequence,s=n.cades,o=s.OtherCertID,a=t.lang.String.isHex;s.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var c=this.params,l=[],d=0;d<c.array.length;d++){var h=c.array[d];if(typeof h=="string")if(h.indexOf("-----BEGIN")!=-1)h={cert:h};else if(a(h))h={hash:h};else throw new e("unsupported value: "+h);c.alg!=null&&h.alg==null&&(h.alg=c.alg),c.hasis!=null&&h.hasis==null&&(h.hasis=c.hasis);var u=new o(h);l.push(u)}var f=new i({array:l});return[f]},r!=null&&this.setByParam(r)};U(p.asn1.cades.CompleteCertificateRefs,p.asn1.cms.Attribute);p.asn1.cades.OtherCertID=function(r){var e=p,t=e.asn1,n=t.DERSequence,i=t.cms,s=i.IssuerSerial,o=t.cades,a=o.OtherHashValue,c=o.OtherHashAlgAndValue;o.OtherCertID.superclass.constructor.call(this),this.params=r,this.tohex=function(){var l=this.params;typeof l=="string"&&(l.indexOf("-----BEGIN")!=-1?l={cert:l}:_isHex(l)&&(l={hash:l}));var d=[],h=null;if(l.alg!=null?h=new c(l):h=new a(l),d.push(h),l.cert!=null&&l.hasis==!0||l.issuer!=null&&l.serial!=null){var u=new s(l);d.push(u)}var f=new n({array:d});return f.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cades.OtherCertID,p.asn1.ASN1Object);p.asn1.cades.OtherHash=function(r){var e=Error,t=p,n=t.asn1,i=n.cms,s=n.cades,o=s.OtherHashAlgAndValue,a=s.OtherHashValue,c=t.crypto.Util.hashHex,l=t.lang.String.isHex;s.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var d=this.params;typeof d=="string"&&(d.indexOf("-----BEGIN")!=-1?d={cert:d}:l(d)&&(d={hash:d}));var h=null;return d.alg!=null?h=new o(d):h=new a(d),h.tohex()},this.getEncodedHex=function(){return this.tohex()},r!=null&&this.setByParam(r)};U(p.asn1.cades.OtherHash,p.asn1.ASN1Object);p.asn1.cades.CAdESUtil=new function(){};p.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(r){var e=new p.asn1.cms.CMSParser,t=e.getCMSSignedData(r);return t};p.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(r,e,t){var n=Q,i=n.getChildIdx,s=n.getTLV,o=n.getV,a=p,c=a.asn1,l=c.ASN1Object,d=c.cms,h=d.AttributeList,u=d.SignerInfo,f={},g=i(r,e);if(g.length!=6)throw"not supported items for SignerInfo (!=6)";var m=g.shift();f.version=s(r,m);var b=g.shift();f.si=s(r,b);var v=g.shift();f.digalg=s(r,v);var x=g.shift();f.sattrs=s(r,x);var _=g.shift();f.sigalg=s(r,_);var A=g.shift();f.sig=s(r,A),f.sigval=o(r,A);var D=null;return f.obj=new u,D=new l,D.hTLV=f.version,f.obj.dCMSVersion=D,D=new l,D.hTLV=f.si,f.obj.dSignerIdentifier=D,D=new l,D.hTLV=f.digalg,f.obj.dDigestAlgorithm=D,D=new l,D.hTLV=f.sattrs,f.obj.dSignedAttrs=D,D=new l,D.hTLV=f.sigalg,f.obj.dSigAlg=D,D=new l,D.hTLV=f.sig,f.obj.dSig=D,f.obj.dUnsignedAttrs=new h,f};(typeof p.asn1.csr>"u"||!p.asn1.csr)&&(p.asn1.csr={});p.asn1.csr.CertificationRequest=function(r){var e=p,t=e.asn1,n=t.DERBitString,i=t.DERSequence,s=t.csr,o=t.x509,a=s.CertificationRequestInfo;s.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(c){this.params=c},this.sign=function(){var c=new a(this.params).tohex(),l=new p.crypto.Signature({alg:this.params.sigalg});l.init(this.params.sbjprvkey),l.updateHex(c);var d=l.sign();this.params.sighex=d},this.getPEM=function(){return Yt(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var c=this.params,l=new p.asn1.csr.CertificationRequestInfo(this.params),d=new p.asn1.x509.AlgorithmIdentifier({name:c.sigalg});if(c.sighex==null&&c.sbjprvkey!=null&&this.sign(),c.sighex==null)throw new Error("sighex or sbjprvkey parameter not defined");var h=new n({hex:"00"+c.sighex}),u=new i({array:[l,d,h]});return u.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.csr.CertificationRequest,p.asn1.ASN1Object);p.asn1.csr.CertificationRequestInfo=function(r){var e=p,t=e.asn1,n=t.DERBitString,i=t.DERSequence,s=t.DERInteger,o=t.DERUTF8String,a=t.DERTaggedObject,c=t.ASN1Util.newObject,l=t.csr,d=t.x509,h=d.X500Name,u=d.Extensions,f=d.SubjectPublicKeyInfo,g=l.AttributeList;l.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(b){b!=null&&(this.params=b)},this.tohex=function(){var b=this.params,v=[];if(v.push(new s({int:0})),v.push(new h(b.subject)),v.push(new f(we.getKey(b.sbjpubkey))),b.attrs!=null){var x=m(b.attrs),_=c({tag:{tage:"a0",obj:x}});v.push(_)}else if(b.extreq!=null){var A=new u(b.extreq),_=c({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[A]}]}}});v.push(_)}else v.push(new a({tag:"a0",explicit:!1,obj:new o({str:""})}));var D=new i({array:v});return D.tohex()},this.getEncodedHex=function(){return this.tohex()};function m(b){for(var v=Error,x=p.asn1.x509.Extensions,_=[],A=0;A<b.length;A++){var D=b[A],O=D.attr;if(O=="extensionRequest"){var M=new x(D.ext),S={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[M]}]};_.push(S)}else if(O=="unstructuredName"){var S={seq:[{oid:"1.2.840.113549.1.9.2"},{set:D.names}]};_.push(S)}else if(O=="challengePassword"){var S={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:D.password}]}]};_.push(S)}else throw new v("unknown CSR attribute")}return{set:_}}r!=null&&this.setByParam(r)};U(p.asn1.csr.CertificationRequestInfo,p.asn1.ASN1Object);p.asn1.csr.AttributeList=function(r){function e(t){}};U(p.asn1.csr.AttributeList,p.asn1.ASN1Object);p.asn1.csr.CSRUtil=new function(){};p.asn1.csr.CSRUtil.newCSRPEM=function(r){var e=we,t=p.asn1.csr,n=new t.CertificationRequest(r),i=n.getPEM();return i};p.asn1.csr.CSRUtil.getParam=function(r,e){var t=Q,n=t.getV,i=t.getIdxbyList,s=t.getTLVbyList,o=t.getTLVbyListEx,a=t.getVbyListEx,c=function(x){var _=i(x,0,[0,3,0,0],"06");return n(x,_)!="2a864886f70d01090e"?null:s(x,0,[0,3,0,1,0],"30")},l={};if(r.indexOf("-----BEGIN CERTIFICATE REQUEST")==-1)throw new Error("argument is not PEM file");var d=dt(r,"CERTIFICATE REQUEST");e&&(l.tbs=s(d,0,[0]));try{var h=o(d,0,[0,1]);if(h=="3000")l.subject={};else{var m=new he;l.subject=m.getX500Name(h)}}catch{}var u=o(d,0,[0,2]),f=we.getKey(u,null,"pkcs8pub");l.sbjpubkey=we.getPEM(f,"PKCS8PUB");var g=c(d),m=new he;g!=null&&(l.extreq=m.getExtParamArray(g));try{var b=o(d,0,[1],"30"),m=new he;l.sigalg=m.getAlgorithmIdentifierName(b)}catch{}try{var v=a(d,0,[2]);l.sighex=v}catch{}return l};p.asn1.csr.CSRUtil.verifySignature=function(r){try{var e=null;if(typeof r=="string"&&r.indexOf("-----BEGIN CERTIFICATE REQUEST")!=-1?e=p.asn1.csr.CSRUtil.getParam(r,!0):typeof r=="object"&&r.sbjpubkey!=null&&r.sigalg!=null&&r.sighex!=null&&r.tbs!=null&&(e=r),e==null)return!1;var t=new p.crypto.Signature({alg:e.sigalg});return t.init(e.sbjpubkey),t.updateHex(e.tbs),t.verify(e.sighex)}catch(n){return alert(n),!1}};(typeof p>"u"||!p)&&(p={});(typeof p.asn1>"u"||!p.asn1)&&(p.asn1={});(typeof p.asn1.ocsp>"u"||!p.asn1.ocsp)&&(p.asn1.ocsp={});p.asn1.ocsp.DEFAULT_HASH="sha1";p.asn1.ocsp.OCSPResponse=function(r){p.asn1.ocsp.OCSPResponse.superclass.constructor.call(this);var e=p.asn1.DEREnumerated,t=p.asn1.ASN1Util.newObject,n=p.asn1.ocsp.ResponseBytes,i=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var s=this.params.resstatus;return typeof s=="number"?s:typeof s!="string"?-1:i.indexOf(s)},this.setByParam=function(s){this.params=s},this.tohex=function(){var s=this.params,o=this._getStatusCode();if(o==-1)throw new Error("responseStatus not supported: "+s.resstatus);if(o!=0)return t({seq:[{enum:{int:o}}]}).tohex();var a=new n(s);return t({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:a}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.ocsp.OCSPResponse,p.asn1.ASN1Object);p.asn1.ocsp.ResponseBytes=function(r){p.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var e=p.asn1,t=e.DERSequence,n=e.DERObjectIdentifier,i=e.DEROctetString,s=e.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(o){this.params=o},this.tohex=function(){var o=this.params;if(o.restype!="ocspBasic")throw new Error("not supported responseType: "+o.restype);var a=new s(o),c=[];c.push(new n({name:"ocspBasic"})),c.push(new i({hex:a.tohex()}));var l=new t({array:c});return l.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.ocsp.ResponseBytes,p.asn1.ASN1Object);p.asn1.ocsp.BasicOCSPResponse=function(r){p.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var e=Error,t=p.asn1,n=t.ASN1Object,i=t.DERSequence,s=t.DERGeneralizedTime,o=t.DERTaggedObject,a=t.DERBitString,c=t.x509.Extensions,l=t.x509.AlgorithmIdentifier,d=t.ocsp,h=d.ResponderID;_SingleResponseList=d.SingleResponseList,_ResponseData=d.ResponseData,this.params=null,this.setByParam=function(u){this.params=u},this.sign=function(){var u=this.params,f=u.tbsresp.tohex(),g=new p.crypto.Signature({alg:u.sigalg});g.init(u.reskey),g.updateHex(f),u.sighex=g.sign()},this.tohex=function(){var u=this.params;u.tbsresp==null&&(u.tbsresp=new _ResponseData(u)),u.sighex==null&&u.reskey!=null&&this.sign();var f=[];if(f.push(u.tbsresp),f.push(new l({name:u.sigalg})),f.push(new a({hex:"00"+u.sighex})),u.certs!=null&&u.certs.length!=null){for(var g=[],m=0;m<u.certs.length;m++){var b=u.certs[m],v=null;if(Q.isASN1HEX(b))v=b;else if(b.match(/-----BEGIN/))v=dt(b);else throw new e("certs["+m+"] not hex or PEM");g.push(new n({tlv:v}))}var x=new i({array:g});f.push(new o({tag:"a0",explicit:!0,obj:x}))}var _=new i({array:f});return _.tohex()},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.ocsp.BasicOCSPResponse,p.asn1.ASN1Object);p.asn1.ocsp.ResponseData=function(r){p.asn1.ocsp.ResponseData.superclass.constructor.call(this);var e=Error,t=p.asn1,n=t.DERSequence,i=t.DERGeneralizedTime,s=t.DERTaggedObject,o=t.x509.Extensions,a=t.ocsp,c=a.ResponderID;_SingleResponseList=a.SingleResponseList,this.params=null,this.tohex=function(){var l=this.params;l.respid!=null&&new e("respid not specified"),l.prodat!=null&&new e("prodat not specified"),l.array!=null&&new e("array not specified");var d=[];if(d.push(new c(l.respid)),d.push(new i(l.prodat)),d.push(new _SingleResponseList(l.array)),l.ext!=null){var h=new o(l.ext);d.push(new s({tag:"a1",explicit:!0,obj:h}))}var u=new n({array:d});return u.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(l){this.params=l},r!==void 0&&this.setByParam(r)};U(p.asn1.ocsp.ResponseData,p.asn1.ASN1Object);p.asn1.ocsp.ResponderID=function(r){p.asn1.ocsp.ResponderID.superclass.constructor.call(this);var e=p,t=e.asn1,n=t.ASN1Util.newObject,i=t.x509.X500Name,s=e.lang.String.isHex,o=Error;this.params=null,this.tohex=function(){var a=this.params;if(a.key!=null){var c=null;if(typeof a.key=="string"){if(s(a.key)&&(c=a.key),a.key.match(/-----BEGIN CERTIFICATE/)){var l=new he(a.key),d=l.getExtSubjectKeyIdentifier();d!=null&&(c=d.kid.hex)}}else if(a.key instanceof he){var d=a.key.getExtSubjectKeyIdentifier();d!=null&&(c=d.kid.hex)}if(c==null)throw new o("wrong key member value");var h=n({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:c}}}});return h.tohex()}else if(a.name!=null){var u=null;if(typeof a.name=="string"&&a.name.match(/-----BEGIN CERTIFICATE/)){var l=new he(a.name);u=l.getSubject()}else a.name instanceof he?u=a.name.getSubject():typeof a.name=="object"&&(a.name.array!=null||a.name.str!=null)&&(u=a.name);if(u==null)throw new o("wrong name member value");var h=n({tag:{tag:"a1",explicit:!0,obj:new i(u)}});return h.tohex()}throw new o("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(a){this.params=a},r!==void 0&&this.setByParam(r)};U(p.asn1.ocsp.ResponderID,p.asn1.ASN1Object);p.asn1.ocsp.SingleResponseList=function(r){p.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var e=p.asn1,t=e.DERSequence,n=e.ocsp.SingleResponse;this.params=null,this.tohex=function(){var i=this.params;if(typeof i!="object"||i.length==null)throw new Error("params not specified properly");for(var s=[],o=0;o<i.length;o++)s.push(new n(i[o]));var a=new t({array:s});return a.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(i){this.params=i},r!==void 0&&this.setByParam(r)};U(p.asn1.ocsp.SingleResponseList,p.asn1.ASN1Object);p.asn1.ocsp.SingleResponse=function(r){var e=Error,t=p,n=t.asn1,i=n.DERSequence,s=n.DERGeneralizedTime,o=n.DERTaggedObject,a=n.ocsp,c=a.CertID,l=a.CertStatus,d=n.x509,h=d.Extensions;a.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var u=this.params,f=[];if(u.certid==null)throw new e("certid unspecified");if(u.status==null)throw new e("status unspecified");if(u.thisupdate==null)throw new e("thisupdate unspecified");if(f.push(new c(u.certid)),f.push(new l(u.status)),f.push(new s(u.thisupdate)),u.nextupdate!=null){var g=new s(u.nextupdate);f.push(new o({tag:"a0",explicit:!0,obj:g}))}if(u.ext!=null){var m=new h(u.ext);f.push(new o({tag:"a1",explicit:!0,obj:m}))}var b=new i({array:f});return b.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(u){this.params=u},r!==void 0&&this.setByParam(r)};U(p.asn1.ocsp.SingleResponse,p.asn1.ASN1Object);p.asn1.ocsp.CertID=function(r){var e=p,t=e.asn1,n=t.DEROctetString,i=t.DERInteger,s=t.DERSequence,o=t.x509,a=o.AlgorithmIdentifier,c=t.ocsp,l=c.DEFAULT_HASH,d=e.crypto,h=d.Util.hashHex,u=he,f=Q,g=f.getVbyList;c.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(m,b,v,x){x==null&&(x=this.DEFAULT_HASH),this.params={alg:x,issname:m,isskey:b,sbjsn:v}},this.setByCert=function(m,b,v){v==null&&(v=this.DEFAULT_HASH),this.params={alg:v,issuerCert:m,subjectCert:b}},this.getParamByCerts=function(m,b,v){v==null&&(v=this.DEFAULT_HASH);var x=new u(m),_=new u(b),A=h(x.getSubjectHex(),v),D=x.getPublicKeyHex(),O=h(g(D,0,[1],"03",!0),v),M=_.getSerialNumberHex(),S={alg:v,issname:A,isskey:O,sbjsn:M};return S},this.tohex=function(){if(typeof this.params!="object")throw new Error("params not set");var m=this.params,b,v,x,_;if(m.alg==null?_=this.DEFAULT_HASH:_=m.alg,m.issuerCert!=null&&m.subjectCert!=null){var A=this.getParamByCerts(m.issuerCert,m.subjectCert,_);b=A.issname,v=A.isskey,x=A.sbjsn}else if(m.issname!=null&&m.isskey!=null&&m.sbjsn!=null)b=m.issname,v=m.isskey,x=m.sbjsn;else throw new Error("required param members not defined");var D=new a({name:_}),O=new n({hex:b}),M=new n({hex:v}),S=new i({hex:x}),E=new s({array:[D,O,M,S]});return this.hTLV=E.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&this.setByParam(r)};U(p.asn1.ocsp.CertID,p.asn1.ASN1Object);p.asn1.ocsp.CertStatus=function(r){p.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(e.status=="good")return"8000";if(e.status=="unknown")return"8200";if(e.status=="revoked"){var t=[{gentime:{str:e.time}}];e.reason!=null&&t.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:e.reason}}}});var n={tag:"a1",explicit:!1,obj:{seq:t}};return p.asn1.ASN1Util.newObject({tag:n}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},r!==void 0&&this.setByParam(r)};U(p.asn1.ocsp.CertStatus,p.asn1.ASN1Object);p.asn1.ocsp.Request=function(r){var e=p,t=e.asn1,n=t.DERSequence,i=t.ocsp;if(i.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var o=[];if(this.dReqCert===null)throw"reqCert not set";o.push(this.dReqCert);var a=new n({array:o});return this.hTLV=a.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},typeof r<"u"){var s=new i.CertID(r);this.dReqCert=s}};U(p.asn1.ocsp.Request,p.asn1.ASN1Object);p.asn1.ocsp.TBSRequest=function(r){var e=p,t=e.asn1,n=t.DERSequence,i=t.ocsp;i.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(s){for(var o=[],a=0;a<s.length;a++){var c=new i.Request(s[0]);o.push(c)}this.dRequestList=o},this.tohex=function(){var s=[];if(this.version!==0)throw"not supported version: "+this.version;if(this.dRequestorName!==null)throw"requestorName not supported";var o=new n({array:this.dRequestList});if(s.push(o),this.dRequestExt!==null)throw"requestExtensions not supported";var a=new n({array:s});return this.hTLV=a.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&r.reqList!==void 0&&this.setRequestListByParam(r.reqList)};U(p.asn1.ocsp.TBSRequest,p.asn1.ASN1Object);p.asn1.ocsp.OCSPRequest=function(r){var e=p,t=e.asn1,n=t.DERSequence,i=t.ocsp;if(i.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var o=[];if(this.dTbsRequest!==null)o.push(this.dTbsRequest);else throw"tbsRequest not set";if(this.dOptionalSignature!==null)throw"optionalSignature not supported";var a=new n({array:o});return this.hTLV=a.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},r!==void 0&&r.reqList!==void 0){var s=new i.TBSRequest(r);this.dTbsRequest=s}};U(p.asn1.ocsp.OCSPRequest,p.asn1.ASN1Object);p.asn1.ocsp.OCSPUtil={};p.asn1.ocsp.OCSPUtil.getRequestHex=function(r,e,t){var n=p,i=n.asn1,s=i.ocsp;t===void 0&&(t=s.DEFAULT_HASH);var o={alg:t,issuerCert:r,subjectCert:e},a=new s.OCSPRequest({reqList:[o]});return a.tohex()};p.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(r){var e=Q,t=e.getVbyList,n=e.getVbyListEx,i=e.getIdxbyList,s=e.getIdxbyListEx,o=e.getV,a={};try{var c=n(r,0,[0],"0a");a.responseStatus=parseInt(c,16)}catch{}if(a.responseStatus!==0)return a;try{var l=i(r,0,[1,0,1,0,0,2,0,1]);r.substr(l,2)==="80"?a.certStatus="good":r.substr(l,2)==="a1"?(a.certStatus="revoked",a.revocationTime=qe(t(r,l,[0]))):r.substr(l,2)==="82"&&(a.certStatus="unknown")}catch{}try{var d=i(r,0,[1,0,1,0,0,2,0,2]);a.thisUpdate=qe(o(r,d))}catch{}try{var h=i(r,0,[1,0,1,0,0,2,0,3]);r.substr(h,2)==="a0"&&(a.nextUpdate=qe(t(r,h,[0])))}catch{}return a};p.asn1.ocsp.OCSPParser=function(){var r=Error,e=he,t=new e,n=Q,i=n.getV,s=n.getTLV,o=n.getIdxbyList,a=n.getVbyList,c=n.getTLVbyList,l=n.getVbyListEx,d=n.getTLVbyListEx,h=n.getChildIdx;this.getOCSPRequest=function(u){var f=h(u,0);if(f.length!=1&&f.length!=2)throw new r("wrong number elements: "+f.length);var g=this.getTBSRequest(s(u,f[0]));return g},this.getTBSRequest=function(u){var f={},g=d(u,0,[0],"30");f.array=this.getRequestList(g);var m=d(u,0,["[2]",0],"30");return m!=null&&(f.ext=t.getExtParamArray(m)),f},this.getRequestList=function(u){for(var f=[],g=h(u,0),m=0;m<g.length;m++){var u=s(u,g[m]);f.push(this.getRequest(u))}return f},this.getRequest=function(u){var f=h(u,0);if(f.length!=1&&f.length!=2)throw new r("wrong number elements: "+f.length);var g=this.getCertID(s(u,f[0]));if(f.length==2){var m=o(u,0,[1,0]);g.ext=t.getExtParamArray(s(u,m))}return g},this.getCertID=function(u){var f=h(u,0);if(f.length!=4)throw new r("wrong number elements: "+f.length);var g=new e,m={};return m.alg=g.getAlgorithmIdentifierName(s(u,f[0])),m.issname=i(u,f[1]),m.isskey=i(u,f[2]),m.sbjsn=i(u,f[3]),m},this.getOCSPResponse=function(u){var f=h(u,0),g,m=i(u,f[0]),b=parseInt(m);if(f.length==1)return{resstatus:b};var v=c(u,0,[1,0]);return g=this.getResponseBytes(v),g.resstatus=b,g},this.getResponseBytes=function(u){var f=h(u,0),g,m=c(u,0,[1,0]);g=this.getBasicOCSPResponse(m);var b=i(u,f[0]);return g.restype=p.asn1.x509.OID.oid2name(id(b)),g},this.getBasicOCSPResponse=function(u){var f=h(u,0),g;g=this.getResponseData(s(u,f[0]));var m=new he;g.alg=m.getAlgorithmIdentifierName(s(u,f[1]));var b=i(u,f[2]);g.sighex=b.substr(2);var v=l(u,0,["[0]"]);if(v!=null){for(var x=h(v,0),_=[],A=0;A<x.length;A++){var D=s(v,x[A]);_.push(D)}g.certs=_}return g},this.getResponseData=function(u){var f=h(u,0),g=f.length,m={},b=0;u.substr(f[0],2)=="a0"&&b++,m.respid=this.getResponderID(s(u,f[b++]));var v=i(u,f[b++]);if(m.prodat=qe(v),m.array=this.getSingleResponseList(s(u,f[b++])),u.substr(f[g-1],2)=="a1"){var x=c(u,f[g-1],[0]),_=new he;m.ext=_.getExtParamArray(x)}return m},this.getResponderID=function(u){var f={};if(u.substr(0,2)=="a2"){var g=a(u,0,[0]);f.key=g}if(u.substr(0,2)=="a1"){var m=c(u,0,[0]),b=new he;f.name=b.getX500Name(m)}return f},this.getSingleResponseList=function(u){for(var f=h(u,0),g=[],m=0;m<f.length;m++){var b=this.getSingleResponse(s(u,f[m]));g.push(b)}return g},this.getSingleResponse=function(u){var f=h(u,0),g={},m=this.getCertID(s(u,f[0]));g.certid=m;var b=this.getCertStatus(s(u,f[1]));if(g.status=b,u.substr(f[2],2)=="18"){var v=i(u,f[2]);g.thisupdate=qe(v)}for(var x=3;x<f.length;x++){if(u.substr(f[x],2)=="a0"){var _=a(u,f[x],[0],"18");g.nextupdate=qe(_)}if(u.substr(f[x],2)=="a1"){var A=new he,D=c(u,0,[x,0]);g.ext=A.getExtParamArray(D)}}return g},this.getCertStatus=function(u){var f={};if(u=="8000")return{status:"good"};if(u=="8200")return{status:"unknown"};if(u.substr(0,2)=="a1"){f.status="revoked";var g=a(u,0,[0]),m=qe(g);f.time=m}return f}};var p;(typeof p>"u"||!p)&&(p={});(typeof p.lang>"u"||!p.lang)&&(p.lang={});p.lang.String=function(){};function aT(r){for(var e=new Array,t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}function cT(r){for(var e="",t=0;t<r.length;t++)e=e+String.fromCharCode(r[t]);return e}function Qh(r){for(var e="",t=0;t<r.length;t++){var n=r[t].toString(16);n.length==1&&(n="0"+n),e=e+n}return e}function yr(r){return Qh(aT(r))}function kz(r){return Mn(yr(r))}function Mz(r){return Po(Mn(yr(r)))}function Bz(r){return cT(tT(wc(r)))}function Po(r){return r=r.replace(/\=/g,""),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),r}function wc(r){return r.length%4==2?r=r+"==":r.length%4==3&&(r=r+"="),r=r.replace(/-/g,"+"),r=r.replace(/_/g,"/"),r}function _t(r){return r.length%2==1&&(r="0"+r),Po(Mn(r))}function st(r){return Io(wc(r))}var xc,Jr;typeof Buffer=="function"?(xc=function(r){return Po(Buffer.from(r,"utf8").toString("base64"))},Jr=function(r){return Buffer.from(wc(r),"base64").toString("utf8")}):(xc=function(r){return _t(td(nd(r)))},Jr=function(r){return decodeURIComponent(rd(st(r)))});function qz(r){return Mn(td(nd(r)))}function Lz(r){return decodeURIComponent(rd(Io(r)))}function Zh(r){return td(nd(r)).toLowerCase()}function qe(r){try{return decodeURIComponent(rd(r))}catch{return null}}function jz(r){return qe(zz(r))}function zz(r){for(var e=r.match(/.{1,2}/g),t=[],n=0;n<e.length;n++){var i=parseInt(e[n],16);161<=i&&i<=191?(t.push("c2"),t.push(e[n])):192<=i&&i<=255?(t.push("c3"),t.push((i-64).toString(16))):t.push(e[n])}return t.join("")}function br(r){for(var e="",t=0;t<r.length-1;t+=2)e+=String.fromCharCode(parseInt(r.substr(t,2),16));return e}function gn(r){for(var e="",t=0;t<r.length;t++)e+=("0"+r.charCodeAt(t).toString(16)).slice(-2);return e}function t0(r){return Mn(r)}function Hz(r){return ed(t0(r),64)}function ed(r,e){return r=r.replace(new RegExp("(.{"+e+"})","g"),`$1\r
`),r=r.replace(/\s+$/,""),r}function lT(r){var e=r.replace(/[^0-9A-Za-z\/+=]*/g,""),t=Io(e);return t}function Vz(r,e){return"-----BEGIN "+e+`-----\r
`+ed(r,64)+`\r
-----END `+e+`-----\r
`}function Yt(r,e){return"-----BEGIN "+e+`-----\r
`+ed(t0(r),64)+`\r
-----END `+e+`-----\r
`}function dt(r,e){if(r.indexOf("-----BEGIN ")==-1)throw new Error("can't find PEM header");return e!==void 0?(r=r.replace(new RegExp("^[^]*-----BEGIN "+e+"-----"),""),r=r.replace(new RegExp("-----END "+e+"-----[^]*$"),"")):(r=r.replace(/^[^]*-----BEGIN [^-]+-----/,""),r=r.replace(/-----END [^-]+-----[^]*$/,"")),lT(r)}function Uz(r){return r.indexOf("-----BEGIN ")==-1||r.indexOf("-----END ")==-1?null:(r=r.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,""),r=r.replace(/-----END [\s\S]+$/m,""),r=r.replace(/\s+/g,""),r.match(/^[0-9a-zA-Z+/=]+$/)?r:null)}function Gz(r){if(r.length%2!=0)throw"input is not even length";if(r.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var e=new ArrayBuffer(r.length/2),t=new DataView(e),n=0;n<r.length/2;n++)t.setUint8(n,parseInt(r.substr(n*2,2),16));return e}function Wz(r){for(var e="",t=new DataView(r),n=0;n<r.byteLength;n++)e+=("00"+t.getUint8(n).toString(16)).slice(-2);return e}function r0(r){var e,t,n,i,s,o,a,c,l,d,h,u;if(r=hT(r),u=r.match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/),u)return e=parseInt(u[1]),t=parseInt(u[2])-1,n=parseInt(u[3]),i=parseInt(u[4]),s=parseInt(u[5]),o=parseInt(u[6]),a=0,d=u[7],d!==""&&(h=(d.substr(1)+"00").substr(0,3),a=parseInt(h)),Date.UTC(e,t,n,i,s,o,a);throw new Error("unsupported zulu format: "+r)}function Kz(r){var e=new Date(r),t=("0000"+e.getUTCFullYear()).slice(-4),n=("00"+(e.getUTCMonth()+1)).slice(-2),i=("00"+e.getUTCDate()).slice(-2),s=("00"+e.getUTCHours()).slice(-2),o=("00"+e.getUTCMinutes()).slice(-2),a=("00"+e.getUTCSeconds()).slice(-2),c=("000"+e.getUTCMilliseconds()).slice(-3);return c=c.replace(/0+$/,""),c=c!=""?"."+c:c,t+n+i+s+o+a+c+"Z"}function uT(r){return Math.round(r0(r)/1e3)}function $z(r){return new Date(r0(r))}function Jz(r,e,t){var n,i=r.getUTCFullYear();if(e){if(i<1950||2049<i)throw"not proper year for UTCTime: "+i;n=(""+i).slice(-2)}else n=("000"+i).slice(-4);if(n+=("0"+(r.getUTCMonth()+1)).slice(-2),n+=("0"+r.getUTCDate()).slice(-2),n+=("0"+r.getUTCHours()).slice(-2),n+=("0"+r.getUTCMinutes()).slice(-2),n+=("0"+r.getUTCSeconds()).slice(-2),t){var s=r.getUTCMilliseconds();s!==0&&(s=("00"+s).slice(-3),s=s.replace(/0+$/g,""),n+="."+s)}return n+="Z",n}function hT(r){return r.match(/^[0-9]{12}Z$/)||r.match(/^[0-9]{12}[.][0-9]*Z$/)?r.match(/^[0-4]/)?"20"+r:"19"+r:r}function td(r){return r.replace(/%/g,"")}function rd(r){return r.replace(/(..)/g,"%$1")}function $g(r){var e="malformed IPv6 address";if(!r.match(/^[0-9A-Fa-f:]+$/))throw e;r=r.toLowerCase();var t=r.split(":").length-1;if(t<2)throw e;var n=":".repeat(7-t+2);r=r.replace("::",n);var i=r.split(":");if(i.length!=8)throw e;for(var s=0;s<8;s++)i[s]=("0000"+i[s]).slice(-4);return i.join("")}function Jg(r){if(!r.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+r);r=r.toLowerCase();var e=r.match(/.{1,4}/g);e=e.map(function(i){return i.replace(/^0+/,"")}),e=e.map(function(i){return i==""?"0":i}),r=":"+e.join(":")+":";var t=r.match(/:(0:){2,}/g);if(t==null)return r.slice(1,-1);var n=t.sort().slice(-1)[0];return r=r.replace(n.substr(0,n.length-1),":"),r.substr(0,2)!="::"&&(r=r.substr(1)),r.substr(-2,2)!="::"&&(r=r.substr(0,r.length-1)),r}function Kh(r){var e=new Error("malformed hex value");if(!r.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw e;if(r.length==8){var t;try{return t=parseInt(r.substr(0,2),16)+"."+parseInt(r.substr(2,2),16)+"."+parseInt(r.substr(4,2),16)+"."+parseInt(r.substr(6,2),16),t}catch{throw e}}else if(r.length==16)try{return Kh(r.substr(0,8))+"/"+Z3(r.substr(8))}catch{throw e}else{if(r.length==32)return Jg(r);if(r.length==64){try{return Jg(r.substr(0,32))+"/"+Z3(r.substr(32))}catch{throw e}return}else return r}}function Z3(r){var e=new Error("malformed mask"),t;try{t=new L(r,16).toString(2)}catch{throw e}if(!t.match(/^1*0*$/))throw e;return t.replace(/0+$/,"").length}function n0(r){var e=new Error("malformed IP address");if(r=r.toLowerCase(r),!r.match(/^[0-9a-f.:/]+$/))throw e;if(r.match(/^[0-9.]+$/)){var t=r.split(".");if(t.length!==4)throw e;var n="";try{for(var i=0;i<4;i++){var s=parseInt(t[i]);n+=("0"+s.toString(16)).slice(-2)}return n}catch{throw e}}else if(r.match(/^[0-9.]+\/[0-9]+$/)){var o=r.split("/");return n0(o[0])+eT(parseInt(o[1]),32)}else{if(r.match(/^[0-9a-f:]+$/)&&r.indexOf(":")!==-1)return $g(r);if(r.match(/^[0-9a-f:]+\/[0-9]+$/)&&r.indexOf(":")!==-1){var o=r.split("/");return $g(o[0])+eT(parseInt(o[1]),128)}else throw e}}function eT(r,e){if(e==32&&r==0)return"00000000";if(e==128&&r==0)return"00000000000000000000000000000000";var t=Array(r+1).join("1")+Array(e-r+1).join("0");return new L(t,2).toString(16)}function i0(r){function e(i){var s=parseInt(i.substr(0,2),16),o=parseInt(i.substr(2),16);if(s==0&o<128)return String.fromCharCode(o);if(s<8){var a=192|(s&7)<<3|(o&192)>>6,c=128|o&63;return qe(a.toString(16)+c.toString(16))}var a=224|(s&240)>>4,c=128|(s&15)<<2|(o&192)>>6,l=128|o&63;return qe(a.toString(16)+c.toString(16)+l.toString(16))}var t=r.match(/.{4}/g),n=t.map(e);return n.join("")}function nd(r){for(var e=encodeURIComponent(r),t="",n=0;n<e.length;n++)e[n]=="%"?(t=t+e.substr(n,3),n=n+2):t=t+"%"+yr(e[n]);return t}function Xz(r){return r=r.replace(/\r\n/mg,`
`),r}function Yz(r){return r=r.replace(/\r\n/mg,`
`),r=r.replace(/\n/mg,`\r
`),r}p.lang.String.isInteger=function(r){return r.match(/^[0-9]+$/)?!0:!!r.match(/^-[0-9]+$/)};p.lang.String.isHex=function(r){return dT(r)};function dT(r){return!!(r.length%2==0&&(r.match(/^[0-9a-f]+$/)||r.match(/^[0-9A-F]+$/)))}p.lang.String.isBase64=function(r){return r=r.replace(/\s+/g,""),!!(r.match(/^[0-9A-Za-z+\/]+={0,3}$/)&&r.length%4==0)};p.lang.String.isBase64URL=function(r){return r.match(/[+/=]/)?!1:(r=wc(r),p.lang.String.isBase64(r))};function s0(r){return!!r.match(/^[0-9A-Za-z-_.]+$/)}p.lang.String.isIntegerArray=function(r){return r=r.replace(/\s+/g,""),!!r.match(/^\[[0-9,]+\]$/)};p.lang.String.isPrintable=function(r){return r.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null};p.lang.String.isIA5=function(r){return r.match(/^[\x20-\x21\x23-\x7f]*$/)!==null};p.lang.String.isMail=function(r){return r.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};function Xg(r){return r.length%2==1?"0"+r:r.substr(0,1)>"7"?"00"+r:r}function Qz(r){r=r.replace(/^\s*\[\s*/,""),r=r.replace(/\s*\]\s*$/,""),r=r.replace(/\s*/g,"");try{var e=r.split(/,/).map(function(t,n,i){var s=parseInt(t);if(s<0||255<s)throw"integer not in range 0-255";var o=("00"+s.toString(16)).slice(-2);return o}).join("");return e}catch(t){throw"malformed integer array string: "+t}}var Zz=function(r,e){var t=r.length;r.length>e.length&&(t=e.length);for(var n=0;n<t;n++)if(r.charCodeAt(n)!=e.charCodeAt(n))return n;return r.length!=e.length?t:-1};function fT(r){var e=function(a){var c=a.toString(16);return c.length==1&&(c="0"+c),c},t=function(a){var c="",l=parseInt(a,10),d=l.toString(2),h=7-d.length%7;h==7&&(h=0);for(var u="",f=0;f<h;f++)u+="0";d=u+d;for(var f=0;f<d.length-1;f+=7){var g=d.substr(f,7);f!=d.length-7&&(g="1"+g),c+=e(parseInt(g,2))}return c};try{if(!r.match(/^[0-9.]+$/))return null;var n="",i=r.split("."),s=parseInt(i[0],10)*40+parseInt(i[1],10);n+=e(s),i.splice(0,2);for(var o=0;o<i.length;o++)n+=t(i[o]);return n}catch{return null}}function id(r){if(!dT(r))return null;try{var e=[],t=r.substr(0,2),n=parseInt(t,16);e[0]=new String(Math.floor(n/40)),e[1]=new String(n%40);for(var i=r.substr(2),s=[],o=0;o<i.length/2;o++)s.push(parseInt(i.substr(o*2,2),16));for(var a=[],c="",o=0;o<s.length;o++)s[o]&128?c=c+$h((s[o]&127).toString(2),7):(c=c+$h((s[o]&127).toString(2),7),a.push(new String(parseInt(c,2))),c="");var l=e.join(".");return a.length>0&&(l=l+"."+a.join(".")),l}catch{return null}}function pT(r){var e=new L(String(r),10);return Cc(e)}function Cc(r){var e=r.toString(16);if(e.substr(0,1)!="-")return e.length%2==1?e="0"+e:e.match(/^[0-7]/)||(e="00"+e),e;var t=e.substr(1),n=t.length;n%2==1?n+=1:e.match(/^[0-7]/)||(n+=2);for(var i="",s=0;s<n;s++)i+="f";var o=new L(i,16),a=o.xor(r).add(L.ONE);return e=a.toString(16).replace(/^-/,""),e}var $h=function(r,e,t){return t==null&&(t="0"),r.length>=e?r:new Array(e-r.length+1).join(t)+r};function mT(r){if(r.length%2!=0||(r=r.toLowerCase(),r.match(/^[0-9a-f]+$/)==null))return-1;try{var e=r.substr(0,2);if(e=="00")return parseInt(r.substr(2),16);var t=parseInt(e,16);if(t>7)return-1;var n=r.substr(2),i=parseInt(n,16).toString(2);i=="0"&&(i="00000000"),i=i.slice(0,0-t);var s=parseInt(i,2);return s==NaN?-1:s}catch{return-1}}function gT(r){if(typeof r!="number"||r<0)return null;var e=Number(r).toString(2),t=8-e.length%8;t==8&&(t=0),e=e+$h("",t,"0");var n=parseInt(e,2).toString(16);n.length%2==1&&(n="0"+n);var i="0"+t;return i+n}function vT(r){if(typeof r!="string"||r.length%2!=0||!r.match(/^[0-9a-f]+$/))return null;try{var e=parseInt(r.substr(0,2),16);if(e<0||7<e)return null;for(var t=r.substr(2),n="",i=0;i<t.length;i+=2){var s=t.substr(i,2),o=parseInt(s,16).toString(2);o=("0000000"+o).slice(-8),n+=o}return n.substr(0,n.length-e)}catch{return null}}function eH(r){if(typeof r!="string"||r.match(/^[01]+$/)==null)return null;try{var e=parseInt(r,2);return gT(e)}catch{return null}}function Jh(r,e){for(var t=0,n=0;n<r.length;n++)t|=1<<e[r[n]];for(var i=t.toString(2),s="",n=i.length-1;n>=0;n--)s+=i[n];return s}function Ke(r,n,t){if(typeof r=="object"){for(var n=String(n).split("."),i=0;i<n.length&&r;i++){var s=n[i];s.match(/^[0-9]+$/)&&(s=parseInt(s)),r=r[s]}return r||r===!1?r:t}}function U(r,e){var t=function(){};t.prototype=e.prototype,r.prototype=new t,r.prototype.constructor=r,r.superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)}(typeof p>"u"||!p)&&(p={});(typeof p.crypto>"u"||!p.crypto)&&(p.crypto={});p.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:ee.algo.MD5,sha1:ee.algo.SHA1,sha224:ee.algo.SHA224,sha256:ee.algo.SHA256,sha384:ee.algo.SHA384,sha512:ee.algo.SHA512,ripemd160:ee.algo.RIPEMD160},this.getDigestInfoHex=function(r,e){if(typeof this.DIGESTINFOHEAD[e]>"u")throw"alg not supported in Util.DIGESTINFOHEAD: "+e;return this.DIGESTINFOHEAD[e]+r},this.getPaddedDigestInfoHex=function(r,e,t){var n=this.getDigestInfoHex(r,e),i=t/4;if(n.length+22>i)throw"key is too short for SigAlg: keylen="+t+","+e;for(var s="0001",o="00"+n,a="",c=i-s.length-o.length,l=0;l<c;l+=2)a+="ff";var d=s+a+o;return d},this.hashString=function(r,e){var t=new p.crypto.MessageDigest({alg:e});return t.digestString(r)},this.hashHex=function(r,e){var t=new p.crypto.MessageDigest({alg:e});return t.digestHex(r)},this.sha1=function(r){return this.hashString(r,"sha1")},this.sha256=function(r){return this.hashString(r,"sha256")},this.sha256Hex=function(r){return this.hashHex(r,"sha256")},this.sha512=function(r){return this.hashString(r,"sha512")},this.sha512Hex=function(r){return this.hashHex(r,"sha512")},this.isKey=function(r){return r instanceof pe||r instanceof p.crypto.DSA||r instanceof p.crypto.ECDSA}};p.crypto.Util.md5=function(r){var e=new p.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return e.digestString(r)};p.crypto.Util.ripemd160=function(r){var e=new p.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return e.digestString(r)};p.crypto.Util.SECURERANDOMGEN=new Ro;p.crypto.Util.getRandomHexOfNbytes=function(r){var e=new Array(r);return p.crypto.Util.SECURERANDOMGEN.nextBytes(e),Qh(e)};p.crypto.Util.getRandomBigIntegerOfNbytes=function(r){return new L(p.crypto.Util.getRandomHexOfNbytes(r),16)};p.crypto.Util.getRandomHexOfNbits=function(r){var e=r%8,t=(r-e)/8,n=new Array(t+1);return p.crypto.Util.SECURERANDOMGEN.nextBytes(n),n[0]=(255<<e&255^255)&n[0],Qh(n)};p.crypto.Util.getRandomBigIntegerOfNbits=function(r){return new L(p.crypto.Util.getRandomHexOfNbits(r),16)};p.crypto.Util.getRandomBigIntegerZeroToMax=function(r){for(var e=r.bitLength();;){var t=p.crypto.Util.getRandomBigIntegerOfNbits(e);if(r.compareTo(t)!=-1)return t}};p.crypto.Util.getRandomBigIntegerMinToMax=function(r,e){var t=r.compareTo(e);if(t==1)throw"biMin is greater than biMax";if(t==0)return r;var n=e.subtract(r),i=p.crypto.Util.getRandomBigIntegerZeroToMax(n);return i.add(r)};p.crypto.MessageDigest=function(r){var e=null,t=null,n=null;this.setAlgAndProvider=function(i,s){if(i=p.crypto.MessageDigest.getCanonicalAlgName(i),i!==null&&s===void 0&&(s=p.crypto.Util.DEFAULTPROVIDER[i]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(i)!=-1&&s=="cryptojs"){try{this.md=p.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[i].create()}catch(o){throw"setAlgAndProvider hash alg set fail alg="+i+"/"+o}this.updateString=function(o){this.md.update(o)},this.updateHex=function(o){var a=ee.enc.Hex.parse(o);this.md.update(a)},this.digest=function(){var o=this.md.finalize();return o.toString(ee.enc.Hex)},this.digestString=function(o){return this.updateString(o),this.digest()},this.digestHex=function(o){return this.updateHex(o),this.digest()}}if(":sha256:".indexOf(i)!=-1&&s=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(o){throw"setAlgAndProvider hash alg set fail alg="+i+"/"+o}this.updateString=function(o){this.md.update(o)},this.updateHex=function(o){var a=sjcl.codec.hex.toBits(o);this.md.update(a)},this.digest=function(){var o=this.md.finalize();return sjcl.codec.hex.fromBits(o)},this.digestString=function(o){return this.updateString(o),this.digest()},this.digestHex=function(o){return this.updateHex(o),this.digest()}}},this.updateString=function(i){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(i){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(i){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(i){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},r!==void 0&&r.alg!==void 0&&(this.algName=r.alg,r.prov===void 0&&(this.provName=p.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))};p.crypto.MessageDigest.getCanonicalAlgName=function(r){return typeof r=="string"&&(r=r.toLowerCase(),r=r.replace(/-/,"")),r};p.crypto.MessageDigest.getHashLength=function(r){var e=p.crypto.MessageDigest,t=e.getCanonicalAlgName(r);if(e.HASHLENGTH[t]===void 0)throw"not supported algorithm: "+r;return e.HASHLENGTH[t]};p.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20};p.crypto.Mac=function(r){var e=null,t=null,n=null,i=null,s=null;this.setAlgAndProvider=function(o,a){if(o=o.toLowerCase(),o==null&&(o="hmacsha1"),o=o.toLowerCase(),o.substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+o;a===void 0&&(a=p.crypto.Util.DEFAULTPROVIDER[o]),this.algProv=o+"/"+a;var c=o.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(c)!=-1&&a=="cryptojs"){try{var l=p.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[c];this.mac=ee.algo.HMAC.create(l,this.pass)}catch(d){throw"setAlgAndProvider hash alg set fail hashAlg="+c+"/"+d}this.updateString=function(d){this.mac.update(d)},this.updateHex=function(d){var h=ee.enc.Hex.parse(d);this.mac.update(h)},this.doFinal=function(){var d=this.mac.finalize();return d.toString(ee.enc.Hex)},this.doFinalString=function(d){return this.updateString(d),this.doFinal()},this.doFinalHex=function(d){return this.updateHex(d),this.doFinal()}}},this.updateString=function(o){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(o){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(o){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(o){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(o){if(typeof o=="string"){var a=o;(o.length%2==1||!o.match(/^[0-9A-Fa-f]+$/))&&(a=gn(o)),this.pass=ee.enc.Hex.parse(a);return}if(typeof o!="object")throw"KJUR.crypto.Mac unsupported password type: "+o;var a=null;if(o.hex!==void 0){if(o.hex.length%2!=0||!o.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+o.hex;a=o.hex}if(o.utf8!==void 0&&(a=Zh(o.utf8)),o.rstr!==void 0&&(a=gn(o.rstr)),o.b64!==void 0&&(a=Io(o.b64)),o.b64u!==void 0&&(a=st(o.b64u)),a==null)throw"KJUR.crypto.Mac unsupported password type: "+o;this.pass=ee.enc.Hex.parse(a)},r!==void 0&&(r.pass!==void 0&&this.setPassword(r.pass),r.alg!==void 0&&(this.algName=r.alg,r.prov===void 0&&(this.provName=p.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))};p.crypto.Signature=function(r){var e=null,t=null,n=null,i=null,s=null,o=null,a=null,c=null,l=null,d=null,h=-1,u=null,f=null,g=null,m=null,b=null;if(this._setAlgNames=function(){var v=this.algName.match(/^(.+)with(.+)$/);v&&(this.mdAlgName=v[1].toLowerCase(),this.pubkeyAlgName=v[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(v,x){for(var _="",A=x/4-v.length,D=0;D<A;D++)_=_+"0";return _+v},this.setAlgAndProvider=function(v,x){if(this._setAlgNames(),x!="cryptojs/jsrsa")throw new Error("provider not supported: "+x);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new p.crypto.MessageDigest({alg:this.mdAlgName})}catch(_){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+_)}this.init=function(_,A){var D=null;try{A===void 0?D=we.getKey(_):D=we.getKey(_,A)}catch(O){throw"init failed:"+O}if(D.isPrivate===!0)this.prvKey=D,this.state="SIGN";else if(D.isPublic===!0)this.pubKey=D,this.state="VERIFY";else throw"init failed.:"+D},this.updateString=function(_){this.md.updateString(_)},this.updateHex=function(_){this.md.updateHex(_)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&p.crypto.ECDSA!==void 0&&(this.prvKey=new p.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof pe&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof pe&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof p.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else if(this.prvKey instanceof p.crypto.DSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;return this.hSign},this.signString=function(_){return this.updateString(_),this.sign()},this.signHex=function(_){return this.updateHex(_),this.sign()},this.verify=function(_){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&p.crypto.ECDSA!==void 0&&(this.pubKey=new p.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof pe&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,_,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof pe&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,_);if(p.crypto.ECDSA!==void 0&&this.pubKey instanceof p.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,_);if(p.crypto.DSA!==void 0&&this.pubKey instanceof p.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,_);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(v,x){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(v){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(v){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(v){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(v){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(v){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=r,r!==void 0&&(r.alg!==void 0&&(this.algName=r.alg,r.prov===void 0?this.provName=p.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=r.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),r.psssaltlen!==void 0&&(this.pssSaltLen=r.psssaltlen),r.prvkeypem!==void 0)){if(r.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{var e=we.getKey(r.prvkeypem);this.init(e)}catch(v){throw"fatal error to load pem private key: "+v}}};p.crypto.Cipher=function(r){};p.crypto.Cipher.encrypt=function(r,e,t,n){if(Ke(n,"enclag")!=null&&(t=n.encalg),typeof t=="string"&&t.substr(-4)=="-CBC"){var i=e,s=r;Ke(n,"key")!=null&&(i=n.key),Ke(n,"enc")!=null&&(hEnc=n.enc);var o=ee.enc.Hex.parse(i),a=ee.enc.Hex.parse(s),c=ee.enc.Hex.parse(n.iv),l;if(t=="des-EDE3-CBC")l=ee.TripleDES.encrypt(a,o,{iv:c});else if(t=="aes128-CBC"||t=="aes256-CBC")l=ee.AES.encrypt(a,o,{iv:c});else throw new Error("unsupported algorithm: "+t);return l+""}else throw new Error("Cipher.encrypt: unsupported key or algorithm")};p.crypto.Cipher.decrypt=function(r,e,t,n){if(Ke(n,"enclag")!=null&&(t=n.encalg),typeof t=="string"&&t.substr(-4)=="-CBC"){var i=e,s=r;Ke(n,"key")!=null&&(i=n.key),Ke(n,"enc")!=null&&(s=n.enc);var o=ee.enc.Hex.parse(i),a=ee.enc.Hex.parse(s),c=ee.enc.Hex.parse(n.iv),l;if(t=="des-EDE3-CBC")l=ee.TripleDES.decrypt({ciphertext:a},o,{iv:c});else if(t=="aes128-CBC"||t=="aes256-CBC")l=ee.AES.decrypt({ciphertext:a},o,{iv:c});else throw new Error("unsupported algorithm: "+t);return ee.enc.Hex.stringify(l)}else throw new Error("Cipher.decrypt: unsupported key or algorithm")};p.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}};(typeof p>"u"||!p)&&(p={});(typeof p.crypto>"u"||!p.crypto)&&(p.crypto={});p.crypto.ECDSA=function(r){var e="secp256r1",t=null,n=null,i=null,s=Error,o=L,a=ke,c=p.crypto.ECDSA,l=p.crypto.ECParameterDB,d=c.getName,h=Q,u=h.getVbyListEx,f=h.isASN1HEX,g=new Ro,m=null;this.type="EC",this.isPrivate=!1,this.isPublic=!1;function b(v,x,_,A){for(var D=Math.max(x.bitLength(),A.bitLength()),O=v.add2D(_),M=v.curve.getInfinity(),S=D-1;S>=0;--S)M=M.twice2D(),M.z=o.ONE,x.testBit(S)?A.testBit(S)?M=M.add2D(O):M=M.add2D(v):A.testBit(S)&&(M=M.add2D(_));return M}this.getBigRandom=function(v){return new o(v.bitLength(),g).mod(v.subtract(o.ONE)).add(o.ONE)},this.setNamedCurve=function(v){this.ecparams=l.getByName(v),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=v},this.setPrivateKeyHex=function(v){this.isPrivate=!0,this.prvKeyHex=v},this.setPublicKeyHex=function(v){this.isPublic=!0,this.pubKeyHex=v},this.getPublicKeyXYHex=function(){var v=this.pubKeyHex;if(v.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var x=this.ecparams.keycharlen;if(v.length!==2+x*2)throw"malformed public key hex length";var _={};return _.x=v.substr(2,x),_.y=v.substr(2+x),_},this.getShortNISTPCurveName=function(){var v=this.curveName;return v==="secp256r1"||v==="NIST P-256"||v==="P-256"||v==="prime256v1"?"P-256":v==="secp384r1"||v==="NIST P-384"||v==="P-384"?"P-384":v==="secp521r1"||v==="NIST P-521"||v==="P-521"?"P-521":null},this.generateKeyPairHex=function(){var v=this.ecparams.n,x=this.getBigRandom(v),_=this.ecparams.keycharlen,A=("0000000000"+x.toString(16)).slice(-_);this.setPrivateKeyHex(A);var D=this.generatePublicKeyHex();return{ecprvhex:A,ecpubhex:D}},this.generatePublicKeyHex=function(){var v=new o(this.prvKeyHex,16),x=this.ecparams.G.multiply(v),_=x.getX().toBigInteger(),A=x.getY().toBigInteger(),D=this.ecparams.keycharlen,O=("0000000000"+_.toString(16)).slice(-D),M=("0000000000"+A.toString(16)).slice(-D),S="04"+O+M;return this.setPublicKeyHex(S),S},this.signWithMessageHash=function(v){return this.signHex(v,this.prvKeyHex)},this.signHex=function(v,x){var _=new o(x,16),A=this.ecparams.n,D=new o(v.substring(0,this.ecparams.keycharlen),16);do var O=this.getBigRandom(A),M=this.ecparams.G,S=M.multiply(O),E=S.getX().toBigInteger().mod(A);while(E.compareTo(o.ZERO)<=0);var w=O.modInverse(A).multiply(D.add(_.multiply(E))).mod(A);return c.biRSSigToASN1Sig(E,w)},this.sign=function(v,x){var _=x,A=this.ecparams.n,D=o.fromByteArrayUnsigned(v);do var O=this.getBigRandom(A),M=this.ecparams.G,S=M.multiply(O),E=S.getX().toBigInteger().mod(A);while(E.compareTo(L.ZERO)<=0);var w=O.modInverse(A).multiply(D.add(_.multiply(E))).mod(A);return this.serializeSig(E,w)},this.verifyWithMessageHash=function(v,x){return this.verifyHex(v,x,this.pubKeyHex)},this.verifyHex=function(v,x,_){try{var A,D,O=c.parseSigHex(x);A=O.r,D=O.s;var M=a.decodeFromHex(this.ecparams.curve,_),S=new o(v.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(S,A,D,M)}catch{return!1}},this.verify=function(v,x,_){var A,D;if(Bitcoin.Util.isArray(x)){var O=this.parseSig(x);A=O.r,D=O.s}else if(typeof x=="object"&&x.r&&x.s)A=x.r,D=x.s;else throw"Invalid value for signature";var M;if(_ instanceof ke)M=_;else if(Bitcoin.Util.isArray(_))M=a.decodeFrom(this.ecparams.curve,_);else throw"Invalid format for pubkey value, must be byte array or ECPointFp";var S=o.fromByteArrayUnsigned(v);return this.verifyRaw(S,A,D,M)},this.verifyRaw=function(v,x,_,A){var D=this.ecparams.n,O=this.ecparams.G;if(x.compareTo(o.ONE)<0||x.compareTo(D)>=0||_.compareTo(o.ONE)<0||_.compareTo(D)>=0)return!1;var M=_.modInverse(D),S=v.multiply(M).mod(D),E=x.multiply(M).mod(D),w=O.multiply(S).add(A.multiply(E)),T=w.getX().toBigInteger().mod(D);return T.equals(x)},this.serializeSig=function(v,x){var _=v.toByteArraySigned(),A=x.toByteArraySigned(),D=[];return D.push(2),D.push(_.length),D=D.concat(_),D.push(2),D.push(A.length),D=D.concat(A),D.unshift(D.length),D.unshift(48),D},this.parseSig=function(v){var x;if(v[0]!=48)throw new Error("Signature not a valid DERSequence");if(x=2,v[x]!=2)throw new Error("First element in signature must be a DERInteger");var _=v.slice(x+2,x+2+v[x+1]);if(x+=2+v[x+1],v[x]!=2)throw new Error("Second element in signature must be a DERInteger");var A=v.slice(x+2,x+2+v[x+1]);x+=2+v[x+1];var D=o.fromByteArrayUnsigned(_),O=o.fromByteArrayUnsigned(A);return{r:D,s:O}},this.parseSigCompact=function(v){if(v.length!==65)throw"Signature has the wrong length";var x=v[0]-27;if(x<0||x>7)throw"Invalid signature type";var _=this.ecparams.n,A=o.fromByteArrayUnsigned(v.slice(1,33)).mod(_),D=o.fromByteArrayUnsigned(v.slice(33,65)).mod(_);return{r:A,s:D,i:x}},this.readPKCS5PrvKeyHex=function(v){if(f(v)===!1)throw new Error("not ASN.1 hex string");var x,_,A;try{x=u(v,0,["[0]",0],"06"),_=u(v,0,[1],"04");try{A=u(v,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=d(x),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(A),this.setPrivateKeyHex(_),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(v){if(f(v)===!1)throw new s("not ASN.1 hex string");var x,_,A,D;try{x=u(v,0,[1,0],"06"),_=u(v,0,[1,1],"06"),A=u(v,0,[2,0,1],"04");try{D=u(v,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new s("malformed PKCS#8 plain ECC private key")}if(this.curveName=d(_),this.curveName===void 0)throw new s("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(D),this.setPrivateKeyHex(A),this.isPublic=!1},this.readPKCS8PubKeyHex=function(v){if(f(v)===!1)throw new s("not ASN.1 hex string");var x,_,A;try{x=u(v,0,[0,0],"06"),_=u(v,0,[0,1],"06"),A=u(v,0,[1],"03")}catch{throw new s("malformed PKCS#8 ECC public key")}if(this.curveName=d(_),this.curveName===null)throw new s("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(A)},this.readCertPubKeyHex=function(v,x){if(f(v)===!1)throw new s("not ASN.1 hex string");var _,A;try{_=u(v,0,[0,5,0,1],"06"),A=u(v,0,[0,5,1],"03")}catch{throw new s("malformed X.509 certificate ECC public key")}if(this.curveName=d(_),this.curveName===null)throw new s("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(A)},r!==void 0&&r.curve!==void 0&&(this.curveName=r.curve),this.curveName===void 0&&(this.curveName=e),this.setNamedCurve(this.curveName),r!==void 0&&(r.prv!==void 0&&this.setPrivateKeyHex(r.prv),r.pub!==void 0&&this.setPublicKeyHex(r.pub))};p.crypto.ECDSA.parseSigHex=function(r){var e=p.crypto.ECDSA.parseSigHexInHexRS(r),t=new L(e.r,16),n=new L(e.s,16);return{r:t,s:n}};p.crypto.ECDSA.parseSigHexInHexRS=function(r){var e=Q,t=e.getChildIdx,n=e.getV;if(e.checkStrictDER(r,0),r.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var i=t(r,0);if(i.length!=2)throw new Error("signature shall have two elements");var s=i[0],o=i[1];if(r.substr(s,2)!="02")throw new Error("1st item not ASN.1 integer");if(r.substr(o,2)!="02")throw new Error("2nd item not ASN.1 integer");var a=n(r,s),c=n(r,o);return{r:a,s:c}};p.crypto.ECDSA.asn1SigToConcatSig=function(r){var e=p.crypto.ECDSA.parseSigHexInHexRS(r),t=e.r,n=e.s;if(t.length>=130&&t.length<=134){if(t.length%2!=0)throw Error("unknown ECDSA sig r length error");if(n.length%2!=0)throw Error("unknown ECDSA sig s length error");t.substr(0,2)=="00"&&(t=t.substr(2)),n.substr(0,2)=="00"&&(n=n.substr(2));var i=Math.max(t.length,n.length);return t=("000000"+t).slice(-i),n=("000000"+n).slice(-i),t+n}if(t.substr(0,2)=="00"&&t.length%32==2&&(t=t.substr(2)),n.substr(0,2)=="00"&&n.length%32==2&&(n=n.substr(2)),t.length%32==30&&(t="00"+t),n.length%32==30&&(n="00"+n),t.length%32!=0)throw Error("unknown ECDSA sig r length error");if(n.length%32!=0)throw Error("unknown ECDSA sig s length error");return t+n};p.crypto.ECDSA.concatSigToASN1Sig=function(r){if(r.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var e=r.substr(0,r.length/2),t=r.substr(r.length/2);return p.crypto.ECDSA.hexRSSigToASN1Sig(e,t)};p.crypto.ECDSA.hexRSSigToASN1Sig=function(r,e){var t=new L(r,16),n=new L(e,16);return p.crypto.ECDSA.biRSSigToASN1Sig(t,n)};p.crypto.ECDSA.biRSSigToASN1Sig=function(r,e){var t=p.asn1,n=new t.DERInteger({bigint:r}),i=new t.DERInteger({bigint:e}),s=new t.DERSequence({array:[n,i]});return s.tohex()};p.crypto.ECDSA.getName=function(r){return r==="2b8104001f"?"secp192k1":r==="2a8648ce3d030107"?"secp256r1":r==="2b8104000a"?"secp256k1":r==="2b81040021"?"secp224r1":r==="2b81040022"?"secp384r1":r==="2b81040023"?"secp521r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(r)!==-1?"secp256r1":"|secp256k1|".indexOf(r)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(r)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(r)!==-1?"secp384r1":"|secp521r1|NIST P-521|P-521|".indexOf(r)!==-1?"secp521r1":null};(typeof p>"u"||!p)&&(p={});(typeof p.crypto>"u"||!p.crypto)&&(p.crypto={});p.crypto.ECParameterDB=new function(){var r={},e={};function t(n){return new L(n,16)}this.getByName=function(n){var i=n;if(typeof e[i]<"u"&&(i=e[n]),typeof r[i]<"u")return r[i];throw"unregistered EC curve name: "+i},this.regist=function(n,i,s,o,a,c,l,d,h,u,f,g){r[n]={};var m=t(s),b=t(o),v=t(a),x=t(c),_=t(l),A=new Bn(m,b,v),D=A.decodePointHex("04"+d+h);r[n].name=n,r[n].keylen=i,r[n].keycharlen=Math.ceil(i/8)*2,r[n].curve=A,r[n].G=D,r[n].n=x,r[n].h=_,r[n].oid=f,r[n].info=g;for(var O=0;O<u.length;O++)e[u[O]]=n}};p.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field");p.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field");p.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field");p.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]);p.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]);p.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]);p.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]);p.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]);p.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]);p.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);(typeof p>"u"||!p)&&(p={});(typeof p.crypto>"u"||!p.crypto)&&(p.crypto={});p.crypto.DSA=function(){var r=Q,e=r.getVbyList,t=r.getVbyListEx,n=r.isASN1HEX,i=L;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(s,o,a,c,l){this.isPrivate=!0,this.p=s,this.q=o,this.g=a,this.y=c,this.x=l},this.setPrivateHex=function(s,o,a,c,l){var d,h,u,f,g;d=new L(s,16),h=new L(o,16),u=new L(a,16),typeof c=="string"&&c.length>1?f=new L(c,16):f=null,g=new L(l,16),this.setPrivate(d,h,u,f,g)},this.setPublic=function(s,o,a,c){this.isPublic=!0,this.p=s,this.q=o,this.g=a,this.y=c,this.x=null},this.setPublicHex=function(s,o,a,c){var l,d,h,u;l=new L(s,16),d=new L(o,16),h=new L(a,16),u=new L(c,16),this.setPublic(l,d,h,u)},this.signWithMessageHash=function(s){var o=this.p,a=this.q,c=this.g,l=this.y,d=this.x,h=p.crypto.Util.getRandomBigIntegerMinToMax(L.ONE.add(L.ONE),a.subtract(L.ONE)),u=s.substr(0,a.bitLength()/4),f=new L(u,16),g=c.modPow(h,o).mod(a),m=h.modInverse(a).multiply(f.add(d.multiply(g))).mod(a),b=p.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:g}},{int:{bigint:m}}]});return b},this.verifyWithMessageHash=function(s,o){var a=this.p,c=this.q,l=this.g,d=this.y,h=this.parseASN1Signature(o),u=h[0],f=h[1],g=s.substr(0,c.bitLength()/4),m=new L(g,16);if(L.ZERO.compareTo(u)>0||u.compareTo(c)>0||L.ZERO.compareTo(f)>=0||f.compareTo(c)>0)throw"invalid DSA signature";var b=f.modInverse(c),v=m.multiply(b).mod(c),x=u.multiply(b).mod(c),_=l.modPow(v,a).multiply(d.modPow(x,a)).mod(a).mod(c);return _.compareTo(u)==0},this.parseASN1Signature=function(s){try{var o=new i(t(s,0,[0],"02"),16),a=new i(t(s,0,[1],"02"),16);return[o,a]}catch{throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(s){var o,a,c,l,d;if(n(s)===!1)throw new Error("not ASN.1 hex string");try{o=t(s,0,[1],"02"),a=t(s,0,[2],"02"),c=t(s,0,[3],"02"),l=t(s,0,[4],"02"),d=t(s,0,[5],"02")}catch{throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(o,a,c,l,d)},this.readPKCS8PrvKeyHex=function(s){var o,a,c,l;if(n(s)===!1)throw new Error("not ASN.1 hex string");try{o=t(s,0,[1,1,0],"02"),a=t(s,0,[1,1,1],"02"),c=t(s,0,[1,1,2],"02"),l=t(s,0,[2,0],"02")}catch{throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(o,a,c,null,l)},this.readPKCS8PubKeyHex=function(s){var o,a,c,l;if(n(s)===!1)throw new Error("not ASN.1 hex string");try{o=t(s,0,[0,1,0],"02"),a=t(s,0,[0,1,1],"02"),c=t(s,0,[0,1,2],"02"),l=t(s,0,[1,0],"02")}catch{throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(o,a,c,l)},this.readCertPubKeyHex=function(s,o){var a,c,l,d;if(n(s)===!1)throw new Error("not ASN.1 hex string");try{a=t(s,0,[0,5,0,1,0],"02"),c=t(s,0,[0,5,0,1,1],"02"),l=t(s,0,[0,5,0,1,2],"02"),d=t(s,0,[0,5,1,0],"02")}catch{throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(a,c,l,d)}};var we=function(){var r=function(m,b,v){return n(ee.AES,m,b,v)},e=function(m,b,v){return n(ee.TripleDES,m,b,v)},t=function(m,b,v){return n(ee.DES,m,b,v)},n=function(m,b,v,x){var _=ee.enc.Hex.parse(b),A=ee.enc.Hex.parse(v),D=ee.enc.Hex.parse(x),O={};O.key=A,O.iv=D,O.ciphertext=_;var M=m.decrypt(O,A,{iv:D});return ee.enc.Hex.stringify(M)},i=function(m,b,v){return a(ee.AES,m,b,v)},s=function(m,b,v){return a(ee.TripleDES,m,b,v)},o=function(m,b,v){return a(ee.DES,m,b,v)},a=function(m,b,v,x){var _=ee.enc.Hex.parse(b),A=ee.enc.Hex.parse(v),D=ee.enc.Hex.parse(x),O=m.encrypt(_,A,{iv:D}),M=ee.enc.Hex.parse(O.toString()),S=ee.enc.Base64.stringify(M);return S},c={"AES-256-CBC":{proc:r,eproc:i,keylen:32,ivlen:16},"AES-192-CBC":{proc:r,eproc:i,keylen:24,ivlen:16},"AES-128-CBC":{proc:r,eproc:i,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:e,eproc:s,keylen:24,ivlen:8},"DES-CBC":{proc:t,eproc:o,keylen:8,ivlen:8}},l=function(m){return c[m].proc},d=function(m){var b=ee.lib.WordArray.random(m),v=ee.enc.Hex.stringify(b);return v},h=function(m){var b={},v=m.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));v&&(b.cipher=v[1],b.ivsalt=v[2]);var x=m.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));x&&(b.type=x[1]);var _=-1,A=0;m.indexOf(`\r
\r
`)!=-1&&(_=m.indexOf(`\r
\r
`),A=2),m.indexOf(`

`)!=-1&&(_=m.indexOf(`

`),A=1);var D=m.indexOf("-----END");if(_!=-1&&D!=-1){var O=m.substring(_+A*2,D-A);O=O.replace(/\s+/g,""),b.data=O}return b},u=function(m,b,v){for(var x=v.substring(0,16),_=ee.enc.Hex.parse(x),A=ee.enc.Utf8.parse(b),D=c[m].keylen+c[m].ivlen,O="",M=null;;){var S=ee.algo.MD5.create();if(M!=null&&S.update(M),S.update(A),S.update(_),M=S.finalize(),O=O+ee.enc.Hex.stringify(M),O.length>=D*2)break}var E={};return E.keyhex=O.substr(0,c[m].keylen*2),E.ivhex=O.substr(c[m].keylen*2,c[m].ivlen*2),E},f=function(m,b,v,x){var _=ee.enc.Base64.parse(m),A=ee.enc.Hex.stringify(_),D=c[b].proc,O=D(A,v,x);return O},g=function(m,b,v,x){var _=c[b].eproc,A=_(m,v,x);return A};return{version:"1.0.0",parsePKCS5PEM:function(m){return h(m)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(m,b,v){return u(m,b,v)},decryptKeyB64:function(m,b,v,x){return f(m,b,v,x)},getDecryptedKeyHex:function(m,b){var v=h(m),x=v.type,_=v.cipher,A=v.ivsalt,D=v.data,O=u(_,b,A),M=O.keyhex,S=f(D,_,M,A);return S},getEncryptedPKCS5PEMFromPrvKeyHex:function(m,b,v,x,_){var w="";if((typeof x>"u"||x==null)&&(x="AES-256-CBC"),typeof c[x]>"u")throw new Error("KEYUTIL unsupported algorithm: "+x);if(typeof _>"u"||_==null){var A=c[x].ivlen,D=d(A);_=D.toUpperCase()}var O=u(x,v,_),M=O.keyhex,S=g(b,x,M,_),E=S.replace(/(.{64})/g,`$1\r
`),w="-----BEGIN "+m+` PRIVATE KEY-----\r
`;return w+=`Proc-Type: 4,ENCRYPTED\r
`,w+="DEK-Info: "+x+","+_+`\r
`,w+=`\r
`,w+=E,w+=`\r
-----END `+m+` PRIVATE KEY-----\r
`,w},getEncryptedPKCS8PEM:function(m,b,v){var x=this.getEncryptedPKCS8Hex(m,b,v);return Yt(x,"ENCRYPTED PRIVATE KEY")},getEncryptedPKCS8Hex:function(m,b,v){var x;v==null||v==null?x={}:x=JSON.parse(JSON.stringify(v)),x.plain=m,this.initPBES2Param(x),this.encryptPBES2Param(x,b);var _=this.generatePBES2ASN1Param(x);return p.asn1.ASN1Util.newObject(_).tohex()},initPBES2Param:function(m){if(Ke(m,"encalg")==null&&(m.encalg="aes256-CBC"),Ke(m,"iter")==null&&(m.iter=2048),Ke(m,"prf")==null&&(m.prf="hmacWithSHA256"),Ke(m,"salt")==null&&(m.salt=ee.enc.Hex.stringify(ee.lib.WordArray.random(8))),Ke(m,"enciv")==null){var b;m.encalg=="des-EDE3-CBC"&&(b=8),m.encalg=="aes128-CBC"&&(b=16),m.encalg=="aes256-CBC"&&(b=16),m.enciv=ee.enc.Hex.stringify(ee.lib.WordArray.random(b))}},encryptPBES2Param:function(m,b){var v=we.getDKFromPBES2Param(m,b);try{var x=p.crypto.Cipher.encrypt(m.plain,v,m.encalg,{iv:m.enciv})}catch{throw new Error("encrypt error: "+m.plain+" "+v+" "+m.encalg+" "+m.enciv)}m.enc=x},generatePBES2ASN1Param:function(m){var b={seq:[{seq:[{oid:"pkcs5PBES2"},{seq:[{seq:[{oid:"pkcs5PBKDF2"},{seq:[{octstr:{hex:m.salt}},{int:{hex:pT(m.iter)}}]}]},{seq:[{oid:m.encalg},{octstr:{hex:m.enciv}}]}]}]},{octstr:{hex:m.enc}}]};return m.prf!="hmacWithSHA1"&&b.seq[0].seq[1].seq[0].seq[1].seq.push({seq:[{oid:m.prf},{null:""}]}),b},parseHexOfEncryptedPKCS8:function(m){var b=Q,v=b.getChildIdx,x=b.getV,_={},A=v(m,0);if(A.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+A.length);_.ciphertext=x(m,A[1]);var D=v(m,A[0]);if(D.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+D.length);if(x(m,D[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var O=v(m,D[1]);if(D.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+O.length);var M=v(m,O[1]);if(M.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+M.length);if(x(m,M[0])!="2a864886f70d0307")throw"this only supports TripleDES";_.encryptionSchemeAlg="TripleDES",_.encryptionSchemeIV=x(m,M[1]);var S=v(m,O[0]);if(S.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+S.length);if(x(m,S[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var E=v(m,S[1]);if(E.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+E.length);_.pbkdf2Salt=x(m,E[0]);var w=x(m,E[1]);try{_.pbkdf2Iter=parseInt(w,16)}catch{throw new Error("malformed format pbkdf2Iter: "+w)}return _},getPBKDF2KeyHexFromParam:function(m,b){var v=ee.enc.Hex.parse(m.pbkdf2Salt),x=m.pbkdf2Iter,_=ee.PBKDF2(b,v,{keySize:192/32,iterations:x}),A=ee.enc.Hex.stringify(_);return A},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(m,b){var v=dt(m,"ENCRYPTED PRIVATE KEY"),x=this.parseHexOfEncryptedPKCS8(v),_=we.getPBKDF2KeyHexFromParam(x,b),A={};A.ciphertext=ee.enc.Hex.parse(x.ciphertext);var D=ee.enc.Hex.parse(_),O=ee.enc.Hex.parse(x.encryptionSchemeIV),M=ee.TripleDES.decrypt(A,D,{iv:O}),S=ee.enc.Hex.stringify(M);return S},parsePBES2:function(m){var b=Q.parse(m);if(Ke(b,"seq.0.seq.0.oid")!="pkcs5PBES2"||Ke(b,"seq.0.seq.1.seq.0.seq.0.oid")!="pkcs5PBKDF2")throw new Error("not pkcs5PBES2 and pkcs5PBKDF2 used");var v=Ke(b,"seq.0.seq.1.seq.0.seq.1.seq");if(v==null)throw new Error("PBKDF2 parameter not found");var x=Ke(v,"0.octstr.hex"),_=Ke(v,"1.int.hex"),A=Ke(v,"2.seq.0.oid","hmacWithSHA1"),D=-1;try{D=parseInt(_,16)}catch{throw new Error("iter not proper value")}var O=Ke(b,"seq.0.seq.1.seq.1.seq.0.oid"),M=Ke(b,"seq.0.seq.1.seq.1.seq.1.octstr.hex"),S=Ke(b,"seq.1.octstr.hex");if(O==null||M==null||S==null)throw new Error("encalg, enciv or enc is undefined");var E={salt:x,iter:D,prf:A,encalg:O,enciv:M,enc:S};return E},getDKFromPBES2Param:function(m,b){var v={hmacWithSHA1:ee.algo.SHA1,hmacWithSHA224:ee.algo.SHA224,hmacWithSHA256:ee.algo.SHA256,hmacWithSHA384:ee.algo.SHA384,hmacWithSHA512:ee.algo.SHA512},x={"des-EDE3-CBC":192/32,"aes128-CBC":128/32,"aes256-CBC":256/32},_=v[m.prf];if(_==null)throw new Error("unsupported prf");var A=x[m.encalg];if(A==null)throw new Error("unsupported encalg");var D=ee.enc.Hex.parse(m.salt),O=m.iter;try{var M=ee.PBKDF2(b,D,{keySize:A,iterations:O,hasher:_});return ee.enc.Hex.stringify(M)}catch(S){throw new Error("PBKDF2 error: "+S+" "+JSON.stringify(m)+" "+b)}},getPlainHexFromEncryptedPKCS8PEM:function(m,b){if(m.indexOf("BEGIN ENCRYPTED PRIVATE KEY")==-1)throw new Error("not Encrypted PKCS#8 PEM string");var v=dt(m),x;try{x=we.parsePBES2(v)}catch(A){throw new Error("malformed PBES2 format: "+A.message)}var _=we.getDKFromPBES2Param(x,b);return p.crypto.Cipher.decrypt(x.enc,_,x.encalg,{iv:x.enciv})},getKeyFromEncryptedPKCS8PEM:function(m,b){var v=this.getPlainHexFromEncryptedPKCS8PEM(m,b),x=this.getKeyFromPlainPrivatePKCS8Hex(v);return x},parsePlainPrivatePKCS8Hex:function(m){var b=Q,v=b.getChildIdx,x=b.getV,_={};if(_.algparam=null,m.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var A=v(m,0);if(A.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(m.substr(A[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var D=v(m,A[1]);if(D.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(m.substr(D[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(_.algoid=x(m,D[0]),m.substr(D[1],2)=="06"&&(_.algparam=x(m,D[1])),m.substr(A[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return _.keyidx=b.getVidx(m,A[2]),_},getKeyFromPlainPrivatePKCS8PEM:function(m){var b=dt(m,"PRIVATE KEY"),v=this.getKeyFromPlainPrivatePKCS8Hex(b);return v},getKeyFromPlainPrivatePKCS8Hex:function(m){var b=this.parsePlainPrivatePKCS8Hex(m),v;if(b.algoid=="2a864886f70d010101")v=new pe;else if(b.algoid=="2a8648ce380401")v=new p.crypto.DSA;else if(b.algoid=="2a8648ce3d0201")v=new p.crypto.ECDSA;else throw new Error("unsupported private key algorithm");return v.readPKCS8PrvKeyHex(m),v},_getKeyFromPublicPKCS8Hex:function(m){var b,v=Q.getVbyList(m,0,[0,0],"06");if(v==="2a864886f70d010101")b=new pe;else if(v==="2a8648ce380401")b=new p.crypto.DSA;else if(v==="2a8648ce3d0201")b=new p.crypto.ECDSA;else throw new Error("unsupported PKCS#8 public key hex");return b.readPKCS8PubKeyHex(m),b},parsePublicRawRSAKeyHex:function(m){var b=Q,v=b.getChildIdx,x=b.getV,_={};if(m.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var A=v(m,0);if(A.length!=2)throw new Error("malformed RSA key(code:002)");if(m.substr(A[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(_.n=x(m,A[0]),m.substr(A[1],2)!="02")throw new Error("malformed RSA key(code:004)");return _.e=x(m,A[1]),_},parsePublicPKCS8Hex:function(m){var b=Q,v=b.getChildIdx,x=b.getV,_={};_.algparam=null;var A=v(m,0);if(A.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+A.length);var D=A[0];if(m.substr(D,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var O=v(m,D);if(O.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(m.substr(O[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(_.algoid=x(m,O[0]),m.substr(O[1],2)=="06"?_.algparam=x(m,O[1]):m.substr(O[1],2)=="30"&&(_.algparam={},_.algparam.p=b.getVbyList(m,O[1],[0],"02"),_.algparam.q=b.getVbyList(m,O[1],[1],"02"),_.algparam.g=b.getVbyList(m,O[1],[2],"02")),m.substr(A[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return _.key=x(m,A[1]).substr(2),_}}}();we.getKey=function(r,e,t){var n=Q,i=n.getChildIdx,s=n.getV,o=n.getVbyList,a=p.crypto,c=a.ECDSA,l=a.DSA,d=pe,h=dt,u=we;if(typeof d<"u"&&r instanceof d||typeof c<"u"&&r instanceof c||typeof l<"u"&&r instanceof l)return r;if(r.curve!==void 0&&r.xy!==void 0&&r.d===void 0)return new c({pub:r.xy,curve:r.curve});if(r.curve!==void 0&&r.d!==void 0)return new c({prv:r.d,curve:r.curve});if(r.kty===void 0&&r.n!==void 0&&r.e!==void 0&&r.d===void 0){var f=new d;return f.setPublic(r.n,r.e),f}if(r.kty===void 0&&r.n!==void 0&&r.e!==void 0&&r.d!==void 0&&r.p!==void 0&&r.q!==void 0&&r.dp!==void 0&&r.dq!==void 0&&r.co!==void 0&&r.qi===void 0){var f=new d;return f.setPrivateEx(r.n,r.e,r.d,r.p,r.q,r.dp,r.dq,r.co),f}if(r.kty===void 0&&r.n!==void 0&&r.e!==void 0&&r.d!==void 0&&r.p===void 0){var f=new d;return f.setPrivate(r.n,r.e,r.d),f}if(r.p!==void 0&&r.q!==void 0&&r.g!==void 0&&r.y!==void 0&&r.x===void 0){var f=new l;return f.setPublic(r.p,r.q,r.g,r.y),f}if(r.p!==void 0&&r.q!==void 0&&r.g!==void 0&&r.y!==void 0&&r.x!==void 0){var f=new l;return f.setPrivate(r.p,r.q,r.g,r.y,r.x),f}if(r.kty==="RSA"&&r.n!==void 0&&r.e!==void 0&&r.d===void 0){var f=new d;return f.setPublic(st(r.n),st(r.e)),f}if(r.kty==="RSA"&&r.n!==void 0&&r.e!==void 0&&r.d!==void 0&&r.p!==void 0&&r.q!==void 0&&r.dp!==void 0&&r.dq!==void 0&&r.qi!==void 0){var f=new d;return f.setPrivateEx(st(r.n),st(r.e),st(r.d),st(r.p),st(r.q),st(r.dp),st(r.dq),st(r.qi)),f}if(r.kty==="RSA"&&r.n!==void 0&&r.e!==void 0&&r.d!==void 0){var f=new d;return f.setPrivate(st(r.n),st(r.e),st(r.d)),f}if(r.kty==="EC"&&r.crv!==void 0&&r.x!==void 0&&r.y!==void 0&&r.d===void 0){var g=new c({curve:r.crv}),m=g.ecparams.keycharlen,b=("0000000000"+st(r.x)).slice(-m),v=("0000000000"+st(r.y)).slice(-m),x="04"+b+v;return g.setPublicKeyHex(x),g}if(r.kty==="EC"&&r.crv!==void 0&&r.x!==void 0&&r.y!==void 0&&r.d!==void 0){var g=new c({curve:r.crv}),m=g.ecparams.keycharlen,b=("0000000000"+st(r.x)).slice(-m),v=("0000000000"+st(r.y)).slice(-m),x="04"+b+v,_=("0000000000"+st(r.d)).slice(-m);return g.setPublicKeyHex(x),g.setPrivateKeyHex(_),g}if(t==="pkcs5prv"){var A=r,n=Q,D,f;if(D=i(A,0),D.length===9)f=new d,f.readPKCS5PrvKeyHex(A);else if(D.length===6)f=new l,f.readPKCS5PrvKeyHex(A);else if(D.length>2&&A.substr(D[1],2)==="04")f=new c,f.readPKCS5PrvKeyHex(A);else throw new Error("unsupported PKCS#1/5 hexadecimal key");return f}if(t==="pkcs8prv"){var f=u.getKeyFromPlainPrivatePKCS8Hex(r);return f}if(t==="pkcs8pub")return u._getKeyFromPublicPKCS8Hex(r);if(t==="x509pub")return he.getPublicKeyFromCertHex(r);if(r.indexOf("-END CERTIFICATE-",0)!=-1||r.indexOf("-END X509 CERTIFICATE-",0)!=-1||r.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return he.getPublicKeyFromCertPEM(r);if(r.indexOf("-END PUBLIC KEY-")!=-1){var O=dt(r,"PUBLIC KEY");return u._getKeyFromPublicPKCS8Hex(O)}if(r.indexOf("-END RSA PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")==-1){var M=h(r,"RSA PRIVATE KEY");return u.getKey(M,null,"pkcs5prv")}if(r.indexOf("-END DSA PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")==-1){var S=h(r,"DSA PRIVATE KEY"),E=o(S,0,[1],"02"),w=o(S,0,[2],"02"),T=o(S,0,[3],"02"),F=o(S,0,[4],"02"),N=o(S,0,[5],"02"),f=new l;return f.setPrivate(new L(E,16),new L(w,16),new L(T,16),new L(F,16),new L(N,16)),f}if(r.indexOf("-END EC PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")==-1){var M=h(r,"EC PRIVATE KEY");return u.getKey(M,null,"pkcs5prv")}if(r.indexOf("-END PRIVATE KEY-")!=-1)return u.getKeyFromPlainPrivatePKCS8PEM(r);if(r.indexOf("-END RSA PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")!=-1){var P=u.getDecryptedKeyHex(r,e),I=new pe;return I.readPKCS5PrvKeyHex(P),I}if(r.indexOf("-END EC PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")!=-1){var S=u.getDecryptedKeyHex(r,e),f=o(S,0,[1],"04"),B=o(S,0,[2,0],"06"),q=o(S,0,[3,0],"03").substr(2),z="";if(p.crypto.OID.oidhex2name[B]!==void 0)z=p.crypto.OID.oidhex2name[B];else throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+B);var g=new c({curve:z});return g.setPublicKeyHex(q),g.setPrivateKeyHex(f),g.isPublic=!1,g}if(r.indexOf("-END DSA PRIVATE KEY-")!=-1&&r.indexOf("4,ENCRYPTED")!=-1){var S=u.getDecryptedKeyHex(r,e),E=o(S,0,[1],"02"),w=o(S,0,[2],"02"),T=o(S,0,[3],"02"),F=o(S,0,[4],"02"),N=o(S,0,[5],"02"),f=new l;return f.setPrivate(new L(E,16),new L(w,16),new L(T,16),new L(F,16),new L(N,16)),f}if(r.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return u.getKeyFromEncryptedPKCS8PEM(r,e);throw new Error("not supported argument")};we.generateKeypair=function(r,e){if(r=="RSA"){var t=e,n=new pe;n.generate(t,"10001"),n.isPrivate=!0,n.isPublic=!0;var i=new pe,s=n.n.toString(16),o=n.e.toString(16);i.setPublic(s,o),i.isPrivate=!1,i.isPublic=!0;var a={};return a.prvKeyObj=n,a.pubKeyObj=i,a}else if(r=="EC"){var c=e,l=new p.crypto.ECDSA({curve:c}),d=l.generateKeyPairHex(),n=new p.crypto.ECDSA({curve:c});n.setPublicKeyHex(d.ecpubhex),n.setPrivateKeyHex(d.ecprvhex),n.isPrivate=!0,n.isPublic=!1;var i=new p.crypto.ECDSA({curve:c});i.setPublicKeyHex(d.ecpubhex),i.isPrivate=!1,i.isPublic=!0;var a={};return a.prvKeyObj=n,a.pubKeyObj=i,a}else throw new Error("unknown algorithm: "+r)};we.getPEM=function(r,e,t,n,i,s){var o=p,a=o.asn1,c=a.DERObjectIdentifier,l=a.DERInteger,d=a.ASN1Util.newObject,h=a.x509,u=h.SubjectPublicKeyInfo,f=o.crypto,g=f.DSA,m=f.ECDSA,b=pe;function v(I){var B=d({seq:[{int:0},{int:{bigint:I.n}},{int:I.e},{int:{bigint:I.d}},{int:{bigint:I.p}},{int:{bigint:I.q}},{int:{bigint:I.dmp1}},{int:{bigint:I.dmq1}},{int:{bigint:I.coeff}}]});return B}function x(I){var B=d({seq:[{int:1},{octstr:{hex:I.prvKeyHex}},{tag:["a0",!0,{oid:{name:I.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+I.pubKeyHex}}]}]});return B}function _(I){var B=d({seq:[{int:0},{int:{bigint:I.p}},{int:{bigint:I.q}},{int:{bigint:I.g}},{int:{bigint:I.y}},{int:{bigint:I.x}}]});return B}if((b!==void 0&&r instanceof b||g!==void 0&&r instanceof g||m!==void 0&&r instanceof m)&&r.isPublic==!0&&(e===void 0||e=="PKCS8PUB")){var A=new u(r),D=A.tohex();return Yt(D,"PUBLIC KEY")}if(e=="PKCS1PRV"&&b!==void 0&&r instanceof b&&(t===void 0||t==null)&&r.isPrivate==!0){var A=v(r),D=A.tohex();return Yt(D,"RSA PRIVATE KEY")}if(e=="PKCS1PRV"&&m!==void 0&&r instanceof m&&(t===void 0||t==null)&&r.isPrivate==!0){var O=new c({name:r.curveName}),M=O.tohex(),S=x(r),E=S.tohex(),w="";return w+=Yt(M,"EC PARAMETERS"),w+=Yt(E,"EC PRIVATE KEY"),w}if(e=="PKCS1PRV"&&g!==void 0&&r instanceof g&&(t===void 0||t==null)&&r.isPrivate==!0){var A=_(r),D=A.tohex();return Yt(D,"DSA PRIVATE KEY")}if(e=="PKCS5PRV"&&b!==void 0&&r instanceof b&&t!==void 0&&t!=null&&r.isPrivate==!0){var A=v(r),D=A.tohex();return n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",D,t,n,s)}if(e=="PKCS5PRV"&&m!==void 0&&r instanceof m&&t!==void 0&&t!=null&&r.isPrivate==!0){var A=x(r),D=A.tohex();return n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",D,t,n,s)}if(e=="PKCS5PRV"&&g!==void 0&&r instanceof g&&t!==void 0&&t!=null&&r.isPrivate==!0){var A=_(r),D=A.tohex();return n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",D,t,n,s)}var T=function(I,B){if(typeof B=="string")return we.getEncryptedPKCS8PEM(I,B);if(typeof B=="object"&&Ke(B,"passcode")!=null){var q=JSON.parse(JSON.stringify(B)),z=q.passcode;return delete q.passcode,we.getEncryptedPKCS8PEM(I,z,q)}};if(e=="PKCS8PRV"&&b!=null&&r instanceof b&&r.isPrivate==!0){var F=v(r),N=F.tohex(),A=d({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:N}}]}),D=A.tohex();return t===void 0||t==null?Yt(D,"PRIVATE KEY"):T(D,t)}if(e=="PKCS8PRV"&&m!==void 0&&r instanceof m&&r.isPrivate==!0){var P={seq:[{int:1},{octstr:{hex:r.prvKeyHex}}]};typeof r.pubKeyHex=="string"&&P.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+r.pubKeyHex}}]});var F=new d(P),N=F.tohex(),A=d({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:r.curveName}}]},{octstr:{hex:N}}]}),D=A.tohex();return t===void 0||t==null?Yt(D,"PRIVATE KEY"):T(D,t)}if(e=="PKCS8PRV"&&g!==void 0&&r instanceof g&&r.isPrivate==!0){var F=new l({bigint:r.x}),N=F.tohex(),A=d({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:r.p}},{int:{bigint:r.q}},{int:{bigint:r.g}}]}]},{octstr:{hex:N}}]}),D=A.tohex();return t===void 0||t==null?Yt(D,"PRIVATE KEY"):T(D,t)}throw new Error("unsupported object nor format")};we.getKeyFromCSRPEM=function(r){var e=dt(r,"CERTIFICATE REQUEST"),t=we.getKeyFromCSRHex(e);return t};we.getKeyFromCSRHex=function(r){var e=we.parseCSRHex(r),t=we.getKey(e.p8pubkeyhex,null,"pkcs8pub");return t};we.parseCSRHex=function(r){var e=Q,t=e.getChildIdx,n=e.getTLV,i={},s=r;if(s.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var o=t(s,0);if(o.length<1)throw new Error("malformed CSR(code:002)");if(s.substr(o[0],2)!="30")throw new Error("malformed CSR(code:003)");var a=t(s,o[0]);if(a.length<3)throw new Error("malformed CSR(code:004)");return i.p8pubkeyhex=n(s,a[2]),i};we.getKeyID=function(r){var e=we,t=Q;typeof r=="string"&&r.indexOf("BEGIN ")!=-1&&(r=e.getKey(r));var n=dt(e.getPEM(r)),i=t.getIdxbyList(n,0,[1]),s=t.getV(n,i).substring(2);return p.crypto.Util.hashHex(s,"sha1")};we.getJWK=function(r,e,t,n,i){var s,o={},a,c=p.crypto.Util.hashHex;if(typeof r=="string")s=we.getKey(r),r.indexOf("CERTIFICATE")!=-1&&(a=dt(r));else if(typeof r=="object")r instanceof he?(s=r.getPublicKey(),a=r.hex):s=r;else throw new Error("unsupported keyinfo type");if(s instanceof pe&&s.isPrivate)o.kty="RSA",o.n=_t(s.n.toString(16)),o.e=_t(s.e.toString(16)),o.d=_t(s.d.toString(16)),o.p=_t(s.p.toString(16)),o.q=_t(s.q.toString(16)),o.dp=_t(s.dmp1.toString(16)),o.dq=_t(s.dmq1.toString(16)),o.qi=_t(s.coeff.toString(16));else if(s instanceof pe&&s.isPublic)o.kty="RSA",o.n=_t(s.n.toString(16)),o.e=_t(s.e.toString(16));else if(s instanceof p.crypto.ECDSA&&s.isPrivate){var l=s.getShortNISTPCurveName();if(l!=="P-256"&&l!=="P-384"&&l!=="P-521")throw new Error("unsupported curve name for JWT: "+l);var d=s.getPublicKeyXYHex();o.kty="EC",o.crv=l,o.x=_t(d.x),o.y=_t(d.y),o.d=_t(s.prvKeyHex)}else if(s instanceof p.crypto.ECDSA&&s.isPublic){var l=s.getShortNISTPCurveName();if(l!=="P-256"&&l!=="P-384"&&l!=="P-521")throw new Error("unsupported curve name for JWT: "+l);var d=s.getPublicKeyXYHex();o.kty="EC",o.crv=l,o.x=_t(d.x),o.y=_t(d.y)}if(o.kty==null)throw new Error("unsupported keyinfo");return!s.isPrivate&&e!=!0&&(o.kid=p.jws.JWS.getJWKthumbprint(o)),a!=null&&t!=!0&&(o.x5c=[Mn(a)]),a!=null&&n!=!0&&(o.x5t=Po(Mn(c(a,"sha1")))),a!=null&&i!=!0&&(o["x5t#S256"]=Po(Mn(c(a,"sha256")))),o};we.getJWKFromKey=function(r){return we.getJWK(r,!0,!0,!0,!0)};pe.getPosArrayOfChildrenFromHex=function(r){return Q.getChildIdx(r,0)};pe.getHexValueArrayOfChildrenFromHex=function(r){var e=Q,t=e.getV,u=pe.getPosArrayOfChildrenFromHex(r),n=t(r,u[0]),i=t(r,u[1]),s=t(r,u[2]),o=t(r,u[3]),a=t(r,u[4]),c=t(r,u[5]),l=t(r,u[6]),d=t(r,u[7]),h=t(r,u[8]),u=new Array;return u.push(n,i,s,o,a,c,l,d,h),u};pe.prototype.readPrivateKeyFromPEMString=function(r){var e=dt(r),t=pe.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])};pe.prototype.readPKCS5PrvKeyHex=function(r){var e=pe.getHexValueArrayOfChildrenFromHex(r);this.setPrivateEx(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])};pe.prototype.readPKCS8PrvKeyHex=function(r){var e,t,n,i,s,o,a,c,l=Q,d=l.getVbyListEx;if(l.isASN1HEX(r)===!1)throw new Error("not ASN.1 hex string");try{e=d(r,0,[2,0,1],"02"),t=d(r,0,[2,0,2],"02"),n=d(r,0,[2,0,3],"02"),i=d(r,0,[2,0,4],"02"),s=d(r,0,[2,0,5],"02"),o=d(r,0,[2,0,6],"02"),a=d(r,0,[2,0,7],"02"),c=d(r,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(e,t,n,i,s,o,a,c)};pe.prototype.readPKCS5PubKeyHex=function(r){var e=Q,t=e.getV;if(e.isASN1HEX(r)===!1)throw new Error("keyHex is not ASN.1 hex string");var n=e.getChildIdx(r,0);if(n.length!==2||r.substr(n[0],2)!=="02"||r.substr(n[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var i=t(r,n[0]),s=t(r,n[1]);this.setPublic(i,s)};pe.prototype.readPKCS8PubKeyHex=function(r){var e=Q;if(e.isASN1HEX(r)===!1)throw new Error("not ASN.1 hex string");if(e.getTLVbyListEx(r,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var t=e.getTLVbyListEx(r,0,[1,0]);this.readPKCS5PubKeyHex(t)};pe.prototype.readCertPubKeyHex=function(r,e){var t,n;t=new he,t.readCertHex(r),n=t.getPublicKeyHex(),this.readPKCS8PubKeyHex(n)};var Dce=new RegExp("[^0-9a-f]","gi");function yT(r,e){for(var t="",n=e/4-r.length,i=0;i<n;i++)t=t+"0";return t+r}pe.prototype.sign=function(r,e){var t=function(i){return p.crypto.Util.hashString(i,e)},n=t(r);return this.signWithMessageHash(n,e)};pe.prototype.signWithMessageHash=function(r,e){var t=p.crypto.Util.getPaddedDigestInfoHex(r,e,this.n.bitLength()),n=vr(t,16),i=this.doPrivate(n),s=i.toString(16);return yT(s,this.n.bitLength())};function bT(r,e,t){for(var n="",i=0;n.length<e;)n+=br(t(gn(r+String.fromCharCode.apply(String,[(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255])))),i+=1;return n}pe.prototype.signPSS=function(r,e,t){var n=function(s){return p.crypto.Util.hashHex(s,e)},i=n(gn(r));return t===void 0&&(t=-1),this.signWithMessageHashPSS(i,e,t)};pe.prototype.signWithMessageHashPSS=function(r,e,t){var n=br(r),i=n.length,s=this.n.bitLength()-1,o=Math.ceil(s/8),a,c=function(b){return p.crypto.Util.hashHex(b,e)};if(t===-1||t===void 0)t=i;else if(t===-2)t=o-i-2;else if(t<-2)throw new Error("invalid salt length");if(o<i+t+2)throw new Error("data too long");var l="";t>0&&(l=new Array(t),new Ro().nextBytes(l),l=String.fromCharCode.apply(String,l));var d=br(c(gn("\0\0\0\0\0\0\0\0"+n+l))),h=[];for(a=0;a<o-t-i-2;a+=1)h[a]=0;var u=String.fromCharCode.apply(String,h)+""+l,f=bT(d,u.length,c),g=[];for(a=0;a<u.length;a+=1)g[a]=u.charCodeAt(a)^f.charCodeAt(a);var m=65280>>8*o-s&255;for(g[0]&=~m,a=0;a<i;a++)g.push(d.charCodeAt(a));return g.push(188),yT(this.doPrivate(new L(g)).toString(16),this.n.bitLength())};function xT(r){for(var e in p.crypto.Util.DIGESTINFOHEAD){var t=p.crypto.Util.DIGESTINFOHEAD[e],n=t.length;if(r.substring(0,n)==t){var i=[e,r.substring(n)];return i}}return[]}pe.prototype.verify=function(r,e){if(e=e.toLowerCase(),e.match(/^[0-9a-f]+$/)==null)return!1;var t=vr(e,16),n=this.n.bitLength();if(t.bitLength()>n)return!1;var i=this.doPublic(t),s=i.toString(16);if(s.length+3!=n/4)return!1;var o=s.replace(/^1f+00/,""),a=xT(o);if(a.length==0)return!1;var c=a[0],l=a[1],d=function(u){return p.crypto.Util.hashString(u,c)},h=d(r);return l==h};pe.prototype.verifyWithMessageHash=function(r,e){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var t=vr(e,16);if(t.bitLength()>this.n.bitLength())return 0;var n=this.doPublic(t),i=n.toString(16).replace(/^1f+00/,""),s=xT(i);if(s.length==0)return!1;var o=s[0],a=s[1];return a==r};pe.prototype.verifyPSS=function(r,e,t,n){var i=function(o){return p.crypto.Util.hashHex(o,t)},s=i(gn(r));return n===void 0&&(n=-1),this.verifyWithMessageHashPSS(s,e,t,n)};pe.prototype.verifyWithMessageHashPSS=function(r,e,t,n){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var i=new L(e,16),s=function(x){return p.crypto.Util.hashHex(x,t)},o=br(r),a=o.length,c=this.n.bitLength()-1,l=Math.ceil(c/8),d;if(n===-1||n===void 0)n=a;else if(n===-2)n=l-a-2;else if(n<-2)throw new Error("invalid salt length");if(l<a+n+2)throw new Error("data too long");var h=this.doPublic(i).toByteArray();for(d=0;d<h.length;d+=1)h[d]&=255;for(;h.length<l;)h.unshift(0);if(h[l-1]!==188)throw new Error("encoded message does not end in 0xbc");h=String.fromCharCode.apply(String,h);var u=h.substr(0,l-a-1),f=h.substr(u.length,a),g=65280>>8*l-c&255;if(u.charCodeAt(0)&g)throw new Error("bits beyond keysize not zero");var m=bT(f,u.length,s),b=[];for(d=0;d<u.length;d+=1)b[d]=u.charCodeAt(d)^m.charCodeAt(d);b[0]&=~g;var v=l-a-n-2;for(d=0;d<v;d+=1)if(b[d]!==0)throw new Error("leftmost octets not zero");if(b[v]!==1)throw new Error("0x01 marker not found");return f===br(s(gn("\0\0\0\0\0\0\0\0"+o+String.fromCharCode.apply(String,b.slice(-n)))))};pe.SALT_LEN_HLEN=-1;pe.SALT_LEN_MAX=-2;pe.SALT_LEN_RECOVER=-2;function he(r){var e=Q,t=e.getChildIdx,n=e.getV,i=e.dump,s=e.parse,o=e.getTLV,a=e.getVbyList,c=e.getVbyListEx,l=e.getTLVbyList,d=e.getTLVbyListEx,h=e.getIdxbyList,u=e.getIdxbyListEx,f=e.getVidx,g=e.getInt,m=e.oidname,b=e.hextooidstr,v=he,x=dt,_,A=Error;try{_=p.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var S=l(this.hex,0,[0,0]);if(S.substr(0,2)=="a0"){var E=l(S,0,[0]),w=g(E,0);if(w<0||2<w)throw new Error("malformed version field");return this.version=w+1,this.version}else return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return c(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var S=d(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(S)},this.getAlgorithmIdentifierName=function(S){for(var E in _)if(S===_[E])return E;return m(c(S,0,[0],"06"))},this.getIssuer=function(S,E){return this.getX500Name(this.getIssuerHex(),S,E)},this.getIssuerHex=function(){return l(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){var S=this.getIssuer();return S.str},this.getSubject=function(S,E){return this.getX500Name(this.getSubjectHex(),S,E)},this.getSubjectHex=function(){return l(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){var S=this.getSubject();return S.str},this.getNotBefore=function(){var S=a(this.hex,0,[0,4+this.foffset,0]);return S=S.replace(/(..)/g,"%$1"),S=decodeURIComponent(S),S},this.getNotAfter=function(){var S=a(this.hex,0,[0,4+this.foffset,1]);return S=S.replace(/(..)/g,"%$1"),S=decodeURIComponent(S),S},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return l(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var S=this.getSPKI();return S==null?null:a(S,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return h(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var S=this.getPublicKeyIdx();return h(this.hex,S,[1,0],"30")},this.getPublicKey=function(){return we.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var S=l(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(S)},this.getSignatureValueHex=function(){return a(this.hex,0,[2],"03",!0)},this.verifySignature=function(S){var E=this.getSignatureAlgorithmField(),w=this.getSignatureValueHex(),T=l(this.hex,0,[0],"30"),F=new p.crypto.Signature({alg:E});return F.init(S),F.updateHex(T),F.verify(w)},this.parseExt=function(S){var E,w,T;if(S===void 0){if(T=this.hex,this.version!==3)return-1;E=h(T,0,[0,7,0],"30"),w=t(T,E)}else{T=dt(S);var F=h(T,0,[0,3,0,0],"06");if(n(T,F)!="2a864886f70d01090e"){this.aExtInfo=new Array;return}E=h(T,0,[0,3,0,1,0],"30"),w=t(T,E),this.hex=T}this.aExtInfo=new Array;for(var N=0;N<w.length;N++){var P={};P.critical=!1;var I=t(T,w[N]),B=0;I.length===3&&(P.critical=!0,B=1),P.oid=e.hextooidstr(a(T,w[N],[0],"06"));var q=h(T,w[N],[1+B]);P.vidx=f(T,q),this.aExtInfo.push(P)}},this.getExtInfo=function(S){var E=this.aExtInfo,w=S;if(S.match(/^[0-9.]+$/)||(w=p.asn1.x509.OID.name2oid(S)),w!==""){for(var T=0;T<E.length;T++)if(E[T].oid===w)return E[T]}},this.getCriticalExtV=function(S,E,w){if(E!=null)return[E,w];var T=this.getExtInfo(S);return T==null?[null,null]:[o(this.hex,T.vidx),T.critical]},this.getExtBasicConstraints=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("basicConstraints");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"basicConstraints"};if(E&&(T.critical=!0),S==="3000")return T;if(S==="30030101ff")return T.cA=!0,T;if(S.substr(0,12)==="30060101ff02"){var F=n(S,10),N=parseInt(F,16);return T.cA=!0,T.pathLen=N,T}throw new Error("hExtV parse error: "+S)},this.getExtNameConstraints=function(S,E){var w=this.getCriticalExtV("nameConstraints",S,E);if(S=w[0],E=w[1],S!=null){var T={extname:"nameConstraints"};E&&(T.critical=!0);for(var F=t(S,0),N=0;N<F.length;N++){for(var P=[],I=t(S,F[N]),B=0;B<I.length;B++){var q=o(S,I[B]),z=this.getGeneralSubtree(q);P.push(z)}var V=S.substr(F[N],2);V=="a0"?T.permit=P:V=="a1"&&(T.exclude=P)}return T}},this.getGeneralSubtree=function(S){var E=t(S,0),w=E.length;if(w<1||2<w)throw new Error("wrong num elements");for(var T=this.getGeneralName(o(S,E[0])),F=1;F<w;F++){var N=S.substr(E[F],2),P=n(S,E[F]),I=parseInt(P,16);N=="80"&&(T.min=I),N=="81"&&(T.max=I)}return T},this.getExtKeyUsage=function(S,E){var w=this.getCriticalExtV("keyUsage",S,E);if(S=w[0],E=w[1],S!=null){var T={extname:"keyUsage"};return E&&(T.critical=!0),T.names=this.getExtKeyUsageString(S).split(","),T}},this.getExtKeyUsageBin=function(S){if(S===void 0){var E=this.getExtInfo("keyUsage");if(E===void 0)return"";S=o(this.hex,E.vidx)}if(S.length!=8&&S.length!=10)throw new Error("malformed key usage value: "+S);var w="000000000000000"+parseInt(S.substr(6),16).toString(2);return S.length==8&&(w=w.slice(-8)),S.length==10&&(w=w.slice(-16)),w=w.replace(/0+$/,""),w==""&&(w="0"),w},this.getExtKeyUsageString=function(S){for(var E=this.getExtKeyUsageBin(S),w=new Array,T=0;T<E.length;T++)E.substr(T,1)=="1"&&w.push(he.KEYUSAGE_NAME[T]);return w.join(",")},this.getExtSubjectKeyIdentifier=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("subjectKeyIdentifier");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"subjectKeyIdentifier"};E&&(T.critical=!0);var F=n(S,0);return T.kid={hex:F},T},this.getExtAuthorityKeyIdentifier=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("authorityKeyIdentifier");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"authorityKeyIdentifier"};E&&(T.critical=!0);for(var F=t(S,0),N=0;N<F.length;N++){var P=S.substr(F[N],2);if(P==="80"&&(T.kid={hex:n(S,F[N])}),P==="a1"){var I=o(S,F[N]),B=this.getGeneralNames(I);T.issuer=B[0].dn}P==="82"&&(T.sn={hex:n(S,F[N])})}return T},this.getExtExtKeyUsage=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("extKeyUsage");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"extKeyUsage",array:[]};E&&(T.critical=!0);for(var F=t(S,0),N=0;N<F.length;N++)T.array.push(m(n(S,F[N])));return T},this.getExtExtKeyUsageName=function(){var S=this.getExtInfo("extKeyUsage");if(S===void 0)return S;var E=new Array,w=o(this.hex,S.vidx);if(w==="")return E;for(var T=t(w,0),F=0;F<T.length;F++)E.push(m(n(w,T[F])));return E},this.getExtSubjectAltName=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("subjectAltName");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"subjectAltName",array:[]};return E&&(T.critical=!0),T.array=this.getGeneralNames(S),T},this.getExtIssuerAltName=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("issuerAltName");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"issuerAltName",array:[]};return E&&(T.critical=!0),T.array=this.getGeneralNames(S),T},this.getGeneralNames=function(S){for(var E=t(S,0),w=[],T=0;T<E.length;T++){var F=this.getGeneralName(o(S,E[T]));F!==void 0&&w.push(F)}return w},this.getGeneralName=function(S){var E=S.substr(0,2),w=n(S,0),T=br(w);if(E=="81")return{rfc822:T};if(E=="82")return{dns:T};if(E=="86")return{uri:T};if(E=="87")return{ip:Kh(w)};if(E=="a4")return{dn:this.getX500Name(w)};if(E=="a0")return{other:this.getOtherName(S)}},this.getExtSubjectAltName2=function(){var S,E,w,T=this.getExtInfo("subjectAltName");if(T===void 0)return T;for(var F=new Array,N=o(this.hex,T.vidx),P=t(N,0),I=0;I<P.length;I++)w=N.substr(P[I],2),S=n(N,P[I]),w==="81"&&(E=qe(S),F.push(["MAIL",E])),w==="82"&&(E=qe(S),F.push(["DNS",E])),w==="84"&&(E=he.hex2dn(S,0),F.push(["DN",E])),w==="86"&&(E=qe(S),F.push(["URI",E])),w==="87"&&(E=Kh(S),F.push(["IP",E]));return F},this.getExtCRLDistributionPoints=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("cRLDistributionPoints");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"cRLDistributionPoints",array:[]};E&&(T.critical=!0);for(var F=t(S,0),N=0;N<F.length;N++){var P=o(S,F[N]);T.array.push(this.getDistributionPoint(P))}return T},this.getDistributionPoint=function(S){for(var E={},w=t(S,0),T=0;T<w.length;T++){var F=S.substr(w[T],2),N=o(S,w[T]);F=="a0"&&(E.dpname=this.getDistributionPointName(N))}return E},this.getDistributionPointName=function(S){for(var E={},w=t(S,0),T=0;T<w.length;T++){var F=S.substr(w[T],2),N=o(S,w[T]);F=="a0"&&(E.full=this.getGeneralNames(N))}return E},this.getExtCRLDistributionPointsURI=function(){var S=this.getExtCRLDistributionPoints();if(S==null)return S;for(var E=S.array,w=[],T=0;T<E.length;T++)try{E[T].dpname.full[0].uri!=null&&w.push(E[T].dpname.full[0].uri)}catch{}return w},this.getExtAIAInfo=function(){var S=this.getExtInfo("authorityInfoAccess");if(S===void 0)return S;for(var E={ocsp:[],caissuer:[]},w=t(this.hex,S.vidx),T=0;T<w.length;T++){var F=a(this.hex,w[T],[0],"06"),N=a(this.hex,w[T],[1],"86");F==="2b06010505073001"&&E.ocsp.push(qe(N)),F==="2b06010505073002"&&E.caissuer.push(qe(N))}return E},this.getExtAuthorityInfoAccess=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("authorityInfoAccess");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"authorityInfoAccess",array:[]};E&&(T.critical=!0);for(var F=t(S,0),N=0;N<F.length;N++){var P=c(S,F[N],[0],"06"),I=a(S,F[N],[1],"86"),B=qe(I);if(P=="2b06010505073001")T.array.push({ocsp:B});else if(P=="2b06010505073002")T.array.push({caissuer:B});else throw new Error("unknown method: "+P)}return T},this.getExtCertificatePolicies=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("certificatePolicies");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"certificatePolicies",array:[]};E&&(T.critical=!0);for(var F=t(S,0),N=0;N<F.length;N++){var P=o(S,F[N]),I=this.getPolicyInformation(P);T.array.push(I)}return T},this.getPolicyInformation=function(S){var E={},w=a(S,0,[0],"06");E.policyoid=m(w);var T=u(S,0,[1],"30");if(T!=-1){E.array=[];for(var F=t(S,T),N=0;N<F.length;N++){var P=o(S,F[N]),I=this.getPolicyQualifierInfo(P);E.array.push(I)}}return E},this.getOtherName=function(S){var E={},w=t(S,0),T=a(S,w[0],[],"06"),F=a(S,w[1],[]);return E.oid=m(T),E.value=s(F),E},this.getPolicyQualifierInfo=function(S){var E={},w=a(S,0,[0],"06");if(w==="2b06010505070201"){var T=c(S,0,[1],"16");E.cps=br(T)}else if(w==="2b06010505070202"){var F=l(S,0,[1],"30");E.unotice=this.getUserNotice(F)}return E},this.getUserNotice=function(S){var E=null,w={};try{E=e.parse(S);var T=this._asn1ToUnotice(E);return T}catch{return}},this._asn1ToUnotice=function(S){try{for(var E={},w=Ke(S,"seq"),T=0;T<w.length;T++){var F=this._asn1ToNoticeRef(w[T]);F!=null&&(E.noticeref=F);var N=this.asn1ToDisplayText(w[T]);N!=null&&(E.exptext=N)}return Object.keys(E).length>0?E:void 0}catch{return}},this._asn1ToNoticeRef=function(S){try{for(var E={},w=Ke(S,"seq"),T=0;T<w.length;T++){var F=this._asn1ToNoticeNum(w[T]);F!=null&&(E.noticenum=F);var N=this.asn1ToDisplayText(w[T]);N!=null&&(E.org=N)}return Object.keys(E).length>0?E:void 0}catch{return}},this._asn1ToNoticeNum=function(S){try{for(var E=Ke(S,"seq"),w=[],T=0;T<E.length;T++){var F=E[T];w.push(parseInt(Ke(F,"int.hex"),16))}return w}catch{return}},this.getDisplayText=function(S){var E={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"},w={};return w.type=E[S.substr(0,2)],w.str=br(n(S,0)),w},this.asn1ToDisplayText=function(S){if(S.utf8str!=null)return{type:"utf8",str:S.utf8str.str};if(S.ia5str!=null)return{type:"ia5",str:S.ia5str.str};if(S.visstr!=null)return{type:"vis",str:S.visstr.str};if(S.bmpstr!=null)return{type:"bmp",str:S.bmpstr.str};if(S.prnstr!=null)return{type:"prn",str:S.prnstr.str}},this.getExtPolicyMappings=function(S,E){var w=this.getCriticalExtV("policyMappings",S,E);if(S=w[0],E=w[1],S!=null){var T={extname:"policyMappings"};E&&(T.critical=!0);try{for(var F=s(S),N=F.seq,P=[],I=0;I<N.length;I++){var B=N[I].seq;P.push([B[0].oid,B[1].oid])}T.array=P}catch{throw new A("malformed policyMappings")}return T}},this.getExtPolicyConstraints=function(S,E){var w=this.getCriticalExtV("policyConstraints",S,E);if(S=w[0],E=w[1],S!=null){var T={extname:"policyConstraints"};E&&(T.critical=!0);var F=s(S);try{for(var N=F.seq,P=0;P<N.length;P++){var I=N[P].tag;I.explicit==!1&&(I.tag=="80"&&(T.reqexp=parseInt(I.hex,16)),I.tag=="81"&&(T.inhibit=parseInt(I.hex,16)))}}catch{return new A("malformed policyConstraints value")}return T}},this.getExtInhibitAnyPolicy=function(S,E){var w=this.getCriticalExtV("inhibitAnyPolicy",S,E);if(S=w[0],E=w[1],S!=null){var T={extname:"inhibitAnyPolicy"};E&&(T.critical=!0);var F=g(S,0);return F==-1?new A("wrong value"):(T.skip=F,T)}},this.getExtCRLNumber=function(S,E){var w={extname:"cRLNumber"};if(E&&(w.critical=!0),S.substr(0,2)=="02")return w.num={hex:n(S,0)},w;throw new A("hExtV parse error: "+S)},this.getExtCRLReason=function(S,E){var w={extname:"cRLReason"};if(E&&(w.critical=!0),S.substr(0,2)=="0a")return w.code=parseInt(n(S,0),16),w;throw new Error("hExtV parse error: "+S)},this.getExtOcspNonce=function(S,E){var w={extname:"ocspNonce"};E&&(w.critical=!0);var T=n(S,0);return w.hex=T,w},this.getExtOcspNoCheck=function(S,E){var w={extname:"ocspNoCheck"};return E&&(w.critical=!0),w},this.getExtAdobeTimeStamp=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("adobeTimeStamp");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"adobeTimeStamp"};E&&(T.critical=!0);var F=t(S,0);if(F.length>1){var N=o(S,F[1]),P=this.getGeneralName(N);P.uri!=null&&(T.uri=P.uri)}if(F.length>2){var I=o(S,F[2]);I=="0101ff"&&(T.reqauth=!0),I=="010100"&&(T.reqauth=!1)}return T},this.getExtSubjectDirectoryAttributes=function(S,E){if(S===void 0&&E===void 0){var w=this.getExtInfo("subjectDirectoryAttributes");if(w===void 0)return;S=o(this.hex,w.vidx),E=w.critical}var T={extname:"subjectDirectoryAttributes"};E&&(T.critical=!0);try{for(var F=s(S),N=[],P=0;P<F.seq.length;P++){var I=F.seq[P],B=Ke(I,"seq.0.oid"),q=Ke(I,"seq.1.set");if(B==null||q==null)throw"error";N.push({attr:B,array:q})}return T.array=N,T}catch{throw new Error("malformed subjectDirectoryAttributes extension value")}};var D=function(S){var E={};try{var w=S.seq[0].oid,T=p.asn1.x509.OID.name2oid(w);E.type=p.asn1.x509.OID.oid2atype(T);var F=S.seq[1];if(F.utf8str!=null)E.ds="utf8",E.value=F.utf8str.str;else if(F.numstr!=null)E.ds="num",E.value=F.numstr.str;else if(F.telstr!=null)E.ds="tel",E.value=F.telstr.str;else if(F.prnstr!=null)E.ds="prn",E.value=F.prnstr.str;else if(F.ia5str!=null)E.ds="ia5",E.value=F.ia5str.str;else if(F.visstr!=null)E.ds="vis",E.value=F.visstr.str;else if(F.bmpstr!=null)E.ds="bmp",E.value=F.bmpstr.str;else throw"error";return E}catch{throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},O=function(S){try{return S.set.map(function(E){return D(E)})}catch(E){throw new Error("improper ASN.1 parsed RDN: "+E)}},M=function(S){try{return S.seq.map(function(E){return O(E)})}catch(E){throw new Error("improper ASN.1 parsed X500Name: "+E)}};this.getX500NameRule=function(S){for(var E=!0,w=!0,T=!1,F="",N="",P=null,I=[],B=0;B<S.length;B++)for(var q=S[B],z=0;z<q.length;z++)I.push(q[z]);for(var B=0;B<I.length;B++){var V=I[B],W=V.ds,ie=V.value,ne=V.type;if(F+=":"+W,W!="prn"&&W!="utf8"&&W!="ia5")return"mixed";if(W=="ia5"){if(ne!="CN")return"mixed";if(p.lang.String.isMail(ie))continue;return"mixed"}if(ne=="C"){if(W=="prn")continue;return"mixed"}if(N+=":"+W,P==null)P=W;else if(P!==W)return"mixed"}return P??"prn"},this.getAttrTypeAndValue=function(S){var E=s(S);return D(E)},this.getRDN=function(S){var E=s(S);return O(E)},this.getX500NameArray=function(S){var E=s(S);return M(E)},this.getX500Name=function(S,E,w){var T=this.getX500NameArray(S),F=this.dnarraytostr(T),N={str:F};return N.array=T,w==!0&&(N.hex=S),E==!0&&(N.canon=this.c14nRDNArray(T)),N},this.readCertPEM=function(S){this.readCertHex(x(S))},this.readCertHex=function(S){this.hex=S,this.getVersion();try{h(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(S){var E={};return S==null&&(S={}),E.version=this.getVersion(),E.serial={hex:this.getSerialNumberHex()},E.sigalg=this.getSignatureAlgorithmField(),E.issuer=this.getIssuer(S.dncanon,S.dnhex),E.notbefore=this.getNotBefore(),E.notafter=this.getNotAfter(),E.subject=this.getSubject(S.dncanon,S.dnhex),E.sbjpubkey=Yt(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo!=null&&this.aExtInfo.length>0&&(E.ext=this.getExtParamArray()),E.sighex=this.getSignatureValueHex(),S.tbshex==!0&&(E.tbshex=l(this.hex,0,[0])),S.nodnarray==!0&&(delete E.issuer.array,delete E.subject.array),E},this.getExtParamArray=function(S){if(S==null){var E=u(this.hex,0,[0,"[3]"]);E!=-1&&(S=d(this.hex,0,[0,"[3]",0],"30"))}for(var w=[],T=t(S,0),F=0;F<T.length;F++){var N=o(S,T[F]),P=this.getExtParam(N);P!=null&&w.push(P)}return w},this.getExtParam=function(S){var E={},w=t(S,0),T=w.length;if(T!=2&&T!=3)throw new Error("wrong number elements in Extension: "+T+" "+S);var F=b(a(S,0,[0],"06")),N=!1;T==3&&l(S,0,[1])=="0101ff"&&(N=!0);var P=l(S,0,[T-1,0]),I=void 0;if(F=="2.5.29.14"?I=this.getExtSubjectKeyIdentifier(P,N):F=="2.5.29.15"?I=this.getExtKeyUsage(P,N):F=="2.5.29.17"?I=this.getExtSubjectAltName(P,N):F=="2.5.29.18"?I=this.getExtIssuerAltName(P,N):F=="2.5.29.19"?I=this.getExtBasicConstraints(P,N):F=="2.5.29.30"?I=this.getExtNameConstraints(P,N):F=="2.5.29.31"?I=this.getExtCRLDistributionPoints(P,N):F=="2.5.29.32"?I=this.getExtCertificatePolicies(P,N):F=="2.5.29.33"?I=this.getExtPolicyMappings(P,N):F=="2.5.29.35"?I=this.getExtAuthorityKeyIdentifier(P,N):F=="2.5.29.36"?I=this.getExtPolicyConstraints(P,N):F=="2.5.29.37"?I=this.getExtExtKeyUsage(P,N):F=="2.5.29.54"?I=this.getExtInhibitAnyPolicy(P,N):F=="1.3.6.1.5.5.7.1.1"?I=this.getExtAuthorityInfoAccess(P,N):F=="2.5.29.20"?I=this.getExtCRLNumber(P,N):F=="2.5.29.21"?I=this.getExtCRLReason(P,N):F=="2.5.29.9"?I=this.getExtSubjectDirectoryAttributes(P,N):F=="1.3.6.1.5.5.7.48.1.2"?I=this.getExtOcspNonce(P,N):F=="1.3.6.1.5.5.7.48.1.5"?I=this.getExtOcspNoCheck(P,N):F=="1.2.840.113583.1.1.9.1"?I=this.getExtAdobeTimeStamp(P,N):he.EXT_PARSER[F]!=null&&(I=he.EXT_PARSER[F](F,N,P)),I!=null)return I;var B={extname:F,extn:P};try{B.extn=s(P)}catch{}return N&&(B.critical=!0),B},this.findExt=function(S,E){for(var w=0;w<S.length;w++)if(S[w].extname==E)return S[w];return null},this.updateExtCDPFullURI=function(S,E){var w=this.findExt(S,"cRLDistributionPoints");if(w!=null&&w.array!=null){for(var T=w.array,F=0;F<T.length;F++)if(T[F].dpname!=null&&T[F].dpname.full!=null)for(var N=T[F].dpname.full,P=0;P<N.length;P++){var I=N[F];I.uri!=null&&(I.uri=E)}}},this.updateExtAIAOCSP=function(S,E){var w=this.findExt(S,"authorityInfoAccess");if(w!=null&&w.array!=null)for(var T=w.array,F=0;F<T.length;F++)T[F].ocsp!=null&&(T[F].ocsp=E)},this.updateExtAIACAIssuer=function(S,E){var w=this.findExt(S,"authorityInfoAccess");if(w!=null&&w.array!=null)for(var T=w.array,F=0;F<T.length;F++)T[F].caissuer!=null&&(T[F].caissuer=E)},this.dnarraytostr=function(S){function E(T){return T.map(function(F){return w(F).replace(/\+/,"\\+")}).join("+")}function w(T){return T.type+"="+T.value}return"/"+S.map(function(T){return E(T).replace(/\//,"\\/")}).join("/")},this.setCanonicalizedDN=function(S){var E;if(S.str!=null&&S.array==null){var w=new p.asn1.x509.X500Name({str:S.str}),T=w.tohex();E=this.getX500NameArray(T)}else E=S.array;S.canon==null&&(S.canon=this.c14nRDNArray(E))},this.c14nRDNArray=function(S){for(var E=[],w=0;w<S.length;w++){for(var T=S[w],F=[],N=0;N<T.length;N++){var P=T[N],I=P.value;I=I.replace(/^\s*/,""),I=I.replace(/\s*$/,""),I=I.replace(/\s+/g," "),I=I.toLowerCase(),F.push(P.type.toLowerCase()+"="+I)}E.push(F.join("+"))}return"/"+E.join("/")},this.getInfo=function(){var S=function(Pe){for(var de="",_e="    ",Se=`
`,ze=Pe.array,xt=0;xt<ze.length;xt++){var Ue=ze[xt];if(Ue.dn!=null&&(de+=_e+"dn: "+Ue.dn.str+Se),Ue.ip!=null&&(de+=_e+"ip: "+Ue.ip+Se),Ue.rfc822!=null&&(de+=_e+"rfc822: "+Ue.rfc822+Se),Ue.dns!=null&&(de+=_e+"dns: "+Ue.dns+Se),Ue.uri!=null&&(de+=_e+"uri: "+Ue.uri+Se),Ue.other!=null){var ar=Ue.other.oid,Uo=JSON.stringify(Ue.other.value).replace(/\"/g,"");de+=_e+"other: "+ar+"="+Uo+Se}}return de=de.replace(/\n$/,""),de},E=function(Pe){for(var de="",_e=Pe.array,Se=0;Se<_e.length;Se++){var ze=_e[Se];if(de+="    policy oid: "+ze.policyoid+`
`,ze.array!==void 0)for(var xt=0;xt<ze.array.length;xt++){var Ue=ze.array[xt];Ue.cps!==void 0&&(de+="    cps: "+Ue.cps+`
`)}}return de},w=function(Pe){for(var de="",_e=Pe.array,Se=0;Se<_e.length;Se++){var ze=_e[Se];try{ze.dpname.full[0].uri!==void 0&&(de+="    "+ze.dpname.full[0].uri+`
`)}catch{}try{ze.dname.full[0].dn.hex!==void 0&&(de+="    "+he.hex2dn(ze.dpname.full[0].dn.hex)+`
`)}catch{}}return de},T=function(Pe){for(var de="",_e=Pe.array,Se=0;Se<_e.length;Se++){var ze=_e[Se];ze.caissuer!==void 0&&(de+="    caissuer: "+ze.caissuer+`
`),ze.ocsp!==void 0&&(de+="    ocsp: "+ze.ocsp+`
`)}return de},F=he,N,P,I;if(N=`Basic Fields
`,N+="  serial number: "+this.getSerialNumberHex()+`
`,N+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,N+="  issuer: "+this.getIssuerString()+`
`,N+="  notBefore: "+this.getNotBefore()+`
`,N+="  notAfter: "+this.getNotAfter()+`
`,N+="  subject: "+this.getSubjectString()+`
`,N+=`  subject public key info: 
`,P=this.getPublicKey(),N+="    key algorithm: "+P.type+`
`,P.type==="RSA"&&(N+="    n="+Xg(P.n.toString(16)).substr(0,16)+`...
`,N+="    e="+Xg(P.e.toString(16))+`
`),I=this.aExtInfo,I!=null){N+=`X509v3 Extensions:
`;for(var B=0;B<I.length;B++){var q=I[B],z=p.asn1.x509.OID.oid2name(q.oid);z===""&&(z=q.oid);var V="";if(q.critical===!0&&(V="CRITICAL"),N+="  "+z+" "+V+`:
`,z==="basicConstraints"){var W=this.getExtBasicConstraints();W.cA===void 0?N+=`    {}
`:(N+="    cA=true",W.pathLen!==void 0&&(N+=", pathLen="+W.pathLen),N+=`
`)}else if(z=="policyMappings"){var ie=this.getExtPolicyMappings().array,ne=ie.map(function(Pe){var de=Pe;return de[0]+":"+de[1]}).join(", ");N+="    "+ne+`
`}else if(z=="policyConstraints"){var me=this.getExtPolicyConstraints();N+="    ",me.reqexp!=null&&(N+=" reqexp="+me.reqexp),me.inhibit!=null&&(N+=" inhibit="+me.inhibit),N+=`
`}else if(z=="inhibitAnyPolicy"){var me=this.getExtInhibitAnyPolicy();N+="    skip="+me.skip+`
`}else if(z=="keyUsage")N+="    "+this.getExtKeyUsageString()+`
`;else if(z=="subjectKeyIdentifier")N+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(z=="authorityKeyIdentifier"){var fe=this.getExtAuthorityKeyIdentifier();fe.kid!==void 0&&(N+="    kid="+fe.kid.hex+`
`)}else if(z=="extKeyUsage"){var Xe=this.getExtExtKeyUsage().array;N+="    "+Xe.join(", ")+`
`}else if(z=="subjectAltName"){var Le=S(this.getExtSubjectAltName());N+=Le+`
`}else if(z=="cRLDistributionPoints"){var je=this.getExtCRLDistributionPoints();N+=w(je)}else if(z=="authorityInfoAccess"){var Ve=this.getExtAuthorityInfoAccess();N+=T(Ve)}else z=="certificatePolicies"&&(N+=E(this.getExtCertificatePolicies()))}}return N+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,N+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`,N},typeof r=="string"&&(r.indexOf("-----BEGIN")!=-1?this.readCertPEM(r):p.lang.String.isHex(r)&&this.readCertHex(r))}he.EXT_PARSER={};he.registExtParser=function(r,e){he.EXT_PARSER[r]=e};he.hex2dn=function(r,e){e===void 0&&(e=0);var t=new he,n=Q.getTLV(r,e),i=t.getX500Name(r);return i.str};he.hex2rdn=function(r,e){if(e===void 0&&(e=0),r.substr(e,2)!=="31")throw new Error("malformed RDN");for(var t=new Array,n=Q.getChildIdx(r,e),i=0;i<n.length;i++)t.push(he.hex2attrTypeValue(r,n[i]));return t=t.map(function(s){return s.replace("+","\\+")}),t.join("+")};he.hex2attrTypeValue=function(r,e){var t=Q,n=t.getV;if(e===void 0&&(e=0),r.substr(e,2)!=="30")throw new Error("malformed attribute type and value");var i=t.getChildIdx(r,e);i.length!==2||r.substr(i[0],2);var s=n(r,i[0]),o=p.asn1.ASN1Util.oidHexToInt(s),a=p.asn1.x509.OID.oid2atype(o),c=n(r,i[1]),l=br(c);return a+"="+l};he.getPublicKeyFromCertHex=function(r){var e=new he;return e.readCertHex(r),e.getPublicKey()};he.getPublicKeyFromCertPEM=function(r){var e=new he;return e.readCertPEM(r),e.getPublicKey()};he.getPublicKeyInfoPropOfCertPEM=function(r){var e=Q,t=e.getVbyList,n={},i,s,o;return n.algparam=null,i=new he,i.readCertPEM(r),s=i.getPublicKeyHex(),n.keyhex=t(s,0,[1],"03").substr(2),n.algoid=t(s,0,[0,0],"06"),n.algoid==="2a8648ce3d0201"&&(n.algparam=t(s,0,[0,1],"06")),n};he.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];var tH=function(r){var e=p,t=e.lang.String.isHex,n=Q,i=n.getV,s=n.getTLV,o=n.getVbyList,a=n.getTLVbyList,c=n.getTLVbyListEx,l=n.getIdxbyList,d=n.getIdxbyListEx,h=n.getChildIdx,u=new he;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var f=l(this.hex,0,[0,0]),g=this.hex.substr(f,2);if(g=="02")this.posSigAlg=1;else if(g=="30")this.posSigAlg=0;else throw new Error("malformed 1st item of TBSCertList: "+g);var m=l(this.hex,0,[0,this.posSigAlg+3]),b=this.hex.substr(m,2);if(b=="17"||b=="18"){var v,x;v=l(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,v!=-1&&(x=this.hex.substr(v,2),x=="30"&&(this.posRevCert=this.posSigAlg+4))}else if(b=="30")this.posRevCert=this.posSigAlg+3;else if(b=="a0")this.posRevCert=null;else throw new Error("malformed nextUpdate or revCert tag: "+b)},this.getVersion=function(){return this.posSigAlg==0?null:parseInt(o(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var f=a(this.hex,0,[0,this.posSigAlg],"30");return u.getAlgorithmIdentifierName(f)},this.getIssuer=function(){return u.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return a(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var f=o(this.hex,0,[0,this.posSigAlg+2]);return result=br(f)},this.getNextUpdate=function(){var f=l(this.hex,0,[0,this.posSigAlg+3]),g=this.hex.substr(f,2);return g!="17"&&g!="18"?null:br(i(this.hex,f))},this.getRevCertArray=function(){if(this.posRevCert==null)return null;for(var f=[],g=l(this.hex,0,[0,this.posRevCert]),m=h(this.hex,g),b=0;b<m.length;b++){var v=s(this.hex,m[b]);f.push(this.getRevCert(v))}return f},this.getRevCert=function(f){var g={},m=h(f,0);return g.sn={hex:o(f,0,[0],"02")},g.date=br(o(f,0,[1])),m.length==3&&(g.ext=u.getExtParamArray(a(f,0,[2]))),g},this.findRevCert=function(f){var g=new he(f),m=g.getSerialNumberHex();return this.findRevCertBySN(m)},this.findRevCertBySN=function(f){if(this.parsed==null&&this.getParam(),this.parsed.revcert==null)return null;for(var g=this.parsed.revcert,m=0;m<g.length;m++)if(f==g[m].sn.hex)return g[m];return null},this.getSignatureValueHex=function(){return o(this.hex,0,[2],"03",!0)},this.verifySignature=function(f){var g=this.getSignatureAlgorithmField(),m=this.getSignatureValueHex(),b=a(this.hex,0,[0],"30"),v=new p.crypto.Signature({alg:g});return v.init(f),v.updateHex(b),v.verify(m)},this.getParam=function(f){var g={},m=this.getVersion();m!=null&&(g.version=m),g.sigalg=this.getSignatureAlgorithmField(),g.issuer=this.getIssuer(),g.thisupdate=this.getThisUpdate();var b=this.getNextUpdate();b!=null&&(g.nextupdate=b);var v=this.getRevCertArray();v!=null&&(g.revcert=v);var x=d(this.hex,0,[0,"[0]"]);if(x!=-1){var _=c(this.hex,0,[0,"[0]",0]);g.ext=u.getExtParamArray(_)}return g.sighex=this.getSignatureValueHex(),this.parsed=g,typeof f=="object"&&(f.tbshex==!0&&(g.tbshex=a(this.hex,0,[0])),f.nodnarray==!0&&delete g.issuer.array),g},typeof r=="string"&&(t(r)?this.hex=r:r.match(/-----BEGIN X509 CRL/)&&(this.hex=dt(r)),this._setPos())};(typeof p>"u"||!p)&&(p={});(typeof p.jws>"u"||!p.jws)&&(p.jws={});p.jws.JWS=function(){var r=p,e=r.jws.JWS,t=e.isSafeJSONString;this.parseJWS=function(n,i){if(!(this.parsedJWS!==void 0&&(i||this.parsedJWS.sigvalH!==void 0))){var s=n.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(s==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var o=s[1],a=s[2],c=s[3],l=o+"."+a;if(this.parsedJWS={},this.parsedJWS.headB64U=o,this.parsedJWS.payloadB64U=a,this.parsedJWS.sigvalB64U=c,this.parsedJWS.si=l,!i){var d=st(c),h=vr(d,16);this.parsedJWS.sigvalH=d,this.parsedJWS.sigvalBI=h}var u=Jr(o),f=Jr(a);if(this.parsedJWS.headS=u,this.parsedJWS.payloadS=f,!t(u,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+u}}};p.jws.JWS.sign=function(r,e,t,n,i){var s=p,o=s.jws,a=o.JWS,c=a.readSafeJSONString,l=a.isSafeJSONString,d=s.crypto,h=d.ECDSA,u=d.Mac,f=d.Signature,g=JSON,m,b,v;if(typeof e!="string"&&typeof e!="object")throw"spHeader must be JSON string or object: "+e;if(typeof e=="object"&&(b=e,m=g.stringify(b)),typeof e=="string"){if(m=e,!l(m))throw"JWS Head is not safe JSON string: "+m;b=c(m)}if(v=t,typeof t=="object"&&(v=g.stringify(t)),(r==""||r==null)&&b.alg!==void 0&&(r=b.alg),r!=""&&r!=null&&b.alg===void 0&&(b.alg=r,m=g.stringify(b)),r!==b.alg)throw"alg and sHeader.alg doesn't match: "+r+"!="+b.alg;var x=null;if(a.jwsalg2sigalg[r]===void 0)throw"unsupported alg name: "+r;x=a.jwsalg2sigalg[r];var _=xc(m),A=xc(v),D=_+"."+A,O="";if(x.substr(0,4)=="Hmac"){if(n===void 0)throw"mac key shall be specified for HS* alg";var M=new u({alg:x,prov:"cryptojs",pass:n});M.updateString(D),O=M.doFinal()}else if(x.indexOf("withECDSA")!=-1){var S=new f({alg:x});S.init(n,i),S.updateString(D);var E=S.sign();O=p.crypto.ECDSA.asn1SigToConcatSig(E)}else if(x!="none"){var S=new f({alg:x});S.init(n,i),S.updateString(D),O=S.sign()}var w=_t(O);return D+"."+w};p.jws.JWS.verify=function(r,e,t){var n=p,i=n.jws,s=i.JWS,o=s.readSafeJSONString,a=n.crypto,c=a.ECDSA,l=a.Mac,d=a.Signature,h;if(typeof pe!==void 0&&(h=pe),!s0(r))return!1;var u=r.split(".");if(u.length!==3)return!1;var f=u[0],g=u[1],m=f+"."+g,b=st(u[2]),v=o(Jr(u[0])),x=null,_=null;if(v.alg===void 0)throw"algorithm not specified in header";if(x=v.alg,_=x.substr(0,2),t!=null&&Object.prototype.toString.call(t)==="[object Array]"&&t.length>0){var A=":"+t.join(":")+":";if(A.indexOf(":"+x+":")==-1)throw"algorithm '"+x+"' not accepted in the list"}if(x!="none"&&e===null)throw"key shall be specified to verify.";if(typeof e=="string"&&e.indexOf("-----BEGIN ")!=-1&&(e=we.getKey(e)),(_=="RS"||_=="PS")&&!(e instanceof h))throw"key shall be a RSAKey obj for RS* and PS* algs";if(_=="ES"&&!(e instanceof c))throw"key shall be a ECDSA obj for ES* algs";x=="none";var D=null;if(s.jwsalg2sigalg[v.alg]===void 0)throw"unsupported alg name: "+x;if(D=s.jwsalg2sigalg[x],D=="none")throw"not supported";if(D.substr(0,4)=="Hmac"){var O=null;if(e===void 0)throw"hexadecimal key shall be specified for HMAC";var M=new l({alg:D,pass:e});return M.updateString(m),O=M.doFinal(),b==O}else if(D.indexOf("withECDSA")!=-1){var S=null;try{S=c.concatSigToASN1Sig(b)}catch{return!1}var E=new d({alg:D});return E.init(e),E.updateString(m),E.verify(S)}else{var E=new d({alg:D});return E.init(e),E.updateString(m),E.verify(b)}};p.jws.JWS.parse=function(r){var e=r.split("."),t={},n,i,s;if(e.length!=2&&e.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return n=e[0],i=e[1],e.length==3&&(s=e[2]),t.headerObj=p.jws.JWS.readSafeJSONString(Jr(n)),t.payloadObj=p.jws.JWS.readSafeJSONString(Jr(i)),t.headerPP=JSON.stringify(t.headerObj,null,"  "),t.payloadObj==null?t.payloadPP=Jr(i):t.payloadPP=JSON.stringify(t.payloadObj,null,"  "),s!==void 0&&(t.sigHex=st(s)),t};p.jws.JWS.verifyJWT=function(r,e,t){var n=p,i=n.jws,s=i.JWS,o=s.readSafeJSONString,a=s.inArray,c=s.includedArray;if(!s0(r))return!1;var l=r.split(".");if(l.length!=3)return!1;var d=l[0],h=l[1],u=d+"."+h,f=st(l[2]),g=o(Jr(d)),m=o(Jr(h));if(g.alg===void 0)return!1;if(t.alg===void 0)throw"acceptField.alg shall be specified";if(!a(g.alg,t.alg)||m.iss!==void 0&&typeof t.iss=="object"&&!a(m.iss,t.iss)||m.sub!==void 0&&typeof t.sub=="object"&&!a(m.sub,t.sub))return!1;if(m.aud!==void 0&&typeof t.aud=="object"){if(typeof m.aud=="string"){if(!a(m.aud,t.aud))return!1}else if(typeof m.aud=="object"&&!c(m.aud,t.aud))return!1}var b=i.IntDate.getNow();return t.verifyAt!==void 0&&typeof t.verifyAt=="number"&&(b=t.verifyAt),(t.gracePeriod===void 0||typeof t.gracePeriod!="number")&&(t.gracePeriod=0),!(m.exp!==void 0&&typeof m.exp=="number"&&m.exp+t.gracePeriod<b||m.nbf!==void 0&&typeof m.nbf=="number"&&b<m.nbf-t.gracePeriod||m.iat!==void 0&&typeof m.iat=="number"&&b<m.iat-t.gracePeriod||m.jti!==void 0&&t.jti!==void 0&&m.jti!==t.jti||!s.verify(r,e,t.alg))};p.jws.JWS.includedArray=function(r,e){var t=p.jws.JWS.inArray;if(r===null||typeof r!="object"||typeof r.length!="number")return!1;for(var n=0;n<r.length;n++)if(!t(r[n],e))return!1;return!0};p.jws.JWS.inArray=function(r,e){if(e===null||typeof e!="object"||typeof e.length!="number")return!1;for(var t=0;t<e.length;t++)if(e[t]==r)return!0;return!1};p.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"};p.jws.JWS.isSafeJSONString=function(r,e,t){var n=null;try{return n=oT(r),typeof n!="object"||n.constructor===Array?0:(e&&(e[t]=n),1)}catch{return 0}};p.jws.JWS.readSafeJSONString=function(r){var e=null;try{return e=oT(r),typeof e!="object"||e.constructor===Array?null:e}catch{return null}};p.jws.JWS.getEncodedSignatureValueFromJWS=function(r){var e=r.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(e==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return e[1]};p.jws.JWS.getJWKthumbprint=function(r){if(r.kty!=="RSA"&&r.kty!=="EC"&&r.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var e="{";if(r.kty==="RSA"){if(typeof r.n!="string"||typeof r.e!="string")throw"wrong n and e value for RSA key";e+='"e":"'+r.e+'",',e+='"kty":"'+r.kty+'",',e+='"n":"'+r.n+'"}'}else if(r.kty==="EC"){if(typeof r.crv!="string"||typeof r.x!="string"||typeof r.y!="string")throw"wrong crv, x and y value for EC key";e+='"crv":"'+r.crv+'",',e+='"kty":"'+r.kty+'",',e+='"x":"'+r.x+'",',e+='"y":"'+r.y+'"}'}else if(r.kty==="oct"){if(typeof r.k!="string")throw"wrong k value for oct(symmetric) key";e+='"kty":"'+r.kty+'",',e+='"k":"'+r.k+'"}'}var t=gn(e),n=p.crypto.Util.hashHex(t,"sha256"),i=_t(n);return i};p.jws.IntDate={};p.jws.IntDate.get=function(r){var e=p.jws.IntDate,t=e.getNow,n=e.getZulu;if(r=="now")return t();if(r=="now + 1hour")return t()+60*60;if(r=="now + 1day")return t()+60*60*24;if(r=="now + 1month")return t()+60*60*24*30;if(r=="now + 1year")return t()+60*60*24*365;if(r.match(/Z$/))return n(r);if(r.match(/^[0-9]+$/))return parseInt(r);throw"unsupported format: "+r};p.jws.IntDate.getZulu=function(r){return uT(r)};p.jws.IntDate.getNow=function(){var r=~~(new Date/1e3);return r};p.jws.IntDate.intDate2UTCString=function(r){var e=new Date(r*1e3);return e.toUTCString()};p.jws.IntDate.intDate2Zulu=function(r){var e=new Date(r*1e3),t=("0000"+e.getUTCFullYear()).slice(-4),n=("00"+(e.getUTCMonth()+1)).slice(-2),i=("00"+e.getUTCDate()).slice(-2),s=("00"+e.getUTCHours()).slice(-2),o=("00"+e.getUTCMinutes()).slice(-2),a=("00"+e.getUTCSeconds()).slice(-2);return t+n+i+s+o+a+"Z"};(typeof p>"u"||!p)&&(p={});(typeof p.jws>"u"||!p.jws)&&(p.jws={});p.jws.JWSJS=function(){var r=p,e=r.jws,t=e.JWS,n=t.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(i){this.init();var s=i.split(".");if(s.length!=3)throw"malformed input JWS";this.aHeader.push(s[0]),this.sPayload=s[1],this.aSignature.push(s[2])},this.addSignature=function(i,s,o,a){if(this.sPayload===void 0||this.sPayload===null)throw"there's no JSON-JS signature to add.";var c=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var l=p.jws.JWS.sign(i,s,this.sPayload,o,a),d=l.split("."),h=d[0],u=d[2];this.aHeader.push(d[0]),this.aSignature.push(d[2])}catch(f){throw this.aHeader.length>c&&this.aHeader.pop(),this.aSignature.length>c&&this.aSignature.pop(),"addSignature failed: "+f}},this.verifyAll=function(i){if(this.aHeader.length!==i.length||this.aSignature.length!==i.length)return!1;for(var s=0;s<i.length;s++){var o=i[s];if(o.length!==2)return!1;var a=this.verifyNth(s,o[0],o[1]);if(a===!1)return!1}return!0},this.verifyNth=function(i,s,o){if(this.aHeader.length<=i||this.aSignature.length<=i)return!1;var a=this.aHeader[i],c=this.aSignature[i],l=a+"."+this.sPayload+"."+c,d=!1;try{d=t.verify(l,s,o)}catch{return!1}return d},this.readJWSJS=function(i){if(typeof i=="string"){var s=n(i);if(s==null)throw"argument is not safe JSON object string";this.aHeader=s.headers,this.sPayload=s.payload,this.aSignature=s.signatures}else try{if(i.headers.length>0)this.aHeader=i.headers;else throw"malformed header";if(typeof i.payload=="string")this.sPayload=i.payload;else throw"malformed signatures";if(i.signatures.length>0)this.aSignature=i.signatures;else throw"malformed signatures"}catch(o){throw"malformed JWS-JS JSON object: "+o}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return this.aHeader.length==0?1:0}};Z.SecureRandom=Ro;Z.rng_seed_time=e0;Z.BigInteger=L;Z.RSAKey=pe;Z.ECDSA=p.crypto.ECDSA;Z.DSA=p.crypto.DSA;Z.Signature=p.crypto.Signature;Z.MessageDigest=p.crypto.MessageDigest;Z.Mac=p.crypto.Mac;Z.KEYUTIL=we;Z.ASN1HEX=Q;Z.X509=he;Z.X509CRL=tH;Z.CryptoJS=ee;Z.b64tohex=Io;Z.b64toBA=tT;Z.ECFieldElementFp=Tt;Z.ECPointFp=ke;Z.ECCurveFp=Bn;Z.stoBA=aT;Z.BAtos=cT;Z.BAtohex=Qh;Z.stohex=yr;Z.stob64=kz;Z.stob64u=Mz;Z.b64utos=Bz;Z.b64tob64u=Po;Z.b64utob64=wc;Z.hex2b64=Mn;Z.hextob64u=_t;Z.b64utohex=st;Z.utf8tob64u=xc;Z.b64utoutf8=Jr;Z.utf8tob64=qz;Z.b64toutf8=Lz;Z.utf8tohex=Zh;Z.hextoutf8=qe;Z.hextorstr=br;Z.rstrtohex=gn;Z.hextob64=t0;Z.hextob64nl=Hz;Z.b64nltohex=lT;Z.hextopem=Yt;Z.pemtohex=dt;Z.hextoArrayBuffer=Gz;Z.ArrayBuffertohex=Wz;Z.zulutomsec=r0;Z.msectozulu=Kz;Z.zulutosec=uT;Z.zulutodate=$z;Z.datetozulu=Jz;Z.uricmptohex=td;Z.hextouricmp=rd;Z.ipv6tohex=$g;Z.hextoipv6=Jg;Z.hextoip=Kh;Z.iptohex=n0;Z.ucs2hextoutf8=i0;Z.encodeURIComponentAll=nd;Z.newline_toUnix=Xz;Z.newline_toDos=Yz;Z.hextoposhex=Xg;Z.intarystrtohex=Qz;Z.strdiffidx=Zz;Z.oidtohex=fT;Z.hextooid=id;Z.strpad=$h;Z.bitstrtoint=mT;Z.inttobitstr=gT;Z.bitstrtobinstr=vT;Z.binstrtobitstr=eH;Z.isBase64URLDot=s0;Z.namearraytobinstr=Jh;Z.extendClass=U;Z.foldnl=ed;Z.b64topem=Vz;Z.pemtob64=Uz;Z.timeogen=hT;Z.aryval=Ke;Z.inttohex=pT;Z.twoscompl=Cc;Z.KJUR=p;Z.crypto=p.crypto;Z.asn1=p.asn1;Z.jws=p.jws;Z.lang=p.lang;Z.VERSION=uL;Z.VERSION_FULL=hL});var TT=R((Vce,_T)=>{"use strict";function rH(r,e){return Object.prototype.hasOwnProperty.call(r,e)}_T.exports=function(r,e,t,n){e=e||"&",t=t||"=";var i={};if(typeof r!="string"||r.length===0)return i;var s=/\+/g;r=r.split(e);var o=1e3;n&&typeof n.maxKeys=="number"&&(o=n.maxKeys);var a=r.length;o>0&&a>o&&(a=o);for(var c=0;c<a;++c){var l=r[c].replace(s,"%20"),d=l.indexOf(t),h,u,f,g;d>=0?(h=l.substr(0,d),u=l.substr(d+1)):(h=l,u=""),f=decodeURIComponent(h),g=decodeURIComponent(u),rH(i,f)?Array.isArray(i[f])?i[f].push(g):i[f]=[i[f],g]:i[f]=g}return i}});var DT=R((Uce,AT)=>{"use strict";var _c=function(r){switch(typeof r){case"string":return r;case"boolean":return r?"true":"false";case"number":return isFinite(r)?r:"";default:return""}};AT.exports=function(r,e,t,n){return e=e||"&",t=t||"=",r===null&&(r=void 0),typeof r=="object"?Object.keys(r).map(function(i){var s=encodeURIComponent(_c(i))+t;return Array.isArray(r[i])?r[i].map(function(o){return s+encodeURIComponent(_c(o))}).join(e):s+encodeURIComponent(_c(r[i]))}).filter(Boolean).join(e):n?encodeURIComponent(_c(n))+t+encodeURIComponent(_c(r)):""}});var FT=R(Tc=>{"use strict";Tc.decode=Tc.parse=TT();Tc.encode=Tc.stringify=DT()});var c0=R((a0,IT)=>{a0=IT.exports=nH;a0.getSerialize=PT;function nH(r,e,t,n){return JSON.stringify(r,PT(e,n),t)}function PT(r,e){var t=[],n=[];return e==null&&(e=function(i,s){return t[0]===s?"[Circular ~]":"[Circular ~."+n.slice(0,t.indexOf(s)).join(".")+"]"}),function(i,s){if(t.length>0){var o=t.indexOf(this);~o?t.splice(o+1):t.push(this),~o?n.splice(o,1/0,i):n.push(i),~t.indexOf(s)&&(s=e.call(this,i,s))}else t.push(s);return r==null?s:r.call(this,i,s)}}});var S5=R((zn,x5)=>{var b5=typeof self<"u"?self:zn,Pd=function(){function r(){this.fetch=!1,this.DOMException=b5.DOMException}return r.prototype=b5,new r}();(function(r){var e=function(t){var n={searchParams:"URLSearchParams"in r,iterable:"Symbol"in r&&"iterator"in Symbol,blob:"FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in r,arrayBuffer:"ArrayBuffer"in r};function i(w){return w&&DataView.prototype.isPrototypeOf(w)}if(n.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(w){return w&&s.indexOf(Object.prototype.toString.call(w))>-1};function a(w){if(typeof w!="string"&&(w=String(w)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(w))throw new TypeError("Invalid character in header field name");return w.toLowerCase()}function c(w){return typeof w!="string"&&(w=String(w)),w}function l(w){var T={next:function(){var F=w.shift();return{done:F===void 0,value:F}}};return n.iterable&&(T[Symbol.iterator]=function(){return T}),T}function d(w){this.map={},w instanceof d?w.forEach(function(T,F){this.append(F,T)},this):Array.isArray(w)?w.forEach(function(T){this.append(T[0],T[1])},this):w&&Object.getOwnPropertyNames(w).forEach(function(T){this.append(T,w[T])},this)}d.prototype.append=function(w,T){w=a(w),T=c(T);var F=this.map[w];this.map[w]=F?F+", "+T:T},d.prototype.delete=function(w){delete this.map[a(w)]},d.prototype.get=function(w){return w=a(w),this.has(w)?this.map[w]:null},d.prototype.has=function(w){return this.map.hasOwnProperty(a(w))},d.prototype.set=function(w,T){this.map[a(w)]=c(T)},d.prototype.forEach=function(w,T){for(var F in this.map)this.map.hasOwnProperty(F)&&w.call(T,this.map[F],F,this)},d.prototype.keys=function(){var w=[];return this.forEach(function(T,F){w.push(F)}),l(w)},d.prototype.values=function(){var w=[];return this.forEach(function(T){w.push(T)}),l(w)},d.prototype.entries=function(){var w=[];return this.forEach(function(T,F){w.push([F,T])}),l(w)},n.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);function h(w){if(w.bodyUsed)return Promise.reject(new TypeError("Already read"));w.bodyUsed=!0}function u(w){return new Promise(function(T,F){w.onload=function(){T(w.result)},w.onerror=function(){F(w.error)}})}function f(w){var T=new FileReader,F=u(T);return T.readAsArrayBuffer(w),F}function g(w){var T=new FileReader,F=u(T);return T.readAsText(w),F}function m(w){for(var T=new Uint8Array(w),F=new Array(T.length),N=0;N<T.length;N++)F[N]=String.fromCharCode(T[N]);return F.join("")}function b(w){if(w.slice)return w.slice(0);var T=new Uint8Array(w.byteLength);return T.set(new Uint8Array(w)),T.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(w){this._bodyInit=w,w?typeof w=="string"?this._bodyText=w:n.blob&&Blob.prototype.isPrototypeOf(w)?this._bodyBlob=w:n.formData&&FormData.prototype.isPrototypeOf(w)?this._bodyFormData=w:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)?this._bodyText=w.toString():n.arrayBuffer&&n.blob&&i(w)?(this._bodyArrayBuffer=b(w.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(w)||o(w))?this._bodyArrayBuffer=b(w):this._bodyText=w=Object.prototype.toString.call(w):this._bodyText="",this.headers.get("content-type")||(typeof w=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var w=h(this);if(w)return w;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var w=h(this);if(w)return w;if(this._bodyBlob)return g(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(m(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(D)}),this.json=function(){return this.text().then(JSON.parse)},this}var x=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function _(w){var T=w.toUpperCase();return x.indexOf(T)>-1?T:w}function A(w,T){T=T||{};var F=T.body;if(w instanceof A){if(w.bodyUsed)throw new TypeError("Already read");this.url=w.url,this.credentials=w.credentials,T.headers||(this.headers=new d(w.headers)),this.method=w.method,this.mode=w.mode,this.signal=w.signal,!F&&w._bodyInit!=null&&(F=w._bodyInit,w.bodyUsed=!0)}else this.url=String(w);if(this.credentials=T.credentials||this.credentials||"same-origin",(T.headers||!this.headers)&&(this.headers=new d(T.headers)),this.method=_(T.method||this.method||"GET"),this.mode=T.mode||this.mode||null,this.signal=T.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&F)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(F)}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function D(w){var T=new FormData;return w.trim().split("&").forEach(function(F){if(F){var N=F.split("="),P=N.shift().replace(/\+/g," "),I=N.join("=").replace(/\+/g," ");T.append(decodeURIComponent(P),decodeURIComponent(I))}}),T}function O(w){var T=new d,F=w.replace(/\r?\n[\t ]+/g," ");return F.split(/\r?\n/).forEach(function(N){var P=N.split(":"),I=P.shift().trim();if(I){var B=P.join(":").trim();T.append(I,B)}}),T}v.call(A.prototype);function M(w,T){T||(T={}),this.type="default",this.status=T.status===void 0?200:T.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in T?T.statusText:"OK",this.headers=new d(T.headers),this.url=T.url||"",this._initBody(w)}v.call(M.prototype),M.prototype.clone=function(){return new M(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},M.error=function(){var w=new M(null,{status:0,statusText:""});return w.type="error",w};var S=[301,302,303,307,308];M.redirect=function(w,T){if(S.indexOf(T)===-1)throw new RangeError("Invalid status code");return new M(null,{status:T,headers:{location:w}})},t.DOMException=r.DOMException;try{new t.DOMException}catch{t.DOMException=function(T,F){this.message=T,this.name=F;var N=Error(T);this.stack=N.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function E(w,T){return new Promise(function(F,N){var P=new A(w,T);if(P.signal&&P.signal.aborted)return N(new t.DOMException("Aborted","AbortError"));var I=new XMLHttpRequest;function B(){I.abort()}I.onload=function(){var q={status:I.status,statusText:I.statusText,headers:O(I.getAllResponseHeaders()||"")};q.url="responseURL"in I?I.responseURL:q.headers.get("X-Request-URL");var z="response"in I?I.response:I.responseText;F(new M(z,q))},I.onerror=function(){N(new TypeError("Network request failed"))},I.ontimeout=function(){N(new TypeError("Network request failed"))},I.onabort=function(){N(new t.DOMException("Aborted","AbortError"))},I.open(P.method,P.url,!0),P.credentials==="include"?I.withCredentials=!0:P.credentials==="omit"&&(I.withCredentials=!1),"responseType"in I&&n.blob&&(I.responseType="blob"),P.headers.forEach(function(q,z){I.setRequestHeader(z,q)}),P.signal&&(P.signal.addEventListener("abort",B),I.onreadystatechange=function(){I.readyState===4&&P.signal.removeEventListener("abort",B)}),I.send(typeof P._bodyInit>"u"?null:P._bodyInit)})}return E.polyfill=!0,r.fetch||(r.fetch=E,r.Headers=d,r.Request=A,r.Response=M),t.Headers=d,t.Request=A,t.Response=M,t.fetch=E,Object.defineProperty(t,"__esModule",{value:!0}),t}({})})(Pd);Pd.fetch.ponyfill=!0;delete Pd.fetch.polyfill;var qo=Pd;zn=qo.fetch;zn.default=qo.fetch;zn.fetch=qo.fetch;zn.Headers=qo.Headers;zn.Request=qo.Request;zn.Response=qo.Response;x5.exports=zn});var E5=R((vde,C5)=>{"use strict";C5.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var A5=R(F0=>{"use strict";var IH=Object.prototype.hasOwnProperty,OH;function _5(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch{return null}}function T5(r){try{return encodeURIComponent(r)}catch{return null}}function NH(r){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},n;n=e.exec(r);){var i=_5(n[1]),s=_5(n[2]);i===null||s===null||i in t||(t[i]=s)}return t}function RH(r,e){e=e||"";var t=[],n,i;typeof e!="string"&&(e="?");for(i in r)if(IH.call(r,i)){if(n=r[i],!n&&(n===null||n===OH||isNaN(n))&&(n=""),i=T5(i),n=T5(n),i===null||n===null)continue;t.push(i+"="+n)}return t.length?e+t.join("&"):""}F0.stringify=RH;F0.parse=NH});var k5=R((bde,R5)=>{"use strict";var F5=E5(),Rd=A5(),kH=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,P5=/[\n\r\t]/g,MH=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,I5=/:\d+$/,BH=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,qH=/^[a-zA-Z]:/;function I0(r){return(r||"").toString().replace(kH,"")}var P0=[["#","hash"],["?","query"],function(e,t){return vn(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],D5={hash:1,query:1};function O5(r){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};r=r||t;var n={},i=typeof r,s;if(r.protocol==="blob:")n=new yn(unescape(r.pathname),{});else if(i==="string"){n=new yn(r,{});for(s in D5)delete n[s]}else if(i==="object"){for(s in r)s in D5||(n[s]=r[s]);n.slashes===void 0&&(n.slashes=MH.test(r.href))}return n}function vn(r){return r==="file:"||r==="ftp:"||r==="http:"||r==="https:"||r==="ws:"||r==="wss:"}function N5(r,e){r=I0(r),r=r.replace(P5,""),e=e||{};var t=BH.exec(r),n=t[1]?t[1].toLowerCase():"",i=!!t[2],s=!!t[3],o=0,a;return i?s?(a=t[2]+t[3]+t[4],o=t[2].length+t[3].length):(a=t[2]+t[4],o=t[2].length):s?(a=t[3]+t[4],o=t[3].length):a=t[4],n==="file:"?o>=2&&(a=a.slice(2)):vn(n)?a=t[4]:n?i&&(a=a.slice(2)):o>=2&&vn(e.protocol)&&(a=t[4]),{protocol:n,slashes:i||vn(n),slashesCount:o,rest:a}}function LH(r,e){if(r==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(r.split("/")),n=t.length,i=t[n-1],s=!1,o=0;n--;)t[n]==="."?t.splice(n,1):t[n]===".."?(t.splice(n,1),o++):o&&(n===0&&(s=!0),t.splice(n,1),o--);return s&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function yn(r,e,t){if(r=I0(r),r=r.replace(P5,""),!(this instanceof yn))return new yn(r,e,t);var n,i,s,o,a,c,l=P0.slice(),d=typeof e,h=this,u=0;for(d!=="object"&&d!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=Rd.parse),e=O5(e),i=N5(r||"",e),n=!i.protocol&&!i.slashes,h.slashes=i.slashes||n&&e.slashes,h.protocol=i.protocol||e.protocol||"",r=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||qH.test(r))||!i.slashes&&(i.protocol||i.slashesCount<2||!vn(h.protocol)))&&(l[3]=[/(.*)/,"pathname"]);u<l.length;u++){if(o=l[u],typeof o=="function"){r=o(r,h);continue}s=o[0],c=o[1],s!==s?h[c]=r:typeof s=="string"?(a=s==="@"?r.lastIndexOf(s):r.indexOf(s),~a&&(typeof o[2]=="number"?(h[c]=r.slice(0,a),r=r.slice(a+o[2])):(h[c]=r.slice(a),r=r.slice(0,a)))):(a=s.exec(r))&&(h[c]=a[1],r=r.slice(0,a.index)),h[c]=h[c]||n&&o[3]&&e[c]||"",o[4]&&(h[c]=h[c].toLowerCase())}t&&(h.query=t(h.query)),n&&e.slashes&&h.pathname.charAt(0)!=="/"&&(h.pathname!==""||e.pathname!=="")&&(h.pathname=LH(h.pathname,e.pathname)),h.pathname.charAt(0)!=="/"&&vn(h.protocol)&&(h.pathname="/"+h.pathname),F5(h.port,h.protocol)||(h.host=h.hostname,h.port=""),h.username=h.password="",h.auth&&(a=h.auth.indexOf(":"),~a?(h.username=h.auth.slice(0,a),h.username=encodeURIComponent(decodeURIComponent(h.username)),h.password=h.auth.slice(a+1),h.password=encodeURIComponent(decodeURIComponent(h.password))):h.username=encodeURIComponent(decodeURIComponent(h.auth)),h.auth=h.password?h.username+":"+h.password:h.username),h.origin=h.protocol!=="file:"&&vn(h.protocol)&&h.host?h.protocol+"//"+h.host:"null",h.href=h.toString()}function jH(r,e,t){var n=this;switch(r){case"query":typeof e=="string"&&e.length&&(e=(t||Rd.parse)(e)),n[r]=e;break;case"port":n[r]=e,F5(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[r]="");break;case"hostname":n[r]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[r]=e,I5.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!t;break;case"pathname":case"hash":if(e){var i=r==="pathname"?"/":"#";n[r]=e.charAt(0)!==i?i+e:e}else n[r]=e;break;case"username":case"password":n[r]=encodeURIComponent(e);break;case"auth":var s=e.indexOf(":");~s?(n.username=e.slice(0,s),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=e.slice(s+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(e))}for(var o=0;o<P0.length;o++){var a=P0[o];a[4]&&(n[a[1]]=n[a[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin=n.protocol!=="file:"&&vn(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function zH(r){(!r||typeof r!="function")&&(r=Rd.stringify);var e,t=this,n=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var s=i+(t.protocol&&t.slashes||vn(t.protocol)?"//":"");return t.username?(s+=t.username,t.password&&(s+=":"+t.password),s+="@"):t.password?(s+=":"+t.password,s+="@"):t.protocol!=="file:"&&vn(t.protocol)&&!n&&t.pathname!=="/"&&(s+="@"),(n[n.length-1]===":"||I5.test(t.hostname)&&!t.port)&&(n+=":"),s+=n+t.pathname,e=typeof t.query=="object"?r(t.query):t.query,e&&(s+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(s+=t.hash),s}yn.prototype={set:jH,toString:zH};yn.extractProtocol=N5;yn.location=O5;yn.trimLeft=I0;yn.qs=Rd;R5.exports=yn});var B5=J(()=>{});var q5=J(()=>{});var L5=J(()=>{});var j5,z5,H5=J(()=>{j5=function(r){return r.NoOp="noop",r.ClientJoin="join",r.ClientLeave="leave",r.Propose="propose",r.Reject="reject",r.Summarize="summarize",r.SummaryAck="summaryAck",r.SummaryNack="summaryNack",r.Operation="op",r.RemoteHelp="remoteHelp",r.NoClient="noClient",r.RoundTrip="tripComplete",r.Control="control",r}(j5||{}),z5=function(r){return r.ThrottlingError="ThrottlingError",r.InvalidScopeError="InvalidScopeError",r.BadRequestError="BadRequestError",r.LimitExceededError="LimitExceededError",r}(z5||{})});var V5,U5,G5=J(()=>{V5=function(r){return r.File="100644",r.Executable="100755",r.Directory="040000",r.Symlink="120000",r}(V5||{}),U5=function(r){return r.Blob="Blob",r.Tree="Tree",r.Attachment="Attachment",r}(U5||{})});var W5,K5=J(()=>{W5=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(W5||{})});var $5=J(()=>{});var J5=J(()=>{});var X5,Y5=J(()=>{X5=function(r){return r.DocRead="doc:read",r.DocWrite="doc:write",r.SummaryWrite="summary:write",r}(X5||{})});var Q5=J(()=>{});var M0={};Pi(M0,{FileMode:()=>V5,MessageType:()=>j5,NackErrorType:()=>z5,ScopeType:()=>X5,SummaryType:()=>W5,TreeEntry:()=>U5});var B0=J(()=>{B5();q5();L5();H5();G5();K5();$5();J5();Y5();Q5();});var Z5=R(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.generateUser=Lo.generateToken=void 0;var WH=ST(),q0=(Dt(),Ht(Aa));function KH(r,e,t,n,i,s=60*60,o="1.0"){let a=i||L0();(a.id===""||a.id===void 0)&&(a=L0());let c=Math.round(Date.now()/1e3),d={documentId:n??"",scopes:t,tenantId:r,user:a,iat:c,exp:c+s,ver:o,jti:(0,q0.v4)()},h={utf8:e};return WH.KJUR.jws.JWS.sign(null,JSON.stringify({alg:"HS256",typ:"JWT"}),d,h)}Lo.generateToken=KH;function L0(){return{id:(0,q0.v4)(),name:(0,q0.v4)()}}Lo.generateUser=L0});var tA=R(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.InsecureTokenProvider=void 0;var jo=(B0(),Ht(M0)),eA=Z5(),j0=class{constructor(e,t,n){this.tenantKey=e,this.user=t,this.scopes=n}fetchOrdererToken(e,t){return y(this,null,function*(){var n;return{fromCache:!0,jwt:(0,eA.generateToken)(e,this.tenantKey,(n=this.scopes)!==null&&n!==void 0?n:[jo.ScopeType.DocRead,jo.ScopeType.DocWrite,jo.ScopeType.SummaryWrite],t,this.user)}})}fetchStorageToken(e,t){return y(this,null,function*(){var n;return{fromCache:!0,jwt:(0,eA.generateToken)(e,this.tenantKey,(n=this.scopes)!==null&&n!==void 0?n:[jo.ScopeType.DocRead,jo.ScopeType.DocWrite,jo.ScopeType.SummaryWrite],t,this.user)}})}};qd.InsecureTokenProvider=j0});var nA=R(Ld=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});Ld.MockFluidDataStoreContext=void 0;var $H=(xe(),Ht(Ap)),rA=(Dt(),Ht(Aa)),z0=class{constructor(e=(0,rA.v4)(),t=!1,n=$H.DebugLogger.create("fluid:MockFluidDataStoreContext")){this.id=e,this.existing=t,this.logger=n,this.documentId=void 0,this.isLocalDataStore=!0,this.packagePath=void 0,this.options=void 0,this.clientId=(0,rA.v4)(),this.clientDetails=void 0,this.connected=!0,this.deltaManager=void 0,this.containerRuntime=void 0,this.storage=void 0,this.IFluidDataStoreRegistry=void 0,this.IFluidHandleContext=void 0,this.attachState=void 0,this.scope=void 0}on(e,t){switch(e){case"attaching":case"attached":return this;default:throw new Error("Method not implemented.")}}once(e,t){return this}off(e,t){throw new Error("Method not implemented.")}getQuorum(){}getAudience(){}submitMessage(e,t,n){throw new Error("Method not implemented.")}submitSignal(e,t){throw new Error("Method not implemented.")}bindToContext(){throw new Error("Method not implemented.")}setChannelDirty(e){throw new Error("Method not implemented.")}getAbsoluteUrl(e){return y(this,null,function*(){throw new Error("Method not implemented.")})}getCreateChildSummarizerNodeFn(e,t){throw new Error("Method not implemented.")}uploadBlob(e){return y(this,null,function*(){throw new Error("Method not implemented.")})}getInitialGCSummaryDetails(){return y(this,null,function*(){throw new Error("Method not implemented.")})}getBaseGCDetails(){return y(this,null,function*(){throw new Error("Method not implemented.")})}};Ld.MockFluidDataStoreContext=z0});var V0=R(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.MockDeltaManager=Ho.MockDeltaQueue=void 0;var JH=Wn(),iA=(te(),Ht(ba)),zo=class extends JH.EventEmitter{constructor(){super(),this.queue=[],this.pauseCount=0,this.processCallback=()=>{}}get disposed(){}get paused(){return this.pauseCount!==0}get length(){return this.queue.length}get idle(){return this.queue.length===0}process(){Promise.resolve().then(()=>{for(;this.pauseCount===0&&this.length>0;){let e=this.pop();(0,iA.assert)(e!==void 0,"this is impossible due to the above length check"),this.processCallback(e)}})}push(e){this.queue.push(e),this.emit("push",e),this.process()}pop(){return this.queue.shift()}pause(){return y(this,null,function*(){this.pauseCount++})}resume(){this.pauseCount--,this.process()}peek(){return this.queue[0]}toArray(){return this.queue}dispose(){}waitTillProcessingDone(){return y(this,null,function*(){throw new Error("NYI")})}};Ho.MockDeltaQueue=zo;var H0=class extends iA.TypedEventEmitter{constructor(){super(),this.readOnlyInfo={readonly:!1},this.clientType=void 0,this.clientDetails=void 0,this._inbound=void 0,this._inboundSignal=void 0,this._outbound=void 0,this.minimumSequenceNumber=0,this.lastSequenceNumber=0,this.lastKnownSeqNumber=0,this.initialSequenceNumber=0,this.hasCheckpointSequenceNumber=!1,this._inbound=new zo,this._outbound=new zo,this._inboundSignal=new zo}get disposed(){}get IDeltaSender(){return this}get inbound(){return this._inbound}get outbound(){return this._outbound}get inboundSignal(){return this._inboundSignal}get version(){}get maxMessageSize(){return 0}get serviceConfiguration(){}get active(){return!0}close(){}submitSignal(e){}flush(){}submit(e,t,n=!1,i){return 0}dispose(){}};Ho.MockDeltaManager=H0});var sA=R(jd=>{"use strict";Object.defineProperty(jd,"__esModule",{value:!0});jd.MockHandle=void 0;var U0=(Pt(),Ht(ig)),G0=class{constructor(e,t=`mock-handle-${Math.random().toString(36).slice(2)}`,n=`/${t}`){this.value=e,this.path=t,this.absolutePath=n,this.graphAttachState=U0.AttachState.Detached}get IFluidHandle(){return this}get isAttached(){return this.graphAttachState===U0.AttachState.Attached}get(){return y(this,null,function*(){return this.value})}attachGraph(){this.graphAttachState=U0.AttachState.Attached}bind(){throw Error("MockHandle.bind() unimplemented.")}};jd.MockHandle=G0});var Y0=R(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.MockSharedObjectServices=Nt.MockObjectStorageService=Nt.MockEmptyDeltaConnection=Nt.MockFluidDataStoreRuntime=Nt.MockQuorumClients=Nt.MockContainerRuntimeFactory=Nt.MockContainerRuntime=Nt.MockDeltaConnection=void 0;var aA=Wn(),Wd=(te(),Ht(ba)),oA=(Pt(),Ht(ig)),XH=(xe(),Ht(Ap)),zd=(B0(),Ht(M0)),W0=(at(),Ht(rg)),K0=(Dt(),Ht(Aa)),cA=V0(),Hd=class{constructor(e,t){this.submitFn=e,this.dirtyFn=t,this._connected=!0}get connected(){return this._connected}attach(e){this.handler=e,e.setConnectionState(this.connected)}submit(e,t){return this.submitFn(e,t)}dirty(){this.dirtyFn()}setConnectionState(e){var t;this._connected=e,(t=this.handler)===null||t===void 0||t.setConnectionState(e)}process(e,t,n){var i;(i=this.handler)===null||i===void 0||i.process(e,t,n)}reSubmit(e,t){var n;(n=this.handler)===null||n===void 0||n.reSubmit(e,t)}};Nt.MockDeltaConnection=Hd;var Vd=class{constructor(e,t){var n;this.dataStoreRuntime=e,this.factory=t,this.clientSequenceNumber=0,this.deltaConnections=[],this.pendingMessages=[],this.deltaManager=new cA.MockDeltaManager,this.dataStoreRuntime.deltaManager=this.deltaManager,this.dataStoreRuntime.quorum=t.quorum,this.clientId=(n=this.dataStoreRuntime.clientId)!==null&&n!==void 0?n:(0,K0.v4)(),t.quorum.addMember(this.clientId,{})}createDeltaConnection(){let e=new Hd((t,n)=>this.submit(t,n),()=>this.dirty());return this.deltaConnections.push(e),e}submit(e,t){let n=this.clientSequenceNumber++,i={clientId:this.clientId,clientSequenceNumber:n,contents:e,referenceSequenceNumber:this.deltaManager.lastSequenceNumber,type:zd.MessageType.Operation};return this.factory.pushMessage(i),this.addPendingMessage(e,t,n),n}dirty(){}process(e){this.deltaManager.lastSequenceNumber=e.sequenceNumber,this.deltaManager.lastMessage=e,this.deltaManager.minimumSequenceNumber=e.minimumSequenceNumber;let[t,n]=this.processInternal(e);this.deltaConnections.forEach(i=>{i.process(e,t,n)})}addPendingMessage(e,t,n){let i={content:e,clientSequenceNumber:n,localOpMetadata:t};this.pendingMessages.push(i)}processInternal(e){let t,n=this.clientId===e.clientId;if(n){let i=this.pendingMessages.shift();(0,Wd.assert)(i?.clientSequenceNumber===e.clientSequenceNumber,"Unexpected client sequence number from message"),t=i.localOpMetadata}return[n,t]}};Nt.MockContainerRuntime=Vd;var $0=class{constructor(){this.sequenceNumber=0,this.minSeq=new Map,this.quorum=new Hc,this.messages=[],this.runtimes=[]}get outstandingMessageCount(){return this.messages.length}getMinSeq(){let e;for(let[t,n]of this.minSeq)this.quorum.getMember(t)!==void 0&&(e=e===void 0?n:Math.min(e,n));return e??0}createContainerRuntime(e){let t=new Vd(e,this);return this.runtimes.push(t),t}pushMessage(e){e.clientId&&e.referenceSequenceNumber!==void 0&&!this.minSeq.has(e.clientId)&&this.minSeq.set(e.clientId,e.referenceSequenceNumber),this.messages.push(e)}processOneMessage(){if(this.messages.length===0)throw new Error("Tried to process a message that did not exist");let e=this.messages.shift();e=JSON.parse(JSON.stringify(e)),this.minSeq.set(e.clientId,e.referenceSequenceNumber),e.sequenceNumber=++this.sequenceNumber,e.minimumSequenceNumber=this.getMinSeq();for(let t of this.runtimes)t.process(e)}processSomeMessages(e){if(e>this.messages.length)throw new Error("Tried to process more messages than exist");for(let t=0;t<e;t++)this.processOneMessage()}processAllMessages(){for(;this.messages.length>0;)this.processOneMessage()}};Nt.MockContainerRuntimeFactory=$0;var Hc=class{constructor(...e){var t;this.eventEmitter=new aA.EventEmitter,this.disposed=!1,this.members=new Map((t=e)!==null&&t!==void 0?t:[])}addMember(e,t){this.members.set(e,t),this.eventEmitter.emit("addMember",e,t)}removeMember(e){this.members.delete(e)&&this.eventEmitter.emit("removeMember",e)}getMembers(){return this.members}getMember(e){return this.getMembers().get(e)}dispose(){throw new Error("Method not implemented.")}addListener(e,t){throw new Error("Method not implemented.")}on(e,t){switch(e){case"afterOn":return this.eventEmitter.on(e,t),this;case"addMember":case"removeMember":return this.eventEmitter.on(e,t),this.eventEmitter.emit("afterOn",e),this;default:throw new Error("Method not implemented.")}}once(e,t){throw new Error("Method not implemented.")}prependListener(e,t){throw new Error("Method not implemented.")}prependOnceListener(e,t){throw new Error("Method not implemented.")}removeListener(e,t){return this.eventEmitter.removeListener(e,t),this}off(e,t){return this.eventEmitter.off(e,t),this}removeAllListeners(e){throw new Error("Method not implemented.")}setMaxListeners(e){throw new Error("Method not implemented.")}getMaxListeners(){throw new Error("Method not implemented.")}listeners(e){throw new Error("Method not implemented.")}rawListeners(e){throw new Error("Method not implemented.")}emit(e,...t){throw new Error("Method not implemented.")}eventNames(){throw new Error("Method not implemented.")}listenerCount(e){throw new Error("Method not implemented.")}};Nt.MockQuorumClients=Hc;var J0=class extends aA.EventEmitter{constructor(){super(...arguments),this.documentId=void 0,this.id=(0,K0.v4)(),this.existing=void 0,this.options={},this.clientId=(0,K0.v4)(),this.path="",this.connected=!0,this.deltaManager=new cA.MockDeltaManager,this.loader=void 0,this.logger=XH.DebugLogger.create("fluid:MockFluidDataStoreRuntime"),this.quorum=new Hc,this._local=!1,this._disposed=!1}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get IFluidRouter(){return this}get absolutePath(){return`/${this.id}`}get local(){return this._local}set local(e){this._local=e}get disposed(){return this._disposed}dispose(){this._disposed=!0}getChannel(e){return y(this,null,function*(){return null})}createChannel(e,t){return null}get isAttached(){return!this.local}get attachState(){return this.local?oA.AttachState.Detached:oA.AttachState.Attached}bindChannel(e){}attachGraph(){}bindToContext(){}bind(e){}getQuorum(){return this.quorum}getAudience(){return null}save(e){}close(){return y(this,null,function*(){})}uploadBlob(e){return y(this,null,function*(){return null})}getBlob(e){return y(this,null,function*(){return null})}submitMessage(e,t){return null}submitSignal(e,t){return null}process(e,t){}processSignal(e,t){}updateMinSequenceNumber(e){}setConnectionState(e,t){}resolveHandle(e){return y(this,null,function*(){return this.request(e)})}request(e){return y(this,null,function*(){return null})}addedGCOutboundReference(e,t){}summarize(e,t){return y(this,null,function*(){let n=(0,W0.mergeStats)();return n.treeNodeCount++,{summary:{type:zd.SummaryType.Tree,tree:{}},stats:n}})}getGCData(){return y(this,null,function*(){return{gcNodes:{}}})}updateUsedRoutes(e,t){}getAttachSnapshot(){return[]}getAttachSummary(){let e=(0,W0.mergeStats)();return e.treeNodeCount++,{summary:{type:zd.SummaryType.Tree,tree:{}},stats:e}}setAttachState(e){}waitAttached(){return y(this,null,function*(){})}requestDataStore(e){return y(this,null,function*(){return null})}reSubmit(e,t){}applyStashedOp(e){return y(this,null,function*(){})}rollback(e,t){}};Nt.MockFluidDataStoreRuntime=J0;var Ud=class{constructor(){this.connected=!1}attach(e){}submit(e){return(0,Wd.assert)(!1,"Throw submit error on mock empty delta connection"),0}dirty(){}};Nt.MockEmptyDeltaConnection=Ud;var Gd=class{constructor(e){this.contents=e}readBlob(e){return y(this,null,function*(){return(0,Wd.stringToBuffer)(this.contents[e],"utf8")})}contains(e){return y(this,null,function*(){return this.contents[e]!==void 0})}list(e){return y(this,null,function*(){let t=(0,W0.getNormalizedObjectStoragePathParts)(e).length;return Object.keys(this.contents).filter(n=>n.startsWith(e)&&n.split("/").length===t+1)})}};Nt.MockObjectStorageService=Gd;var X0=class r{constructor(e){this.deltaConnection=new Ud,this.objectStorage=new Gd(e)}static createFromSummary(e){let t={};for(let[n,i]of Object.entries(e.tree))(0,Wd.assert)(i.type===zd.SummaryType.Blob,"Unexpected summary type on mock createFromSummary"),t[n]=i.content;return new r(t)}};Nt.MockSharedObjectServices=X0});var uA=R(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.MockContainerRuntimeFactoryForReconnection=Vo.MockContainerRuntimeForReconnection=void 0;var YH=(Dt(),Ht(Aa)),QH=(te(),Ht(ba)),lA=Y0(),Kd=class extends lA.MockContainerRuntime{constructor(e,t){super(e,t),this.pendingRemoteMessages=[],this._connected=!0}get connected(){return this._connected}set connected(e){if(this._connected!==e){if(this._connected=e,e){for(let t of this.pendingRemoteMessages)this.process(t);this.pendingRemoteMessages.length=0,this.clientSequenceNumber=0,this.clientId=(0,YH.v4)(),this.dataStoreRuntime.clientId=this.clientId,this.factory.quorum.addMember(this.clientId,{}),this.reSubmitMessages()}else this.factory.clearOutstandingClientMessages(this.clientId),this.factory.quorum.removeMember(this.clientId);this.deltaConnections.forEach(t=>{t.setConnectionState(this.connected)})}}process(e){this.connected?super.process(e):this.pendingRemoteMessages.push(e)}submit(e,t){return this.connected?super.submit(e,t):(this.addPendingMessage(e,t,-1),-1)}reSubmitMessages(){let e=this.pendingMessages.length;for(;e>0;){let t=this.pendingMessages.shift();(0,QH.assert)(t!==void 0,"this is impossible due to the above length check"),this.deltaConnections.forEach(n=>{n.reSubmit(t.content,t.localOpMetadata)}),e--}}};Vo.MockContainerRuntimeForReconnection=Kd;var Q0=class extends lA.MockContainerRuntimeFactory{createContainerRuntime(e){let t=new Kd(e,this);return this.runtimes.push(t),t}clearOutstandingClientMessages(e){this.messages=this.messages.filter(t=>t.clientId!==e)}};Vo.MockContainerRuntimeFactoryForReconnection=Q0});var dA=R($d=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});$d.MockStorage=void 0;var Z0=(te(),Ht(ba)),hA=(at(),Ht(rg)),ev=class r{constructor(e){this.tree=e}static createFromSummary(e){let t=(0,hA.convertSummaryTreeToITree)(e);return new r(t)}static readBlobCore(e,t){if(e){for(let n of e.entries)if(n.path===t[0])return n.type==="Blob"?((0,Z0.assert)(t.length===1,JSON.stringify(Object.assign({},arguments))),n.value):n.type==="Tree"?r.readBlobCore(n.value,t.slice(1)):void 0;return}}readBlob(e){return y(this,null,function*(){let t=r.readBlobCore(this.tree,e.split("/"));return(0,Z0.assert)(t!==void 0,`Blob does not exist: ${e}`),(0,Z0.stringToBuffer)(t.contents,t.encoding)})}contains(e){return y(this,null,function*(){return r.readBlobCore(this.tree,e.split("/"))!==void 0})}list(e){return y(this,null,function*(){return(0,hA.listBlobsAtTreePath)(this.tree,e)})}};$d.MockStorage=ev});var fA=R(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});Jd.shortCodeMap=void 0;Jd.shortCodeMap={"0x000":"nonzero isobuffer byte offset","0x001":"unexpected isobuffer byte length","0x003":"Primary to add to range < last primary!","0x004":"Secondary to add to range < last secondary!","0x005":"Target primary to retrieve < first range's primary!","0x006":"Target primary to retrieve < last range's primary!","0x007":"Target primary to update < first range's primary!","0x008":"Target primary to update < last range's primary!","0x009":"After update, target primary is not first range's primary!","0x00a":"Running timer missing handler","0x00b":"Handler executed without deferred","0x00c":"messageId is incorrect from from the local client's ACK","0x00d":"Missing message handler for message type","0x00e":"Missing message handler for message type","0x00f":"pendingMessageId is missing from the local client's operation","0x010":"Received out of order storage op when there is an unackd clear message","0x011":"pendingMessageId is missing from the local client's operation","0x012":"pendingMessageId is missing from the local client's operation","0x013":"Received out of order op when there is an unackd clear message","0x014":"pendingMessageId is missing from the local client's operation","0x015":"pendingMessageId is missing from the local client's clear operation","0x016":"apply stashed op not implemented for custom value type ops","0x017":"Trying to add invalid handle!","0x018":"Trying to insert handle into position with already valid handle!","0x019":"SharedMatrix.openUndo() supports at most a single IUndoConsumer.","0x01a":"Trying to set out-of-bounds cell!","0x01b":"Trying to set multiple out-of-bounds cells!","0x01c":"The 'localSeq' of the vector submitting an op must >= the 'localSeq' of the other vector.","0x01d":"Trying to submit message to runtime while detached!","0x01e":"Row and col collab window 'localSeq' desynchronized!","0x01f":"Row and col collab window 'collaborating' status desynchronized!","0x020":"Unknown SharedMatrix 'op' type.","0x021":"SharedMatrix message contents have unexpected type!","0x022":"SharedMatrix row and/or col handles are invalid!","0x023":"The 'localSeq' of pending write (if any) must be <= the localSeq of the currently processed op.","0x024":"Start of PermutationSegment already allocated!","0x025":"Trying to set start of PermutationSegment to invalid handle!","0x026":"Trying to split segment at out-of-bounds position!","0x027":"Trying to get handle of out-of-bounds position!","0x028":"'localSeq' for op being resubmitted must be <= the 'localSeq' of the last submitted op.","0x029":"Invalid handle at start of containing segment!","0x02a":"On vector undo, unexpected 'currentOp' type/state!","0x02b":"Must not nest calls to IRevertible.revert()","0x02c":"On cellSet(), invalid row and/or column handles!","0x02d":"Unexpected op type on range remove!","0x02e":"Unexpected op type on range annotate!","0x02f":"Unexpected op type on range insert!","0x030":"Incoming remote op sequence# <= local collabWindow's currentSequence#","0x031":"Incoming remote op minSequence# < local collabWindow's minSequence#","0x032":"localSeq greater than collab window","0x033":"Segment group undefined","0x034":"Segment group not at head of merge tree pending queue","0x035":"Segment group not at head of segment pending queue","0x036":"Segment has no pending properties","0x037":"Segment already has assigned sequence number","0x038":"Incoming op sequence# < local collabWindow's currentSequence#","0x039":"Incoming op sequence# < minSequence#","0x03a":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03b":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03c":"Reset op has 'group' delta type!","0x03d":"segmentGroup is array rather than singleton!","0x03e":"minSeq mismatch between collab window and delta manager!","0x03f":"New format should not emit catchup ops","0x040":"Child count is not within [1,7] range!","0x041":"Unexpected child ordinal length!","0x043":"On ack, unexpected segmentGroup!","0x044":"On annotate ack, missing segment property manager!","0x045":"On insert, seq number already assigned!","0x046":"On remove ack, missing removal info!","0x048":"onMinGE()","0x049":"Trying to reload from segments while collaborating!","0x04f":"minSeq of collab window > target minSeq!","0x050":"Next segment changes are undefined!","0x051":"Too many children on merge block!","0x054":"Sequence number less than minSeq!","0x055":"Sequence number is not sorted!","0x056":"Unexpected total for accumulation of all seglen adjustments!","0x057":"Negative length after length adjustment!","0x058":"Both overlapRemoveClients and clientPartials are set!","0x059":"Client view exists but flat view does not!","0x05a":"Mismatch between number of partial lengths on client and flat views!","0x05b":"Flat view exists but client view does not!","0x05c":"Trying to update more annotate props than do exist!","0x05d":"emit: mismatch in segmentsTotalLength","0x05e":"emit: mismatch in totalSegmentCount","0x05f":"Missing blob header on legacy snapshot!","0x060":"There should be only one blob with catch up ops","0x061":"Mismatch in totalLength","0x062":"Mismatch in totalSegmentCount","0x063":"Mismatch in totalLength","0x064":"Mismatch in totalSegmentCount","0x065":"On removal info preservation, segment has invalid removed sequence number!","0x066":"Corrupted preservation of segment metadata!","0x067":"Missing clientId for removal!","0x068":"On consensusOrderedCollection load, job tracking size > 0","0x069":"On consensusOrderedCollection load, data size > 0","0x06a":"Trying to submit message while detached!","0x06b":"Loading snapshot into a non-empty collection","0x06c":"Value should be undefined or non-empty","0x06d":"SharedObjects contained in ConsensusRegisterCollection can no longer be deserialized as of 0.17","0x06e":"Message's reference sequence number < op's reference sequence number!","0x06f":"data missing for non-atomic inbound update!","0x070":"sequence numbers are expected to be 0 when unattached","0x071":"Versions should naturally be ordered by sequenceNumber","0x072":"Unexpected local op when loading not finished","0x073":"Sequence message not operation","0x074":"Snapshot called when not fully loaded","0x075":"SummarySerializer should be used for serializing data during summary.","0x078":"Possible re-entrancy! Summary should not already be in progress.","0x079":"Possible re-entrancy! Summary should have been in progress.","0x07a":"Services should be there to attach delta handler","0x07b":"Unexpected op","0x07c":"Unexpected op type","0x07d":"Unexpected op","0x07e":"Unexpected op type","0x07f":"clientId undefined","0x080":"Invalid document service!","0x081":"Document service already set!","0x082":"Document storage service already set!","0x083":"User selection status does not match replay controller use status!","0x084":"On storage resolve, user selection already made!","0x085":"On storage resolve, missing storage!","0x086":"After storage resolve, user selection status still false!","0x088":"Missing button ops button!","0x089":"Stringified length of chunk contents > total starting length","0x08a":"resetting ChunkedOpProcessor that never wrote back its contents","0x08b":"Unexpected type on contents for fix of an attach!","0x08c":"innerContent for fixing op contents is undefined!","0x08d":"After sanitize, pending incomplete ops!","0x08e":"Potentially missed initial messages","0x08f":"No op handler is setup!","0x090":"No signal handler is setup!","0x091":"Retrieved ops' first sequence number has unexpected value!","0x092":"version input for reading snapshot tree is null!","0x093":"invalid version input for reading snapshot tree!","0x094":"Missing snapshot tree!","0x096":"Trying to remove valid tree IDs in removeNullTreeIds()!","0x097":"Missing param from office.com URL parameter","0x098":"OuterDocumentServiceFactoryProxy unavailable","0x099":"OuterUrlResolverProxy unavailable","0x09a":"'documentId' must be a defined, non-zero length string.","0x09d":"Connection details should contain epoch","0x09f":"No more socketIO refs to remove!","0x0a0":"Unexpected socketIO references on timeout","0x0a1":"Socket reference set unexpectedly does not point to this socket!","0x0a2":"reentrancy not supported!","0x0a4":"Unexpected blob encoding type","0x0a5":"Trying to set ops when they are already set!","0x0a8":"Docid should not contain slashes!!","0x0ad":"Snapshot entry has both a tree value and a referenced id!","0x0ae":"Tried to create rate limiter with 0 max requests!","0x0b0":"Missing document snapshot tree!","0x0b1":"Storage service not initialized","0x0b2":"Missing orderer URL!","0x0b7":"Pathname should be defined","0x0b8":"'tenantId' and 'documentId' must be defined, non-zero length strings.","0x0b9":"PathName should exist","0x0ba":"Tenant id should exist","0x0bb":"Document id should exist","0x0bc":"Runtime has no DataObject!","0x0bd":"Object runtime already has DataObject!","0x0be":"Trying to initialize from existing while initProps is set!","0x0bf":"set called recursively from the interception callback","0x0c0":"set called recursively from the interception callback","0x0c1":"Interception wrapper methods called recursively from the interception callback","0x0c2":"Interception wrapper methods called recursively from the interception callback","0x0c3":"Interception wrapper methods called recursively from the interception callback","0x0c4":"Interception wrapper methods called recursively from the interception callback","0x0c5":"Interception wrapper methods called recursively from the interception callback","0x0c6":"Interception wrapper methods called recursively from the interception callback","0x0c7":"Interception wrapper methods called recursively from the interception callback","0x0c8":"Interception wrapper methods called recursively from the interception callback","0x0c9":"Interception wrapper methods called recursively from the interception callback","0x0ca":"Trying to use legacy graph attach!","0x0cd":"Container disconnected while waiting for ops!","0x0cf":"disconnect event was not raised!","0x0d1":"Container should be attached before close","0x0d2":"resolved url should be valid Fluid url","0x0d3":"Should only be called in detached container","0x0d6":"Inbound queue should be empty when attaching","0x0d9":"Attempting to connect() a closed DeltaManager","0x0dd":"Existing context not disposed","0x0de":"Mismatch in connection state while setting","0x0df":"Missing active connection","0x0e0":"lost minBlobSize policy","0x0e2":"DeltaManager already has attached op handler!","0x0e3":"Newly set op handler is null/undefined!","0x0e4":"Lost old connection!","0x0e6":"old connection exists on new connection setup","0x0e7":"claims/connectionMode mismatch","0x0e8":"readonly perf with write connection","0x0e9":"messageBuffer is not empty on new connection","0x0eb":"Missing connection for reconnect","0x0ec":"Unexpected value for previously processed message's sequence number","0x0ed":"non-system message have to have clientId","0x0ee":"Not accounting local messages correctly","0x0ef":"client seq# not growing","0x0f0":"Incoming local client seq# > generated by this client","0x0f2":"previouslyProcessedMessage","0x0f3":"not positive","0x0f4":"Nonzero pause-count on resume()","0x0f6":"real blob ID exists","0x0f7":"aggregate blob missing","0x0f8":"blob from aggregate blob exists on its own","0x0f9":"never read summary","0x0fa":"virtual blob not found","0x0fb":"logic err with aggregator","0x0fc":"tree reuse at lower level","0x0fd":"data stores are writing incremental summaries!","0x0fe":"attachment is aggregate blob","0x0ff":"duplicate aggregate blob","0x100":"logic error","0x101":"Unexpected tree entry type on flatten!","0x102":"invalid level of concurrency","0x103":"trying to parallel run while not working","0x104":"undefined end point for parallel fetch","0x105":"unexpected end point for parallel fetch","0x107":"ending dispatch with remaining results to be sent","0x108":"ending results dispatch but knew in advance about more requests","0x109":"unexpected next chunk position","0x10a":"cannot add parallel request while not working","0x10b":"invalid parallel request range","0x10c":"invalid parallel request start point","0x10d":"invalid parallel request end point","0x10e":"should not throw result if we knew about boundary in advance","0x10f":"empty/partial chunks should not be returned by caching","0x110":"callback should retry until valid fetch before it learns new boundary","0x112":"cannot push onto queue if done","0x113":"deferred queue should be empty","0x114":"cannot pop if deferred","0x115":"queue should not be done during pop","0x116":"Missing handle on scheduler load","0x117":"Trying to get missing clientId!","0x118":"Bad client interactive check","0x119":"This agent became inactive while releasing","0x11a":"Unsuccessful registration","0x11b":"Trying to clear tasks on inactive agent","0x11c":"Detached object routing context","0x11d":"task is already running","0x11e":"client is undefined","0x11f":"requesting unknown blobs","0x120":"Undefined latency statistics (op send time)","0x121":"Undefined inner contents type!","0x122":"Message to unpack is not proper runtime message","0x124":"inconsistent readonly property/event state","0x125":"Unsafe to transition to read-only state!","0x126":"Expected createSubRequest url to include a leading slash","0x127":"dirty document event not set on replay","0x12a":"Missing blob id on metadata","0x12b":"did not get root data store","0x12d":"Container Context should already be in attaching state","0x12e":"Container Context should already be in attached state","0x12f":"Container Runtime's summarize should always return a tree","0x131":"Mismatch between new chunkId and expected chunkMap","0x132":"sending ops in detached container","0x133":"Container disconnected when trying to submit system message","0x137":"Failed to get version from storage","0x138":"Failed to get snapshot from storage","0x139":"Undefined package path","0x13a":"Data store ID contains slash","0x13b":"datastore context is already in bound state","0x13c":"undefined channel on datastore context","0x13d":"Detached runtime creation on realize()","0x13e":"Unexpected package path","0x13f":"datastore context registry is already set","0x140":"undefined channel on datastore context","0x141":"Unexpected connected state","0x142":"local store channel is not loaded","0x143":"Channel should not be undefined when running GC","0x144":"Channel should be loaded when updating used routes","0x145":"Channel should be present when data store is loaded","0x146":"Channel must exist when submitting message","0x147":"Channel must exist on submitting signal","0x148":"Detached runtime creation on runtime bind","0x149":"Undefined channel deferral","0x14a":"Undefined package path","0x14b":"Channel must exist when resubmitting ops","0x14c":"Channel must exist when rebasing ops","0x14d":"Should move from detached to attaching","0x14e":"Should move from attaching to attached","0x14f":"There should be a channel when generating attach message","0x150":"pkg should be available in local data store context","0x152":"pkg should be available in local data store","0x154":"runtime creation is already attached","0x155":"channel deferral is already set","0x156":"Unexpected factory for package path","0x157":"datastore registry already attached","0x158":"Creating store with existing ID","0x159":"The given id was not found in notBoundContexts to delete","0x15a":"Cannot find context to resolve to","0x15b":"Expected this id to already be removed from notBoundContexts","0x15c":"Cannot find deferred to resolve","0x15d":"Creating store with existing ID","0x15e":"Local object does not have matching attach message id","0x15f":"Could not find unbound context to bind","0x160":"There should be a store context for the op","0x161":"There should be a store context for the op","0x162":"There should be a store context for the op","0x163":"Missing datastore for local signal","0x165":"Summarizer cannot work if client has local changes","0x166":"BaseSnapshot should be there as detached container loaded from snapshot","0x167":"Used route does not belong to any known data store","0x168":"Expected tree in snapshot not found","0x169":"No pending message found for this remote message","0x16b":"The pending batch state indicates we are already processing a batch","0x16d":"There is no pending batch begin message","0x16e":"Batch with single message should not have batch metadata","0x16f":"Did not receive batch begin metadata","0x170":"Did not receive batch end metadata","0x171":"No pending state found for the remote message","0x172":"The connection state is not consistent with the runtime","0x173":"replayPendingStates called twice for same clientId!","0x174":"initial states should be empty before replaying pending","0x175":"Can only broadcast if summarizer starts in local state","0x176":"Can only ack/nack if summarizer is in broadcasting state","0x177":"Missing delta handler","0x178":"Missing delta handler on attach","0x179":"createChannel() with existing ID","0x17a":"Channel should be loaded when created!!","0x17b":"Channel to be binded should be in not bounded set","0x17c":"Unexpected attach (local) channel OP","0x17e":"Used route does not belong to any known context","0x17f":"Not expecting detached channels during summarize","0x180":"getAttachSummary should always return a tree","0x181":"BaseSnapshot should be there as detached container loaded from snapshot","0x182":"Data store should be attached to attach the channel.","0x183":"There should be a channel context for the op","0x184":"There should be a channel context for the op","0x185":"Channel not found","0x189":"Should always be remote because a local dds shouldn't generate ops before loading","0x18a":"Channel should be loaded to resubmit ops","0x18c":"Channel should be loaded to summarize","0x18d":"Channel should be loaded to take snapshot","0x18e":"Channel must not already be loaded when loading","0x190":".attributes blob should be present","0x192":"Channel should be there if loaded!!","0x193":"Channel should be loaded to run GC","0x194":"Remote channel must be loaded when rebasing op","0x195":"Remote channel must not be local when processing op","0x196":"Remote channel must be loaded when resubmitting op","0x197":"Remote channel must not already be loaded when loading","0x198":"Used route should always be an absolute route","0x19a":"Invalid response value for Fluid object request","0x19b":"Cannot not create response error on 200 status","0x19c":"storage service path has trailing separator","0x19d":"Handles should always have absolute paths","0x19f":"wipSummaryLogger should not be set yet in startSummary","0x1a0":"Already tracking a summary","0x1a1":"summarize should not be called when not tracking the summary","0x1a2":"wipSummaryLogger should have been set in startSummary or ctor","0x1a3":"wipSummaryLogger should have been set in startSummary or ctor","0x1a4":"Not tracking a summary","0x1a5":"Tracked summary local paths not set","0x1a6":"Not found pending summary, but this node has previously completed a summary","0x1a7":"Pending summary reference sequence number should be consistent","0x1a9":"When loading base summary, expected outstanding ops <= tracking sequence number","0x1aa":"Out of order change recorded","0x1ab":"Create SummarizerNode child already exists","0x1ac":"Cannot create child from summary if parent does not have latest summary","0x1ad":"Missing child summary tree","0x1ae":"Child summary object is not a tree","0x1af":"Outstanding ops blob missing, but base summary tree exists","0x1b0":"Base summary tree missing, but outstanding ops blob exists","0x1b1":"wip used routes should be set if tracking a summary","0x1b2":"Getting GC data should not be called when GC is disabled!","0x1b3":"GC data cannot be retrieved without getGCDataFn","0x1b4":"We should not already be tracking used routes when to track a new summary","0x1b5":"We should have been tracking used routes","0x1b6":"Create SummarizerNode child already exists","0x1b7":"Bad session state for processing quorum messages","0x1b8":"Bad session state for processing quorum messages","0x1b9":"Unexpected value for sequence number of first message in file","0x1ba":"should not return empty buckets","0x1bb":"Unexpected sequence number on first of messages to save","0x1bc":"Unexpected sequence number on last of messages to save","0x1bd":"Stopped writing at unexpected sequence number","0x1c5":"snapshot should be set before retrieving it","0x1c6":"snapshot should be set before retrieving it","0x1c7":"snapshot should be set before retrieving it as expanded string","0x1c8":"Mismatch between document sequence number and current op number","0x1c9":"Leftover documents after replay!","0x1ca":"replay-to target is <= current op in replay cycle","0x1cb":"Bad window to verify snapshot","0x1cc":"Unexpected previous snapshot op number","0x1ce":"clientId not found","0x1cf":"clientId not found","0x1d0":"sequenceNumber not found","0x1d3":"Missing client id on disconnect","0x1d5":"Invalid snapshot format version","0x1d6":"Parent summary object is not a tree","0x1d8":"Should only transition from Connecting state","0x1d9":"addRequestCore() should break into smaller chunks","0x1da":"Client id should be set if connected","0x1db":"epoch exists","0x1dc":"all entries have to have epoch","0x1dd":"no epoch","0x1de":"Not an ODSP resolved url","0x1e0":"Protocol and App summary trees should be present","0x1e2":"Caller must ensure 'isAttached()' before calling 'sendSetCellOp'.","0x1e4":"Unexpected serializable type","0x1e5":"Storage token should not be null","0x1e6":"Epoch  should be present in response","0x1e7":"caching was not performed!","0x1e8":"reentrancy","0x1e9":"Pending ops","0x1ea":"Prefetch snapshot only available for odsp!","0x1eb":"Snapshot should be prefetched!","0x1ec":"No refresh token provided.","0x1ed":"Share link should be present","0x1ef":"services must be defined","0x1f0":"Unexpected mismatch in readonly","0x1f5":"Attached state should have storage","0x1f6":"Negative client sequence number not allowed","0x1f7":"Previous client should always be defined","0x1f8":"local BlobAttach op with no pending blob","0x1fc":"summary is not a tree","0x1fe":"isolated channels subtree should exist in remote datastore snapshot","0x1ff":"isolated channels subtree should exist in local datastore snapshot","0x200":"Returned odsp snapshot is malformed. No trees!","0x201":"Returned odsp snapshot is malformed. No blobs!","0x203":"Summary handle is undefined","0x205":"attach() called more than once","0x207":"Channel should be defined","0x208":"Factory should be undefined before loading","0x209":"Factory Type should be defined","0x20a":"register for event on disposed object","0x20b":"mismatch","0x20c":"connection disposed","0x20d":"double connection listener","0x20e":"double tracked listener","0x20f":"Driver min read version should >= to server minReadVersion","0x210":"Snapshot should be created with minReadVersion or above","0x219":"1 root should be there","0x21b":"Snapshot id should be provided","0x21c":"Seq number should be provided","0x21d":"body is not string","0x21e":"improper boundary format","0x220":"socket key collision","0x221":"Root tree should contain the id","0x222":"Root tree should contain the id!!","0x223":"unexpected end of buffer","0x224":"Skip length should be positive","0x225":"Data should be there","0x226":"Should write complete data","0x227":"Data should be there","0x22b":"Should be a pair","0x22c":"reading pairs","0x231":"Number should be an integer","0x232":"Payload should not be negative","0x233":"Unexpected data at the end of buffer","0x234":"has joinOpTimer","0x235":"no joinOpTimer","0x236":"In all cases it should be already installed","0x237":"Snapshot should exist","0x238":"called only in connected state","0x239":"called only in disconnected state","0x23a":"seq#'s","0x23b":"we are not packing at the right level","0x23c":"we are not packing at the right level","0x23d":"pending is undefined","0x23e":"pending is undefined","0x23f":"pending undefined","0x240":"Binary format snapshot only for odsp driver!!","0x241":"disconnect should result in stopSequenceNumberUpdate() call","0x242":"has timer","0x243":"stopSequenceNumberUpdate should be called as result of sending any op!","0x244":"Socket is closed, but connection is not!","0x245":"tracked listener","0x246":"checking consistency of socket & _disposed flags","0x247":"Use addTrackedListener instead","0x248":"should not subscribe to forwarded events","0x24c":"Cannot call `flush()` from `orderSequentially`'s callback","0x24e":"assertion for type narrowing","0x250":"serialized container with attachment blobs must be rehydrated with detached blob storage","0x251":"creation summary has to have seq=0 && handle === undefined","0x252":"redirect table can only be set in detached container","0x253":"redirect table already exists","0x254":"unrecognized id in redirect table","0x255":"detached blob id absent in redirect table","0x256":"storage undefined in attached container","0x257":"This is not summarizing container","0x258":"connected","0x259":"Container disconnected when trying to submit system message","0x25b":"Caller is responsible for checking lock","0x25d":"We should never connect as 'read'","0x25e":"no reason to call fail if all promises have been completed","0x25f":"retryAfterSeconds","0x260":"Disposed should mean disconnected!","0x261":"Expected: off","0x262":"Old summarizer is still working!","0x263":"Expected: starting","0x264":"Expected: Not Off","0x266":"lastKnownSeqNumber should never be below last processed sequence number","0x267":"lastObservedSeqNumber should be updated first","0x268":"There can't be pending fetch that early in boot sequence!","0x269":"pending ops are not dropped","0x26a":"not closed","0x26b":"initial state","0x26c":"handler should be installed","0x26d":"wrong start","0x26e":"wrong start","0x26f":"continuous and no duplicates","0x270":"All requested ops fetched","0x272":"empty request","0x273":"Invalid document id from parsed URL","0x274":"type check","0x275":"Root tree should contain the id","0x278":"API is not supported for non-connecting or closed container","0x27b":"reentrancy may result in incorrect behavior","0x280":"Validate first op seq number","0x281":"Unreferenced if present should be true","0x282":"Headers should be present now","0x283":"Length of data len should fit in the bytes from the map","0x284":"Length of id should fit in the bytes from the map","0x285":"Start code should not undefined","0x286":"End code should not undefined","0x287":"key must exist in the map","0x288":"All properties should exist","0x289":"logic error","0x28a":"can't be disposed - Callers need to ensure that!","0x292":"Unexpected undefined result from getFileLinkCore","0x293":"initial state","0x294":"can't have op processing paused if we are processing an op","0x295":"there should be no pending batch if we have no ops","0x296":"we should never start processing incomplete batch!","0x297":"always called from resumed state","0x298":"we have something in the queue that generates this event","0x299":"non-synchronized state","0x29a":"System message in the middle of batch!","0x29b":"system op in a batch?","0x29c":"we should be processing ops when there is no active batch","0x29d":"we should be processing ops when there is no active batch","0x29e":"there can't be active batch","0x29f":"we should be processing ops when there is no active batch","0x2a0":"batch presence was validated above","0x2a1":"logic error","0x2a2":"Batch is interrupted by other client op. Should be caught by trackPending()","0x2a3":"container should be closed on any error","0x2a5":"join timer","0x2a6":"waitingForLeaveOp should imply writeConnection (we need to be ready to flush pending ops)","0x2a7":"Container is not attached","0x2a8":"Expected data store snapshot tree in base snapshot","0x2a9":"GC nodes for data store not in GC blob","0x2ac":"Connected when timeout waiting for leave from previous session fired!","0x2ad":"GC blob missing from snapshot","0x2ae":"node id should always be an absolute route","0x2af":"Child GC data should have been initialized","0x2b0":"Used route should always be an absolute route","0x2b1":"This should have be initiallized when generate GC nodes above","0x2b2":"Two entries for the same GC node with different unreferenced timestamp","0x2b3":"logic error","0x2b4":"not connected on sending ops!","0x2b5":"logic error","0x2b6":"Missing data store context","0x2b8":"Chunk should be set in map","0x2ba":"batchBegin must fire before batchEnd","0x2bb":"Instrumented token fetcher with throwOnNullToken = true should never return null","0x2bc":"Instrumented token fetcher with throwOnNullToken =true should never return null","0x2bd":"We should not see a pending FlushMode until we see a flush when processing a batch","0x2be":"LocalReferences array contains a gap","0x2bf":"both removedClientIds and removedSeq should be set or not set","0x2c0":"ID must be created before adding interval to collection","0x2c1":"Creating an interval collection that already exists?","0x2c2":"Create Version should be equal to currentReadVersion","0x2c4":"client should not be summarizer before container is created","0x2c5":"Attempting to connect() a closed Container","0x2c6":"Attempting to connect() a container that is not attached","0x2c7":"Attempting to disconnect() a closed Container","0x2c8":"outboundPushEventTime should be undefined","0x2c9":"durationNetwork should be undefined","0x2ca":"durationOutboundBatching should be undefined","0x2cb":"submitOpEventTime should be undefined","0x2cc":"OpTimeSittingInboundQueue should be undefined","0x2cd":"durationNetwork should be undefined","0x2ce":"msnTrackingTimestamp should not be undefined","0x2cf":"undefined channel on datastore context","0x2d0":"Data store should be globally visible to attach channels.","0x2d1":"Data store should be locally visible before it can become globally visible.","0x2d2":"Data store should be globally visible when its attached.","0x2d3":"Local channel must be globally visible when processing op","0x2d4":"Local channel must be globally visible when resubmitting op","0x2d5":"Invalid blob node id in unused routes.","0x2d7":"No data store with specified id","0x2d8":"Empty change event should not be emitted.","0x2da":"Unknown SharedMatrix 'op' type.","0x2db":"Applying op must generate a pending segment","0x2dc":"Cannot find code proposal","0x2dd":"Cannot find blob for a given id","0x2de":"Package path requested for unsupported node type.","0x2df":"transient references cannot be bound to segments","0x2e0":"lref not a Local Reference","0x2e1":"Support for plain value types removed.","0x2e2":"Must only wait for leave message when clientId in quorum","0x2e3":"Must have a valid protocol handler instance","0x2e4":"there should be service config for active connection","0x2e5":"Must have a base snapshot","0x2e6":"Must have a base snapshot","0x2e7":"Must serialize base snapshot blobs before getting runtime state","0x2e8":"There should be a store context for the op","0x2e9":"Must call getLocalState() after applying initial states","0x2ea":"Configuration state should be enabled","0x2eb":"Summary not supported with configuration disabled","0x2ec":"Blob must be present in blobsContents","0x2ed":"There should be a channel context for the op","0x2ee":"Channel should be loaded to rollback ops","0x2ef":"Local channel must be globally visible when rolling back op","0x2f0":"Remote channel must be loaded when rolling back op","0x2f1":"slideReferences from a segment which has not been removed and acked","0x2f2":"Ref not in the segment localRefs","0x2f3":"Ref not in the segment localRefs","0x2f4":"localRefs must be allocated","0x2f5":"op create references must be SlideOnRemove","0x2f6":"SlideOnRemove references must be op created","0x2f8":"Unexpected accept op, nothing pending","0x2f9":"Unexpected accept op, client not in expectedSignoffs","0x2fa":"Unexpected pending message received","0x2fb":"pendingMessageId does not match","0x2fc":"Invalid localOpMetadata for clear","0x2fd":"pendingMessageId does not match","0x2fe":"Invalid localOpMetadata in submit","0x2ff":"Unexpected pending message received","0x300":"localSeq greater than collab window","0x301":"Either seq or localSeq should be defined","0x302":"No segment found","0x303":"Invalid offset","0x304":"Id cannot contain slashes","0x305":"registerDependent on disposed Dependee","0x306":"invalidateDependents on disposed Dependee","0x307":"endInitialization should be called exactly once","0x308":"onDispose should be set when disposing","0x309":"Cannot unregister dependees on a disposed SimpleObservingDependent.","0x30a":"shouldClientJoinWrite should imply this is a writeConnection","0x30b":"Must have a valid protocol handler instance","0x30c":"Id cannot contain slashes","0x30d":"Id cannot contain slashes","0x30e":"Id cannot contain slashes. DataStoreContext should have validated this.","0x30f":"Channel context ID cannot contain slashes","0x310":"Channel context ID cannot contain slashes","0x311":"expected id to exist on interval","0x312":"snapshot should be parsed","0x313":'Specified user was not of type "TinyliciousUser".',"0x314":"Container properly closed","0x315":"re-entrancy","0x316":"There should be a cached promise of in-progress aliasing","0x317":"dataStoreFactory is undefined","0x318":"resolvedUrl is undefined","0x319":"No delta connection server associated with specified document ID","0x31a":"resolvedUrl is undefined","0x31b":"container1.resolvedUrl is undefined","0x31c":"rightDiv is undefined","0x31d":'options are not of type "IRouterliciousRouteOptions" as expected',"0x31e":"options.tenantId is undefined","0x320":"options.tenantId is undefined","0x322":"options.fluidHost is undefined","0x324":"options.server is undefined","0x325":"options.odspAccessToken is undefined","0x326":"lockResolver is undefined","0x327":"options.server is undefined","0x328":"options.server is undefined","0x329":"browser.umd property is undefined","0x32a":"pendingMessageId does not match","0x32b":"Invalid localOpMetadata for clear","0x32c":"pendingMessageId does not match","0x32d":"Invalid localOpMetadata in submit","0x32e":"Unexpected pending message received","0x32f":"Invalid localOpMetadata for sub directory op","0x330":"Unexpected pending message received","0x331":"Unexpected pending message received","0x332":"Unexpected pending message received","0x333":"PathShared.splice can only insert detached ranges","0x334":"Anchor must not be double freed","0x335":"ObjectForest.getRoot only valid for existing roots","0x336":"ObjectForest must only be given its own Anchors","0x337":"ObjectForest must only be given its own Cursor type","0x338":"ObjectForest must only be given its own Cursor","0x339":"Anchor must not be double freed","0x33a":"Anchor must not be double freed","0x33b":"Cursor must not be freed","0x33c":"Cursor must not be freed","0x33d":"Cursor must be current to be used","0x33e":"Cursor must be current to be used","0x33f":"Cursor must not be double freed","0x340":"Cursor must be current to be used","0x341":"Cursor must be current to be used","0x342":'Invalid usage. "blobid" should always be null',"0x343":'Invalid usage. "count" should always be 1',"0x344":"this.pendingConnection should be undefined","0x345":"this.pendingConnection is undefined when trying to cancel","0x346":"inboundQueuePausedFromInit should be true"}});var pA=R(Xd=>{"use strict";Object.defineProperty(Xd,"__esModule",{value:!0});Xd.validateAssertionError=void 0;var ZH=fA();function eV(r,e){var t;let n=(t=ZH.shortCodeMap[r.message])!==null&&t!==void 0?t:r.message;if(n!==e)throw new Error(`Unexpected assertion thrown: ${r.message} ('${n}')`);return!0}Xd.validateAssertionError=eV});var mA=R(xr=>{"use strict";var tV=xr&&xr.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Di=xr&&xr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&tV(e,r,t)};Object.defineProperty(xr,"__esModule",{value:!0});Di(tA(),xr);Di(nA(),xr);Di(V0(),xr);Di(sA(),xr);Di(Y0(),xr);Di(uA(),xr);Di(dA(),xr);Di(pA(),xr)});var wA=["tooltip"],Bv=20;var qv=new Yd("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{let r=cv($o);return()=>r.scrollStrategies.reposition({scrollThrottle:Bv})}});function CA(r){return()=>r.scrollStrategies.reposition({scrollThrottle:Bv})}var EA={provide:qv,deps:[$o],useFactory:CA};function _A(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}var TA=new Yd("mat-tooltip-default-options",{providedIn:"root",factory:_A});var kv="tooltip-panel",Mv=Cv({passive:!0}),AA=8,DA=8,FA=24,PA=200,Lv=(()=>{let e=class e{get position(){return this._position}set position(n){n!==this._position&&(this._position=n,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(n){this._positionAtOrigin=nf(n),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(n){this._disabled=nf(n),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(n){this._showDelay=sf(n)}get hideDelay(){return this._hideDelay}set hideDelay(n){this._hideDelay=sf(n),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(n){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=n!=null?String(n).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(n){this._tooltipClass=n,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(n,i,s,o,a,c,l,d,h,u,f,g){this._overlay=n,this._elementRef=i,this._scrollDispatcher=s,this._viewContainerRef=o,this._ngZone=a,this._platform=c,this._ariaDescriber=l,this._focusMonitor=d,this._dir=u,this._defaultOptions=f,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._tooltipComponent=IA,this._viewportMargin=8,this._cssClassPrefix="mat-mdc",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new Ir,this._scrollStrategy=h,this._document=g,f&&(this._showDelay=f.showDelay,this._hideDelay=f.hideDelay,f.position&&(this.position=f.position),f.positionAtOrigin&&(this.positionAtOrigin=f.positionAtOrigin),f.touchGestures&&(this.touchGestures=f.touchGestures)),u.change.pipe(bn(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),this._viewportMargin=AA}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(bn(this._destroyed)).subscribe(n=>{n?n==="keyboard"&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){let n=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,s])=>{n.removeEventListener(i,s,Mv)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(n,this.message,"tooltip"),this._focusMonitor.stopMonitoring(n)}show(n=this.showDelay,i){if(this.disabled||!this.message||this._isTooltipVisible()){this._tooltipInstance?._cancelPendingAnimations();return}let s=this._createOverlay(i);this._detach(),this._portal=this._portal||new Av(this._tooltipComponent,this._viewContainerRef);let o=this._tooltipInstance=s.attach(this._portal).instance;o._triggerElement=this._elementRef.nativeElement,o._mouseLeaveHideDelay=this._hideDelay,o.afterHidden().pipe(bn(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),o.show(n)}hide(n=this.hideDelay){let i=this._tooltipInstance;i&&(i.isVisible()?i.hide(n):(i._cancelPendingAnimations(),this._detach()))}toggle(n){this._isTooltipVisible()?this.hide():this.show(void 0,n)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(n){if(this._overlayRef){let o=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!n)&&o._origin instanceof tn)return this._overlayRef;this._detach()}let i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),s=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin?n||this._elementRef:this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i);return s.positionChanges.pipe(bn(this._destroyed)).subscribe(o=>{this._updateCurrentPositionClass(o.connectionPair),this._tooltipInstance&&o.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:s,panelClass:`${this._cssClassPrefix}-${kv}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(bn(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(bn(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(bn(this._destroyed)).subscribe(o=>{this._isTooltipVisible()&&o.keyCode===27&&!Dv(o)&&(o.preventDefault(),o.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(n){let i=n.getConfig().positionStrategy,s=this._getOrigin(),o=this._getOverlayPosition();i.withPositions([this._addOffset(Go(Go({},s.main),o.main)),this._addOffset(Go(Go({},s.fallback),o.fallback))])}_addOffset(n){let i=DA,s=!this._dir||this._dir.value=="ltr";return n.originY==="top"?n.offsetY=-i:n.originY==="bottom"?n.offsetY=i:n.originX==="start"?n.offsetX=s?-i:i:n.originX==="end"&&(n.offsetX=s?i:-i),n}_getOrigin(){let n=!this._dir||this._dir.value=="ltr",i=this.position,s;i=="above"||i=="below"?s={originX:"center",originY:i=="above"?"top":"bottom"}:i=="before"||i=="left"&&n||i=="right"&&!n?s={originX:"start",originY:"center"}:(i=="after"||i=="right"&&n||i=="left"&&!n)&&(s={originX:"end",originY:"center"});let{x:o,y:a}=this._invertPosition(s.originX,s.originY);return{main:s,fallback:{originX:o,originY:a}}}_getOverlayPosition(){let n=!this._dir||this._dir.value=="ltr",i=this.position,s;i=="above"?s={overlayX:"center",overlayY:"bottom"}:i=="below"?s={overlayX:"center",overlayY:"top"}:i=="before"||i=="left"&&n||i=="right"&&!n?s={overlayX:"end",overlayY:"center"}:(i=="after"||i=="right"&&n||i=="left"&&!n)&&(s={overlayX:"start",overlayY:"center"});let{x:o,y:a}=this._invertPosition(s.overlayX,s.overlayY);return{main:s,fallback:{overlayX:o,overlayY:a}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(sv(1),bn(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(n){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=n,this._tooltipInstance._markForCheck())}_invertPosition(n,i){return this.position==="above"||this.position==="below"?i==="top"?i="bottom":i==="bottom"&&(i="top"):n==="end"?n="start":n==="start"&&(n="end"),{x:n,y:i}}_updateCurrentPositionClass(n){let{overlayY:i,originX:s,originY:o}=n,a;if(i==="center"?this._dir&&this._dir.value==="rtl"?a=s==="end"?"left":"right":a=s==="start"?"left":"right":a=i==="bottom"&&o==="top"?"above":"below",a!==this._currentPosition){let c=this._overlayRef;if(c){let l=`${this._cssClassPrefix}-${kv}-`;c.removePanelClass(l+this._currentPosition),c.addPanelClass(l+a)}this._currentPosition=a}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",n=>{this._setupPointerExitEventsIfNeeded();let i;n.x!==void 0&&n.y!==void 0&&(i=n),this.show(void 0,i)}]):this.touchGestures!=="off"&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",n=>{let i=n.targetTouches?.[0],s=i?{x:i.clientX,y:i.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout);let o=500;this._touchstartTimeout=setTimeout(()=>this.show(void 0,s),this._defaultOptions.touchLongPressShowDelay??o)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;let n=[];if(this._platformSupportsMouseEvents())n.push(["mouseleave",i=>{let s=i.relatedTarget;(!s||!this._overlayRef?.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if(this.touchGestures!=="off"){this._disableNativeGesturesIfNecessary();let i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};n.push(["touchend",i],["touchcancel",i])}this._addListeners(n),this._passiveListeners.push(...n)}_addListeners(n){n.forEach(([i,s])=>{this._elementRef.nativeElement.addEventListener(i,s,Mv)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(n){if(this._isTooltipVisible()){let i=this._document.elementFromPoint(n.clientX,n.clientY),s=this._elementRef.nativeElement;i!==s&&!s.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){let n=this.touchGestures;if(n!=="off"){let i=this._elementRef.nativeElement,s=i.style;(n==="on"||i.nodeName!=="INPUT"&&i.nodeName!=="TEXTAREA")&&(s.userSelect=s.msUserSelect=s.webkitUserSelect=s.MozUserSelect="none"),(n==="on"||!i.draggable)&&(s.webkitUserDrag="none"),s.touchAction="none",s.webkitTapHighlightColor="transparent"}}};e.\u0275fac=function(i){return new(i||e)(Ie($o),Ie(tn),Ie(_v),Ie(pv),Ie(fv),Ie(wv),Ie(Pv),Ie(Iv),Ie(qv),Ie(Ev),Ie(TA,8),Ie(bv))},e.\u0275dir=Ii({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(i,s){i&2&&Rt("mat-mdc-tooltip-disabled",s.disabled)},inputs:{position:[xn.None,"matTooltipPosition","position"],positionAtOrigin:[xn.None,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[xn.None,"matTooltipDisabled","disabled"],showDelay:[xn.None,"matTooltipShowDelay","showDelay"],hideDelay:[xn.None,"matTooltipHideDelay","hideDelay"],touchGestures:[xn.None,"matTooltipTouchGestures","touchGestures"],message:[xn.None,"matTooltip","message"],tooltipClass:[xn.None,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"],standalone:!0});let r=e;return r})(),IA=(()=>{let e=class e{constructor(n,i,s){this._changeDetectorRef=n,this._elementRef=i,this._isMultiline=!1,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new Ir,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide",this._animationsDisabled=s==="NoopAnimations"}show(n){this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},n)}hide(n){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},n)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:n}){(!n||!this._triggerElement.contains(n))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){let n=this._elementRef.nativeElement.getBoundingClientRect();return n.height>FA&&n.width>=PA}_handleAnimationEnd({animationName:n}){(n===this._showAnimation||n===this._hideAnimation)&&this._finalizeAnimation(n===this._showAnimation)}_cancelPendingAnimations(){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(n){n?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(n){let i=this._tooltip.nativeElement,s=this._showAnimation,o=this._hideAnimation;if(i.classList.remove(n?o:s),i.classList.add(n?s:o),this._isVisible=n,n&&!this._animationsDisabled&&typeof getComputedStyle=="function"){let a=getComputedStyle(i);(a.getPropertyValue("animation-duration")==="0s"||a.getPropertyValue("animation-name")==="none")&&(this._animationsDisabled=!0)}n&&this._onShow(),this._animationsDisabled&&(i.classList.add("_mat-animation-noopable"),this._finalizeAnimation(n))}};e.\u0275fac=function(i){return new(i||e)(Ie(Ni),Ie(tn),Ie(uv,8))},e.\u0275cmp=Sn({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(i,s){if(i&1&&Sr(wA,7),i&2){let o;wr(o=Cr())&&(s._tooltip=o.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(i,s){i&1&&X("mouseleave",function(a){return s._handleMouseLeave(a)}),i&2&&Vt("zoom",s.isVisible()?1:null)},standalone:!0,features:[Wc],decls:4,vars:4,consts:[["tooltip",""],[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"animationend","ngClass"],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(i,s){if(i&1){let o=$e();k(0,"div",1,0),X("animationend",function(c){return K(o),$(s._handleAnimationEnd(c))}),k(2,"div",2),re(3),j()()}i&2&&(Rt("mdc-tooltip--multiline",s._isMultiline),Y("ngClass",s.tooltipClass),H(3),ms(s.message))},dependencies:[xv],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - 2*8px);margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - 2*8px);align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0});let r=e;return r})();var jv=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=ps({type:e}),e.\u0275inj=ds({providers:[EA],imports:[Ov,Un,Fv,of,of,Tv]});let r=e;return r})();function zv(r,e,t,n=i=>i){return r*n(.5-e*(.5-t))}function NA(r){return[-r[0],-r[1]]}function jr(r,e){return[r[0]+e[0],r[1]+e[1]]}function Or(r,e){return[r[0]-e[0],r[1]-e[1]]}function Lr(r,e){return[r[0]*e,r[1]*e]}function RA(r,e){return[r[0]/e,r[1]/e]}function Xo(r){return[r[1],-r[0]]}function Hv(r,e){return r[0]*e[0]+r[1]*e[1]}function kA(r,e){return r[0]===e[0]&&r[1]===e[1]}function MA(r){return Math.hypot(r[0],r[1])}function BA(r){return r[0]*r[0]+r[1]*r[1]}function Vv(r,e){return BA(Or(r,e))}function Wv(r){return RA(r,MA(r))}function qA(r,e){return Math.hypot(r[1]-e[1],r[0]-e[0])}function Yo(r,e,t){let n=Math.sin(t),i=Math.cos(t),s=r[0]-e[0],o=r[1]-e[1],a=s*i-o*n,c=s*n+o*i;return[a+e[0],c+e[1]]}function af(r,e,t){return jr(r,Lr(Or(e,r),t))}function Uv(r,e,t){return jr(r,Lr(e,t))}var{min:ys,PI:LA}=Math,Gv=.275,Qo=LA+1e-4;function jA(r,e={}){let{size:t=16,smoothing:n=.5,thinning:i=.5,simulatePressure:s=!0,easing:o=q=>q,start:a={},end:c={},last:l=!1}=e,{cap:d=!0,easing:h=q=>q*(2-q)}=a,{cap:u=!0,easing:f=q=>--q*q*q+1}=c;if(r.length===0||t<=0)return[];let g=r[r.length-1].runningLength,m=a.taper===!1?0:a.taper===!0?Math.max(t,g):a.taper,b=c.taper===!1?0:c.taper===!0?Math.max(t,g):c.taper,v=Math.pow(t*n,2),x=[],_=[],A=r.slice(0,10).reduce((q,z)=>{let V=z.pressure;if(s){let W=ys(1,z.distance/t),ie=ys(1,1-W);V=ys(1,q+(ie-q)*(W*Gv))}return(q+V)/2},r[0].pressure),D=zv(t,i,r[r.length-1].pressure,o),O,M=r[0].vector,S=r[0].point,E=S,w=S,T=E,F=!1;for(let q=0;q<r.length;q++){let{pressure:z}=r[q],{point:V,vector:W,distance:ie,runningLength:ne}=r[q];if(q<r.length-1&&g-ne<3)continue;if(i){if(s){let de=ys(1,ie/t),_e=ys(1,1-de);z=ys(1,A+(_e-A)*(de*Gv))}D=zv(t,i,z,o)}else D=t/2;O===void 0&&(O=D);let me=ne<m?h(ne/m):1,fe=g-ne<b?f((g-ne)/b):1;D=Math.max(.01,D*Math.min(me,fe));let Xe=(q<r.length-1?r[q+1]:r[q]).vector,Le=q<r.length-1?Hv(W,Xe):1,je=Hv(W,M)<0&&!F,Ve=Le!==null&&Le<0;if(je||Ve){let de=Lr(Xo(M),D);for(let _e=1/13,Se=0;Se<=1;Se+=_e)w=Yo(Or(V,de),V,Qo*Se),x.push(w),T=Yo(jr(V,de),V,Qo*-Se),_.push(T);S=w,E=T,Ve&&(F=!0);continue}if(F=!1,q===r.length-1){let de=Lr(Xo(W),D);x.push(Or(V,de)),_.push(jr(V,de));continue}let Pe=Lr(Xo(af(Xe,W,Le)),D);w=Or(V,Pe),(q<=1||Vv(S,w)>v)&&(x.push(w),S=w),T=jr(V,Pe),(q<=1||Vv(E,T)>v)&&(_.push(T),E=T),A=z,M=W}let N=r[0].point.slice(0,2),P=r.length>1?r[r.length-1].point.slice(0,2):jr(r[0].point,[1,1]),I=[],B=[];if(r.length===1){if(!(m||b)||l){let q=Uv(N,Wv(Xo(Or(N,P))),-(O||D)),z=[];for(let V=1/13,W=V;W<=1;W+=V)z.push(Yo(q,N,Qo*2*W));return z}}else{if(!(m||b&&r.length===1))if(d)for(let z=1/13,V=z;V<=1;V+=z){let W=Yo(_[0],N,Qo*V);I.push(W)}else{let z=Or(x[0],_[0]),V=Lr(z,.5),W=Lr(z,.51);I.push(Or(N,V),Or(N,W),jr(N,W),jr(N,V))}let q=Xo(NA(r[r.length-1].vector));if(b||m&&r.length===1)B.push(P);else if(u){let z=Uv(P,q,D);for(let V=1/29,W=V;W<1;W+=V)B.push(Yo(z,P,Qo*3*W))}else B.push(jr(P,Lr(q,D)),jr(P,Lr(q,D*.99)),Or(P,Lr(q,D*.99)),Or(P,Lr(q,D)))}return x.concat(B,_.reverse(),I)}function zA(r,e={}){var t;let{streamline:n=.5,size:i=16,last:s=!1}=e;if(r.length===0)return[];let o=.15+(1-n)*.85,a=Array.isArray(r[0])?r:r.map(({x:f,y:g,pressure:m=.5})=>[f,g,m]);if(a.length===2){let f=a[1];a=a.slice(0,-1);for(let g=1;g<5;g++)a.push(af(a[0],f,g/4))}a.length===1&&(a=[...a,[...jr(a[0],[1,1]),...a[0].slice(2)]]);let c=[{point:[a[0][0],a[0][1]],pressure:a[0][2]>=0?a[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],l=!1,d=0,h=c[0],u=a.length-1;for(let f=1;f<a.length;f++){let g=s&&f===u?a[f].slice(0,2):af(h.point,a[f],o);if(kA(h.point,g))continue;let m=qA(g,h.point);if(d+=m,f<u&&!l){if(d<i)continue;l=!0}h={point:g,pressure:a[f][2]>=0?a[f][2]:.5,vector:Wv(Or(h.point,g)),distance:m,runningLength:d},c.push(h)}return c[0].vector=((t=c[1])==null?void 0:t.vector)||[0,0],c}function Xc(r,e={}){return jA(zA(r,e),e)}var HA=["svgContainer"],VA=["textInput"],UA=(r,e)=>[0,0,r,e];function GA(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"rect",20),j()),r&2){let t=G();H(),Ce("width",t.canvasWidth*t.zoom+100*2)("height",t.canvasHeight*t.zoom+100*2)}}function WA(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"path",24),j()),r&2){let t=G().$implicit;H(),Ce("d",t.value)("stroke-dasharray",t.options.dasharray)("stroke-dashoffset",1)("stroke-width",t.options.strokeWidth)("stroke-linecap",t.options.lineCap)("stroke-linejoin",t.options.lineJoin)("stroke",t.options.strokeColor)}}function KA(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"image",25),j()),r&2){let t=G().$implicit;H(),Ce("height",t.options.height)("width",t.options.width)("href",t.value,null,"xlink")("href",t.value)("stroke-width",t.options.strokeWidth)("stroke-dasharray",t.options.dasharray)("fill",t.options.fill)("stroke",t.options.strokeColor)}}function $A(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"line",26),j()),r&2){let t=G().$implicit;H(),Ce("x1",t.options.x1)("y1",t.options.y1)("x2",t.options.x2)("y2",t.options.y2)("stroke-dasharray",t.options.dasharray)("stroke-dashoffset",1)("stroke-width",t.options.strokeWidth)("stroke-linecap",t.options.lineCap)("stroke-linejoin",t.options.lineJoin)("stroke",t.options.strokeColor)}}function JA(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"rect",27),j()),r&2){let t=G().$implicit;H(),Ce("x",t.options.x2)("y",t.options.y2)("rx",t.options.rx)("width",t.options.width)("height",t.options.height)("stroke-dasharray",t.options.dasharray)("stroke-dashoffset",t.options.dashoffset)("stroke-width",t.options.strokeWidth)("fill",t.options.fill)("stroke",t.options.strokeColor)}}function XA(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"ellipse",28),j()),r&2){let t=G().$implicit;H(),Ce("cx",t.options.cx)("cy",t.options.cy)("rx",t.options.rx)("ry",t.options.ry)("stroke-dasharray",t.options.dasharray)("stroke-dashoffset",1)("stroke-width",t.options.strokeWidth)("stroke-linecap",t.options.lineCap)("stroke-linejoin",t.options.lineJoin)("stroke",t.options.strokeColor)("fill",t.options.fill)}}function YA(r,e){if(r&1&&(ge(),k(0,"g")(1,"text",29),re(2),j()()),r&2){let t=G().$implicit;H(),Ce("x",t.options.left)("y",t.options.top)("width",t.options.width)("height",t.options.height)("font-size",t.options.fontSize)("font-family",t.options.fontFamily)("stroke-dasharray",t.options.dasharray)("stroke-dashoffset",1)("stroke-width",t.options.strokeWidth)("stroke-linecap",t.options.lineCap)("stroke-linejoin",t.options.lineJoin)("stroke",t.options.strokeColor)("fill",t.options.fill)("font-style",t.options.fontStyle)("font-weight",t.options.fontWeight),H(),Oi(" ",t.value," ")}}function QA(r,e){r&1&&(ge(),k(0,"g")(1,"text"),re(2,"Not defined type"),j()())}function ZA(r,e){if(r&1&&(ge(),lt(0),k(1,"g",21),ft(2,WA,2,7,"g",22)(3,KA,2,8,"g",22)(4,$A,2,10,"g",22)(5,JA,2,10,"g",22)(6,XA,2,11,"g",22)(7,YA,3,16,"g",22)(8,QA,3,0,"g",23),j(),ut()),r&2){let t=e.$implicit,n=G();H(),Y("id","item_"+t.id)("ngSwitch",t.type),Ce("data-wb-id",t.id)("transform","translate("+t.x+","+t.y+")rotate("+t.rotation+")")("opacity",t.opacity/100),H(),Y("ngSwitchCase",n.types.BRUSH),H(),Y("ngSwitchCase",n.types.IMAGE),H(),Y("ngSwitchCase",n.types.LINE),H(),Y("ngSwitchCase",n.types.RECT),H(),Y("ngSwitchCase",n.types.ELLIPSE),H(),Y("ngSwitchCase",n.types.TEXT)}}function eD(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"path",24),j()),r&2){let t=G(2);H(),Ce("d",t.tempElement.value)("stroke-dasharray",t.tempElement.options.dasharray)("stroke-dashoffset",1)("stroke-width",t.tempElement.options.strokeWidth)("stroke-linecap",t.tempElement.options.lineCap)("stroke-linejoin",t.tempElement.options.lineJoin)("stroke",t.tempElement.options.strokeColor)}}function tD(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"image",25),j()),r&2){let t=G(2);H(),Ce("height",t.tempElement.options.height)("width",t.tempElement.options.width)("href",t.tempElement.value,null,"xlink")("href",t.tempElement.value)("stroke-width",t.tempElement.options.strokeWidth)("stroke-dasharray",t.tempElement.options.dasharray)("fill",t.tempElement.options.fill)("stroke",t.tempElement.options.strokeColor)}}function rD(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"line",26),j()),r&2){let t=G(2);H(),Ce("x1",t.tempElement.options.x1)("y1",t.tempElement.options.y1)("x2",t.tempElement.options.x2)("y2",t.tempElement.options.y2)("stroke-dasharray",t.tempElement.options.dasharray)("stroke-dashoffset",1)("stroke-width",t.tempElement.options.strokeWidth)("stroke-linecap",t.tempElement.options.lineCap)("stroke-linejoin",t.tempElement.options.lineJoin)("stroke",t.tempElement.options.strokeColor)}}function nD(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"rect",27),j()),r&2){let t=G(2);H(),Ce("x",t.tempElement.options.x2)("y",t.tempElement.options.y2)("rx",t.tempElement.options.rx)("width",t.tempElement.options.width)("height",t.tempElement.options.height)("stroke-dasharray",t.tempElement.options.dasharray)("stroke-dashoffset",t.tempElement.options.dashoffset)("stroke-width",t.tempElement.options.strokeWidth)("fill",t.tempElement.options.fill)("stroke",t.tempElement.options.strokeColor)}}function iD(r,e){if(r&1&&(ge(),k(0,"g"),oe(1,"ellipse",28),j()),r&2){let t=G(2);H(),Ce("cx",t.tempElement.options.cx)("cy",t.tempElement.options.cy)("rx",t.tempElement.options.rx)("ry",t.tempElement.options.ry)("stroke-dasharray",t.tempElement.options.dasharray)("stroke-dashoffset",1)("stroke-width",t.tempElement.options.strokeWidth)("stroke-linecap",t.tempElement.options.lineCap)("stroke-linejoin",t.tempElement.options.lineJoin)("stroke",t.tempElement.options.strokeColor)("fill",t.tempElement.options.fill)}}function sD(r,e){r&1&&(ge(),oe(0,"g"))}function oD(r,e){r&1&&(ge(),k(0,"g")(1,"text"),re(2,"Not defined type"),j()())}function aD(r,e){if(r&1&&(ge(),k(0,"g",30),ft(1,eD,2,7,"g",22)(2,tD,2,8,"g",22)(3,rD,2,10,"g",22)(4,nD,2,10,"g",22)(5,iD,2,11,"g",22)(6,sD,1,0,"g",22)(7,oD,3,0,"g",23),j()),r&2){let t=G();Y("ngSwitch",t.selectedTool),H(),Y("ngSwitchCase",t.tools.BRUSH),H(),Y("ngSwitchCase",t.types.IMAGE),H(),Y("ngSwitchCase",t.types.LINE),H(),Y("ngSwitchCase",t.types.RECT),H(),Y("ngSwitchCase",t.types.ELLIPSE),H(),Y("ngSwitchCase",t.types.TEXT)}}function cD(r,e){if(r&1){let t=$e();ge(),k(0,"g",31)(1,"g",32)(2,"g",33)(3,"rect",34),X("pointerdown",function(i){K(t);let s=G();return $(s.moveSelect(i))}),j()(),k(4,"g",33),oe(5,"circle",35)(6,"circle",36)(7,"circle",37)(8,"circle",38),k(9,"rect",39),X("pointerdown",function(i){K(t);let s=G();return $(s.resizeSelect(i))}),j(),k(10,"rect",40),X("pointerdown",function(i){K(t);let s=G();return $(s.resizeSelect(i))}),j(),k(11,"rect",41),X("pointerdown",function(i){K(t);let s=G();return $(s.resizeSelect(i))}),j(),k(12,"rect",42),X("pointerdown",function(i){K(t);let s=G();return $(s.resizeSelect(i))}),j(),k(13,"rect",43),X("pointerdown",function(i){K(t);let s=G();return $(s.resizeSelect(i))}),j(),k(14,"rect",44),X("pointerdown",function(i){K(t);let s=G();return $(s.resizeSelect(i))}),j(),k(15,"rect",45),X("pointerdown",function(i){K(t);let s=G();return $(s.resizeSelect(i))}),j(),k(16,"rect",46),X("pointerdown",function(i){K(t);let s=G();return $(s.resizeSelect(i))}),j()()()()}if(r&2){let t=G();H(),Vt("display",t.rubberBox.display),Ce("transform","translate("+t.selectedElement.x+","+t.selectedElement.y+")rotate("+t.selectedElement.rotation+")"),H(2),Ce("x",t.rubberBox.x)("y",t.rubberBox.y)("width",t.rubberBox.width)("height",t.rubberBox.height),H(2),Ce("cx",t.rubberBox.x-4)("cy",t.rubberBox.y-4),H(),Ce("cx",t.rubberBox.x+t.rubberBox.width+4)("cy",t.rubberBox.y-4),H(),Ce("cx",t.rubberBox.x+t.rubberBox.width+4)("cy",t.rubberBox.y+t.rubberBox.height+4),H(),Ce("cx",t.rubberBox.x-4)("cy",t.rubberBox.y+t.rubberBox.height+4),H(),Ce("x",t.rubberBox.x-4)("y",t.rubberBox.y-4),H(),Ce("x",t.rubberBox.x+t.rubberBox.width/2-4)("y",t.rubberBox.y-4),H(),Ce("x",t.rubberBox.x+t.rubberBox.width-4)("y",t.rubberBox.y-4),H(),Ce("x",t.rubberBox.x+t.rubberBox.width-4)("y",t.rubberBox.y+t.rubberBox.height/2-4),H(),Ce("x",t.rubberBox.x+t.rubberBox.width-4)("y",t.rubberBox.y+t.rubberBox.height-4),H(),Ce("x",t.rubberBox.x+t.rubberBox.width/2-4)("y",t.rubberBox.y+t.rubberBox.height-4),H(),Ce("x",t.rubberBox.x-4)("y",t.rubberBox.y+t.rubberBox.height-4),H(),Ce("x",t.rubberBox.x-4)("y",t.rubberBox.y+t.rubberBox.height/2-4)}}function lD(r,e){if(r&1){let t=$e();k(0,"div")(1,"input",47,1),X("input",function(){K(t);let i=ae(2),s=G();return $(s.updateTextItem(i.value))}),j()()}if(r&2){let t=ae(2),n=G();Vt("font-family",n.fontFamily)("font-size",n.fontSize,"px")("pointer-events","none")("width",n.canvasWidth*n.zoom,"px")("height",n.canvasHeight*n.zoom,"px")("position","absolute")("top",n.y,"px")("left",n.x,"px"),H(),Vt("width",t.value.length+"ch")("height",2*n.zoom+"ch")("top",(n.tempElement.options.top||0)*n.zoom,"px")("left",(n.tempElement.options.left||0)*n.zoom,"px")("font-size",n.tempElement.options.fontSize,"px"),Y("value",n.tempElement.value)}}var yt=function(r){return r.BRUSH="BRUSH",r.LINE="LINE",r.RECT="RECT",r.ELLIPSE="ELLIPSE",r.IMAGE="IMAGE",r.TEXT="TEXT",r.SHAPE="SHAPE",r}(yt||{}),bs=function(r){return r.BUTT="butt",r.SQUARE="square",r.ROUND="round",r}(bs||{}),xs=function(r){return r.MITER="miter",r.ROUND="round",r.BEVEL="bevel",r.MITER_CLIP="miter-clip",r}(xs||{}),Je=function(r){return r.SELECT="SELECT",r.BRUSH="BRUSH",r.IMAGE="IMAGE",r.LINE="LINE",r.RECT="RECT",r.ELLIPSE="ELLIPSE",r.TEXT="TEXT",r.ERASER="ERASER",r}(Je||{}),lf=class{constructor(e){this.strokeWidth=e.strokeWidth||2,this.strokeColor=e.strokeColor||"#000000",this.lineCap=e.lineCap||bs.ROUND,this.lineJoin=e.lineJoin||xs.ROUND,this.dasharray=e.dasharray||"",this.dashoffset=e.dashoffset||0}},uf=class{constructor(e){this.width=e.width||0,this.height=e.height||0,this.strokeWidth=e.strokeWidth||2,this.strokeColor=e.strokeColor||"#000000",this.dasharray=e.dasharray||"",this.fill=e.fill||"#000000"}},hf=class{constructor(e){this.x1=e.x1||0,this.y1=e.y1||0,this.x2=e.x2||0,this.y2=e.y2||0,this.strokeWidth=e.strokeWidth||2,this.strokeColor=e.strokeColor||"#000000",this.lineCap=e.lineCap||bs.ROUND,this.lineJoin=e.lineJoin||xs.ROUND,this.dasharray=e.dasharray||"",this.dashoffset=e.dashoffset||0}},df=class{constructor(e){this.left=e.left||0,this.top=e.top||0,this.width=e.width||0,this.height=e.height||0,this.fontFamily=e.fontFamily||"Arial",this.fontSize=e.fontSize||14,this.fontStyle=e.fontStyle||"normal",this.fontWeight=e.fontWeight||"normal",this.strokeWidth=e.strokeWidth||2,this.strokeColor=e.strokeColor||"#000000",this.fill=e.fill||"#000000",this.lineJoin=e.lineJoin||xs.ROUND,this.lineCap=e.lineCap||bs.ROUND,this.dasharray=e.dasharray||"",this.dashoffset=e.dashoffset||0}},ff=class{constructor(e){this.cx=e.cx||0,this.cy=e.cy||0,this.rx=e.rx||0,this.ry=e.ry||0,this.dasharray=e.dasharray||"",this.dashoffset=e.dashoffset||0,this.strokeWidth=e.strokeWidth||2,this.strokeColor=e.strokeColor||"#000000",this.fill=e.fill||"#000000",this.lineCap=e.lineCap||bs.ROUND,this.lineJoin=e.lineJoin||xs.ROUND}},pf=class{constructor(e){this.width=e.width||0,this.height=e.height||0,this.x1=e.x1||0,this.y1=e.y1||0,this.rx=e.rx||0,this.strokeWidth=e.strokeWidth||2,this.strokeColor=e.strokeColor||"#000000",this.fill=e.fill||"#000000",this.dasharray=e.dasharray||"",this.dashoffset=e.dashoffset||0}},mf=class{constructor(e,t,n){switch(this.x=0,this.y=0,this.rotation=0,this.opacity=100,this.options={},this.type=e,this.value=n||"",this.id=`element_${this.type}_${Math.floor(Math.random()*1e3)}`,e){case yt.BRUSH:this.options=new lf(t);break;case yt.IMAGE:this.options=new uf(t);break;case yt.RECT:this.options=new pf(t);break;case yt.LINE:this.options=new hf(t);break;case yt.ELLIPSE:this.options=new ff(t);break;case yt.TEXT:this.options=new df(t);break;default:this.options={};break}}},ki=function(r){return r.Png="png",r.Jpeg="jpeg",r.Svg="svg",r.Base64="base64",r}(ki||{}),Zo=(()=>{let e=class e{constructor(){this.eraseMethodCallSource=new Ir,this.saveMethodCallSource=new Ir,this.undoMethodCallSource=new Ir,this.redoMethodCallSource=new Ir,this.addImageMethodCallSource=new Ir,this.eraseMethodCalled$=this.eraseMethodCallSource.asObservable(),this.saveMethodCalled$=this.saveMethodCallSource.asObservable(),this.undoMethodCalled$=this.undoMethodCallSource.asObservable(),this.redoMethodCalled$=this.redoMethodCallSource.asObservable(),this.addImageMethodCalled$=this.addImageMethodCallSource.asObservable()}erase(){this.eraseMethodCallSource.next()}save(n=ki.Base64,i="New board"){this.saveMethodCallSource.next({name:i,format:n})}undo(){this.undoMethodCallSource.next()}redo(){this.redoMethodCallSource.next()}addImage(n,i,s){this.addImageMethodCallSource.next({image:n,x:i,y:s})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=en({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),St=class{static toSvgString(e){let n=new XMLSerializer().serializeToString(e);return n=n.replace(/(\w+)?:?xlink=/g,"xmlns:xlink="),n=n.replace(/NS\d+:href/g,"xlink:href"),n}static snapToGrid(e,t){let n=t;return Math.round(e/n)*n}static snapToAngle(e,t,n,i){let s=Math.PI/4,o=n-e,a=i-t,c=Math.atan2(a,o),l=Math.sqrt(o*o+a*a),d=Math.round(c/s)*s,h=e+l*Math.cos(d),u=t+l*Math.sin(d);return{x:h,y:u,a:d}}static downloadFile(e,t){let n=document.createElement("a");n.href=e,n.setAttribute("visibility","hidden"),n.download=t||"new white-board",document.body.appendChild(n),n.click(),document.body.removeChild(n)}static svgToBase64(e,t,n,i=ki.Png){return new Promise((s,o)=>{let a=document.createElement("canvas");a.width=t,a.height=n;let c=a.getContext("2d"),l=new Image;l.src=`data:image/svg+xml;base64,${btoa(e)}`,l.onload=()=>{c.drawImage(l,0,0,t,n);let d=a.toDataURL(`image/${i}`);s(d)},l.onerror=d=>{o(d)}})}static getSvgPathFromStroke(e,t=!0){let n=e.length;if(n<4)return"";let i=e[0],s=e[1],o=e[2],a=`M${i[0].toFixed(2)},${i[1].toFixed(2)} Q${s[0].toFixed(2)},${s[1].toFixed(2)} ${((s[0]+o[0])/2).toFixed(2)},${((s[1]+o[1])/2).toFixed(2)} T`;for(let c=2,l=n-1;c<l;c++)i=e[c],s=e[c+1],a+=`${((i[0]+s[0])/2).toFixed(2)},${((i[1]+s[1])/2).toFixed(2)} `;return t&&(a+="Z"),a}},gf=(()=>{let e=class e{constructor(){this.isPointing=!1,this.pointerDownSubject=new Ir,this.pointerMoveSubject=new Ir,this.pointerUpSubject=new Ir}onPointerDown(n){this.isPointing=!0,this.pointerDownSubject.next(n)}onPointerMove(n){this.isPointing&&this.pointerMoveSubject.next(n)}onPointerUp(n){this.isPointing=!1,this.pointerUpSubject.next(n)}getPointerDown$(){return this.pointerDownSubject.asObservable()}getPointerMove$(){return this.pointerMoveSubject.asObservable()}getPointerUp$(){return this.pointerUpSubject.asObservable()}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=en({token:e,factory:e.\u0275fac});let r=e;return r})(),uD=(()=>{let e=class e{constructor(n,i){this.elementRef=n,this.svgService=i}onPointerDown(n){if(n.button!==0&&n.button!==1&&n.button!==5)return;this.elementRef.nativeElement.setPointerCapture(n.pointerId);let i=n;this.svgService.onPointerDown(i)}onPointerMove(n){if(n.clientX===this.lastX&&n.clientY===this.lastY)return;this.lastX=n.clientX,this.lastY=n.clientY;let i=n;this.svgService.onPointerMove(i)}onPointerUp(n){if(n.button!==0&&n.button!==1&&n.button!==2&&n.button!==5)return;this.lastX=n.clientX,this.lastY=n.clientY,this.elementRef.nativeElement.hasPointerCapture(n.pointerId)&&this.elementRef.nativeElement?.releasePointerCapture(n.pointerId);let i=n;this.svgService.onPointerUp(i)}};e.\u0275fac=function(i){return new(i||e)(Ie(tn),Ie(gf))},e.\u0275dir=Ii({type:e,selectors:[["","svg",""]],hostBindings:function(i,s){i&1&&X("pointerdown",function(a){return s.onPointerDown(a)})("pointermove",function(a){return s.onPointerMove(a)})("pointerup",function(a){return s.onPointerUp(a)})}});let r=e;return r})(),cf={size:1,smoothing:1,thinning:0,streamline:.9},$v=(()=>{let e=class e{set data(n){n&&this._data.next(n)}get data(){return this._data.getValue()}set selectedTool(n){this._selectedTool!==n&&(this._selectedTool===Je.TEXT&&this.tempElement?.type===yt.TEXT&&this.finishTextInput(),this._selectedTool=n,this.toolChanged.emit(n),this.clearSelectedElement(),this.tempElement=null)}get selectedTool(){return this._selectedTool}constructor(n,i,s){this.whiteboardService=n,this._cd=i,this._svgService=s,this._data=new Vc([]),this.drawingEnabled=!0,this.canvasWidth=800,this.canvasHeight=600,this.fullScreen=!0,this.center=!0,this.strokeColor="#000",this.strokeWidth=2,this.backgroundColor="#fff",this.lineJoin=xs.ROUND,this.lineCap=bs.ROUND,this.fill="#333",this.zoom=1,this.fontFamily="sans-serif",this.fontSize=24,this.dasharray="",this.dashoffset=0,this.x=0,this.y=0,this.enableGrid=!1,this.gridSize=10,this.snapToGrid=!1,this.ready=new ct,this.dataChange=new ct,this.clear=new ct,this.undo=new ct,this.redo=new ct,this.save=new ct,this.imageAdded=new ct,this.selectElement=new ct,this.deleteElement=new ct,this.toolChanged=new ct,this._subscriptionList=[],this._initialData=[],this.undoStack=[],this.redoStack=[],this._selectedTool=Je.BRUSH,this.types=yt,this.tools=Je,this.rubberBox={x:0,y:0,width:0,height:0,display:"none"}}ngOnInit(){this._initInputsFromOptions(this.options),this._initObservables(),this._initialData=JSON.parse(JSON.stringify(this.data))}ngOnChanges(n){n.options&&this._initInputsFromOptions(n.options.currentValue)}ngAfterViewInit(){this._resizeScreen(),this._cd.detectChanges(),this.ready.emit()}ngOnDestroy(){this._subscriptionList.forEach(n=>this._unsubscribe(n))}_initInputsFromOptions(n){n&&(n.drawingEnabled!=null&&(this.drawingEnabled=n.drawingEnabled),n.selectedTool!=null&&(this.selectedTool=n.selectedTool),n.canvasWidth!=null&&(this.canvasWidth=n.canvasWidth),n.canvasHeight!=null&&(this.canvasHeight=n.canvasHeight),n.fullScreen!=null&&(this.fullScreen=n.fullScreen),n.center!=null&&(this.center=n.center),n.strokeColor!=null&&(this.strokeColor=n.strokeColor),n.strokeWidth!=null&&(this.strokeWidth=n.strokeWidth),n.backgroundColor!=null&&(this.backgroundColor=n.backgroundColor),n.lineJoin!=null&&(this.lineJoin=n.lineJoin),n.lineCap!=null&&(this.lineCap=n.lineCap),n.fill!=null&&(this.fill=n.fill),n.zoom!=null&&(this.zoom=n.zoom),n.fontFamily!=null&&(this.fontFamily=n.fontFamily),n.fontSize!=null&&(this.fontSize=n.fontSize),n.dasharray!=null&&(this.dasharray=n.dasharray),n.dashoffset!=null&&(this.dashoffset=n.dashoffset),n.x!=null&&(this.x=n.x),n.y!=null&&(this.y=n.y),n.enableGrid!=null&&(this.enableGrid=n.enableGrid),n.gridSize!=null&&(this.gridSize=n.gridSize),n.snapToGrid!=null&&(this.snapToGrid=n.snapToGrid))}_initObservables(){this._subscriptionList.push(this._svgService.getPointerDown$().subscribe(this.handleStartEvent.bind(this))),this._subscriptionList.push(this._svgService.getPointerMove$().subscribe(this.handleDragEvent.bind(this))),this._subscriptionList.push(this._svgService.getPointerUp$().subscribe(this.handleEndEvent.bind(this))),this._subscriptionList.push(this.whiteboardService.saveMethodCalled$.subscribe(({name:n,format:i})=>this.saveDraw(n,i))),this._subscriptionList.push(this.whiteboardService.addImageMethodCalled$.subscribe(n=>this.addImage(n))),this._subscriptionList.push(this.whiteboardService.eraseMethodCalled$.subscribe(()=>this.clearDraw())),this._subscriptionList.push(this.whiteboardService.undoMethodCalled$.subscribe(()=>this.undoDraw())),this._subscriptionList.push(this.whiteboardService.redoMethodCalled$.subscribe(()=>this.redoDraw())),this._subscriptionList.push(iv(window,"resize").subscribe(()=>this._resizeScreen())),this._subscriptionList.push(this._data.pipe(ov(1)).subscribe(n=>{this.dataChange.emit(n)}))}handleStartEvent(n){this.redoStack=[];let s={[Je.BRUSH]:this.handleStartBrush,[Je.IMAGE]:this.handleImageTool,[Je.LINE]:this.handleStartLine,[Je.RECT]:this.handleStartRect,[Je.ELLIPSE]:this.handleStartEllipse,[Je.TEXT]:this.handleTextTool,[Je.SELECT]:this.handleSelectTool,[Je.ERASER]:this.handleEraserTool}[this.selectedTool];s&&s.apply(this,[n])}handleDragEvent(n){let s={[Je.BRUSH]:this.handleDragBrush,[Je.LINE]:this.handleDragLine,[Je.RECT]:this.handleDragRect,[Je.ELLIPSE]:this.handleDragEllipse,[Je.TEXT]:this.handleTextDrag}[this.selectedTool];s&&s.apply(this,[n])}handleEndEvent(n){let s={[Je.BRUSH]:this.handleEndBrush,[Je.LINE]:this.handleEndLine,[Je.RECT]:this.handleEndRect,[Je.ELLIPSE]:this.handleEndEllipse,[Je.TEXT]:this.handleTextEnd}[this.selectedTool];s&&s.apply(this,[n])}handleStartBrush(n){let i=this._generateNewElement(yt.BRUSH);this.tempDraw=[this._calculateXAndY([n.offsetX,n.offsetY])];let s=Xc(this.tempDraw,cf),o=St.getSvgPathFromStroke(s);i.value=o,i.options.strokeWidth=this.strokeWidth,this.tempElement=i}handleDragBrush(n){this.tempDraw.push(this._calculateXAndY([n.offsetX,n.offsetY]));let i=Xc(this.tempDraw,cf),s=St.getSvgPathFromStroke(i);this.tempElement.value=s}handleEndBrush(n){this.tempDraw.push(this._calculateXAndY([n.offsetX,n.offsetY]));let i=Xc(this.tempDraw,cf),s=St.getSvgPathFromStroke(i);this.tempElement.value=s,this._pushToData(this.tempElement),this._pushToUndo(),this.tempDraw=null,this.tempElement=null}handleImageTool(n){let[i,s]=this._calculateXAndY([n.offsetX,n.offsetY]),o=document.createElement("input");o.type="file",o.accept="image/*",o.onchange=a=>{let c=a.target.files;if(c){let l=new FileReader;l.onload=d=>{let h=d.target.result;this.addImage({image:h,x:i,y:s})},l.readAsDataURL(c[0])}},o.click()}handleStartLine(n){let i=this._generateNewElement(yt.LINE),[s,o]=this._calculateXAndY([n.offsetX,n.offsetY]);this.snapToGrid&&(s=St.snapToGrid(s,this.gridSize),o=St.snapToGrid(o,this.gridSize)),i.options.x1=s,i.options.y1=o,i.options.x2=s,i.options.y2=o,this.tempElement=i}handleDragLine(n){let[i,s]=this._calculateXAndY([n.offsetX,n.offsetY]);if(this.snapToGrid&&(i=St.snapToGrid(i,this.gridSize),s=St.snapToGrid(s,this.gridSize)),n.shiftKey){let o=this.tempElement.options.x1,a=this.tempElement.options.y1,{x:c,y:l}=St.snapToAngle(o,a,i,s);[i,s]=[c,l]}this.tempElement.options.x2=i,this.tempElement.options.y2=s}handleEndLine(){(this.tempElement.options.x1!=this.tempElement.options.x2||this.tempElement.options.y1!=this.tempElement.options.y2)&&(this._pushToData(this.tempElement),this._pushToUndo(),this.tempElement=null)}handleStartRect(n){let i=this._generateNewElement(yt.RECT),[s,o]=this._calculateXAndY([n.offsetX,n.offsetY]);this.snapToGrid&&(s=St.snapToGrid(s,this.gridSize),o=St.snapToGrid(o,this.gridSize)),i.options.x1=s,i.options.y1=o,i.options.x2=s,i.options.y2=o,i.options.width=1,i.options.height=1,this.tempElement=i}handleDragRect(n){let[i,s]=this._calculateXAndY([n.offsetX,n.offsetY]),o=this.tempElement.options.x1||0,a=this.tempElement.options.y1||0,c=Math.abs(i-o),l=Math.abs(s-a),d=null,h=null;n.shiftKey?(c=l=Math.max(c,l),d=o<i?o:o-c,h=a<s?a:a-l):(d=Math.min(o,i),h=Math.min(a,s)),n.altKey&&(c*=2,l*=2,d=o-c/2,h=a-l/2),this.snapToGrid&&(c=St.snapToGrid(c,this.gridSize),l=St.snapToGrid(l,this.gridSize),d=St.snapToGrid(d,this.gridSize),h=St.snapToGrid(h,this.gridSize)),this.tempElement.options.width=c,this.tempElement.options.height=l,this.tempElement.options.x2=d,this.tempElement.options.y2=h}handleEndRect(){(this.tempElement.options.width!=0||this.tempElement.options.height!=0)&&(this._pushToData(this.tempElement),this._pushToUndo(),this.tempElement=null)}handleStartEllipse(n){let i=this._generateNewElement(yt.ELLIPSE),[s,o]=this._calculateXAndY([n.offsetX,n.offsetY]);i.options.x1=s,i.options.y1=o,i.options.cx=s,i.options.cy=o,this.tempElement=i}handleDragEllipse(n){let[i,s]=this._calculateXAndY([n.offsetX,n.offsetY]),o=this.tempElement.options.x1||0,a=this.tempElement.options.y1||0,c=Math.abs(o+(i-o)/2),l=Math.abs(a+(s-a)/2),d=Math.abs(o-c),h=Math.abs(a-l);n.shiftKey&&(h=d,l=s>a?a+d:a-d),n.altKey&&(c=o,l=a,d=Math.abs(i-c),h=n.shiftKey?d:Math.abs(s-l)),this.tempElement.options.rx=d,this.tempElement.options.ry=h,this.tempElement.options.cx=c,this.tempElement.options.cy=l}handleEndEllipse(){(this.tempElement.options.rx!=0||this.tempElement.options.ry!=0)&&(this._pushToData(this.tempElement),this._pushToUndo(),this.tempElement=null)}handleTextTool(n){if(this.tempElement){this.finishTextInput();return}let i=this._getTargetElement(n);if(i&&i.type===yt.TEXT)this._removeFromData(i);else{i=this._generateNewElement(yt.TEXT);let[s,o]=this._calculateXAndY([n.offsetX,n.offsetY]);i.options.top=o,i.options.left=s,i.options.strokeWidth=0}this.tempElement=i,this._cd.detectChanges(),setTimeout(()=>{this.textInput.nativeElement.focus()},0)}handleTextDrag(n){if(!this.tempElement)return;let[i,s]=this._calculateXAndY([n.offsetX,n.offsetY]);this.tempElement.options.top=s,this.tempElement.options.left=i}handleTextEnd(){this.tempElement&&this._pushToUndo()}handleSelectTool(n){let i=this._getMouseTarget(n);if(i){if(i.id==="selectorGroup")return;let s=i.getAttribute("data-wb-id"),o=this.data.find(a=>a.id===s);this.setSelectedElement(o)}else this.clearSelectedElement()}handleEraserTool(n){let i=this._getTargetElement(n);i&&(this.data=this.data.filter(s=>s.id!==i.id),this._pushToUndo(),this.deleteElement.emit(i))}finishTextInput(){let n=this.textInput.nativeElement.value;this.tempElement.value=n,this.tempElement.value&&(this._pushToData(this.tempElement),this._pushToUndo()),this.tempElement=null}updateTextItem(n){this.tempElement&&this.selectedTool==Je.TEXT&&(this.tempElement.value=n)}setSelectedElement(n){this.selectedTool=Je.SELECT;let i=this._getElementBbox(n);this.selectedElement=n,this.selectElement.emit(n),this._showGrips(i)}clearSelectedElement(){this.selectedElement=null,this.rubberBox.display="none",this.selectElement.emit(null)}addImage(n){let i=new Image;i.onload=()=>{let s=this.canvasHeight,o=i.width,a=i.height,c=i.width/i.height,l=a>s?s-40:a,d=l===s-40?(s-40)*c:o,h=n.x||(o-d)*(n.x||0),u=n.y||(a-l)*(n.y||0);h<0&&(h=0),u<0&&(u=0);let f=this._generateNewElement(yt.IMAGE);f.value=n.image,f.options.width=d,f.options.height=l,f.x=h,f.y=u,this._pushToData(f),this.imageAdded.emit(),this._pushToUndo()},i.src=n.image}saveDraw(n,i){return y(this,null,function*(){let o=this.svgContainer.nativeElement.getElementById("svgcontent").cloneNode(!0),a=o.getElementById("selectorParentGroup");a&&a.remove();let c=o.getElementById("contentBackground");c&&c.removeAttribute("opacity"),o.setAttribute("x","0"),o.setAttribute("y","0");let l=new XMLSerializer().serializeToString(o),d=yield St.svgToBase64(l,this.canvasWidth,this.canvasHeight,i);switch(i){case ki.Base64:this.save.emit(d);break;case ki.Svg:{let h="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l)));St.downloadFile(h,n),this.save.emit(h);break}default:St.downloadFile(d,n),this.save.emit(d);break}})}clearDraw(){this.data=[],this._data.next(this.data),this._pushToUndo(),this.clear.emit()}undoDraw(){if(!this.undoStack.length)return;let n=this.undoStack.pop();this.redoStack.push(n),this.undoStack.length?this.data=JSON.parse(JSON.stringify(this.undoStack[this.undoStack.length-1])):this.data=JSON.parse(JSON.stringify(this._initialData)),this.undo.emit()}redoDraw(){if(!this.redoStack.length)return;let n=this.redoStack.pop();this.undoStack.push(JSON.parse(JSON.stringify(n))),this.data=n,this.redo.emit()}_pushToUndo(){this.undoStack.push(JSON.parse(JSON.stringify(this.data)))}_pushToData(n){this.data.push(n),this._data.next(this.data)}_removeFromData(n){let i=this.data.indexOf(n);i>-1&&(this.data.splice(i,1),this._data.next(this.data))}_generateNewElement(n){return new mf(n,{strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fill:this.fill,lineJoin:this.lineJoin,lineCap:this.lineCap,fontSize:this.fontSize,fontFamily:this.fontFamily,dasharray:this.dasharray,dashoffset:this.dashoffset})}_calculateXAndY([n,i]){return[(n-this.x)/this.zoom,(i-this.y)/this.zoom]}_resizeScreen(){let n=this.svgContainer.nativeElement;this.fullScreen&&(this.canvasWidth=n.clientWidth,this.canvasHeight=n.clientHeight),this.center&&(this.x=n.clientWidth/2-this.canvasWidth/2,this.y=n.clientHeight/2-this.canvasHeight/2)}_getElementBbox(n){let i=`item_${n.id}`;return this.svgContainer.nativeElement.getElementById(i).getBBox()}_getMouseTarget(n){if(n==null||n.target==null)return null;let i=n.target;if(i.id==="svgroot")return null;if(i.parentNode){if(i=i.parentNode.parentNode,i.id==="selectorGroup")return i;for(;!i.id.includes("item_");){if(i.id==="svgroot")return null;i=i.parentNode}}return i}_getTargetElement(n){let i=this._getMouseTarget(n);if(i){if(i.id==="selectorGroup")return null;let s=i.getAttribute("data-wb-id");return this.data.find(o=>o.id===s)}return null}_showGrips(n){this.rubberBox={x:n.x-(this.selectedElement.options.strokeWidth||0)*.5,y:n.y-(this.selectedElement.options.strokeWidth||0)*.5,width:n.width+this.selectedElement.options.strokeWidth||0,height:n.height+this.selectedElement.options.strokeWidth||0,display:"block"}}moveSelect(n){let i=!0;n.stopPropagation();let s=n.target;s.addEventListener("pointermove",o=>{i&&this.selectedElement&&(this.selectedElement.x+=o.movementX,this.selectedElement.y+=o.movementY)}),s.addEventListener("pointerup",()=>{i=!1})}resizeSelect(n){let i=!0,s=n.target;document.addEventListener("pointermove",o=>{if(!i)return;let a=s.id.split("_")[2],c=o.movementX,l=o.movementY,d=this._getElementBbox(this.selectedElement),h=d.width,u=d.height;switch(this.selectedElement.type){case yt.ELLIPSE:this._resizeElipse(a,{x:c,y:l,width:h,height:u});break;case yt.LINE:this._resizeLine(a,{x:c,y:l,width:h,height:u});break;default:this._resizeDefault(a,{x:c,y:l,width:h,height:u});break}this._showGrips(this._getElementBbox(this.selectedElement))}),document.addEventListener("pointerup",()=>{i=!1})}_resizeLine(n,i){switch(n){case"nw":this.selectedElement.options.x1+=i.x,this.selectedElement.options.y1+=i.y;break;case"n":this.selectedElement.options.y1+=i.y;break;case"ne":this.selectedElement.options.x2+=i.x,this.selectedElement.options.y1+=i.y;break;case"e":this.selectedElement.options.x2+=i.x;break;case"se":this.selectedElement.options.x2+=i.x,this.selectedElement.options.y2+=i.y;break;case"s":this.selectedElement.options.y2+=i.y;break;case"sw":this.selectedElement.options.x1+=i.x,this.selectedElement.options.y2+=i.y;break;case"w":this.selectedElement.options.x1+=i.x;break}}_resizeElipse(n,i){switch(n){case"nw":this.selectedElement.x+=i.x/2,this.selectedElement.y+=i.y/2,this.selectedElement.options.rx-=i.x/2,this.selectedElement.options.ry-=i.y/2;break;case"n":this.selectedElement.y+=i.y/2,this.selectedElement.options.ry-=i.y/2;break;case"ne":this.selectedElement.x+=i.x/2,this.selectedElement.y+=i.y/2,this.selectedElement.options.rx+=i.x/2,this.selectedElement.options.ry-=i.y/2;break;case"e":this.selectedElement.x+=i.x/2,this.selectedElement.options.rx+=i.x/2;break;case"se":this.selectedElement.x+=i.x/2,this.selectedElement.y+=i.y/2,this.selectedElement.options.rx+=i.x/2,this.selectedElement.options.ry+=i.y/2;break;case"s":this.selectedElement.y+=i.y/2,this.selectedElement.options.ry+=i.y/2;break;case"sw":this.selectedElement.x+=i.x/2,this.selectedElement.y+=i.y/2,this.selectedElement.options.rx-=i.x/2,this.selectedElement.options.ry+=i.y/2;break;case"w":this.selectedElement.x+=i.x/2,this.selectedElement.options.rx-=i.x/2;break}}_resizeDefault(n,i){switch(n){case"nw":this.selectedElement.x+=i.x,this.selectedElement.y+=i.y,this.selectedElement.options.width=i.width-i.x,this.selectedElement.options.height=i.height-i.y;break;case"n":this.selectedElement.y+=i.y,this.selectedElement.options.height=i.height-i.y;break;case"ne":this.selectedElement.y+=i.y,this.selectedElement.options.width=i.width+i.x,this.selectedElement.options.height=i.height-i.y;break;case"e":this.selectedElement.options.width=i.width+i.x;break;case"se":this.selectedElement.options.width=i.width+i.x,this.selectedElement.options.height=i.height+i.y;break;case"s":this.selectedElement.options.height=i.height+i.y;break;case"sw":this.selectedElement.x+=i.x,this.selectedElement.options.width=i.width-i.x,this.selectedElement.options.height=i.height+i.y;break;case"w":this.selectedElement.x+=i.x,this.selectedElement.options.width=i.width-i.x;break}}_unsubscribe(n){n&&n.unsubscribe()}};e.\u0275fac=function(i){return new(i||e)(Ie(Zo),Ie(Ni),Ie(gf))},e.\u0275cmp=Sn({type:e,selectors:[["ng-whiteboard"]],viewQuery:function(i,s){if(i&1&&(Sr(HA,5),Sr(VA,5)),i&2){let o;wr(o=Cr())&&(s.svgContainer=o.first),wr(o=Cr())&&(s.textInput=o.first)}},inputs:{data:"data",options:"options",selectedTool:"selectedTool",drawingEnabled:"drawingEnabled",canvasWidth:"canvasWidth",canvasHeight:"canvasHeight",fullScreen:"fullScreen",center:"center",strokeColor:"strokeColor",strokeWidth:"strokeWidth",backgroundColor:"backgroundColor",lineJoin:"lineJoin",lineCap:"lineCap",fill:"fill",zoom:"zoom",fontFamily:"fontFamily",fontSize:"fontSize",dasharray:"dasharray",dashoffset:"dashoffset",x:"x",y:"y",enableGrid:"enableGrid",gridSize:"gridSize",snapToGrid:"snapToGrid"},outputs:{ready:"ready",dataChange:"dataChange",clear:"clear",undo:"undo",redo:"redo",save:"save",imageAdded:"imageAdded",selectElement:"selectElement",deleteElement:"deleteElement",toolChanged:"toolChanged"},features:[gs([gf]),Uc],decls:19,vars:24,consts:[["svgContainer",""],["textInput",""],["id","svgroot","xlinkns","http://www.w3.org/2000/svg","svg",""],["id","canvasBackground",2,"pointer-events","none"],["id","grid-pattern"],["id","smallGrid","patternUnits","userSpaceOnUse"],["fill","none","stroke","gray","stroke-width","0.5"],["id","grid","width","100","height","100","patternUnits","userSpaceOnUse"],["width","100","height","100","fill","url(#smallGrid)"],["d","M 100 0 H 0 V 100","fill","none","stroke","gray","stroke-width","2"],["id","placeholder_defs"],["width","100%","height","100%","x","0","y","0","stroke-width","0","stroke","transparent",2,"pointer-events","none"],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","id","svgcontent"],["id","contentBackground","opacity","0","width","100%","height","100%","x","0","y","0","stroke-width","0","stroke","transparent"],[2,"pointer-events","all"],[4,"ngFor","ngForOf"],["class","temp-element",3,"ngSwitch",4,"ngIf"],["id","selectorParentGroup",4,"ngIf"],[3,"font-family","font-size","pointer-events","width","height","position","top","left",4,"ngIf"],["x","-100","y","-100","fill","url(#grid)"],[1,"wb_element",3,"id","ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["fill","none",1,"brush"],["preserveAspectRatio","none",2,"pointer-events","inherit"],[1,"line",2,"pointer-events","inherit"],[1,"rect"],[2,"pointer-events","inherit"],["text-anchor","start",0,"xml","space","preserve","alignment-baseline","before-edge",1,"text_element",2,"pointer-events","inherit","white-space","normal"],[1,"temp-element",3,"ngSwitch"],["id","selectorParentGroup"],["id","selectorGroup","transform","",1,"selectorGroup"],["display","inline"],["id","selectedBox","fill","none","stroke","#4F80FF","shape-rendering","crispEdges",2,"cursor","move",3,"pointerdown"],["id","selectorGrip_rotate_nw","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_rotate_ne","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_rotate_se","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_rotate_sw","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_resize_nw","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","nw-resize",3,"pointerdown"],["id","selectorGrip_resize_n","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","n-resize",3,"pointerdown"],["id","selectorGrip_resize_ne","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","ne-resize",3,"pointerdown"],["id","selectorGrip_resize_e","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","e-resize",3,"pointerdown"],["id","selectorGrip_resize_se","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","se-resize",3,"pointerdown"],["id","selectorGrip_resize_s","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","s-resize",3,"pointerdown"],["id","selectorGrip_resize_sw","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","sw-resize",3,"pointerdown"],["id","selectorGrip_resize_w","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","w-resize",3,"pointerdown"],["type","text","autofocus","",1,"text-input",3,"input","value"]],template:function(i,s){i&1&&(ge(),k(0,"svg",2,0)(2,"svg",3)(3,"defs",4)(4,"pattern",5),oe(5,"path",6),j(),k(6,"pattern",7),oe(7,"rect",8)(8,"path",9),j()(),oe(9,"defs",10)(10,"rect",11),ft(11,GA,2,2,"g",12),j(),k(12,"svg",13),oe(13,"rect",14),k(14,"g",15),ft(15,ZA,9,11,"ng-container",16)(16,aD,8,7,"g",17)(17,cD,17,31,"g",18),j()()(),ft(18,lD,3,27,"div",19)),i&2&&(mv("svgroot "+s.selectedTool),H(2),Ce("width",s.canvasWidth*s.zoom)("height",s.canvasHeight*s.zoom)("x",s.x)("y",s.y),H(2),Ce("width",s.gridSize)("height",s.gridSize),H(),Ce("d","M "+s.gridSize+" 0 H 0 V "+s.gridSize),H(5),Ce("fill",s.backgroundColor),H(),Y("ngIf",s.enableGrid),H(),Ce("width",s.canvasWidth*s.zoom)("height",s.canvasHeight*s.zoom)("viewBox",vv(21,UA,s.canvasWidth,s.canvasHeight))("x",s.x)("y",s.y),H(),Ce("fill",s.backgroundColor),H(2),Y("ngForOf",s.data),H(),Y("ngIf",s.tempElement),H(),Y("ngIf",s.selectedElement),H(),Y("ngIf",s.tempElement&&s.selectedTool===s.tools.TEXT))},dependencies:[vs,Ri,Kc,$c,Jc,uD],styles:['[_nghost-%COMP%]{width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit;background-size:cover;background-position:50%;background-repeat:no-repeat;touch-action:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%], [_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .selectorGroup[_ngcontent-%COMP%]{transform-box:fill-box;transform-origin:center}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-family:Arial,Helvetica,sans-serif}[_nghost-%COMP%]   .svgroot.drawing[_ngcontent-%COMP%]{cursor:url("data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 height%3D%2220%22 width%3D%2220%22%3E  %3Ccircle cx%3D%225%22 cy%3D%225%22 r%3D%225%22 style%3D%22fill%3A none%3B stroke%3A %235a5a5a%3B stroke-width%3A .02em%3B%22 %2F%3E%3C%2Fsvg%3E") 5 5,crosshair}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .HAND[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]   .SELECT[_ngcontent-%COMP%]{cursor:default}[_nghost-%COMP%]   .BRUSH[_ngcontent-%COMP%]{cursor:url("data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 width%3D%2224%22 height%3D%2224%22%3E%3Cpath fill%3D%22%23333%22 stroke-width%3D%221%22 stroke%3D%22%23ccc%22 d%3D%22m16.318 6.11l-3.536-3.535l1.415-1.414c.63-.63 2.073-.755 2.828 0l.707.707c.755.755.631 2.198 0 2.829L16.318 6.11zm-1.414 1.415l-9.9 9.9l-4.596 1.06l1.06-4.596l9.9-9.9l3.536 3.536z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E") 1 18,crosshair}[_nghost-%COMP%]   .IMAGE[_ngcontent-%COMP%]{cursor:copy}[_nghost-%COMP%]   .LINE[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .RECT[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .ELLIPSE[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .TEXT[_ngcontent-%COMP%]{cursor:text}[_nghost-%COMP%]   .ERASER[_ngcontent-%COMP%]{cursor:url("data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 width%3D%2224%22 height%3D%2224%22%3E    %3Cpath fill%3D%22%23333%22 stroke-width%3D%221%22 stroke%3D%22%23ccc%22 d%3D%22M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm2.121.707a1 1 0 0 0-1.414 0L4.16 7.547l5.293 5.293l4.633-4.633a1 1 0 0 0 0-1.414l-3.879-3.879zM8.746 13.547L3.453 8.254L1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E") 0 12,crosshair}.foreign[_ngcontent-%COMP%]{text-align:left}.insideforeign[_ngcontent-%COMP%]{display:inline-block}.text-input[_ngcontent-%COMP%]{position:absolute;background:transparent;border:1px dashed #0b89f0;outline:none;height:25px;font-size:inherit;font-family:inherit;min-width:5ch;height:2ch;padding:0;pointer-events:auto;z-index:5}']});let r=e;return r})(),Jv=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=ps({type:e}),e.\u0275inj=ds({imports:[Un]});let r=e;return r})();var dD=["hueSlider"],fD=["alphaSlider"];function pD(r,e){if(r&1){let t=$e();k(0,"div",10),X("newValue",function(i){K(t);let s=G();return $(s.onSliderChange("saturation-lightness",i))}),k(1,"div",11),oe(2,"div"),j()()}if(r&2){let t=G();Vt("background-color",t.hueSliderColor),Y("rgX",1)("rgY",1),H(),Vt("top",t.slider==null?null:t.slider.v,"px")("left",t.slider==null?null:t.slider.s,"px")}}function mD(r,e){if(r&1&&(k(0,"div",12),oe(1,"div",13)(2,"div",14),j()),r&2){let t=G();H(2),Vt("background-color",t.selectedColor)}}function gD(r,e){if(r&1){let t=$e();k(0,"div",15,1),X("newValue",function(i){K(t);let s=G();return $(s.onSliderChange("hue",i))}),k(2,"div",16)(3,"div"),oe(4,"div"),j()()()}if(r&2){let t=G();Y("rgX",1),H(2),Vt("left",t.slider==null?null:t.slider.h,"px")}}function vD(r,e){if(r&1){let t=$e();k(0,"div",17,2),X("newValue",function(i){K(t);let s=G();return $(s.onSliderChange("alpha",i))}),oe(2,"div",18),k(3,"div",16)(4,"div"),oe(5,"div"),j()()()}if(r&2){let t=G();Y("rgX",1),H(2),Y("ngStyle",t.getBackgroundColor(t.alphaSliderColor)),H(),Vt("left",t.slider==null?null:t.slider.a,"px")}}var yD=["dialog"],bD=r=>({background:r});function xD(r,e){r&1&&oe(0,"div",12)}function SD(r,e){if(r&1){let t=$e();lt(0),k(1,"div",9)(2,"div",10),X("click",function(){let i=K(t).$implicit,s=G(2);return $(s.onColorClick(i))}),ft(3,xD,1,0,"div",11),j()(),ut()}if(r&2){let t=e.$implicit,n=e.index,i=G(2);H(2),Rt("colornull",!t),Y("ngStyle",i.getBackgroundColor(t)),H(),Y("ngIf",n==i.indexSeleccionado)}}function wD(r,e){if(r&1&&oe(0,"div",18),r&2){let t=G(3);Y("ngStyle",t.getBackgroundColor(t.color))}}function CD(r,e){if(r&1){let t=$e();k(0,"div",13),X("click",function(){K(t);let i=G(2);return $(i.addColor())}),ft(1,wD,1,1,"div",14),ge(),k(2,"svg",15),oe(3,"path",16)(4,"path",17),j()()}if(r&2){let t=G(2);H(),Y("ngIf",t.indexSeleccionado===void 0)}}function ED(r,e){if(r&1){let t=$e();k(0,"color-picker",19),X("colorChange",function(i){K(t);let s=G(2);return $(s.onChangeColorPicker(i))})("onAlphaChange",function(i){K(t);let s=G(2);return $(s.onAlphaChange(i))}),j()}if(r&2){let t=G(2);Y("controls",t.colorPickerControls)("color",t.hsva)}}function _D(r,e){if(r&1&&(lt(0),k(1,"div",5),ft(2,SD,4,4,"ng-container",6)(3,CD,5,1,"div",7)(4,ED,1,2,"color-picker",8),j(),ut()),r&2){let t=G();H(),Y("@colorsAnimation",t.colorsAnimationEffect),H(),Y("ngForOf",t.palette),H(),Y("ngIf",!t.hideColorPicker&&t.colorPickerControls!="only-alpha"),H(),Y("ngIf",!t.hideColorPicker&&t.colorPickerControls=="only-alpha")}}function TD(r,e){r&1&&oe(0,"div",12)}function AD(r,e){if(r&1){let t=$e();lt(0),k(1,"div",9)(2,"div",25),X("click",function(){let i=K(t).$implicit,s=G(2);return $(s.changeColor(i))}),ft(3,TD,1,0,"div",11),j()(),ut()}if(r&2){let t=e.$implicit,n=G(2);H(2),Rt("colornull",!t),Y("ngStyle",gv(4,bD,t)),H(),Y("ngIf",n.isSelected(t))}}function DD(r,e){if(r&1){let t=$e();lt(0),k(1,"div",5)(2,"div",20)(3,"div",21),X("click",function(){K(t);let i=G();return $(i.onClickBack())}),ge(),k(4,"svg",22),oe(5,"path",23)(6,"path",24),j()()(),ft(7,AD,4,6,"ng-container",6),j(),ut()}if(r&2){let t=G();H(),Y("@colorsAnimation",t.colorsAnimationEffect),H(6),Y("ngForOf",t.variants)}}function FD(r,e){if(r&1){let t=$e();lt(0),k(1,"div",26)(2,"div",27),X("click",function(){K(t);let i=G();return $(i.onClickBack())}),ge(),k(3,"svg",22),oe(4,"path",23)(5,"path",24),j()(),vt(),k(6,"button",28),X("click",function(){K(t);let i=G();return $(i.emitClose("cancel"))}),re(7),j(),k(8,"button",28),X("click",function(){K(t);let i=G();return $(i.emitClose("accept"))}),re(9),j()(),k(10,"div",29)(11,"color-picker",30),X("sliderChange",function(i){K(t);let s=G();return $(s.onChangeColorPicker(i))}),j()(),ut()}if(r&2){let t=G();H(7),Oi(" ",t.cancelLabel," "),H(2),Oi(" ",t.acceptLabel," "),H(2),Y("controls",t.colorPickerControls)("color",t.hsva)}}function PD(r,e){if(r&1){let t=$e();k(0,"div",31)(1,"p",32),X("click",function(){K(t);let i=G();return $(i.nextFormat())}),re(2),j(),k(3,"div",33)(4,"input",34,1),X("keyup",function(){K(t);let i=ae(5),s=G();return $(s.changeColorManual(i.value))})("keydown.enter",function(){K(t);let i=G();return $(i.emitClose("accept"))}),j()()()}if(r&2){let t=G();H(2),ms(t.colorFormats[t.format]),H(2),Vt("font-size",t.color&&t.color.length>23?9:10,"px")("letter-spacing",t.color&&t.color.length>16?0:1.5,"px"),Y("placeholder",t.placeholder)("value",t.color)}}var ea=["hex","rgba","hsla"],Cn=function(r){return r[r.HEX=0]="HEX",r[r.RGBA=1]="RGBA",r[r.HSLA=2]="HSLA",r[r.CMYK=3]="CMYK",r}(Cn||{}),Xv=[{color:"rojo",preview:"#E57373",variants:["#FFEBEE","#FFCDD2","#EF9A9A","#E57373","#EF5350","#F44336","#E53935","#D32F2F","#C62828"]},{color:"rosa",preview:"#F06292",variants:["#FCE4EC","#F8BBD0","#F48FB1","#F06292","#EC407A","#E91E63","#D81B60","#C2185B","#AD1457"]},{color:"purpura",preview:"#BA68C8",variants:["#F3E5F5","#E1BEE7","#CE93D8","#BA68C8","#AB47BC","#9C27B0","#8E24AA","#7B1FA2","#6A1B9A"]},{color:"purpura oscuro",preview:"#9575CD",variants:["#EDE7F6","#D1C4E9","#B39DDB","#9575CD","#7E57C2","#673AB7","#5E35B1","#512DA8","#4527A0"]},{color:"indigo",preview:"#7986CB",variants:["#E8EAF6","#C5CAE9","#9FA8DA","#7986CB","#5C6BC0","#3F51B5","#3949AB","#303F9F","#283593"]},{color:"azul",preview:"#64B5F6",variants:["#E3F2FD","#BBDEFB","#90CAF9","#64B5F6","#42A5F5","#2196F3","#1E88E5","#1976D2","#1565C0"]},{color:"celeste",preview:"#4FC3F7",variants:["#E1F5FE","#B3E5FC","#81D4FA","#4FC3F7","#29B6F6","#03A9F4","#039BE5","#0288D1","#0277BD"]},{color:"cyan",preview:"#4DD0E1",variants:["#E0F7FA","#B2EBF2","#80DEEA","#4DD0E1","#26C6DA","#00BCD4","#00ACC1","#0097A7","#00838F"]},{color:"color",preview:"#4DB6AC",variants:["#E0F2F1","#B2DFDB","#80CBC4","#4DB6AC","#26A69A","#009688","#00897B","#00796B","#00695C"]},{color:"verde",preview:"#81C784",variants:["#E8F5E9","#C8E6C9","#A5D6A7","#81C784","#66BB6A","#4CAF50","#43A047","#388E3C","#2E7D32"]},{color:"verde claro",preview:"#AED581",variants:["#F1F8E9","#DCEDC8","#C5E1A5","#AED581","#9CCC65","#8BC34A","#7CB342","#689F38","#558B2F"]},{color:"lima",preview:"#DCE775",variants:["#F9FBE7","#F0F4C3","#E6EE9C","#DCE775","#D4E157","#CDDC39","#C0CA33","#AFB42B","#9E9D24"]},{color:"amarillo",preview:"#FFF176",variants:["#FFFDE7","#FFF9C4","#FFF59D","#FFF176","#FFEE58","#FFEB3B","#FDD835","#FBC02D","#F9A825"]},{color:"ambar",preview:"#FFD54F",variants:["#FFF8E1","#FFECB3","#FFE082","#FFD54F","#FFCA28","#FFC107","#FFB300","#FFA000","#FF8F00"]},{color:"naranja",preview:"#FFB74D",variants:["#FFF3E0","#FFE0B2","#FFCC80","#FFB74D","#FFA726","#FF9800","#FB8C00","#F57C00","#EF6C00"]},{color:"naranja oscuro",preview:"#FF8A65",variants:["#FBE9E7","#FFCCBC","#FFAB91","#FF8A65","#FF7043","#FF5722","#F4511E","#E64A19","#D84315"]},{color:"marron",preview:"#A1887F",variants:["#EFEBE9","#D7CCC8","#BCAAA4","#A1887F","#8D6E63","#795548","#6D4C41","#5D4037","#4E342E"]},{color:"escala de grises",preview:"#E0E0E0",variants:["#FFFFFF","#FAFAFA","#F5F5F5","#EEEEEE","#E0E0E0","#BDBDBD","#9E9E9E","#757575","#616161","#424242","#000000"]},{color:"azul gris",preview:"#90A4AE",variants:["#ECEFF1","#CFD8DC","#B0BEC5","#90A4AE","#78909C","#607D8B","#546E7A","#455A64","#37474F"]}],rn=class{constructor(e,t,n,i){this.r=e,this.g=t,this.b=n,this.a=i}denormalize(){return this.r=Math.round(this.r*255),this.g=Math.round(this.g*255),this.b=Math.round(this.b*255),this}toString(){return this.denormalize(),"rgb"+(this.a!=1?"a(":"(")+this.r+", "+this.g+", "+this.b+(this.a!=1?", "+this.a.toPrecision(2)+")":")")}},zr=class{constructor(e,t,n,i){this.h=e,this.s=t,this.v=n,this.a=i,this.onChange=new ct(!0)}onColorChange(e){this.s=e.s/e.rgX,this.v=e.v/e.rgY}onHueChange(e){this.h=e.v/e.rgX}onValueChange(e){this.v=e.v/e.rgX}onAlphaChange(e){this.a=e.v/e.rgX}},Mi=class{constructor(e,t,n,i){this.h=e,this.s=t,this.l=n,this.a=i}denormalize(){return this.h=Math.round(this.h*360),this.s=Math.round(this.s*100),this.l=Math.round(this.l*100),this}toString(){return"hsl"+(this.a!=1?"a(":"(")+this.h+", "+this.s+"%, "+this.l+"%"+(this.a!=1?", "+this.a.toPrecision(2)+")":")")}},Ss=class{constructor(e,t,n,i,s=1){this.c=e,this.m=t,this.y=n,this.k=i,this.a=s}},vf=class{constructor(e){e&&(this.preview=e.preview,this.variants=e.variants)}},Qc=(()=>{class r{constructor(){}toFormat(t,n){var i="";if(t)switch(n){case Cn.HEX:var o=this.hsvaToRgba(t);o.denormalize();var i=this.rgbaToHex(o,!0);break;case Cn.HSLA:var s=this.hsva2hsla(t);s.denormalize();var i=s.toString();break;case Cn.RGBA:var o=this.hsvaToRgba(t),i=o.toString();break;case Cn.CMYK:var o=this.hsvaToRgba(t),a=this.rgbaToCmyk(o);break}return i}stringToFormat(t,n){var i=this.stringToHsva(t,!0);return this.toFormat(i,n)}hsva2hsla(t){let n=t.h,i=t.s,s=t.v,o=t.a;if(s===0)return new Mi(n,0,0,o);if(i===0&&s===1)return new Mi(n,1,1,o);{let a=s*(2-i)/2;return new Mi(n,s*i/(1-Math.abs(2*a-1)),a,o)}}hsla2hsva(t){let n=Math.min(t.h,1),i=Math.min(t.s,1),s=Math.min(t.l,1),o=Math.min(t.a,1);if(s===0)return new zr(n,0,0,o);{let a=s+i*(1-Math.abs(2*s-1))/2;return new zr(n,2*(a-s)/a,a,o)}}hsvaToRgba(t){let n,i,s,o=t.h,a=t.s,c=t.v,l=t.a,d=Math.floor(o*6),h=o*6-d,u=c*(1-a),f=c*(1-h*a),g=c*(1-(1-h)*a);switch(d%6){case 0:n=c,i=g,s=u;break;case 1:n=f,i=c,s=u;break;case 2:n=u,i=c,s=g;break;case 3:n=u,i=f,s=c;break;case 4:n=g,i=u,s=c;break;case 5:n=c,i=u,s=f;break;default:n=0,i=0,s=0}return new rn(n,i,s,l)}cmykToRgb(t){let n=(1-t.c)*(1-t.k),i=(1-t.m)*(1-t.k),s=(1-t.y)*(1-t.k);return new rn(n,i,s,t.a)}rgbaToCmyk(t){let n=1-Math.max(t.r,t.g,t.b);if(n===1)return new Ss(0,0,0,1,t.a);{let i=(1-t.r-n)/(1-n),s=(1-t.g-n)/(1-n),o=(1-t.b-n)/(1-n);return new Ss(i,s,o,n,t.a)}}rgbaToHsva(t){let n,i,s=Math.min(t.r,1),o=Math.min(t.g,1),a=Math.min(t.b,1),c=Math.min(t.a,1),l=Math.max(s,o,a),d=Math.min(s,o,a),h=l,u=l-d;if(i=l===0?0:u/l,l===d)n=0;else{switch(l){case s:n=(o-a)/u+(o<a?6:0);break;case o:n=(a-s)/u+2;break;case a:n=(s-o)/u+4;break;default:n=0}n/=6}return new zr(n,i,h,c)}rgbaToHex(t,n){let i="#"+(16777216|t.r<<16|t.g<<8|t.b).toString(16).substr(1);return t.a!=1&&(i+=(256|Math.round(t.a*255)).toString(16).substr(1)),i}normalizeCMYK(t){return new Ss(t.c/100,t.m/100,t.y/100,t.k/100,t.a)}denormalizeCMYK(t){return new Ss(Math.floor(t.c*100),Math.floor(t.m*100),Math.floor(t.y*100),Math.floor(t.k*100),t.a)}denormalizeRGBA(t){return new rn(Math.round(t.r*255),Math.round(t.g*255),Math.round(t.b*255),t.a)}stringToHsva(t="",n=!0){let i=null;t=(t||"").toLowerCase();let s=[{re:/(rgb)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*%?,\s*(\d{1,3})\s*%?(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(o){return new rn(parseInt(o[2],10)/255,parseInt(o[3],10)/255,parseInt(o[4],10)/255,isNaN(parseFloat(o[5]))?1:parseFloat(o[5]))}},{re:/(hsl)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})%\s*,\s*(\d{1,3})%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(o){return new Mi(parseInt(o[2],10)/360,parseInt(o[3],10)/100,parseInt(o[4],10)/100,isNaN(parseFloat(o[5]))?1:parseFloat(o[5]))}}];n?s.push({re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})?$/,parse:function(o){return new rn(parseInt(o[1],16)/255,parseInt(o[2],16)/255,parseInt(o[3],16)/255,parseInt(o[4]||"FF",16)/255)}}):s.push({re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/,parse:function(o){return new rn(parseInt(o[1],16)/255,parseInt(o[2],16)/255,parseInt(o[3],16)/255,1)}}),s.push({re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/,parse:function(o){return new rn(parseInt(o[1]+o[1],16)/255,parseInt(o[2]+o[2],16)/255,parseInt(o[3]+o[3],16)/255,1)}});for(let o in s)if(s.hasOwnProperty(o)){let a=s[o],c=a.re.exec(t),l=c&&a.parse(c);if(l)return l instanceof rn?i=this.rgbaToHsva(l):l instanceof Mi&&(i=this.hsla2hsva(l)),i}return i}outputFormat(t){return this.hsvaToRgba(t).toString()}getFormatByString(t){if(t){t=t.toLowerCase();let n=/(#([\da-f]{3}(?:[\da-f]{3})?(?:[\da-f]{2})?))/,i=/(rgba\((\d{1,3},\s?){3}(1|0?\.\d+)\)|rgb\(\d{1,3}(,\s?\d{1,3}){2}\))/,s=/(hsla\((\d{1,3}%?,\s?){3}(1|0?\.\d+)\)|hsl\(\d{1,3}%?(,\s?\d{1,3}%?){2}\))/;if(n.test(t))return"hex";if(i.test(t))return"rgba";if(s.test(t))return"hsla"}return"hex"}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=en({token:r,factory:r.\u0275fac}),r})(),Yc=class{constructor(e,t,n,i){this.h=e,this.s=t,this.v=n,this.a=i}},yf=class{constructor(e,t,n,i){this.h=e,this.s=t,this.v=n,this.a=i}},ID=(()=>{class r{mouseDown(t){this.start(t)}touchStart(t){this.start(t)}constructor(t){this.elRef=t,this.dragEnd=new ct,this.dragStart=new ct,this.newValue=new ct,this.listenerMove=n=>this.move(n),this.listenerStop=()=>this.stop()}move(t){t.preventDefault(),this.setCursor(t)}start(t){this.setCursor(t),t.stopPropagation(),document.addEventListener("mouseup",this.listenerStop),document.addEventListener("touchend",this.listenerStop),document.addEventListener("mousemove",this.listenerMove),document.addEventListener("touchmove",this.listenerMove),this.dragStart.emit()}stop(){document.removeEventListener("mouseup",this.listenerStop),document.removeEventListener("touchend",this.listenerStop),document.removeEventListener("mousemove",this.listenerMove),document.removeEventListener("touchmove",this.listenerMove),this.dragEnd.emit()}getX(t){let n=this.elRef.nativeElement.getBoundingClientRect();return(t.pageX!==void 0?t.pageX:t.touches[0].pageX)-n.left-window.pageXOffset}getY(t){let n=this.elRef.nativeElement.getBoundingClientRect();return(t.pageY!==void 0?t.pageY:t.touches[0].pageY)-n.top-window.pageYOffset}setCursor(t){let n=this.elRef.nativeElement.offsetWidth,i=this.elRef.nativeElement.offsetHeight,s=Math.max(0,Math.min(this.getX(t),n)),o=Math.max(0,Math.min(this.getY(t),i));this.rgX!==void 0&&this.rgY!==void 0?this.newValue.emit({s:s/n,v:1-o/i,rgX:this.rgX,rgY:this.rgY}):this.rgX===void 0&&this.rgY!==void 0?this.newValue.emit({v:o/i,rgY:this.rgY}):this.rgX!==void 0&&this.rgY===void 0&&this.newValue.emit({v:s/n,rgX:this.rgX})}}return r.\u0275fac=function(t){return new(t||r)(Ie(tn))},r.\u0275dir=Ii({type:r,selectors:[["","slider",""]],hostBindings:function(t,n){t&1&&X("mousedown",function(s){return n.mouseDown(s)})("touchstart",function(s){return n.touchStart(s)})},inputs:{rgX:"rgX",rgY:"rgY",slider:"slider"},outputs:{dragEnd:"dragEnd",dragStart:"dragStart",newValue:"newValue"}}),r})(),OD=(()=>{class r{constructor(t,n){this.service=t,this.cdr=n,this.color=new zr(0,1,1,1),this.controls="default",this.sliderChange=new ct(!1),this.onAlphaChange=new ct(!1),this.hsva=new zr(0,1,1,1),this.selectedColor="#000000",this.fallbackColor="#000000"}ngOnInit(){this.color||(this.color=new zr(0,1,1,1)),this.slider=new Yc(0,0,0,0),this.update()}ngOnDestroy(){}ngOnChanges(t){t.color&&this.color&&this.update()}ngAfterViewInit(){let t=this.hueSlider?.nativeElement.offsetWidth||140,n=this.alphaSlider?.nativeElement.offsetWidth||140;this.sliderDimMax=new yf(t,220,130,n),this.update()}onSliderChange(t,n){switch(t){case"saturation-lightness":this.hsva.onColorChange(n);break;case"hue":this.hsva.onHueChange(n);break;case"alpha":this.hsva.onAlphaChange(n),this.onAlphaChange.emit(n);break;case"value":this.hsva.onValueChange(n);break}this.update(),this.setColor(this.outputColor)}setColor(t){this.color=t,this.sliderChange.emit(this.color)}getBackgroundColor(t){return{background:"linear-gradient(90deg, rgba(36,0,0,0) 0%, "+t+" 100%)"}}update(){if(this.hsva=this.color,this.sliderDimMax){let t=this.service.hsvaToRgba(this.hsva).denormalize(),n=this.service.hsvaToRgba(new zr(this.hsva.h,1,1,1)).denormalize();this.hueSliderColor="rgb("+n.r+","+n.g+","+n.b+")",this.alphaSliderColor="rgb("+t.r+","+t.g+","+t.b+")",this.outputColor=this.hsva,this.selectedColor=this.service.hsvaToRgba(this.hsva).toString(),this.slider=new Yc(this.hsva.h*this.sliderDimMax.h-5,this.hsva.s*this.sliderDimMax.s-8,(1-this.hsva.v)*this.sliderDimMax.v-8,this.hsva.a*this.sliderDimMax.a-5),this.cdr.detectChanges()}}}return r.\u0275fac=function(t){return new(t||r)(Ie(Qc),Ie(Ni))},r.\u0275cmp=Sn({type:r,selectors:[["color-picker"]],viewQuery:function(t,n){if(t&1&&(Sr(dD,5),Sr(fD,5)),t&2){let i;wr(i=Cr())&&(n.hueSlider=i.first),wr(i=Cr())&&(n.alphaSlider=i.first)}},inputs:{color:"color",controls:"controls"},outputs:{sliderChange:"sliderChange",onAlphaChange:"onAlphaChange"},features:[Uc],decls:8,vars:4,consts:[["dialogPopup",""],["hueSlider",""],["alphaSlider",""],[1,"color-picker",3,"click"],["class","saturation-lightness",3,"slider","rgX","rgY","background-color","newValue",4,"ngIf"],[1,"hue-alpha","box"],["class","left",4,"ngIf"],[1,"right"],["class","hue",3,"slider","rgX","newValue",4,"ngIf"],["class","alpha",3,"slider","rgX","newValue",4,"ngIf"],[1,"saturation-lightness",3,"newValue","slider","rgX","rgY"],[1,"cursor"],[1,"left"],[1,"selected-color-background"],[1,"selected-color"],[1,"hue",3,"newValue","slider","rgX"],[1,"sliderCursor"],[1,"alpha",3,"newValue","slider","rgX"],[1,"alpha-gradient",3,"ngStyle"]],template:function(t,n){if(t&1){let i=$e();k(0,"div",3,0),X("click",function(o){return K(i),$(o.stopPropagation())}),ft(2,pD,3,8,"div",4),k(3,"div",5),ft(4,mD,3,2,"div",6),k(5,"div",7),ft(6,gD,5,3,"div",8)(7,vD,6,4,"div",9),j()()()}t&2&&(H(2),Y("ngIf",n.controls!="only-alpha"),H(2),Y("ngIf",n.controls!="only-alpha"),H(2),Y("ngIf",n.controls!="only-alpha"),H(),Y("ngIf",n.controls!="no-alpha"))},dependencies:[Ri,Qd,ID],styles:[`.color-picker{position:relative;z-index:1000;width:220px;height:auto;cursor:default;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;touch-action:none}.color-picker *{box-sizing:border-box;margin:0;font-size:11px}.color-picker input{width:0;height:26px;min-width:0;font-size:13px;text-align:center;color:#000}.color-picker input:invalid,.color-picker input:-moz-ui-invalid,.color-picker input:-moz-submit-invalid{box-shadow:none}.color-picker input::-webkit-inner-spin-button,.color-picker input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none}.color-picker .sliderCursor{width:10px;border-radius:5px;position:absolute;margin-top:-3px;border:1px solid black}.color-picker .sliderCursor>div{border:2px solid white;border-radius:5px}.color-picker .sliderCursor>div>div{border-radius:5px;border:1px solid black;height:24px}.color-picker .cursor{position:absolute;width:21px;border:3px solid black;border-radius:100%;margin:-2px 0 0 -2px}.color-picker .cursor>div{height:15px;border:3px solid white;border-radius:100%}.color-picker .box{display:flex;padding:4px 8px}.color-picker .left{position:relative;padding:16px 8px}.color-picker .right{flex:1 1 auto;display:flex;flex-direction:column;gap:10px;padding:12px 8px}.color-picker .hue-alpha{display:flex;align-items:center;margin-bottom:3px}.color-picker .hue{direction:ltr;width:100%;height:24px;border:none;border-radius:5px;position:relative;cursor:pointer;background-size:100% 100%;background:linear-gradient(to right,red 0%,#ff0 17%,lime 33%,cyan 50%,blue 66%,#f0f 83%,red 100%)}.color-picker .alpha{direction:ltr;position:relative;width:100%;height:24px;border:none;border-radius:5px;cursor:pointer;background-image:linear-gradient(45deg,#ccc 25%,transparent 25%),linear-gradient(-45deg,#ccc 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#ccc 75%),linear-gradient(-45deg,transparent 75%,#ccc 75%);background-size:16px 16px;background-position:0 0,0 8px,8px -8px,-8px 0px}.color-picker .alpha-gradient{width:100%;height:100%;border-radius:5px;position:absolute}.color-picker .selected-color{position:absolute;top:16px;left:8px;width:40px;height:40px;box-shadow:0 1px 1px 1px #00000026;border-radius:50%}.color-picker .selected-color-background{width:40px;height:40px;border-radius:50%;background-image:linear-gradient(45deg,#ccc 25%,transparent 25%),linear-gradient(-45deg,#ccc 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#ccc 75%),linear-gradient(-45deg,transparent 75%,#ccc 75%);background-size:16px 16px;background-position:0 0,0 8px,8px -8px,-8px 0px}.color-picker .saturation-lightness{direction:ltr;cursor:crosshair;width:100%;position:relative;height:130px;border:none;touch-action:manipulation;background-image:linear-gradient(to top,#000 0%,transparent 100%),linear-gradient(to right,#fff 0%,transparent 100%)}
`],encapsulation:2}),r})(),ND=(()=>{class r{click(t){this.isOutside(t)&&this.emitClose("cancel")}onScroll(){this.onScreenMovement()}onResize(){this.onScreenMovement()}constructor(t,n){this.service=t,this.cdr=n,this.color="#000000",this.previewColor="#000000",this.hsva=new zr(0,1,1,1),this.colorsAnimationEffect="slide-in",this.palette=Xv,this.variants=[],this.colorFormats=ea,this.format=Cn.HEX,this.canChangeFormat=!0,this.menu=1,this.hideColorPicker=!1,this.hideTextInput=!1,this.colorPickerControls="default",this.placeholder="#FFFFFF"}ngOnInit(){this.setPosition(),this.hsva=this.service.stringToHsva(this.color),this.indexSeleccionado=this.findIndexSelectedColor(this.palette)}ngAfterViewInit(){this.setPositionY()}onScreenMovement(){this.setPosition(),this.setPositionY(),this.panelRef.nativeElement.style.transition||(this.panelRef.nativeElement.style.transition="transform 0.5s ease-out")}findIndexSelectedColor(t){let n;if(this.color)for(let i=0;i<t.length;i++){let s=t[i];typeof s=="string"?this.service.stringToFormat(this.color,Cn.HEX)==this.service.stringToFormat(s,Cn.HEX)&&(n=i):s===void 0?this.color=void 0:this.findIndexSelectedColor(s.variants)!=null&&(n=i)}return n}iniciate(t,n,i,s,o,a,c,l,d,h,u,f){if(this.colorPickerControls=u,this.triggerInstance=t,this.TriggerBBox=n,this.color=i,this.hideColorPicker=l,this.hideTextInput=c,this.acceptLabel=d,this.cancelLabel=h,a?ea.includes(a)?(this.format=ea.indexOf(a.toLowerCase()),this.canChangeFormat=!1,this.service.getFormatByString(this.color)!=a.toLowerCase()&&this.setColor(this.service.stringToHsva(this.color))):(console.error("Format provided is invalid, using HEX"),this.format=Cn.HEX):this.format=ea.indexOf(this.service.getFormatByString(this.color)),this.previewColor=this.color,this.palette=s??Xv,this.colorsAnimationEffect=o,f=="top"){let g=this.TriggerBBox.nativeElement.getBoundingClientRect();this.positionString="transform: translateY(calc( -100% - "+g.height+"px ))"}}setPosition(){if(this.TriggerBBox){let n=this.TriggerBBox.nativeElement.getBoundingClientRect();this.top=n.top+n.height,n.left+250>window.innerWidth?this.left=n.right<250?window.innerWidth/2-250/2:n.right-250:this.left=n.left}}setPositionY(){let t=this.TriggerBBox.nativeElement.getBoundingClientRect(),n=this.panelRef.nativeElement.getBoundingClientRect(),i=n.height;t.bottom+i>window.innerHeight?this.positionString=t.top<n.height?"transform: translateY(-"+t.bottom+"px );":"transform: translateY(calc( -100% - "+t.height+"px ));":this.positionString="",this.cdr.detectChanges()}hasVariant(t){return this.previewColor?typeof t!="string"&&t.variants.some(n=>n.toUpperCase()==this.previewColor.toUpperCase()):!1}isSelected(t){return this.previewColor?typeof t=="string"&&t.toUpperCase()==this.previewColor.toUpperCase():!1}getBackgroundColor(t){return typeof t=="string"?{background:t}:{background:t?.preview}}onAlphaChange(t){this.palette=this.ChangeAlphaOnPalette(t,this.palette)}ChangeAlphaOnPalette(t,n){var i=[];for(let s=0;s<n.length;s++){let o=n[s];if(typeof o=="string"){let a=this.service.stringToHsva(o);a.onAlphaChange(t),i.push(this.service.toFormat(a,this.format))}else{let a=new vf,c=this.service.stringToHsva(o.preview);c.onAlphaChange(t),a.preview=this.service.toFormat(c,this.format),a.variants=this.ChangeAlphaOnPalette(t,o.variants),i.push(a)}}return i}changeColor(t){this.setColor(this.service.stringToHsva(t)),this.emitClose("accept")}onChangeColorPicker(t){this.temporalColor=t,this.color=this.service.toFormat(t,this.format),this.triggerInstance.sliderChange(this.service.toFormat(t,this.format))}changeColorManual(t){this.previewColor=t,this.color=t,this.hsva=this.service.stringToHsva(t),this.temporalColor=this.hsva,this.triggerInstance.setColor(this.color)}setColor(t){this.hsva=t,this.color=this.service.toFormat(t,this.format),this.setPreviewColor(t),this.triggerInstance.setColor(this.color)}setPreviewColor(t){this.previewColor=t?this.service.hsvaToRgba(t).toString():void 0}onChange(){}onColorClick(t){typeof t=="string"||t===void 0?this.changeColor(t):(this.variants=t.variants,this.menu=2)}addColor(){this.menu=3,this.backupColor=this.color,this.temporalColor=this.service.stringToHsva(this.color)}nextFormat(){this.canChangeFormat&&(this.format=(this.format+1)%this.colorFormats.length,this.setColor(this.hsva),this.placeholder=this.service.toFormat(new zr(0,0,1,1),this.format))}emitClose(t){this.menu==3&&(t=="cancel"||t=="accept"&&this.setColor(this.temporalColor)),this.triggerInstance.closePanel()}onClickBack(){this.menu==3&&(this.color=this.backupColor,this.hsva=this.service.stringToHsva(this.color)),this.indexSeleccionado=this.findIndexSelectedColor(this.palette),this.menu=1}isOutside(t){return t.target.classList.contains("ngx-colors-overlay")}}return r.\u0275fac=function(t){return new(t||r)(Ie(Qc),Ie(Ni))},r.\u0275cmp=Sn({type:r,selectors:[["ngx-colors-panel"]],viewQuery:function(t,n){if(t&1&&Sr(yD,5),t&2){let i;wr(i=Cr())&&(n.panelRef=i.first)}},hostVars:4,hostBindings:function(t,n){t&1&&X("mousedown",function(s){return n.click(s)},!1,Wo)("scroll",function(){return n.onScroll()},!1,Wo)("resize",function(){return n.onResize()},!1,hv),t&2&&Vt("top",n.top,"px")("left",n.left,"px")},decls:6,vars:6,consts:[["dialog",""],["paintInput",""],[1,"opened"],[4,"ngIf"],["class","manual-input-wrapper",4,"ngIf"],[1,"colors"],[4,"ngFor","ngForOf"],["style","background: rgb(245 245 245); position: relative","class","circle button",3,"click",4,"ngIf"],[3,"controls","color","colorChange","onAlphaChange",4,"ngIf"],[1,"circle","wrapper","color"],[1,"circle","color","circle-border",3,"click","ngStyle"],["class","selected",4,"ngIf"],[1,"selected"],[1,"circle","button",2,"background","rgb(245 245 245)","position","relative",3,"click"],["style",`
            position: absolute;
            height: 7px;
            width: 7px;
            border: 1px solid rgba(0, 0, 0, 0.03);
            border-radius: 100%;
            top: 0;
            right: 0;
          `,3,"ngStyle",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","height","24px","viewBox","0 0 24 24","width","24px","fill","#222222"],["d","M24 24H0V0h24v24z","fill","none","opacity",".87"],["d","M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"],[2,"position","absolute","height","7px","width","7px","border","1px solid rgba(0, 0, 0, 0.03)","border-radius","100%","top","0","right","0",3,"ngStyle"],[3,"colorChange","onAlphaChange","controls","color"],[1,"circle","wrapper"],[1,"add",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24"],["d","M0 0h24v24H0z","fill","none"],["d","M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"],[1,"circle","circle-border",3,"click","ngStyle"],[1,"nav-wrapper"],[1,"round-button","button",2,"float","left",3,"click"],[2,"float","right",3,"click"],[1,"color-picker-wrapper"],[3,"sliderChange","controls","color"],[1,"manual-input-wrapper"],[3,"click"],[1,"g-input"],["type","text",3,"keyup","keydown.enter","placeholder","value"]],template:function(t,n){t&1&&(k(0,"div",2,0),ft(2,_D,5,4,"ng-container",3)(3,DD,8,2,"ng-container",3)(4,FD,12,4,"ng-container",3)(5,PD,6,7,"div",4),j()),t&2&&(Gc(n.positionString),H(2),Y("ngIf",n.menu==1),H(),Y("ngIf",n.menu==2),H(),Y("ngIf",n.menu==3),H(),Y("ngIf",!n.hideTextInput))},dependencies:[vs,Ri,Qd,OD],styles:["[_nghost-%COMP%]{position:fixed;z-index:2001}.hidden[_ngcontent-%COMP%]{display:none}.button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.top[_ngcontent-%COMP%]{transform:translateY(-100%)}.opened[_ngcontent-%COMP%]{box-sizing:border-box;box-shadow:0 2px 4px -1px #0003,0 4px 5px #00000024,0 1px 10px #0000001f;background:#fff;width:250px;border-radius:5px;position:absolute}.opened[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;font-family:inherit;font-size:12px;background-color:unset;-webkit-user-select:none;user-select:none;padding:10px;letter-spacing:1px;color:#222;border-radius:3px;line-height:20px}.opened[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .opened[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]:hover{background-color:#0000000d;transition:opacity .2s cubic-bezier(.35,0,.25,1),background-color .2s cubic-bezier(.35,0,.25,1);transition-property:opacity,background-color;transition-duration:.2s,.2s;transition-timing-function:cubic-bezier(.35,0,.25,1),cubic-bezier(.35,0,.25,1);transition-delay:0s,0s}.opened[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:none}.opened[_ngcontent-%COMP%]   .colors[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;margin:15px}.opened[_ngcontent-%COMP%]   .colors[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%]{height:34px;width:34px;box-sizing:border-box;border-radius:100%;cursor:pointer}.opened[_ngcontent-%COMP%]   .colors[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%]   .add[_ngcontent-%COMP%]{font-size:20px;line-height:45px;text-align:center}.opened[_ngcontent-%COMP%]   .colors[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{border:2px solid white;border-radius:100%;height:28px;width:28px;box-sizing:border-box;margin:2px}.opened[_ngcontent-%COMP%]   .colors[_ngcontent-%COMP%]   .circle.colornull[_ngcontent-%COMP%]{background:linear-gradient(135deg,rgba(236,236,236,.7) 0%,rgba(236,236,236,.7) 45%,#de0f00 50%,rgba(236,236,236,.7) 55%,rgba(236,236,236,.7) 100%)}.opened[_ngcontent-%COMP%]   .colors[_ngcontent-%COMP%]   .circle.wrapper[_ngcontent-%COMP%]{margin:0 5px 5px;flex:34px 0 0}.opened[_ngcontent-%COMP%]   .colors[_ngcontent-%COMP%]   .circle.button[_ngcontent-%COMP%]{margin:0 5px 5px}.opened[_ngcontent-%COMP%]   .colors[_ngcontent-%COMP%]   .circle.wrapper.color[_ngcontent-%COMP%]{background-image:linear-gradient(45deg,#ccc 25%,transparent 25%),linear-gradient(-45deg,#ccc 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#ccc 75%),linear-gradient(-45deg,transparent 75%,#ccc 75%);background-size:16px 16px;background-position:0 0,0 8px,8px -8px,-8px 0px}.opened[_ngcontent-%COMP%]   .colors[_ngcontent-%COMP%]   .circle-border[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.03)}.opened[_ngcontent-%COMP%]   .color-picker-wrapper[_ngcontent-%COMP%]{margin:5px 15px}.opened[_ngcontent-%COMP%]   .nav-wrapper[_ngcontent-%COMP%]{overflow:hidden;margin:5px}.opened[_ngcontent-%COMP%]   .nav-wrapper[_ngcontent-%COMP%]   .round-button[_ngcontent-%COMP%]{padding:5px 0;width:40px;height:40px;box-sizing:border-box;border-radius:100%;text-align:center;line-height:45px}.opened[_ngcontent-%COMP%]   .manual-input-wrapper[_ngcontent-%COMP%]{display:flex;margin:15px;font-family:sans-serif}.opened[_ngcontent-%COMP%]   .manual-input-wrapper[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;text-align:center;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;line-height:48px;width:145px;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.opened[_ngcontent-%COMP%]   .manual-input-wrapper[_ngcontent-%COMP%]   .g-input[_ngcontent-%COMP%]{border:1px solid #e8ebed;height:45px;border-radius:5px;width:100%}.opened[_ngcontent-%COMP%]   .manual-input-wrapper[_ngcontent-%COMP%]   .g-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:9px;border:none;width:100%;text-transform:uppercase;outline:none;text-align:center;letter-spacing:1px;color:#595b65;height:100%;border-radius:5px;margin:0;padding:0}"],data:{animation:[Sv("colorsAnimation",[tf("void => slide-in",[Ko(":enter",wn({opacity:0}),{optional:!0}),Ko(":enter",rf("10ms",[Zd(".3s ease-in",ef([wn({opacity:0,transform:"translatex(-50%)",offset:0}),wn({opacity:.5,transform:"translatex(-10px) scale(1.1)",offset:.3}),wn({opacity:1,transform:"translatex(0)",offset:1})]))]),{optional:!0})]),tf("void => popup",[Ko(":enter",wn({opacity:0,transform:"scale(0)"}),{optional:!0}),Ko(":enter",rf("10ms",[Zd("500ms ease-out",ef([wn({opacity:.5,transform:"scale(.5)",offset:.3}),wn({opacity:1,transform:"scale(1.1)",offset:.8}),wn({opacity:1,transform:"scale(1)",offset:1})]))]),{optional:!0})])])]}}),r})(),Yv={position:"fixed",height:"100%",width:"100%","z-index":2e3,top:0,left:0},Qv=(()=>{class r{constructor(t,n,i){this.resolver=t,this.applicationRef=n,this.injector=i}createPanel(t,n){this.componentRef!=null&&this.removePanel();let i=this.resolver.resolveComponentFactory(ND);this.componentRef=i.create(this.injector),this.applicationRef.attachView(this.componentRef.hostView);let s=this.componentRef.hostView.rootNodes[0];return this.overlay=document.createElement("div"),this.overlay.id="ngx-colors-overlay",this.overlay.classList.add("ngx-colors-overlay"),this.overlay.classList.add(n),Object.keys(Yv).forEach(o=>{this.overlay.style[o]=Yv[o]}),t?document.getElementById(t).appendChild(this.overlay):document.body.appendChild(this.overlay),this.overlay.appendChild(s),this.componentRef}removePanel(){this.applicationRef.detachView(this.componentRef.hostView),this.componentRef.destroy(),this.overlay.remove()}}return r.\u0275fac=function(t){return new(t||r)(fs(dv),fs(yv),fs(lv))},r.\u0275prov=en({token:r,factory:r.\u0275fac}),r})(),Zv=(()=>{class r{onClick(){this.openPanel()}constructor(t,n,i){this.triggerRef=t,this.panelFactory=n,this.service=i,this.color="",this.colorsAnimation="slide-in",this.position="bottom",this.attachTo=void 0,this.overlayClassName=void 0,this.colorPickerControls="default",this.acceptLabel="ACCEPT",this.cancelLabel="CANCEL",this.change=new ct,this.input=new ct,this.slider=new ct,this.close=new ct,this.open=new ct,this.isDisabled=!1,this.onTouchedCallback=()=>{},this.onChangeCallback=()=>{}}ngOnDestroy(){this.panelRef&&this.panelFactory.removePanel()}openPanel(){this.isDisabled||(this.panelRef=this.panelFactory.createPanel(this.attachTo,this.overlayClassName),this.panelRef.instance.iniciate(this,this.triggerRef,this.color,this.palette,this.colorsAnimation,this.format,this.hideTextInput,this.hideColorPicker,this.acceptLabel,this.cancelLabel,this.colorPickerControls,this.position)),this.open.emit(this.color)}closePanel(){this.panelFactory.removePanel(),this.onTouchedCallback(),this.close.emit(this.color)}setDisabledState(t){this.isDisabled=t,this.triggerRef.nativeElement.style.opacity=t?.5:1}setColor(t){this.writeValue(t),this.onChangeCallback(t),this.input.emit(t)}sliderChange(t){this.slider.emit(t)}get value(){return this.color}set value(t){this.setColor(t),this.onChangeCallback(t)}writeValue(t){if(t!==this.color){if(this.format){let n=ea.indexOf(this.format.toLowerCase());t=this.service.stringToFormat(t,n)}this.color=t,this.change.emit(t)}}registerOnChange(t){this.onChangeCallback=t}registerOnTouched(t){this.onTouchedCallback=t}}return r.\u0275fac=function(t){return new(t||r)(Ie(tn),Ie(Qv),Ie(Qc))},r.\u0275dir=Ii({type:r,selectors:[["","ngx-colors-trigger",""]],hostBindings:function(t,n){t&1&&X("click",function(){return n.onClick()})},inputs:{colorsAnimation:"colorsAnimation",palette:"palette",format:"format",position:"position",hideTextInput:"hideTextInput",hideColorPicker:"hideColorPicker",attachTo:"attachTo",overlayClassName:"overlayClassName",colorPickerControls:"colorPickerControls",acceptLabel:"acceptLabel",cancelLabel:"cancelLabel"},outputs:{change:"change",input:"input",slider:"slider",close:"close",open:"open"},features:[gs([{provide:Nv,useExisting:av(()=>r),multi:!0}])]}),r})();var ey=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=ps({type:r}),r.\u0275inj=ds({providers:[Qc,Qv],imports:[Un]}),r})();var ty=[6,12,16,25,50,75,100,150,200,300,400,600,800,1600];var kD=(r,e,t)=>{let n=`
    <svg width="60px" height="60px" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M24.5 25.98C29.4725 25.98 33.5 21.9227 33.5 16.9133C33.5 11.904 29.4725 7.84668 24.5 7.84668C19.5275 7.84668 15.5 11.904 15.5 16.9133C15.5 21.9227 19.5275 25.98 24.5 25.98Z" fill="${t}"/>
      <path d="M17.3786 29.2021C17.8814 29.0785 18.3971 29.3313 18.6254 29.7991L22.6893 32.7994C24.5 32.799 24.5 32.7995 26.3105 32.7991L30.3746 29.7991C30.6029 29.3313 31.1186 29.0785 31.6214 29.2021C37.0255 30.5301 42.5 33.238 42.5 37.3116V41.845H6.5V37.3116C6.5 33.238 11.9745 30.5301 17.3786 29.2021Z" fill="${t}"/>
      <text x="50%" y="35" fill="${t}">${e}</text>
    </svg>
  `,i=`
    <svg fill="${t}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60" width="60px" height="60px">
      <path d="M 9 3 A 1 1 0 0 0 8 4 L 8 21 A 1 1 0 0 0 9 22 A 1 1 0 0 0 9.796875 21.601562 L 12.919922 18.119141 L 16.382812 26.117188 C 16.701812 26.855187 17.566828 27.188469 18.298828 26.855469 C 19.020828 26.527469 19.340672 25.678078 19.013672 24.955078 L 15.439453 17.039062 L 21 17 A 1 1 0 0 0 22 16 A 1 1 0 0 0 21.628906 15.222656 L 9.7832031 3.3789062 A 1 1 0 0 0 9 3 z"/>
      <text x="0" y="40" fill="${t}">${e}!</text>
    </svg>
  `;return r==="person"?n:i};function ry(r,e,t){let n=()=>{if(t){let i=t.userName;e.innerHTML="",r.getMousePresences().forEach((s,o)=>{if(o.userName!==i){let a=document.createElement("div");a.innerHTML=kD("person",o.userName,o.additionalDetails.color),a.style.position="absolute",a.style.left=`${s.x}px`,a.style.top=`${s.y}px`,e.appendChild(a)}})}};n(),r.on("mousePositionChanged",n)}te();var ES=(()=>{let e=class e extends be{constructor(n,i,s){super(),this.audience=i,this.signalManager=s,this.posMap=new Map,this.onMouseSignalFn=(o,a)=>{let c=a.userId,l=a.pos,d=this.posMap.get(c);d===void 0&&(d=new Map,this.posMap.set(c,d)),d.set(o,l),this.emit("mousePositionChanged")},this.audience.on("memberRemoved",(o,a)=>{let c=this.posMap.get(a.userId);c!==void 0&&(c.delete(o),c.size===0&&this.posMap.delete(a.userId)),this.emit("mousePositionChanged")}),this.signalManager.on("error",o=>{this.emit("error",o)}),this.signalManager.onSignal(e.mouseSignalType,(o,a,c)=>{this.onMouseSignalFn(o,c)}),window.addEventListener("mousemove",o=>{let a={x:o.clientX,y:o.clientY};if(this.prevPosition){let l=a.x>=this.prevPosition.x+this.prevPosition.x*.02||a.x<=this.prevPosition.x-this.prevPosition.x*.02,d=a.y>=this.prevPosition.y+this.prevPosition.y*.02||a.y<=this.prevPosition.y-this.prevPosition.y*.02;(l||d)&&this.sendMouseSignal(a)}else this.sendMouseSignal(a);this.prevPosition=a})}sendMouseSignal(n){this.signalManager.submitSignal(e.mouseSignalType,{userId:this.audience.getMyself()?.userId,pos:n})}getMousePresences(){let n=new Map;return this.audience.getMembers().forEach((i,s)=>{i.connections.forEach(o=>{let a=this.getMousePresenceForUser(s,o.id);a!==void 0&&n.set(i,a)})}),n}getMousePresenceForUser(n,i){return this.posMap.get(n)?.get(i)}};e.mouseSignalType="positionChanged";let r=e;return r})();function ap(r,e){if(!r)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}te();var xa=class extends be{constructor(e,t){super(),this.container=e,this.rootDataObject=t,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=n=>this.emit("disposed",n),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),e.on("connected",this.connectedHandler),e.on("closed",this.disposedHandler),e.on("disconnected",this.disconnectedHandler),e.on("saved",this.savedHandler),e.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}attach(){return y(this,null,function*(){throw new Error("Cannot attach container. Container is not in detached state")})}connect(){return y(this,null,function*(){var e,t;(t=(e=this.container).connect)===null||t===void 0||t.call(e)})}disconnect(){return y(this,null,function*(){var e,t;(t=(e=this.container).disconnect)===null||t===void 0||t.call(e)})}create(e){return y(this,null,function*(){return this.rootDataObject.create(e)})}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}};var Sa=function(r){return r.NoOp="noop",r.ClientJoin="join",r.ClientLeave="leave",r.Propose="propose",r.Reject="reject",r.Summarize="summarize",r.SummaryAck="summaryAck",r.SummaryNack="summaryNack",r.Operation="op",r.RemoteHelp="remoteHelp",r.NoClient="noClient",r.RoundTrip="tripComplete",r.Control="control",r}(Sa||{});var Xn=class{constructor(e){this.internalStorageService=e}set policies(e){this._policies=e}get policies(){var e;return(e=this._policies)!==null&&e!==void 0?e:this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}getSnapshotTree(e,t){return y(this,null,function*(){return this.internalStorageService.getSnapshotTree(e,t)})}getVersions(e,t,n){return y(this,null,function*(){return this.internalStorageService.getVersions(e,t,n)})}uploadSummaryWithContext(e,t){return y(this,null,function*(){return this.internalStorageService.uploadSummaryWithContext(e,t)})}downloadSummary(e){return y(this,null,function*(){return this.internalStorageService.downloadSummary(e)})}createBlob(e){return y(this,null,function*(){return this.internalStorageService.createBlob(e)})}readBlob(e){return y(this,null,function*(){return this.internalStorageService.readBlob(e)})}};var yl=class extends Xn{constructor(e,t){super(e),this.blobs=t}get policies(){return this.internalStorageService.policies}readBlob(e){return y(this,null,function*(){let t=this.blobs.get(e);return t!==void 0?t:this.internalStorageService.readBlob(e)})}};var Li=function(r){return r.NoOp="noop",r.ClientJoin="join",r.ClientLeave="leave",r.Propose="propose",r.Reject="reject",r.Summarize="summarize",r.SummaryAck="summaryAck",r.SummaryNack="summaryNack",r.Operation="op",r.RemoteHelp="remoteHelp",r.NoClient="noClient",r.RoundTrip="tripComplete",r.Control="control",r}(Li||{});var bl=function(r){return r.File="100644",r.Executable="100755",r.Directory="040000",r.Symlink="120000",r}(bl||{}),wa=function(r){return r.Blob="Blob",r.Tree="Tree",r.Attachment="Attachment",r}(wa||{});var Yn=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(Yn||{});te();Tn();Dt();function Ew(r,e,t){let n=[];for(let i of e){let s=`${r}${i.path}`;if(i.type===wa.Blob){let o=i.value,a=Er(o.contents,o.encoding),c=Te();t.set(c,a);let l={mode:bl[i.mode],path:s,sha:c,size:0,type:"blob",url:""};n.push(l)}else if(i.type===wa.Tree){C(i.type===wa.Tree,257);let o=i.value,a={mode:bl[i.mode],path:s,sha:"",size:-1,type:"tree",url:""};n.push(a);let c=Ew(`${s}/`,o.entries,t);n.push(...c)}}return n}function tk(r,e){return{sha:"",tree:Ew("",r,e),url:""}}function zl(r,e){let t=tk(r,e);return Hs(t)}var Bt=function(r){return r.genericError="genericError",r.genericNetworkError="genericNetworkError",r.authorizationError="authorizationError",r.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",r.throttlingError="throttlingError",r.offlineError="offlineError",r.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",r.writeError="writeError",r.fetchFailure="fetchFailure",r.incorrectServerResponse="incorrectServerResponse",r.fileOverwrittenInStorage="fileOverwrittenInStorage",r.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",r.locationRedirection="locationRedirection",r}(Bt||{});var oi=function(r){return r[r.NoCaching=0]="NoCaching",r[r.Prefetch=1]="Prefetch",r}(oi||{});var ai=function(r){return r.summarizingClient="fluid-client-summarizer",r.createNew="createNew",r}(ai||{});var Bm=ye(cm());var Ga=r=>r?.type==="fluid";function rr(r){if(!Ga(r))throw new Error(`resolved is not a Fluid url. Type: ${r?.type}`)}var hu=class r{constructor(e){this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,e.forEach(t=>{this.protocolToDocumentFactoryMap.set(t.protocolName,t)})}static create(e){if(Array.isArray(e)){let t=[];return e.forEach(n=>{let i=n;i.protocolToDocumentFactoryMap!==void 0?t.push(...i.protocolToDocumentFactoryMap.values()):t.push(n)}),t.length===1?t[0]:new r(t)}return e}createDocumentService(e,t,n){return y(this,null,function*(){rr(e);let i=(0,Bm.parse)(e.url);if(i.protocol===void 0||i.protocol===null)throw new Error("No protocol provided");let s=this.protocolToDocumentFactoryMap.get(i.protocol);if(s===void 0)throw new Error("Unknown Fluid protocol");return s.createDocumentService(e,t,n)})}createContainer(e,t,n,i){return y(this,null,function*(){rr(t);let s=(0,Bm.parse)(t.url);if(s.protocol===void 0||s.protocol===null)throw new Error("No protocol provided");let o=this.protocolToDocumentFactoryMap.get(s.protocol);if(o===void 0)throw new Error("Unknown Fluid protocol");return o.createContainer(e,t,n,i)})}};function B9(r,e){return y(this,null,function*(){let t;for(let n of r)if(t=yield n.resolve(Object.assign({},e)),t!==void 0)return t})}var du=class r{constructor(e){this.urlResolvers=e}static create(e){return Array.isArray(e)?e.length===1?e[0]:new r(e):e}resolve(e){return y(this,null,function*(){return B9(this.urlResolvers,e)})}getAbsoluteUrl(e,t){return y(this,null,function*(){throw new Error("Not implmented")})}};xe();var qm,Dn=function(r){return r[r.Offline=0]="Offline",r[r.Online=1]="Online",r[r.Unknown=2]="Unknown",r}(Dn||{});function Ka(){return typeof navigator=="object"&&navigator!==null&&typeof navigator.onLine=="boolean"?navigator.onLine?Dn.Online:Dn.Offline:Dn.Unknown}var oo=class extends Re{constructor(e,t,n){super(e,n),this.canRetry=t,this.errorType=Bt.genericNetworkError}},GE="deltaStreamConnectionForbidden",Wa=class r extends Re{constructor(e,t){super(e,Object.assign(Object.assign({},t),{statusCode:400})),this.errorType=r.errorType,this.canRetry=!1}};Wa.errorType=(qm=Bt[GE])!==null&&qm!==void 0?qm:GE;var fu=class extends Re{constructor(e,t,n,i){super(e,i,new Set(["claims","tenantId"])),this.claims=t,this.tenantId=n,this.errorType=Bt.authorizationError,this.canRetry=!1}},Lm=class extends Re{constructor(e,t,n,i){super(e,i),this.errorType=t,this.canRetry=n}},Fn=class extends Lm{constructor(e,t,n){super(e,t,!1,n),this.errorType=t}};var jm=class extends Re{constructor(e,t,n){super(e,n),this.retryAfterSeconds=t,this.errorType=Bt.throttlingError,this.canRetry=!0}},WE=(r,e)=>new Fn(r,Bt.writeError,e);function cn(r,e,t){return e.retryAfterMs!==void 0&&e.canRetry?new jm(r,e.retryAfterMs/1e3,t):new oo(r,e.canRetry,t)}var ln=r=>r?.canRetry===!0,zm=r=>r?.retryAfterSeconds,Ji=r=>r?.retryAfterSeconds!==void 0?r.retryAfterSeconds*1e3:void 0;te();function We(r,e){return y(this,null,function*(){let t=yield r.readBlob(e),n=Gn(t,"utf8");return JSON.parse(n)})}function ao(r,e){return{type:Yn.Tree,tree:{".protocol":e,".app":r}}}function KE(r){var e;let t=r.tree.attributes,n=JSON.parse(t.content);return n.term=(e=n.term)!==null&&e!==void 0?e:1,n}function $E(r){let e=r.tree.quorumValues;return JSON.parse(e.content)}te();xe();function $a(r,e,t){var n,i;let s=Object.assign({},e),o=t.online;if(s.online=typeof o=="string"?o:Dn[Ka()],typeof navigator=="object"&&navigator!==null){let a=navigator,c=(i=(n=a.connection)!==null&&n!==void 0?n:a.mozConnection)!==null&&i!==void 0?i:a.webkitConnection;c!==null&&typeof c=="object"&&(s.connectionType=c.type)}s.category=ln(t)?"generic":"error",r.sendTelemetryEvent(s,t)}function Ja(r){return new Promise(t=>{let n=t,i=r;Ka()===Dn.Offline&&window?.addEventListener!==void 0&&(n=()=>{t(),window.removeEventListener("online",n)},window.addEventListener("online",n,!1),i=Math.max(r,3e4)),setTimeout(n,i)})}var pu="1.4.0";var q9=1e4,L9=100,Hm=class{constructor(e,t,n,i,s,o){this.to=t,this.payloadSize=n,this.logger=i,this.requestCallback=s,this.responseCallback=o,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new Ee,this.requests=0,this.latestRequested=e,this.nextToDeliver=e,this.knewTo=t!==void 0}get working(){return this.workingState==="working"}get canceled(){return this.workingState==="canceled"}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}run(e){return y(this,null,function*(){C(e>0,258),C(this.working,259);let t=e;for(;t>0;)t--,this.addRequest();return this.dispatch(),this.endEvent.promise})}done(){C(this.to!==void 0,260),C(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}dispatch(){for(;this.working;){let e=this.results.get(this.nextToDeliver);if(e===void 0)break;this.results.delete(this.nextToDeliver),C(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(this.requestsInFlight===0?(C(this.results.size===0,263),this.done()):this.to!==void 0&&this.nextToDeliver>=this.to&&(C(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;let e=this.latestRequested;if(!(this.to!==void 0&&this.to<=e))return this.latestRequested+=this.payloadSize,this.to!==void 0&&(this.latestRequested=Math.min(this.to,this.latestRequested)),C(e<this.latestRequested,265),{from:e,to:this.latestRequested}}addRequest(){let e=this.getNextChunk();e!==void 0&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}addRequestCore(e,t){return y(this,null,function*(){C(this.working,266);let n=e,i=t;for(this.requestsInFlight++;this.working;){let s=i-n;C(s>0,267),this.to!==void 0&&(C(n<this.to,268),C(i<=this.to,269)),this.requests++;let o=this.requestCallback(this.requests,n,i,this.to!==void 0,{});this.dispatch();let{payload:a,cancel:c,partial:l}=yield o;if(c&&this.cancel(),this.to!==void 0&&n>=this.to){C(!this.knewTo,270),a.length!==0&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:n,to:i,end:this.to,length:a.length});break}if(this.working){let d=n,h=a.length,u=s<=h;if(h!==0){s<h&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:n,to:i,length:h});let f=a.splice(0,s);this.results.set(n,f),n+=f.length}else C(!l,271),C(!this.knewTo,272);if(!l&&!u){if(!this.knewTo){(this.to===void 0||this.to>n)&&(this.to=n);break}this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:d,to:i,length:h})}if(i===this.latestRequested&&(a.length!==0&&(this.results.set(n,a),n+=a.length),this.latestRequested=n,u=!0),u){let f=this.getNextChunk();if(f===void 0)break;n=f.from,i=f.to}}}this.requestsInFlight--,this.dispatch()})}},Vm=class{constructor(){this.queue=[],this.done=!1}pushValue(e){this.pushCore(Promise.resolve({done:!1,value:e}))}pushError(e){this.pushCore(Promise.reject(e)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(e){C(!this.done,274),this.deferred?(C(this.queue.length===0,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}read(){return y(this,null,function*(){C(this.deferred===void 0,276);let e=this.queue.shift();return e!==void 0?e:(C(!this.done,277),this.deferred=new Ee,this.deferred.promise)})}};function j9(r,e,t,n,i,s){return y(this,null,function*(){let o,a=0,c=[],l={partial:!1,cancel:!0,payload:[]};for(;i?.aborted!==!0;){a++;let d=Math.min(q9,L9*Math.pow(2,a)),h=le.now();try{let u=r(Object.assign(Object.assign({},e),{retry:a})),{messages:f,partialResult:g}=yield u;if(c.push(...f),f.length!==0||!t)return{payload:c,cancel:!1,partial:g};if(o===void 0)o=le.now();else if(le.now()-o>3e4)throw cn("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:a,driverVersion:pu},e))}catch(u){let f=ln(u);o=void 0;let g=Ji(u);if($a(n,Object.assign(Object.assign({eventName:"GetDeltas_Error"},e),{retry:a,duration:le.now()-h,retryAfter:g,reason:s}),u),!f)throw u;g!==void 0&&g>=0&&(d=g)}yield Ja(d)}return l})}function JE(r,e,t,n,i,s,o,a){let c=0,l,d=0,h=new Vm,u={fromTotal:t,toTotal:n},f=ce.start(s,Object.assign(Object.assign({eventName:"GetDeltas"},u),{reason:a})),g=new Hm(t,n,i,s,(b,v,x,_,A)=>y(this,null,function*(){return c++,j9(D=>y(this,null,function*(){return r(v,x,D)}),Object.assign(Object.assign({request:b,from:v,to:x},u),A),_,s,o,a)}),b=>{l===void 0?C(b[0].sequenceNumber===t,621):C(b[0].sequenceNumber===l+1,622),l=b[b.length-1].sequenceNumber,C(l-b[0].sequenceNumber+1===b.length,623),d+=b.length,h.pushValue(b)}),m=b=>{g.cancel()};return o!==void 0&&o.addEventListener("abort",m),g.run(e).finally(()=>{o!==void 0&&o.removeEventListener("abort",m)}).then(()=>{let b={lastFetch:l,length:d,requests:c};g.canceled?f.cancel(Object.assign(Object.assign({},b),{error:"ops request cancelled by client"})):(C(n===void 0||l!==void 0&&l>=n-1,624),f.end(b)),h.pushDone()}).catch(b=>{f.cancel({lastFetch:l,length:d,requests:c},b),h.pushError(b)}),h}var XE={read:()=>y(void 0,null,function*(){return{done:!0}})};var mu=class extends Xn{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){let e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:oi.NoCaching})}getSnapshotTree(e){return y(this,null,function*(){let t=this.internalStorageService.getSnapshotTree(e);return this.prefetchEnabled&&t.then(n=>{n!=null&&this.prefetchTree(n)}),t})}readBlob(e){return y(this,null,function*(){return this.cachedRead(e)})}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}cachedRead(e){return y(this,null,function*(){if(this.prefetchEnabled){let t=this.prefetchCache.get(e);if(t!==void 0)return t;let n=this.internalStorageService.readBlob(e);return this.prefetchCache.set(e,n.catch(i=>{throw ln(i)&&this.prefetchCache.delete(e),i})),n}return this.internalStorageService.readBlob(e)})}prefetchTree(e){let t=[];this.prefetchTreeCore(e,t);for(let n of t)this.cachedRead(n)}prefetchTreeCore(e,t){for(let n of Object.keys(e.blobs)){let i=e.blobs[n];n.startsWith(".")||n==="header"||n.startsWith("quorum")?i!==null&&this.cachedRead(i):n.startsWith("deltas")||i!==null&&t.push(i)}for(let n of Object.keys(e.trees))this.prefetchTreeCore(e.trees[n],t)}};te();var fi=class{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{let t=this.tasks.shift();if(t!==void 0)return t();this.maxRequests++},C(e>0,174)}get waitQueueLength(){return this.tasks.length}acquire(){return y(this,null,function*(){if(this.maxRequests>0){this.maxRequests--;return}return new Promise(e=>{this.tasks.push(e)})})}schedule(e){return y(this,null,function*(){return yield this.acquire(),e().finally(this.release)})}};te();function co(r,e,t,n){return y(this,null,function*(){var i,s;let o,a=!1,c=1e3,l=0,d=le.now(),h;do try{o=yield r(n.cancel),a=!0}catch(u){if(!ln(u))throw t.sendTelemetryEvent({eventName:`${e}_cancel`,retry:l,duration:le.now()-d,fetchCallName:e},u),u;if(((i=n.cancel)===null||i===void 0?void 0:i.aborted)===!0)throw t.sendTelemetryEvent({eventName:`${e}_runWithRetryAborted`,retry:l,duration:le.now()-d,fetchCallName:e},u),new Fn("runWithRetry was Aborted",Bt.genericError,{driverVersion:pu,fetchCallName:e});l++,h=u,c=(s=Ji(u))!==null&&s!==void 0?s:Math.min(c*2,8e3),n.onRetry&&n.onRetry(c,u),yield ya(c)}while(!a);return l>0&&t.sendTelemetryEvent({eventName:`${e}_lastError`,retry:l,duration:le.now()-d,fetchCallName:e},h),o})}te();var Um=class{constructor(e){this.props=e,this.attachmentCounter=0,this.summaryTree={}}get summary(){var e;return{type:Yn.Tree,tree:Object.assign({},this.summaryTree),unreferenced:(e=this.props)===null||e===void 0?void 0:e.unreferenced}}addBlob(e,t){this.summaryTree[e]={type:Yn.Blob,content:t}}addHandle(e,t,n){this.summaryTree[e]={type:Yn.Handle,handleType:t,handle:n}}addTree(e,t){this.summaryTree[e]=t}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:Yn.Attachment}}};function Gm(r,e){let t=new Um({unreferenced:r.unreferenced});for(let[n,i]of Object.entries(r.blobs)){let s=e.get(i);C(s!==void 0,733),t.addBlob(n,kt.from(s).toString("utf-8"))}for(let[n,i]of Object.entries(r.trees)){let s=Gm(i,e);t.addTree(n,s)}return t.summary}function YE(r){if(pi(r))return!0;switch(r.type){case Li.Propose:case Li.Reject:case Li.NoOp:return!0;default:return!1}}function pi(r){return r.type===Li.Operation||r.type===Li.Summarize}var QE=function(r){return r.FluidDataStoreOp="component",r.Attach="attach",r.ChunkedOp="chunkedOp",r.BlobAttach="blobAttach",r.Rejoin="rejoin",r.Alias="alias",r.Operation="op",r}(QE||{});function Xi(r){return!!Object.values(QE).includes(r.type)}at();te();Pt();te();xe();Pt();xe();var ir=class extends Re{constructor(e,t,n){super(e,n,new Set(["error"])),this.error=t,this.errorType=yi.genericError}},Fu=class r extends Re{constructor(e,t,n){super(e,n),this.retryAfterSeconds=t,this.errorType=yi.throttlingError}static wrap(e,t,n){return Ia(e,s=>new r(s,t),n)}},ve=class extends Re{constructor(e){super(e,{usageError:!0}),this.errorType="usageError"}},Pu=class extends Re{constructor(e,t){super(e,{timeoutMs:t}),this.expiryMs=t,this.errorType=yi.clientSessionExpiredError}},qt=class extends Re{constructor(e,t){super(e,Object.assign(Object.assign({},t),{dataProcessingError:1})),this.errorType=yi.dataCorruptionError,this.canRetry=!1}},gt=class r extends Re{constructor(e){super(e),this.errorType=yi.dataProcessingError,this.canRetry=!1}static create(e,t,n,i={}){let s=r.wrapIfUnrecognized(e,t,n);return s.addTelemetryProperties(i),s}static wrapIfUnrecognized(e,t,n){let i=Object.assign({dataProcessingError:1,dataProcessingCodepath:t},n===void 0?void 0:Wr(n)),s=$t(e,{props:i});if(!Pl(s))return s;let o=ti(s,a=>new r(a));return o.addTelemetryProperties(s.getTelemetryProperties()),o}},Wr=r=>({messageClientId:r.clientId,messageSequenceNumber:r.sequenceNumber,messageClientSequenceNumber:r.clientSequenceNumber,messageReferenceSequenceNumber:r.referenceSequenceNumber,messageMinimumSequenceNumber:r.minimumSequenceNumber,messageTimestamp:r.timestamp});var tt=function(r){return r.NoOp="noop",r.ClientJoin="join",r.ClientLeave="leave",r.Propose="propose",r.Reject="reject",r.Summarize="summarize",r.SummaryAck="summaryAck",r.SummaryNack="summaryNack",r.Operation="op",r.RemoteHelp="remoteHelp",r.NoClient="noClient",r.RoundTrip="tripComplete",r.Control="control",r}(tt||{});var dn=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(dn||{});var Kr=ye(Tr());at();po();Dt();Pt();at();var Iu=class{constructor(e,t,n){this.path=e,this.runtime=t,this.routeContext=n,this.absolutePath=Vr(e,this.routeContext)}get IFluidHandleContext(){return this}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==se.Detached}resolveHandle(e){return y(this,null,function*(){return this.runtime.resolveHandle(e)})}};var Pn=class{constructor(e){this.map=new Map;for(let t of e){if(this.map.has(t[0]))throw new ve("Duplicate entry names exist");this.map.set(t[0],t[1])}}get IFluidDataStoreRegistry(){return this}get(e){return y(this,null,function*(){if(this.map.has(e))return this.map.get(e)})}};var e4=ye(Wn());te();Pt();at();xe();te();var Lt="summarizer",Ou=(()=>{class r extends be{constructor(t,n,i,s,o){super(),this.logger=t,this.summaryCollection=n,this.clientElection=i,this.maxOpsSinceLastSummary=s,this.electionEnabled=o,this.lastReportedSeq=0,this.summaryCollection.on("default",({sequenceNumber:a})=>{var c,l,d;let h=this.electedClientId;if(h===void 0){this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(a);return}let u=this.clientElection.electionSequenceNumber;if(a-((c=this.lastSummaryAckSeqForClient)!==null&&c!==void 0?c:u)>this.maxOpsSinceLastSummary){let g=a-this.lastReportedSeq;if(g>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:h,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:u,nextElectedClientId:(l=this.clientElection.peekNextElectedClient())===null||l===void 0?void 0:l.clientId,electionEnabled:this.electionEnabled}),this.lastReportedSeq=a),this.electionEnabled){let m=this.electedParentId;this.clientElection.incrementElectedClient(a),u=this.clientElection.electionSequenceNumber,a>((d=this.lastSummaryAckSeqForClient)!==null&&d!==void 0?d:u)&&g>this.maxOpsSinceLastSummary&&this.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:u,sequenceNumber:a,previousClientId:h,previousParentId:m,electedParentId:this.electedParentId,electedClientId:this.electedClientId,opsSinceLastReport:g,maxOpsSinceLastSummary:s})}}}),this.summaryCollection.on(tt.SummaryAck,a=>{this.lastSummaryAckSeqForClient=a.sequenceNumber}),this.clientElection.on("election",(a,c)=>{this.lastSummaryAckSeqForClient=void 0,a===void 0&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(c),this.emit("electedSummarizerChanged")})}get electedClientId(){var t;return(t=this.clientElection.electedClient)===null||t===void 0?void 0:t.clientId}get electedParentId(){var t;return(t=this.clientElection.electedParent)===null||t===void 0?void 0:t.clientId}serialize(){var t;let{electedClientId:n,electedParentId:i,electionSequenceNumber:s}=this.clientElection.serialize();return{electedClientId:n,electedParentId:i,electionSequenceNumber:(t=this.lastSummaryAckSeqForClient)!==null&&t!==void 0?t:s}}static isClientEligible(t){let n=t.client.details;return n===void 0?!0:r.clientDetailsPermitElection(n)}}return r.clientDetailsPermitElection=e=>e.capabilities.interactive||e.type===Lt,r})();Pt();te();xe();var sg=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(sg||{});var pr=ye(Tr());at();po();Dt();at();te();var Nu=class{constructor(e,t,n,i,s){this.objectId=e,this._connected=t,this.submit=n,this.dirty=i,this.addedGCOutboundReference=s}get handler(){return C(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){C(this._handler===void 0,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,n){try{this.handler.process(e,t,n)}catch(i){throw gt.wrapIfUnrecognized(i,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(this.handler.rollback===void 0)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}};at();var Ru=class r{constructor(e,t,n,i){this.tree=e,this.storage=t,this.logger=n,this.extraBlobs=i,this.flattenedTree={},e!==void 0&&r.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,n){for(let i in t.trees)r.flattenTree(`${e}${i}/`,t.trees[i],n);for(let i in t.blobs)n[`${e}${i}`]=t.blobs[i]}contains(e){return y(this,null,function*(){return this.flattenedTree[e]!==void 0})}readBlob(e){return y(this,null,function*(){let t=yield this.getIdForPath(e),n=this.extraBlobs!==void 0?this.extraBlobs.get(t):void 0;if(n!==void 0)return n;let i=this.storage.readBlob(t);return i.catch(s=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},s)),i})}list(e){return y(this,null,function*(){var t;let n=this.tree,i=vu(e);for(;n!==void 0&&i.length>0;){let s=i.shift();n=n.trees[s]}if(n===void 0||i.length!==0)throw new Error("path does not exist");return Object.keys((t=n?.blobs)!==null&&t!==void 0?t:{})})}getIdForPath(e){return y(this,null,function*(){return this.flattenedTree[e]})}};var ic=".attributes";function sc(r,e,t,n,i,s,o,a,c){let l=new Nu(r,e,(h,u)=>t(h,u),n,i),d=new Ru(a,s,o,c);return{deltaConnection:l,objectStorage:d}}function ku(r,e=!1,t=!1,n){let i=r.getAttachSummary(e,t,n);return dr(i,ic,JSON.stringify(r.attributes)),i}function Mu(r,e=!1,t=!1,n){return y(this,null,function*(){let i=yield r.summarize(e,t,n);return dr(i,ic,JSON.stringify(r.attributes)),i})}var J_=ye(vl());te();var go=class{constructor(e,t,n,i){this.id=e,this.registry=t,this.runtime=n,this.servicesGetter=i,this.globallyVisible=!1,this.pending=[],C(!this.id.includes("/"),783)}getChannel(){return y(this,null,function*(){return C(this.channel!==void 0,519),this.channel})}get isLoaded(){return this.channel!==void 0}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,n){C(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,n):(C(t===!1,393),this.pending.push(e))}reSubmit(e,t){C(this.isLoaded,394),C(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){C(this.isLoaded,750),C(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}summarize(e=!1,t=!1,n){return y(this,null,function*(){return C(this.isLoaded&&this.channel!==void 0,396),Mu(this.channel,e,t,n)})}getAttachSummary(e){return C(this.isLoaded&&this.channel!==void 0,397),ku(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(C(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}getGCData(e=!1){return y(this,null,function*(){return C(this.isLoaded&&this.channel!==void 0,403),this.channel.getGCData(e)})}updateUsedRoutes(e,t){}},Bu=class extends go{constructor(e,t,n,i,s,o,a,c,l,d){super(e,t,n,()=>this.services),this.snapshotTree=d;let h=new Map,u=(0,J_.default)(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(u,h)&&this.sanitizeSnapshot(u),this.services=new lr(()=>sc(this.id,i.connected,a,this.dirtyFn,l,s,o,u,h)),this.dirtyFn=()=>{c(e)}}getChannel(){return y(this,null,function*(){return this.channel===void 0&&(this.channel=yield this.loadChannel().catch(e=>{throw gt.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)})),this.channel})}loadChannel(){return y(this,null,function*(){C(!this.isLoaded,398),C(yield this.services.value.objectStorage.contains(".attributes"),400);let e=yield We(this.services.value.objectStorage,".attributes");if(C(this.factory===void 0,520),this.factory=this.registry.get(e.type),this.factory===void 0)throw new Error(`Channel Factory ${e.type} not registered`);let t=yield this.factory.load(this.runtime,this.id,this.services.value,e);this.channel=t;for(let n of this.pending)this.services.value.deltaConnection.process(n,!1,void 0);return this.channel})}isSnapshotInOldFormatAndCollectBlobs(e,t){let n=!1,i=e.blobsContents;Object.entries(i).forEach(([s,o])=>{t.set(s,o),e.blobs[s]!==void 0&&(n=!0)});for(let s of Object.values(e.trees))n=n||this.isSnapshotInOldFormatAndCollectBlobs(s,t);return n}sanitizeSnapshot(e){let t=new Map(Object.entries(e.blobs));for(let[n,i]of t.entries())t.get(i)===void 0&&delete e.blobs[n];for(let n of Object.values(e.trees))this.sanitizeSnapshot(n)}},qu=class extends go{constructor(e,t,n,i,s,o,a,c,l,d){if(super(e,t,i,()=>this.services),C(n!==void 0,521),this.factory=t.get(n),this.factory===void 0)throw new Error(`Channel Factory ${n} not registered`);this.channel=this.factory.create(i,e),this.services=new lr(()=>sc(this.id,s.connected,c,this.dirtyFn,d,o,a)),this.dirtyFn=()=>{l(e)}}};te();xe();var og=(()=>{class r{constructor(t,n,i,s,o,a,c,l,d,h,u,f,g){this.runtime=t,this.dataStoreContext=n,this.id=c,this.registry=d,this.attachMessageType=g,this.isLoaded=!1,this.pending=[],C(!this.id.includes("/"),784),this.subLogger=ue.create(this.runtime.logger,"RemoteChannelContext"),this.services=sc(this.id,this.dataStoreContext.connected,s,()=>o(this.id),a,i,this.subLogger,l,h);let m=(b,v,x)=>y(this,null,function*(){return this.summarizeInternal(b,v,x)});this.summarizerNode=u(m,b=>y(this,null,function*(){return this.getGCDataInternal(b)}),()=>y(this,null,function*(){return f()})),this.thresholdOpsCounter=new Vi(r.pendingOpsCountThreshold,this.subLogger)}getChannel(){return this.channelP===void 0&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(t,n){this.isLoaded&&this.services.deltaConnection.setConnectionState(t)}applyStashedOp(t){return C(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(t)}processOp(t,n,i){this.summarizerNode.invalidate(t.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(t,n,i):(C(!n,405),C(this.pending!==void 0,574),this.pending.push(t),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(t,n){C(this.isLoaded,406),this.services.deltaConnection.reSubmit(t,n)}rollback(t,n){C(this.isLoaded,752),this.services.deltaConnection.rollback(t,n)}summarize(t=!1,n=!0,i){return y(this,null,function*(){return this.summarizerNode.summarize(t,n,i)})}summarizeInternal(t,n,i){return y(this,null,function*(){let s=yield this.getChannel(),o=yield Mu(s,t,n,i);return Object.assign(Object.assign({},o),{id:this.id})})}loadChannel(){return y(this,null,function*(){C(!this.isLoaded,407);let t;(yield this.services.objectStorage.contains(ic))&&(t=yield We(this.services.objectStorage,ic));let n;if(t===void 0){if(this.attachMessageType===void 0)throw new qt("channelTypeNotAvailable",{channelId:{value:this.id,tag:Ne.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:Ne.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});if(n=this.registry.get(this.attachMessageType),n===void 0)throw new qt("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:Ne.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:Ne.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});t=n.attributes}else if(n=this.registry.get(t.type),n===void 0)throw new qt("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:Ne.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:Ne.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:t.type});t.snapshotFormatVersion!==void 0&&t.snapshotFormatVersion!==n.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:t.type,tag:Ne.PackageData},channelSnapshotVersion:{value:`${t.snapshotFormatVersion}@${t.packageVersion}`,tag:Ne.PackageData},channelCodeVersion:{value:`${n.attributes.snapshotFormatVersion}@${n.attributes.packageVersion}`,tag:Ne.PackageData}});let i=yield n.load(this.runtime,this.id,this.services,t);C(this.pending!==void 0,575);for(let s of this.pending)this.services.deltaConnection.process(s,!1,void 0);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=i,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),this.channel})}getGCData(t=!1){return y(this,null,function*(){return this.summarizerNode.getGCData(t)})}getGCDataInternal(t=!1){return y(this,null,function*(){return(yield this.getChannel()).getGCData(t)})}updateUsedRoutes(t,n){this.summarizerNode.updateUsedRoutes([""])}}return r.pendingOpsCountThreshold=1e3,r})();var bi=function(r){return r.Attach="attach",r.ChannelOp="op",r}(bi||{}),Zi=class r extends be{constructor(e,t,n){super(),this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new Ee,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,C(!e.id.includes("/"),782),this.logger=ue.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:Te()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();let i=e.baseSnapshot;this.channelsBaseGCDetails=new At(()=>y(this,null,function*(){var s,o,a;let c=yield(a=(o=(s=this.dataStoreContext).getBaseGCDetails)===null||o===void 0?void 0:o.call(s))!==null&&a!==void 0?a:this.dataStoreContext.getInitialGCSummaryDetails();return _u(c)})),i?.trees!==void 0&&Object.keys(i.trees).forEach(s=>{if(s==="_search")return;let o;e.isLocalDataStore?(o=new Bu(s,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(c,l)=>this.submitChannelOp(s,c,l),c=>this.setChannelDirty(c),(c,l)=>this.addedGCOutboundReference(c,l),i.trees[s]),e.attachState!==se.Detached?o.makeVisible():this.localChannelContextQueue.set(s,o)):o=new og(this,e,e.storage,(c,l)=>this.submitChannelOp(s,c,l),c=>this.setChannelDirty(c),(c,l)=>this.addedGCOutboundReference(c,l),s,i.trees[s],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:pr.CreateSummarizerNodeSource.FromSummary}),()=>y(this,null,function*(){return this.getChannelBaseGCDetails(s)}));let a=new Ee;a.resolve(o),this.contexts.set(s,o),this.contextsDeferred.set(s,a)}),this.attachListener(),this.bindState=n?nr.Bound:nr.NotBound,this._attachState=e.attachState,n?this.visibilityState=e.attachState===se.Detached?pr.VisibilityState.LocallyVisible:pr.VisibilityState.GloballyVisible:this.visibilityState=pr.VisibilityState.NotVisible,n&&this.deferredAttached.resolve()}static load(e,t,n){return new r(e,t,n)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==se.Detached}get attachState(){return this._attachState}get absolutePath(){return Vr(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}resolveHandle(e){return y(this,null,function*(){return this.request(e)})}request(e){return y(this,null,function*(){try{let t=hr.create(e),n=t.pathParts[0];if(n==="_channels"||n==="_custom")return this.request(t.createSubRequest(1));if(this.contextsDeferred.has(n)&&t.isLeaf(1))try{return{mimeType:"fluid/object",status:200,value:yield(yield this.contextsDeferred.get(n).promise).getChannel()}}catch(i){return this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},i),gu(500,`Failed to get Channel: ${i}`,e)}return Et(e)}catch(t){return mi(t)}})}getChannel(e){return y(this,null,function*(){return this.verifyNotClosed(),this.contextsDeferred.has(e)||this.contextsDeferred.set(e,new Ee),yield(yield this.contextsDeferred.get(e).promise).getChannel()})}createChannel(e=Te(),t){if(e.includes("/"))throw new ve(`Id cannot contain slashes: ${e}`);this.verifyNotClosed(),C(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);let n=new qu(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(i,s)=>this.submitChannelOp(e,i,s),i=>this.setChannelDirty(i),(i,s)=>this.addedGCOutboundReference(i,s));if(this.contexts.set(e,n),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(n);else{let i=new Ee;i.resolve(n),this.contextsDeferred.set(e,i)}return C(!!n.channel,378),n.channel}bindChannel(e){if(C(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached){this.attachChannel(e);return}this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===pr.VisibilityState.NotVisible&&(this.visibilityState=pr.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===nr.NotBound&&(this.bindState=nr.Binding,this.dataStoreContext.bindToContext(),this.bindState=nr.Bound)}bind(e){if(this.visibilityState!==pr.VisibilityState.NotVisible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}setConnectionState(e,t){this.verifyNotClosed();for(let[,n]of this.contexts)n.setConnectionState(e,t);Hi(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}uploadBlob(e){return y(this,null,function*(){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(e)})}process(e,t,n){this.verifyNotClosed();try{switch(e.type){case bi.Attach:{let i=e.contents,s=i.id;if(t)C(this.pendingAttach.has(s),380),this.pendingAttach.delete(s);else{C(!this.contexts.has(s),381);let o=new Map,a=zl(i.snapshot.entries,o),c=new og(this,this.dataStoreContext,this.dataStoreContext.storage,(l,d)=>this.submitChannelOp(s,l,d),l=>this.setChannelDirty(l),(l,d)=>this.addedGCOutboundReference(l,d),s,a,this.sharedObjectRegistry,o,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:pr.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:i.snapshot}),()=>y(this,null,function*(){return this.getChannelBaseGCDetails(s)}),i.type);if(this.contexts.set(s,c),this.contextsDeferred.has(s))this.contextsDeferred.get(s).resolve(c);else{let l=new Ee;l.resolve(c),this.contextsDeferred.set(s,l)}}break}case bi.ChannelOp:this.processChannelOp(e,t,n);break;default:}this.emit("op",e)}catch(i){throw gt.wrapIfUnrecognized(i,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){let e=[];for(let[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}getGCData(e=!1){return y(this,null,function*(){let t=new vi;return yield Promise.all(Array.from(this.contexts).filter(([n,i])=>this.isChannelAttached(n)).map(s=>y(this,[s],function*([n,i]){let o=yield i.getGCData(e);t.prefixAndAddNodes(n,o.gcNodes)}))),this.updateGCNodes(t),t.getGCData()})}updateUsedRoutes(e,t){var n;let i=Tu(e);for(let[s]of i)C(this.contexts.has(s),382);for(let[s,o]of this.contexts)o.updateUsedRoutes((n=i.get(s))!==null&&n!==void 0?n:[],t)}addedGCOutboundReference(e,t){var n,i;(i=(n=this.dataStoreContext).addedGCOutboundReference)===null||i===void 0||i.call(n,e,t)}getChannelBaseGCDetails(e){return y(this,null,function*(){var t;let n=(yield this.channelsBaseGCDetails).get(e);return n===void 0?n={}:((t=n.gcData)===null||t===void 0?void 0:t.gcNodes)!==void 0&&O_(n.gcData.gcNodes,this.absolutePath),(n.usedRoutes===void 0||n.usedRoutes.length===0)&&(n.usedRoutes=[""]),n})}summarize(e=!1,t=!0,n){return y(this,null,function*(){let i=new mt;return yield Promise.all(Array.from(this.contexts).filter(([s,o])=>{let a=this.isChannelAttached(s);return C(a,383),a}).map(a=>y(this,[a],function*([s,o]){let c=yield o.summarize(e,t,n);i.addWithStats(s,c)}))),i.getSummaryTree()})}getAttachSummary(e){this.attachGraph();let t=new mt;for(let[n,i]of this.contexts){if(!(i instanceof go))throw new Re("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(n)){let s;if(i.isLoaded){let o=i.getAttachSummary(e);C(o.summary.type===sg.Tree,384),s={stats:o.stats,summary:o.summary}}else C(!!this.dataStoreContext.baseSnapshot,385),s=ho(this.dataStoreContext.baseSnapshot.trees[n]);t.addWithStats(n,s)}}return t.getSummaryTree()}submitMessage(e,t,n){this.submit(e,t,n)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}waitAttached(){return y(this,null,function*(){return this.deferredAttached.promise})}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),C(this.isAttached,386),C(this.visibilityState===pr.VisibilityState.GloballyVisible,720);let t=ku(e,!0,!1),n=fo(t.summary),i={id:e.id,snapshot:n,type:e.attributes.type};this.pendingAttach.set(e.id,i),this.submit(bi.Attach,i),this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,n){let i={address:e,contents:t};this.submit(bi.ChannelOp,i,n)}submit(e,t,n=void 0){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,n)}reSubmit(e,t,n){switch(this.verifyNotClosed(),e){case bi.ChannelOp:{let i=t,s=this.contexts.get(i.address);C(!!s,387),s.reSubmit(i.contents,n);break}case bi.Attach:this.submit(e,t,n);break;default:ot(e)}}rollback(e,t,n){switch(this.verifyNotClosed(),e){case bi.ChannelOp:{let i=t,s=this.contexts.get(i.address);C(!!s,749),s.rollback(i.contents,n);break}default:throw new Re(`Can't rollback ${e} message`)}}applyStashedOp(e){return y(this,null,function*(){let t=e,n=this.contexts.get(t.address);return C(!!n,388),yield n.getChannel(),n.applyStashedOp(t.contents)})}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,n){this.verifyNotClosed();let i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);return C(!!o,389),o.processOp(s,t,n),o}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",()=>{this.attachGraph(),this._attachState=se.Attaching,C(this.visibilityState===pr.VisibilityState.LocallyVisible,721),this.visibilityState=pr.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach(e=>{e.makeVisible()}),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")}),this.dataStoreContext.once("attached",()=>{C(this.visibilityState===pr.VisibilityState.GloballyVisible,722),this._attachState=se.Attached,this.emit("attached")})}verifyNotClosed(){if(this._disposed)throw new Re("Runtime is closed")}},X_=(r,e=Zi)=>class Y_ extends e{request(n){return y(this,null,function*(){let i=yield qr(Y_.prototype,this,"request").call(this,n);return i.status===404?r(n,this):i})}};at();var kr=class{constructor(e,t,n){this.value=e,this.path=t,this.routeContext=n,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=Vr(t,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}get(){return y(this,null,function*(){return this.value})}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(e){if(this.visible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}};var Lu=class extends kr{get(){return y(this,null,function*(){throw Error("Do not try to get a summarizer object from the handle. Reference it directly.")})}attach(){}bind(e){}};te();xe();te();var ju=class{constructor(e,t){this.lastOpSequenceNumber=e,this._lastAttempt=t,this._lastSuccessfulSummary=Object.assign({},t)}get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}updateWithLastSummaryAckInfo(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}recordAttempt(e){this._lastAttempt={refSequenceNumber:e??this.lastOpSequenceNumber,summaryTime:Date.now()}}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}},zu=class{constructor(e,t,n,i){this.heuristicData=e,this.configuration=t,this.trySummarize=n,this.logger=i,this.idleTimer=new Zt(this.configuration.idleTime,()=>this.trySummarize("idle")),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}run(){let e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}shouldRunLastSummary(){let e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}dispose(){this.idleTimer.clear()}};te();xe();function Hu(r,e,t){return y(this,null,function*(){let n=[r.then(i=>({result:"done",value:i})),e.then(({timerResult:i})=>({result:i}))];return t!==void 0&&n.push(t.waitCancelled.then(()=>({result:"cancelled"}))),Promise.race(n)})}var Q_=2e4,Q9=5,Z_={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"},In=class{constructor(){this.summarySubmitted=new Ee,this.summaryOpBroadcasted=new Ee,this.receivedSummaryAckOrNack=new Ee}fail(e,t,n,i){C(!this.receivedSummaryAckOrNack.isCompleted,606);let s={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:i};this.summarySubmitted.resolve(s),this.summaryOpBroadcasted.resolve(s),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},s),{data:n}))}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}},Vu=class{constructor(e,t,n,i,s,o,a){this.pendingAckTimer=e,this.heuristicData=t,this.submitSummaryCallback=n,this.raiseSummarizingError=i,this.successfulSummaryCallback=s,this.summaryWatcher=o,this.logger=a,this.summarizeTimer=new Zt(Q_,()=>this.summarizeTimerHandler(Q_,1))}summarize(e,t,n,i=new In){return this.summarizeCore(e,t,i,n).catch(s=>{let o="UnexpectedSummarizeError";this.logger.sendErrorEvent(Object.assign({eventName:o},e),s),i.fail(o,s)}),i.build()}summarizeCore(e,t,n,i){return y(this,null,function*(){let{refreshLatestAck:s,fullTree:o}=t,a=ue.create(this.logger,void 0,{all:e}),c=Date.now()-this.heuristicData.lastAttempt.summaryTime,l=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,d={fullTree:o,timeSinceLastAttempt:c,timeSinceLastSummary:l},h=ce.start(a,Object.assign({eventName:"Summarize",refreshLatestAck:s},d)),u=m=>`${m}: ${Z_[m]}`,f=(m,b,v,x)=>{this.raiseSummarizingError(Z_[m]);let _=zm(b),A=i.cancelled||b?.errorType===Bt.offlineError?"generic":"error";h.cancel(Object.assign(Object.assign({},v),{reason:m,category:A,retryAfterSeconds:_}),b),n.fail(u(m),b,x,_)};this.summarizeTimer.start();let g;try{g=yield this.submitSummaryCallback({fullTree:o,refreshLatestAck:s,summaryLogger:a,cancellationToken:i});let m=g.referenceSequenceNumber,b=m-this.heuristicData.lastSuccessfulSummary.refSequenceNumber;if(d=Object.assign(Object.assign({},d),{referenceSequenceNumber:m,minimumSequenceNumber:g.minimumSequenceNumber,opsSinceLastAttempt:m-this.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:b}),g.stage!=="base"&&(d=Object.assign(Object.assign(Object.assign({},d),g.summaryStats),{generateDuration:g.generateDuration}),g.stage!=="generate"&&(d=Object.assign(Object.assign({},d),{handle:g.handle,uploadDuration:g.uploadDuration}),g.stage!=="upload"&&(d=Object.assign(Object.assign({},d),{clientSequenceNumber:g.clientSequenceNumber})))),g.stage!=="submit")return f("submitSummaryFailure",g.error,d);if(!o&&!g.forcedFullTree){let{summarizedDataStoreCount:v,gcStateUpdatedDataStoreCount:x=0}=g.summaryStats;v>x+b&&a.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:v,gcStateUpdatedDataStoreCount:x,opsSinceLastSummary:b})}h.reportEvent("generate",Object.assign({},d)),n.summarySubmitted.resolve({success:!0,data:g})}catch(m){return f("submitSummaryFailure",m)}finally{this.heuristicData.recordAttempt(g?.referenceSequenceNumber),this.summarizeTimer.clear()}try{let m=this.pendingAckTimer.start(),b=this.summaryWatcher.watchSummary(g.clientSequenceNumber),v=yield Hu(b.waitBroadcast(),m,i);if(v.result==="cancelled")return f("disconnect");if(v.result!=="done")return f("summaryOpWaitTimeout");let x=v.value,_=Date.now()-this.heuristicData.lastAttempt.summaryTime;n.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:x,broadcastDuration:_}}),this.heuristicData.lastAttempt.summarySequenceNumber=x.sequenceNumber,a.sendTelemetryEvent({eventName:"Summarize_Op",duration:_,referenceSequenceNumber:x.referenceSequenceNumber,summarySequenceNumber:x.sequenceNumber,handle:x.contents.handle});let A=yield Hu(b.waitAckNack(),m,i);if(A.result==="cancelled")return f("disconnect");if(A.result!=="done")return f("summaryAckWaitTimeout");let D=A.value;this.pendingAckTimer.clear();let O=Date.now()-this.heuristicData.lastAttempt.summaryTime;if(d=Object.assign({ackWaitDuration:O,ackNackSequenceNumber:D.sequenceNumber,summarySequenceNumber:D.contents.summaryProposal.summarySequenceNumber},d),D.type===tt.SummaryAck)this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),h.end(Object.assign(Object.assign({},d),{handle:D.contents.handle})),n.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:D,ackNackDuration:O}});else{C(D.type===tt.SummaryNack,628);let M=D.contents,S=M?.message,E=M?.retryAfter,w=new Re(`Received summaryNack: ${S}`,{retryAfterSeconds:E});return C(zm(w)===E,607),f("summaryNack",w,Object.assign(Object.assign({},d),{nackRetryAfter:E}),{summaryNackOp:D,ackNackDuration:O})}}finally{this.pendingAckTimer.clear()}})}summarizeTimerHandler(e,t){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<Q9){let n=e*2;this.summarizeTimer.start(n,()=>this.summarizeTimerHandler(n,t+1))}}dispose(){this.summarizeTimer.clear()}};var ag=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},Z9=10*60*1e3,Uu=class r{constructor(e,t,n,i,s,o,a,c,l){this.summaryWatcher=t,this.configuration=n,this.submitSummaryCallback=i,this.heuristicData=s,this.raiseSummarizingError=o,this.summaryCollection=a,this.cancellationToken=c,this.stopSummarizerCallback=l,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=u=>this.heuristicData.lastAttempt.refSequenceNumber===u?this.logger:void 0;let d={summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts};this.logger=ue.create(e,"Running",{all:d}),n.state!=="disableHeuristics"&&(C(this.configuration.state==="enabled",746),this.heuristicRunner=new zu(s,this.configuration,u=>this.trySummarize(u),this.logger)),C(this.configuration.state!=="disabled",747);let h=Math.min(this.configuration.maxAckWaitTime,Z9);this.pendingAckTimer=new va(h,()=>{this.raiseSummarizingError("Pending summary ack not received in time"),this.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:h,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})}),a.setPendingAckTimerTimeoutCallback(h,()=>{this.pendingAckTimer.hasTimer&&(this.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())}),this.generator=new Vu(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,()=>{this.totalSuccessfulAttempts++},this.summaryWatcher,this.logger)}static start(e,t,n,i,s,o,a,c,l){return y(this,null,function*(){var d;let h=new r(e,t,n,i,s,o,a,c,l);return yield h.waitStart(),(d=h.heuristicRunner)===null||d===void 0||d.run(),h})}get disposed(){return this._disposed}dispose(){var e;this.summaryWatcher.dispose(),(e=this.heuristicRunner)===null||e===void 0||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleSystemOp(e){switch(e.type){case tt.ClientLeave:case tt.ClientJoin:case tt.Propose:{this.handleOp(void 0,e);return}default:return}}handleOp(e,{sequenceNumber:t,type:n,clientId:i,contents:s}){var o;e===void 0&&(this.heuristicData.lastOpSequenceNumber=t,this.tryRunEnqueuedSummary()||(o=this.heuristicRunner)===null||o===void 0||o.run())}waitStop(e){return y(this,null,function*(){var t;this.stopping||(this.stopping=!0,this.disposeEnqueuedSummary(),e&&(!((t=this.heuristicRunner)===null||t===void 0)&&t.shouldRunLastSummary())&&this.summarizingLock===void 0&&this.trySummarizeOnce({reason:"lastSummary"},{}),yield this.summarizingLock)})}waitStart(){return y(this,null,function*(){let e=yield Hu(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),e.result==="done"&&e.value!==void 0&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:e.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:e.value.summaryOp.sequenceNumber})})}lockedRefreshSummaryAckAction(e){return y(this,null,function*(){C(this.refreshSummaryAckLock===void 0,"Refresh Summary Ack - Caller is responsible for checking lock");let t=new Ee;return this.refreshSummaryAckLock=t.promise,e().finally(()=>{t.resolve(),this.refreshSummaryAckLock=void 0})})}lockedSummaryAction(e){return y(this,null,function*(){C(this.summarizingLock===void 0,603);let t=new Ee;return this.summarizingLock=t.promise,this.summarizeCount++,yield this.refreshSummaryAckLock,e().finally(()=>{var n;t.resolve(),this.summarizingLock=void 0;let i=this.tryWhileSummarizing;this.tryWhileSummarizing=!1,!this.stopping&&!this.tryRunEnqueuedSummary()&&i&&((n=this.heuristicRunner)===null||n===void 0||n.run())})})}trySummarizeOnce(e,t,n=this.cancellationToken,i=new In){return this.lockedSummaryAction(()=>y(this,null,function*(){return this.generator.summarize(e,t,n,i).receivedSummaryAckOrNack})).catch(s=>{}),i.build()}trySummarize(e,t=this.cancellationToken){if(this.summarizingLock!==void 0){this.tryWhileSummarizing=!0;return}this.lockedSummaryAction(()=>y(this,null,function*(){let n=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}],i,s=0,o=0,a;for(let c=0;c<n.length;){if(this.cancellationToken.cancelled||++s>1&&e==="lastSummary")return;o++;let l=n[c],{delaySeconds:d=0}=l,h=ag(l,["delaySeconds"]),u=i??d,f=Object.assign({reason:e,summaryAttempts:s,summaryAttemptsPerPhase:o,summaryAttemptPhase:c+1},h);u>0&&(this.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:u,summaryNackDelay:i!==void 0},f)),yield ya(u*1e3)),yield this.refreshSummaryAckLock;let m=yield this.generator.summarize(f,h,t).receivedSummaryAckOrNack;if(m.success)return;i=m.retryAfterSeconds,(i===void 0||o>1)&&(c++,o=0),a=m}this.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:a?.message},a?.error),this.stopSummarizerCallback("failToSummarize")})).catch(n=>{this.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},n)})}summarizeOnDemand(e=new In,t){var{reason:n}=t,i=ag(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(this.summarizingLock!==void 0)throw new ve("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:`onDemand/${n}`},i,this.cancellationToken,e)}enqueueSummarize(e){var{reason:t,afterSequenceNumber:n=0,override:i=!1}=e,s=ag(e,["reason","afterSequenceNumber","override"]);let o=`enqueue;${t}`,a=!1;if(this.enqueuedSummary!==void 0){if(!i)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,a=!0}this.enqueuedSummary={reason:o,afterSequenceNumber:n,options:s,resultsBuilder:new In};let c=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),a?Object.assign(Object.assign({},c),{alreadyEnqueued:!0,overridden:!0}):c}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(this.enqueuedSummary===void 0||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||this.summarizingLock!==void 0)return!1;let{reason:e,resultsBuilder:t,options:n}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:`enqueuedSummary/${e}`},n,this.cancellationToken,t),!0}disposeEnqueuedSummary(){this.enqueuedSummary!==void 0&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}};var eq="summarizingError",oc=class r extends Re{constructor(e,t=!1){super(e),this.logged=t,this.errorType=eq,this.canRetry=!0}static wrap(e,t=!1,n){return Ia(e,s=>new r(s,t),n)}},tq=(r,e)=>new oc(r,e),Gu=class r extends e4.EventEmitter{constructor(e,t,n,i,s,o,a){super(),this.runtime=t,this.configurationGetter=n,this.internalsProvider=i,this.summaryCollection=o,this.runCoordinatorCreateFn=a,this._disposed=!1,this.starting=!1,this.stopDeferred=new Ee,this.summarizeOnDemand=(...c)=>{var l;try{if(this._disposed||!((l=this.runningSummarizer)===null||l===void 0)&&l.disposed)throw new ve("Summarizer is already disposed.");if(this.runtime.summarizerClientId!==void 0&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new ve("On-demand summary attempted while an elected summarizer is present");let d=new In;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(d,...c):(this.runCoordinatorCreateFn(this.runtime).then(u=>{this.start(this.runtime.clientId,u).then(g=>y(this,null,function*(){g.summarizeOnDemand(d,...c);let m=yield Promise.race([this.stopDeferred.promise,u.waitCancelled]);yield g.waitStop(!1),u.stop(m),this.close()})).catch(g=>{d.fail("Failed to start summarizer",g)})}).catch(u=>{d.fail("Failed to create cancellation token",u)}),d.build())}catch(d){throw oc.wrap(d,!1,this.logger)}},this.enqueueSummarize=(...c)=>{if(this._disposed||this.runningSummarizer===void 0||this.runningSummarizer.disposed)throw new ve("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(...c)},this.logger=ue.create(this.runtime.logger,"Summarizer"),this.innerHandle=new Lu(this,e,s)}get IFluidLoadable(){return this}get ISummarizer(){return this}get handle(){return this.innerHandle}static create(e,t){return y(this,null,function*(){let n={headers:{[et.cache]:!1,[et.clientDetails]:{capabilities:{interactive:!1},type:Lt},[ai.summarizingClient]:!0,[et.reconnect]:!1},url:t},i=yield e.resolve(n),s=yield un(i,{url:"_summarizer"});if(s.ISummarizer===void 0)throw new ve("Fluid object does not implement ISummarizer");return s.ISummarizer})}run(e){return y(this,null,function*(){try{return yield this.runCore(e)}catch(t){throw this.stop("summarizerException"),oc.wrap(t,!1,this.logger)}finally{this.close()}})}stop(e){this.stopDeferred.resolve(e)}close(){this.dispose(),this.runtime.closeFn()}runCore(e){return y(this,null,function*(){let t=yield this.runCoordinatorCreateFn(this.runtime),n=Promise.race([t.waitCancelled,this.stopDeferred.promise]);if(n.then(o=>{this.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:e,reason:o})}),t.cancelled)return t.waitCancelled;let i=yield this.start(e,t),s=yield n;return yield i.waitStop(!t.cancelled&&r.stopReasonCanRunLastSummary(s)),t.stop(s),s})}static stopReasonCanRunLastSummary(e){return e==="parentNotConnected"}start(e,t){return y(this,null,function*(){if(this.runningSummarizer){if(this.runningSummarizer.disposed)throw new ve("Starting a disposed summarizer");return this.runningSummarizer}if(this.starting)throw new ve("Attempting to start a summarizer that is already starting");this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:e,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())});let n=this.runtime.clientId;if(n===void 0)throw new ve("clientId should be defined if connected.");let i=yield Uu.start(this.logger,this.summaryCollection.createWatcher(n),this.configurationGetter(),(...s)=>y(this,null,function*(){return this.internalsProvider.submitSummary(...s)}),new ju(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),s=>{this._disposed||this.logger.sendErrorEvent({eventName:"summarizingError"},tq(s,!0))},this.summaryCollection,t,s=>t.stop(s));return this.runningSummarizer=i,this.starting=!1,this.handleSummaryAcks().catch(s=>{this.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},s)}),this.systemOpListener=s=>i.handleSystemOp(s),this.runtime.deltaManager.inbound.on("op",this.systemOpListener),this.opListener=(s,o)=>i.handleOp(s,o),this.runtime.on("batchEnd",this.opListener),i})}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}handleSummaryAcks(){return y(this,null,function*(){var e,t,n,i,s;let o=this.runtime.deltaManager.initialSequenceNumber,a;for(;this.runningSummarizer;){let c=(e=this.runningSummarizer.tryGetCorrelatedLogger(o))!==null&&e!==void 0?e:this.logger;try{a=void 0,a=yield this.summaryCollection.waitSummaryAck(o),o=a.summaryOp.referenceSequenceNumber;let l=a.summaryOp.contents.handle,d=a.summaryAck.contents.handle;yield this.runningSummarizer.lockedRefreshSummaryAckAction(()=>y(this,null,function*(){return this.internalsProvider.refreshLatestSummaryAck(l,d,o,c).catch(h=>y(this,null,function*(){if(Da(h)&&h.errorType===Bt.fileNotFoundOrAccessDeniedError)c.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:o,proposalHandle:l,ackHandle:d},h);else throw h}))}))}catch(l){c.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:o,handle:(n=(t=a?.summaryOp)===null||t===void 0?void 0:t.contents)===null||n===void 0?void 0:n.handle,ackHandle:(s=(i=a?.summaryAck)===null||i===void 0?void 0:i.contents)===null||s===void 0?void 0:s.handle},l)}o++}})}};te();xe();var rq=5e3,nq=4e3,jt=function(r){return r[r.Off=0]="Off",r[r.Starting=1]="Starting",r[r.Running=2]="Running",r[r.Stopping=3]="Stopping",r}(jt||{}),t4=(()=>{class r{constructor(t,n,i,s,o,a,{initialDelayMs:c=rq,opsToBypassInitialDelay:l=nq}={},d){this.clientElection=t,this.connectedState=n,this.summaryCollection=i,this.requestSummarizerFn=o,this.startThrottler=a,this.disableHeuristics=d,this.state=jt.Off,this._disposed=!1,this.handleConnected=h=>{this.latestClientId=h,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{let h=this.getShouldSummarizeState();switch(this.state){case jt.Off:{h.shouldSummarize&&this.startSummarization();return}case jt.Starting:return;case jt.Running:{h.shouldSummarize===!1&&this.stop(h.stopReason);return}case jt.Stopping:return;default:return}},this.summarizeOnDemand=(...h)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.summarizeOnDemand(...h)},this.enqueueSummarize=(...h)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.enqueueSummarize(...h)},this.logger=ue.create(s,"SummaryManager",{all:{clientId:()=>this.latestClientId}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=l,this.initialDelayMs=c}get disposed(){return this._disposed}get currentState(){return this.state}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){if(this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==jt.Running&&this.connectedState.clientId!==this.clientElection.electedClientId)return{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"};if(this.connectedState.connected)if(this.disposed)C(!1,608);else return{shouldSummarize:!0};else return{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){C(this.state===jt.Off,609),this.state=jt.Starting,C(this.summarizer===void 0,610),this.delayBeforeCreatingSummarizer().then(t=>y(this,null,function*(){if(t&&this.getShouldSummarizeState().shouldSummarize===!1)return"early exit";C(this.state===jt.Starting,611),this.state=jt.Running;let n=yield this.requestSummarizerFn();this.summarizer=n;let i=this.getShouldSummarizeState();if(i.shouldSummarize===!1)return this.state=jt.Starting,n.stop(i.stopReason),"early exit after starting summarizer";let s=this.latestClientId;return ce.timedExecAsync(this.logger,{eventName:"RunningSummarizer",attempt:this.startThrottler.numAttempts},()=>y(this,null,function*(){return n.run(s,this.disableHeuristics)}))})).then(t=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:t})}).catch(t=>{if(this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},t),this.getShouldSummarizeState().shouldSummarize||this.summarizer!==void 0){let n=t?.errorType===Bt.offlineError?"generic":"error";this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:n},t)}}).finally(()=>{var t;C(this.state!==jt.Off,612),this.state=jt.Off,(t=this.summarizer)===null||t===void 0||t.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()})}stop(t){var n;r.isStartingOrRunning(this.state)&&(this.state=jt.Stopping,(n=this.summarizer)===null||n===void 0||n.stop(t))}delayBeforeCreatingSummarizer(){return y(this,null,function*(){let t=this.startThrottler.getDelay();this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:t,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay});let n=!1;if(this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(n=!0,t=Math.max(t,this.initialDelayMs)),t>0){let i,s,o=()=>{this.summaryCollection.opsSinceLastAck>=this.opsToBypassInitialDelay&&(clearTimeout(i),s())},a=new Promise(l=>{i=setTimeout(()=>l(),t)}),c=new Promise(l=>{s=l});this.summaryCollection.addOpListener(o),yield Promise.race([a,c]),this.summaryCollection.removeOpListener(o)}return n})}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}return r.isStartingOrRunning=e=>e===jt.Starting||e===jt.Running,r})();te();xe();var r4=(()=>{class r{constructor(t,n){this.logger=n,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=r.processingTime,this.schedulingCount=0,this.deltaManager=t,this.deltaManager.inbound.on("idle",()=>{this.inboundQueueIdle()})}batchBegin(t){this.processingStartTime||(this.processingStartTime=le.now()),this.schedulingLog===void 0&&this.schedulingCount%500===0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:t.sequenceNumber,lastSequenceNumber:t.sequenceNumber,startTime:le.now()})}batchEnd(t){if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=t.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){let n=le.now(),i=n-this.processingStartTime;i>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=i),setTimeout(()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:Qe.formatTick(i),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:Qe.formatTick(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:Qe.formatTick(le.now()-n)}),this.deltaManager.inbound.resume()}),this.processingStartTime=void 0)}}inboundQueueIdle(){if(this.schedulingLog){let t=le.now();this.schedulingLog.totalProcessingTime+=t-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:Qe.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:Qe.formatTick(t-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=r.processingTime}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}return r.processingTime=50,r})();xe();te();var lg=5e3,cg=class{constructor(e,t,n){this.clientId=e,this.deltaManager=t,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=le.now(),this.connectionStartTime=0,this.gap=0,this.logger=ue.create(n,"OpPerf"),this.deltaManager.on("pong",i=>this.recordPingTime(i)),this.deltaManager.on("submitOp",i=>this.beforeOpSubmit(i)),this.deltaManager.on("op",i=>this.afterProcessingOp(i)),this.deltaManager.on("connect",(i,s)=>{this.clientId=i.clientId,s!==void 0&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=s,this.connectionStartTime=le.now(),this.gap<=0&&this.reportGettingUpToDate())}),this.deltaManager.on("disconnect",()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.opProcessingTimes={},this.opPerfData={},this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.pongCount=0}),this.deltaManager.outbound.on("push",i=>{for(let s of i)s.type===tt.Operation&&this.clientSequenceNumberForLatencyStatistics===s.clientSequenceNumber&&(C(this.opProcessingTimes.outboundPushEventTime===void 0,712),C(this.opPerfData.durationNetwork===void 0,713),this.opProcessingTimes.outboundPushEventTime=Date.now(),C(this.opPerfData.durationOutboundBatching===void 0,714),C(this.opProcessingTimes.submitOpEventTime!==void 0,715),this.opPerfData.durationOutboundBatching=this.opProcessingTimes.outboundPushEventTime-this.opProcessingTimes.submitOpEventTime)}),this.deltaManager.inbound.on("push",i=>{this.clientId===i.clientId&&i.type===tt.Operation&&this.clientSequenceNumberForLatencyStatistics===i.clientSequenceNumber&&this.opProcessingTimes.outboundPushEventTime!==void 0&&(this.opProcessingTimes.inboundPushEventTime=Date.now(),this.opPerfData.durationNetwork=this.opProcessingTimes.inboundPushEventTime-this.opProcessingTimes.outboundPushEventTime,this.opProcessingTimes.outboundPushEventTime=void 0,this.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)}),this.deltaManager.inbound.on("idle",(i,s)=>{typeof i=="number"&&i>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:i,duration:s})})}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:le.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?Qe.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(e){this.pingLatency=e,this.pongCount%100===0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}beforeOpSubmit(e){this.clientSequenceNumberForLatencyStatistics===void 0&&e.clientSequenceNumber%500===1&&(C(this.opProcessingTimes.outboundPushEventTime===void 0,716),C(this.opPerfData.durationNetwork===void 0,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}afterProcessingOp(e){let t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),this.sequenceNumberForMsnTracking===void 0&&t%1e3===0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),this.sequenceNumberForMsnTracking!==void 0&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&(C(this.msnTrackingTimestamp!==void 0,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){C(this.opProcessingTimes.submitOpEventTime!==void 0,288);let n=Date.now();this.opProcessingTimes.inboundPushEventTime!==void 0&&(this.opPerfData.durationInboundToProcessing=n-this.opProcessingTimes.inboundPushEventTime);let i=n-this.opProcessingTimes.submitOpEventTime,s=i>lg?"error":"performance";this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:i,category:s,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}};function n4(r,e,t){new cg(r,e,t)}te();var Wu=ye(Tr());xe();var hg=ye(ug());var Ku=class{constructor(e,t,n){var i;this.stateHandler=e,this.pendingStates=new hg.default,this.disposeOnce=new lr(()=>{this.initialStates.clear(),this.pendingStates.clear()}),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=()=>this.disposeOnce.value,this.initialStates=new hg.default((i=n?.pendingStates)!==null&&i!==void 0?i:[]),this.flushModeForNextMessage=t,this.onFlushModeUpdated(t)}get pendingMessagesCount(){return this._pendingMessagesCount}hasPendingMessages(){return this._pendingMessagesCount!==0||!this.initialStates.isEmpty()}getLocalState(){if(C(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map(e=>e.type==="message"?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e)}}get disposed(){return this.disposeOnce.evaluated}onSubmitMessage(e,t,n,i,s,o){let a={type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:n,content:i,localOpMetadata:s,opMetadata:o};this.pendingStates.push(a),this._pendingMessagesCount++}onFlushModeUpdated(e){this.pendingStates.push({type:"flushMode",flushMode:e})}onFlush(){if(this.stateHandler.flushMode()===Wu.FlushMode.Immediate)return;let e=this.pendingStates.peekBack();e?.type==="message"&&this.pendingStates.push({type:"flush"})}applyStashedOpsAt(e){return y(this,null,function*(){for(;!this.initialStates.isEmpty();){let t=this.initialStates.peekFront();if(t.type==="message"){if(e!==void 0){if(t.referenceSequenceNumber>e)break;if(t.referenceSequenceNumber<e)throw new Error("loaded from snapshot too recent to apply stashed ops")}let n=yield this.stateHandler.applyStashedOp(t.messageType,t.content);t.localOpMetadata=n}this.pendingStates.push(this.initialStates.shift())}})}processPendingLocalMessage(e){this.maybeProcessBatchBegin(e);let t=this.peekNextPendingState();if(C(t.type==="message",361),this.pendingStates.shift(),t.clientSequenceNumber!==e.clientSequenceNumber){let n=gt.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(n);return}return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata}maybeProcessBatchBegin(e){let t,n=!1,i=this.peekNextPendingState();for(;i.type!=="message";)i.type==="flushMode"&&(t=i.flushMode),i.type==="flush"&&(n=!0),this.pendingStates.shift(),i=this.peekNextPendingState();t!==void 0&&(this.flushModeForNextMessage=t),t!==Wu.FlushMode.Immediate&&(t===Wu.FlushMode.TurnBased||n)&&(C(!this.isProcessingBatch&&this.pendingBatchBeginMessage===void 0,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}maybeProcessBatchEnd(e){var t,n;if(!this.isProcessingBatch)return;let i=this.peekNextPendingState();if(i.type==="message")return;C(i.type!=="flushMode",701),C(this.pendingBatchBeginMessage!==void 0,365);let s=(t=this.pendingBatchBeginMessage.metadata)===null||t===void 0?void 0:t.batch;if(this.pendingBatchBeginMessage===e)C(s===void 0,366);else{let o=(n=e.metadata)===null||n===void 0?void 0:n.batch;C(s===!0,367),C(o===!1,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}checkpoint(){let e=this.pendingStates.peekBack();return{rollback:()=>{try{for(;this.pendingStates.peekBack()!==e;)this.rollbackNextPendingState()}catch(t){let n=ti(t,i=>gt.create(`RollbackError: ${i}`,"checkpointRollback",void 0));throw this.stateHandler.close(n),n}}}}peekNextPendingState(){let e=this.pendingStates.peekFront();return C(!!e,369),e}rollbackNextPendingState(){if(this.pendingStates.length===0)return;this._pendingMessagesCount--;let t=this.pendingStates.pop();switch(t.type){case"message":this.stateHandler.rollback(t.messageType,t.content,t.localOpMetadata);break;default:throw new Error(`Can't rollback state ${t.type}`)}}replayPendingStates(){C(this.stateHandler.connected(),370),C(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),C(this.initialStates.isEmpty(),372);let e=this.pendingStates.length;if(e===0)return;this._pendingMessagesCount=0;let t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){let n=this.pendingStates.shift();switch(n.type){case"message":this.stateHandler.reSubmit(n.messageType,n.content,n.localOpMetadata,n.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(n.flushMode);break;case"flush":this.stateHandler.flush();break;default:break}e--}this.stateHandler.setFlushMode(t)}};var ac="1.4.0";at();te();Pt();xe();var $u=class{constructor(e,t,n){this.path=e,this.routeContext=t,this.get=n,this.attached=!1,this.absolutePath=Vr(e,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.attached}attachGraph(){this.attached=!0}bind(e){throw new Error("Cannot bind to blob handle")}},vo=(()=>{class r{constructor(t,n,i,s,o,a,c){this.routeContext=t,this.getStorage=i,this.attachBlobCallback=s,this.gcNodeUpdated=o,this.runtime=a,this.logger=c,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",()=>{for(let l of this.pendingBlobIds.values())l.reject(new Error("runtime disposed while blobAttach op in flight"))}),this.load(n)}hasBlob(t){return this.blobIds.has(t)||this.detachedBlobIds.has(t)}getBlobGCNodePath(t){return`/${r.basePath}/${t}`}getBlob(t){return y(this,null,function*(){var n,i;let s=(i=(n=this.redirectTable)===null||n===void 0?void 0:n.get(t))!==null&&i!==void 0?i:t;return C(this.hasBlob(s),287),this.gcNodeUpdated(this.getBlobGCNodePath(t)),new $u(`${r.basePath}/${s}`,this.routeContext,()=>y(this,null,function*(){return ce.timedExecAsync(this.logger,{eventName:"AttachmentReadBlob",id:s},()=>y(this,null,function*(){return this.getStorage().readBlob(s)}),{end:!0,cancel:"error"})}))})}createBlob(t){return y(this,null,function*(){var n,i;this.runtime.attachState===se.Attaching&&(this.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),yield new Promise(a=>this.runtime.once("attached",a))),!this.runtime.connected&&this.runtime.attachState===se.Attached&&(yield new Promise(a=>this.runtime.once("connected",a)));let s=yield ce.timedExecAsync(this.logger,{eventName:"createBlob"},()=>y(this,null,function*(){return this.getStorage().createBlob(t)}),{end:!0,cancel:"error"}),o=new $u(`${r.basePath}/${s.id}`,this.routeContext,()=>y(this,null,function*(){return this.getBlob(s.id).then(a=>y(this,null,function*(){return a.get()}))}));return this.runtime.attachState===se.Detached?(this.detachedBlobIds.add(s.id),o):(this.pendingBlobIds.has(s.id)?yield(n=this.pendingBlobIds.get(s.id))===null||n===void 0?void 0:n.promise:this.blobIds.has(s.id)||(this.pendingBlobIds.set(s.id,new Ee),this.attachBlobCallback(s.id),yield(i=this.pendingBlobIds.get(s.id))===null||i===void 0?void 0:i.promise),o)})}processBlobAttachOp(t,n){if(n){let i=this.pendingBlobIds.get(t);C(i!==void 0,504),i.resolve(),this.pendingBlobIds.delete(t)}this.blobIds.add(t)}static load(t,n){return y(this,null,function*(){if(!t)return{};let i,s=t.blobs[this.redirectTableBlobName];return s&&(i=yield n(s)),{ids:Object.entries(t.blobs).filter(([a,c])=>a!==this.redirectTableBlobName).map(([a,c])=>c),redirectTable:i}})}load(t){var n,i,s;if(t.ids){let o=this.runtime.attachState===se.Detached;t.ids.map(a=>o?this.detachedBlobIds.add(a):this.blobIds.add(a))}t.redirectTable&&(this.redirectTable=new Map(t.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:(i=(n=t.ids)===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0,redirectTable:(s=t.redirectTable)===null||s===void 0?void 0:s.length})}getGCData(t=!1){let n={gcNodes:{}};if(this.blobIds.forEach(i=>{n.gcNodes[this.getBlobGCNodePath(i)]=[]}),this.redirectTable!==void 0)for(let[i,s]of this.redirectTable)n.gcNodes[this.getBlobGCNodePath(i)]=[this.getBlobGCNodePath(s)];return n}deleteUnusedRoutes(t){var n;for(let i of t){let s=i.split("/");C(s.length===3&&s[1]===r.basePath,725);let o=s[2];if(!((n=this.redirectTable)===null||n===void 0)&&n.has(o)){this.redirectTable.delete(o);continue}this.blobIds.delete(o)}}summarize(t){let i=!!this.redirectTable||this.runtime.attachState!==se.Detached?this.blobIds:this.detachedBlobIds,s=new mt;return i.forEach(o=>{s.addAttachment(o)}),this.redirectTable&&this.redirectTable.size>0&&s.addBlob(r.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),s.getSummaryTree()}setRedirectTable(t){C(this.runtime.attachState===se.Detached,594),C(!this.redirectTable,595);for(let[n,i]of t)C(this.detachedBlobIds.delete(n),596),this.blobIds.add(i);C(this.detachedBlobIds.size===0,597),this.redirectTable=t}}return r.basePath="_blobs",r.redirectTableBlobName=".redirectTable",r})();var xi=ye(Tr());at();xe();Pt();te();Dt();po();te();xe();var Ju=class{constructor(e){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new lr(()=>{for(let[t,n]of this.deferredContexts)n.promise.then(i=>{i.dispose()}).catch(i=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:t},i)})}),this.dispose=()=>this.disposeOnce.value,this._logger=ue.create(e)}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(e){return this.notBoundContexts.has(e)}has(e){return this._contexts.has(e)}get(e){return this._contexts.get(e)}delete(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}getUnbound(e){if(!(this._contexts.get(e)===void 0||!this.notBoundContexts.has(e)))return this._contexts.get(e)}addUnbound(e){let t=e.id;C(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}getBoundOrRemoted(e,t){return y(this,null,function*(){let n=this.ensureDeferred(e);if(!(!t&&!n.isCompleted))return n.promise})}ensureDeferred(e){let t=this.deferredContexts.get(e);if(t)return t;let n=new Ee;return this.deferredContexts.set(e,n),n}bind(e){let t=this.notBoundContexts.delete(e);C(t,345),this.resolveDeferred(e)}resolveDeferred(e){let t=this._contexts.get(e);C(!!t,346),C(!this.notBoundContexts.has(e),347);let n=this.deferredContexts.get(e);C(!!n,348),n.resolve(t)}addBoundOrRemoted(e){let t=e.id;C(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}};Pt();te();Tn();var bo=ye(Tr());at();xe();te();var u4=ye(Tr());te();po();var c4=ye(Tr());at();xe();var oq=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},aq=1,fn="gc",l4="__gc",cq="Fluid.GarbageCollection.RunGC",lq="Fluid.GarbageCollection.RunSweep",uq="Fluid.GarbageCollection.GCTestMode",hq="Fluid.GarbageCollection.WriteDataAtRoot",dq="Fluid.GarbageCollection.RunSessionExpiry",fq="Fluid.GarbageCollection.DisableSessionExpiry",pq="Fluid.GarbageCollection.TrackGCState",mq="Fluid.GarbageCollection.DisableSweepLog",pg=1*24*60*60*1e3,gq=7*pg,vq=30*pg,zt={DataStore:"DataStore",SubDataStore:"SubDataStore",Blob:"Blob",Other:"Other"},Ar={Active:"Active",Inactive:"Inactive",SweepReady:"SweepReady"},Xu=class{constructor(e,t,n,i){this.unreferencedTimestampMs=e,this.inactiveTimeoutMs=t,this.sweepTimeoutMs=n,this._state=Ar.Active,i!==void 0&&this.updateTracking(i)}get state(){return this._state}updateTracking(e){let t=e-this.unreferencedTimestampMs;if(this.sweepTimeoutMs!==void 0&&t>=this.sweepTimeoutMs){this._state=Ar.SweepReady,this.clearTimers();return}if(t>=this.inactiveTimeoutMs){this._state=Ar.Inactive,this.clearTimers(),this.sweepTimeoutMs!==void 0&&Qu(this.sweepTimeoutMs-t,()=>{this._state=Ar.SweepReady},i=>{this.sweepTimer=i});return}let n=this.inactiveTimeoutMs-t;if(this.inactiveTimer===void 0){let i=()=>{this._state=Ar.Inactive,this.sweepTimeoutMs!==void 0&&Qu(this.sweepTimeoutMs-this.inactiveTimeoutMs,()=>{this._state=Ar.SweepReady},s=>{this.sweepTimer=s})};this.inactiveTimer=new Zt(n,()=>i())}this.inactiveTimer.restart(n)}clearTimers(){var e;(e=this.inactiveTimer)===null||e===void 0||e.clear(),this.sweepTimer!==void 0&&clearTimeout(this.sweepTimer)}stopTracking(){this.clearTimers(),this._state=Ar.Active}},Yu=class r{constructor(e){var t,n,i,s,o,a,c;this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=aq,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=e.runtime,this.isSummarizerClient=e.isSummarizerClient,this.gcOptions=e.gcOptions,this.getNodePackagePath=e.getNodePackagePath,this.getLastSummaryTimestampMs=e.getLastSummaryTimestampMs;let l=e.baseSnapshot,d=e.metadata,h=e.readAndParseBlob;this.mc=ur(ue.create(e.baseLogger,"GarbageCollector",{all:{completedGCRuns:()=>this.completedRuns}}));let u;if(e.existing)u=fg(d),this.gcEnabled=u>0,this.sweepEnabled=(t=d?.sweepEnabled)!==null&&t!==void 0?t:!1,this.sessionExpiryTimeoutMs=d?.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&this.gcOptions.gcAllowed===!1)throw new ve("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=this.gcOptions.gcAllowed!==!1,this.sweepEnabled=this.gcOptions.sweepAllowed===!0,this.mc.config.getBoolean(dq)&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=vq)}if(this.sessionExpiryTimeoutMs!==void 0&&this.mc.config.getBoolean(fq)!==!0){let m=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs"),b=m??this.sessionExpiryTimeoutMs;Qu(b,()=>{this.runtime.closeFn(new Pu("Client session expired.",b))},v=>{this.sessionExpiryTimer=v}),e.snapshotCacheExpiryMs!==void 0&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+e.snapshotCacheExpiryMs+pg)}if(this.latestSummaryGCVersion=u??this.currentGCVersion,this.shouldRunGC=(n=this.mc.config.getBoolean(cq))!==null&&n!==void 0?n:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&this.sweepTimeoutMs!==void 0&&((i=this.mc.config.getBoolean(lq))!==null&&i!==void 0?i:this.sweepEnabled),this.trackGCState=this.mc.config.getBoolean(pq)===!0,this.inactiveTimeoutMs=(o=(s=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))!==null&&s!==void 0?s:this.gcOptions.inactiveTimeoutMs)!==null&&o!==void 0?o:gq,this.sweepTimeoutMs!==void 0&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new ve("inactive timeout should not be greated than the sweep timeout");if(this.testMode=(a=this.mc.config.getBoolean(uq))!==null&&a!==void 0?a:this.gcOptions.runGCInTestMode===!0,this._writeDataAtRoot=(c=this.mc.config.getBoolean(hq))!==null&&c!==void 0?c:!0,this._writeDataAtRoot){let m=l?.trees[fn]!==void 0;this.initialStateNeedsReset=m!==this.shouldRunGC}let f=new At(()=>y(this,null,function*(){var m;if(l===void 0)return;let b=l.trees[fn];if(b!==void 0){this._writeDataAtRoot=!0;let _=yield a4(b,h);return this.trackGCState&&(this.latestSerializedSummaryState=JSON.stringify(dg(_))),_}let v={gcNodes:{"/":{outboundRoutes:[]}}},x=Zu(l,d);C(x!==void 0,680);for(let[_,A]of Object.entries(x.trees)){let D=A.blobs[c4.gcBlobKey];if(D===void 0)continue;let O=yield h(D);if(((m=O.gcData)===null||m===void 0?void 0:m.gcNodes)===void 0)continue;let M=`/${_}`;(yield h(A.blobs[On])).isRootDataStore&&v.gcNodes["/"].outboundRoutes.push(M);for(let[E,w]of Object.entries(O.gcData.gcNodes)){let T=E==="/"?M:`${M}${E}`;v.gcNodes[T]={outboundRoutes:Array.from(w)}}C(v.gcNodes[M]!==void 0,681),v.gcNodes[M].unreferencedTimestampMs=O.unrefTimestamp}return Object.keys(v.gcNodes).length===1?void 0:v}));this.initializeBaseStateP=new At(()=>y(this,null,function*(){let m=this.runtime.getCurrentReferenceTimestampMs(),b=yield f;if(b===void 0)return;let v={};for(let[x,_]of Object.entries(b.gcNodes))_.unreferencedTimestampMs!==void 0&&this.unreferencedNodesState.set(x,new Xu(_.unreferencedTimestampMs,this.inactiveTimeoutMs,this.sweepTimeoutMs,m)),v[x]=Array.from(_.outboundRoutes);this.previousGCDataFromLastRun={gcNodes:v}})),this.baseGCDetailsP=new At(()=>y(this,null,function*(){let m=yield f;if(m===void 0)return new Map;let b={};for(let[_,A]of Object.entries(m.gcNodes))b[_]=Array.from(A.outboundRoutes);let v=Eu(b,["/"]).referencedNodeIds,x=_u({gcData:{gcNodes:b},usedRoutes:v});for(let[_,A]of Object.entries(m.gcNodes))if(A.unreferencedTimestampMs!==void 0){let D=x.get(_.slice(1));D!==void 0&&(D.unrefTimestamp=A.unreferencedTimestampMs)}return x}));let g=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:e.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:g}),this.shouldRunGC&&this.initializeBaseStateP.catch(m=>{let b=gt.wrapIfUnrecognized(m,"FailedToInitializeGC");throw b.addTelemetryProperties({gcConfigs:g}),b})}static create(e){return new r(e)}get summaryStateNeedsReset(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}get writeDataAtRoot(){return this._writeDataAtRoot}collectGarbage(e){return y(this,null,function*(){let{fullGC:t=this.gcOptions.runFullGC===!0||this.summaryStateNeedsReset}=e,n=e.logger?ue.create(e.logger,void 0,{all:{completedGCRuns:()=>this.completedRuns}}):this.mc.logger;return ce.timedExecAsync(n,{eventName:"GarbageCollection"},i=>y(this,null,function*(){yield this.runPreGCSteps();let s=yield this.runtime.getGCData(t),o=Eu(s.gcNodes,["/"]),a=yield this.runPostGCSteps(s,o,n);return i.end(Object.assign({},a)),this.completedRuns++,a}),{end:!0,cancel:"error"})})}runPreGCSteps(){return y(this,null,function*(){yield this.initializeBaseStateP,yield this.runtime.updateStateBeforeGC()})}runPostGCSteps(e,t,n){return y(this,null,function*(){let i=this.generateStats(t);this.updateStateSinceLastRun(e,n);let s=this.runtime.getCurrentReferenceTimestampMs();return this.updateCurrentState(e,t,s),this.runtime.updateUsedRoutes(t.referencedNodeIds,s),this.logSweepEvents(n,s),this.testMode&&this.runtime.deleteUnusedRoutes(t.deletedNodeIds),yield this.logUnreferencedEvents(n),i})}summarize(e,t,n){var i;if(!this.shouldRunGC||this.previousGCDataFromLastRun===void 0)return;let s={gcNodes:{}};for(let[c,l]of Object.entries(this.previousGCDataFromLastRun.gcNodes))s.gcNodes[c]={outboundRoutes:l,unreferencedTimestampMs:(i=this.unreferencedNodesState.get(c))===null||i===void 0?void 0:i.unreferencedTimestampMs};let o=JSON.stringify(dg(s));if(this.trackGCState&&(this.pendingSerializedSummaryState=o,this.latestSerializedSummaryState!==void 0&&this.latestSerializedSummaryState===o&&!e&&t)){let c=Gr();return c.handleNodeCount++,{summary:{type:dn.Handle,handle:`/${fn}`,handleType:dn.Tree},stats:c}}let a=new mt;return a.addBlob(`${l4}_root`,o),a.getSummaryTree()}getMetadata(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}getBaseGCDetails(){return y(this,null,function*(){return this.baseGCDetailsP})}latestSummaryStateRefreshed(e,t){return y(this,null,function*(){if(!this.shouldRunGC||!e.latestSummaryUpdated)return;if(e.wasSummaryTracked){this.latestSummaryGCVersion=this.currentGCVersion,this.initialStateNeedsReset=!1,this.trackGCState&&(this.latestSerializedSummaryState=this.pendingSerializedSummaryState,this.pendingSerializedSummaryState=void 0);return}let n=e.snapshot,i=n.blobs[cc];if(i){let o=yield t(i);this.latestSummaryGCVersion=fg(o)}let s=n.trees[fn];if(s!==void 0&&this.trackGCState){let o=yield a4(s,t);this.latestSerializedSummaryState=JSON.stringify(dg(o))}else this.latestSerializedSummaryState=void 0;this.pendingSerializedSummaryState=void 0})}nodeUpdated(e,t,n,i,s){if(!this.shouldRunGC)return;let o=this.unreferencedNodesState.get(e);o&&o.state!==Ar.Active&&this.inactiveNodeUsed(t,e,o,void 0,i,n,s)}addedOutboundReference(e,t){var n;if(!this.shouldRunGC)return;let i=(n=this.newReferencesSinceLastRun.get(e))!==null&&n!==void 0?n:[];i.push(t),this.newReferencesSinceLastRun.set(e,i);let s=this.unreferencedNodesState.get(t);s&&s.state!==Ar.Active&&this.inactiveNodeUsed("Revived",t,s,e)}dispose(){this.sessionExpiryTimer!==void 0&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}updateCurrentState(e,t,n){this.previousGCDataFromLastRun=Qi(e),this.newReferencesSinceLastRun.clear();for(let i of t.referencedNodeIds){let s=this.unreferencedNodesState.get(i);s!==void 0&&(s.stopTracking(),this.unreferencedNodesState.delete(i))}if(n!==void 0)for(let i of t.deletedNodeIds){let s=this.unreferencedNodesState.get(i);s===void 0?this.unreferencedNodesState.set(i,new Xu(n,this.inactiveTimeoutMs,this.sweepTimeoutMs,n)):s.updateTracking(n)}}updateStateSinceLastRun(e,t){if(this.previousGCDataFromLastRun===void 0)return;let n=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&n.length>0&&n.forEach(o=>{let a={eventName:"gcUnknownOutboundReferences",gcNodeId:o[0],gcRoutes:JSON.stringify(o[1])};t.sendPerformanceEvent(a)}),this.newReferencesSinceLastRun.size===0)return;let i=R_(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach((o,a)=>{i.gcNodes[a]===void 0?i.gcNodes[a]=o:i.gcNodes[a].push(...o)});let s=Eu(i.gcNodes,["/"]);for(let o of s.referencedNodeIds){let a=this.unreferencedNodesState.get(o);a!==void 0&&(a.stopTracking(),this.unreferencedNodesState.delete(o))}}findMissingExplicitReferences(e,t,n){C(t!==void 0,695);let i=Object.entries(e.gcNodes),s=[];return i.forEach(([o,a])=>{var c,l;let d=(c=t.gcNodes[o])!==null&&c!==void 0?c:[],h=(l=n.get(o))!==null&&l!==void 0?l:[],u=[];a.forEach(f=>{let g=this.runtime.getNodeType(f)===zt.Blob||this.runtime.getNodeType(f)===zt.DataStore,m=!o.startsWith(f);g&&m&&!d.includes(f)&&!h.includes(f)&&u.push(f)}),u.length>0&&s.push([o,u])}),s}generateStats(e){let t={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},n=(i,s)=>{t.nodeCount++;let o=this.previousGCDataFromLastRun===void 0||this.unreferencedNodesState.has(i)===s;o&&t.updatedNodeCount++,s||t.unrefNodeCount++,this.runtime.getNodeType(i)===zt.DataStore&&(t.dataStoreCount++,o&&t.updatedDataStoreCount++,s||t.unrefDataStoreCount++),this.runtime.getNodeType(i)===zt.Blob&&(t.attachmentBlobCount++,o&&t.updatedAttachmentBlobCount++,s||t.unrefAttachmentBlobCount++)};for(let i of e.referencedNodeIds)n(i,!0);for(let i of e.deletedNodeIds)n(i,!1);return t}logSweepEvents(e,t){this.mc.config.getBoolean(mq)===!0||t===void 0||this.sweepTimeoutMs===void 0||this.unreferencedNodesState.forEach((n,i)=>{if(n.state!==Ar.SweepReady)return;let s=this.runtime.getNodeType(i);if(s!==zt.DataStore&&s!==zt.Blob)return;let o=`Deleted-${i}`;this.loggedUnreferencedEvents.has(o)||(this.loggedUnreferencedEvents.add(o),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:i,type:s,age:t-n.unreferencedTimestampMs,timeout:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs()}))})}inactiveNodeUsed(e,t,n,i,s,o=this.runtime.getCurrentReferenceTimestampMs(),a){if(o===void 0||n.state===Ar.Active||!this.isSummarizerClient&&e!=="Loaded")return;let c=this.runtime.getNodeType(t);if(c!==zt.DataStore&&c!==zt.Blob)return;let l=n.state,d=`${l}-${t}-${e}`;if(this.loggedUnreferencedEvents.has(d))return;this.loggedUnreferencedEvents.add(d);let h={id:t,type:c,unrefTime:n.unreferencedTimestampMs,age:o-n.unreferencedTimestampMs,timeout:n.state===Ar.Inactive?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:a?.[pn.externalRequest],viaHandle:a?.[pn.viaHandle],fromId:i};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},h),{usageType:e,state:l})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},h),{eventName:`${l}Object_${e}`,pkg:s?{value:s.join("/"),tag:Ne.CodeArtifact}:void 0}))}logUnreferencedEvents(e){return y(this,null,function*(){for(let t of this.pendingEventsQueue){let{usageType:n,state:i}=t,s=oq(t,["usageType","state"]),o=this.unreferencedNodesState.get(t.id),a=o===void 0||o.state===Ar.Active;if(n==="Revived"===a){let c=yield this.getNodePackagePath(t.id),l=t.fromId?yield this.getNodePackagePath(t.fromId):void 0;e.sendErrorEvent(Object.assign(Object.assign({},s),{eventName:`${i}Object_${n}`,pkg:c?{value:c.join("/"),tag:Ne.CodeArtifact}:void 0,fromPkg:l?{value:l.join("/"),tag:Ne.CodeArtifact}:void 0}))}}this.pendingEventsQueue=[]})}};function a4(r,e){return y(this,null,function*(){let t={gcNodes:{}};for(let n of Object.keys(r.blobs)){if(!n.startsWith(l4))continue;let i=r.blobs[n];if(i===void 0)continue;let s=yield e(i);C(s!==void 0,685),t=N_(t,s)}return t})}function dg(r){let e=Object.entries(r.gcNodes);e.sort(([n],[i])=>n.localeCompare(i));let t={gcNodes:{}};for(let[n,i]of e)i.outboundRoutes.sort(),t.gcNodes[n]=i;return t}function Qu(r,e,t){let i;if(r>2147483647){let s=r-2147483647;i=setTimeout(()=>Qu(s,e,t),2147483647)}else i=setTimeout(()=>e(),r);t(i)}function mg(r){return r.summaryFormatVersion?r.summaryFormatVersion:r.snapshotFormatVersion==="0.1"?1:0}function gg(r){return!!r.summaryFormatVersion&&!r.disableIsolatedChannels}var h4=r=>r===void 0?void 0:{clientId:r.clientId,clientSequenceNumber:r.clientSequenceNumber,minimumSequenceNumber:r.minimumSequenceNumber,referenceSequenceNumber:r.referenceSequenceNumber,sequenceNumber:r.sequenceNumber,timestamp:r.timestamp,type:r.type};var vg=".aliases",cc=".metadata",yg=".chunks",bg=".electedSummarizer",eh=".blobs";function d4(r){return!!r&&!r.disableIsolatedChannels}function fg(r){var e;return r&&(e=r.gcFeature)!==null&&e!==void 0?e:0}var yq=".protocol",f4=[yq,".logTail",".serviceProtocol",eh,fn],On=".component";function yo(r){r.summary={type:dn.Tree,tree:{[u4.channelsTreeName]:r.summary}},r.stats.treeNodeCount++}function p4(r,e){return y(this,null,function*(){let t=yield We(r,e.blobs[On]),n=mg(t);return C(n>0,469),t})}function xg(r,e,t){let n=JSON.stringify(r);return t?{pkg:n,snapshotFormatVersion:"0.1",isRootDataStore:e}:{pkg:n,summaryFormatVersion:2,isRootDataStore:e}}function m4(r,e,t){let n=xg(r,e,t);return new zs(On,JSON.stringify(n))}var g4=(()=>{class r extends be{constructor(t,n,i,s,o){super(),this.existing=n,this.bindState=i,this.isLocalDataStore=s,this.makeLocallyVisibleFn=o,this._disposed=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pending=[],this._isInMemoryRoot=!1,this._containerRuntime=t.runtime,this.id=t.id,this.storage=t.storage,this.scope=t.scope,this.writeGCDataAtRoot=t.writeGCDataAtRoot,this.disableIsolatedChannels=t.disableIsolatedChannels,this.pkg=t.pkg,C(!this.id.includes("/"),314),this._attachState=this.containerRuntime.attachState!==se.Detached&&this.existing?this.containerRuntime.attachState:se.Detached,this.bindToContext=()=>{C(this.bindState===nr.NotBound,315),this.bindState=nr.Binding,C(this.channel!==void 0,316),this.makeLocallyVisible(),this.bindState=nr.Bound};let a=(c,l,d)=>y(this,null,function*(){return this.summarizeInternal(c,l,d)});this.summarizerNode=t.createSummarizerNodeFn(a,c=>y(this,null,function*(){return this.getGCDataInternal(c)}),()=>y(this,null,function*(){return this.getBaseGCDetails()})),this.subLogger=ue.create(this.logger,"FluidDataStoreContext"),this.thresholdOpsCounter=new Vi(r.pendingOpsCountThreshold,this.subLogger)}get packagePath(){return C(this.pkg!==void 0,313),this.pkg}get options(){return this._containerRuntime.options}get clientId(){return this._containerRuntime.clientId}get clientDetails(){return this._containerRuntime.clientDetails}get logger(){return this._containerRuntime.logger}get deltaManager(){return this._containerRuntime.deltaManager}get connected(){return this._containerRuntime.connected}get IFluidHandleContext(){return this._containerRuntime.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get disposed(){return this._disposed}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}isRoot(){return y(this,null,function*(){return this.isInMemoryRoot()||(yield this.getInitialSnapshotDetails()).isRootDataStore})}isInMemoryRoot(){return this._isInMemoryRoot}dispose(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then(t=>{t.dispose()}).catch(t=>{}))}rejectDeferredRealize(t,n){throw new Re(t,{packageName:{value:n,tag:Ne.PackageData}})}realize(){return y(this,null,function*(){return C(!this.detachedRuntimeCreation,317),this.channelDeferred||(this.channelDeferred=new Ee,this.realizeCore(this.existing).catch(t=>{var n;let i=gt.wrapIfUnrecognized(t,"realizeFluidDataStoreContext");i.addTelemetryProperties({fluidDataStoreId:{value:this.id,tag:"PackageData"}}),(n=this.channelDeferred)===null||n===void 0||n.reject(i),this.logger.sendErrorEvent({eventName:"RealizeError"},i)})),this.channelDeferred.promise})}factoryFromPackagePath(t){return y(this,null,function*(){C(this.pkg===t,318),t===void 0&&this.rejectDeferredRealize("packages is undefined");let n,i=this._containerRuntime.IFluidDataStoreRegistry,s;for(let a of t)i||this.rejectDeferredRealize("No registry for package",s),s=a,n=yield i.get(a),n||this.rejectDeferredRealize("Registry does not contain entry for the package",a),i=n.IFluidDataStoreRegistry;let o=n?.IFluidDataStoreFactory;return o===void 0&&this.rejectDeferredRealize("Can't find factory for package",s),{factory:o,registry:i}})}realizeCore(t){return y(this,null,function*(){let n=yield this.getInitialSnapshotDetails();this._baseSnapshot=n.snapshot;let i=n.pkg,{factory:s,registry:o}=yield this.factoryFromPackagePath(i);C(this.registry===void 0,319),this.registry=o;let a=yield s.instantiateDataStore(this,t);C(a!==void 0,320),this.bindRuntime(a)})}setConnectionState(t,n){this.verifyNotClosed(),this.loaded&&(C(this.connected===t,321),this.channel.setConnectionState(t,n))}process(t,n,i){var s;this.verifyNotClosed();let o=t.contents,a=Object.assign(Object.assign({},t),{type:o.type,contents:o.content});if(this.summarizerNode.recordChange(a),this.loaded)return(s=this.channel)===null||s===void 0?void 0:s.process(a,n,i);C(!n,322),C(this.pending!==void 0,573),this.pending.push(a),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}processSignal(t,n){var i;this.verifyNotClosed(),this.loaded&&((i=this.channel)===null||i===void 0||i.processSignal(t,n))}getQuorum(){return this._containerRuntime.getQuorum()}getAudience(){return this._containerRuntime.getAudience()}summarize(t=!1,n=!0,i){return y(this,null,function*(){return this.summarizerNode.summarize(t,n,i)})}summarizeInternal(t,n,i){return y(this,null,function*(){yield this.realize();let s=yield this.channel.summarize(t,n,i),o;this.disableIsolatedChannels||(yo(s),o=[bo.channelsTreeName]);let{pkg:a}=yield this.getInitialSnapshotDetails(),c=yield this.isRoot(),l=xg(a,c,this.disableIsolatedChannels);return dr(s,On,JSON.stringify(l)),this.writeGCDataAtRoot||dr(s,bo.gcBlobKey,JSON.stringify(this.summarizerNode.getGCSummaryDetails())),this.summarizerNode.isReferenced()||(s.summary.unreferenced=!0,s.stats.unreferencedBlobSize=s.stats.totalBlobSize),Object.assign(Object.assign({},s),{id:this.id,pathPartsForChildren:o})})}getGCData(t=!1){return y(this,null,function*(){return this.summarizerNode.getGCData(t)})}getGCDataInternal(t=!1){return y(this,null,function*(){return yield this.realize(),C(this.channel!==void 0,323),this.channel.getGCData(t)})}updateUsedRoutes(t,n){this.summarizerNode.updateUsedRoutes(t,n),this.lastUsedState={usedRoutes:t,gcTimestamp:n},this.loaded&&this.updateChannelUsedRoutes()}addedGCOutboundReference(t,n){this._containerRuntime.addedGCOutboundReference(t,n)}updateChannelUsedRoutes(){if(C(this.loaded,324),C(this.channel!==void 0,325),this.lastUsedState===void 0)return;let t=this.lastUsedState.usedRoutes.filter(n=>n!=="/"&&n!=="");this.channel.updateUsedRoutes(t,this.lastUsedState.gcTimestamp)}request(t){return y(this,null,function*(){return(yield this.realize()).request(t)})}submitMessage(t,n,i){this.verifyNotClosed(),C(!!this.channel,326);let s={content:n,type:t};this._containerRuntime.submitDataStoreOp(this.id,s,i)}setChannelDirty(t){this.verifyNotClosed();let n=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(n);let i=this.summarizerNode.getChild(t);i&&i.invalidate(n)}submitSignal(t,n){return this.verifyNotClosed(),C(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,t,n)}makeLocallyVisible(){C(this.channel!==void 0,719),this.makeLocallyVisibleFn()}bindRuntime(t){var n;if(this.channel)throw new Error("Runtime already bound");try{C(!this.detachedRuntimeCreation,328),C(this.channelDeferred!==void 0,329),C(this.pkg!==void 0,330);let i=this.pending;for(let s of i)t.process(s,!1,void 0);this.thresholdOpsCounter.send("ProcessPendingOps",i.length),this.pending=void 0,this.loaded=!0,this.channel=t,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(i){(n=this.channelDeferred)===null||n===void 0||n.reject(i),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},i)}}getAbsoluteUrl(t){return y(this,null,function*(){if(this.attachState===se.Attached)return this._containerRuntime.getAbsoluteUrl(t)})}setInMemoryRoot(){this._isInMemoryRoot=!0}reSubmit(t,n){C(!!this.channel,331);let i=t;this.channel.reSubmit(i.type,i.content,n)}rollback(t,n){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");let i=t;this.channel.rollback(i.type,i.content,n)}applyStashedOp(t){return y(this,null,function*(){this.channel||(yield this.realize()),C(!!this.channel,332);let n=t;return this.channel.applyStashedOp(n.content)})}verifyNotClosed(){if(this._disposed)throw new Error("Context is closed")}getCreateChildSummarizerNodeFn(t,n){return(i,s,o)=>this.summarizerNode.createChild(i,t,n,{throwOnFailure:!0},s,o)}uploadBlob(t){return y(this,null,function*(){return this.containerRuntime.uploadBlob(t)})}}return r.pendingOpsCountThreshold=1e3,r})(),lc=class extends g4{constructor(e){super(e,!0,nr.Bound,!1,()=>{throw new Error("Already attached")}),this.initialSnapshotDetailsP=new At(()=>y(this,null,function*(){var t,n;let i,s=!0;if(typeof this.initSnapshotValue=="string"){let a=(yield this.storage.getVersions(this.initSnapshotValue,1))[0];i=(t=yield this.storage.getSnapshotTree(a))!==null&&t!==void 0?t:void 0}else i=this.initSnapshotValue;let o=a=>y(this,null,function*(){return We(this.storage,a)});if(i){let a=yield this.summarizerNode.loadBaseSummary(i,o);i=a.baseSummary,this.pending=a.outstandingOps.concat(this.pending)}if(i&&i.blobs[On]!==void 0){let a=yield o(i.blobs[On]),c;mg(a)<1?a.pkg.startsWith('["')&&a.pkg.endsWith('"]')?c=JSON.parse(a.pkg):c=[a.pkg]:c=JSON.parse(a.pkg),this.pkg=c,s=(n=a.isRootDataStore)!==null&&n!==void 0?n:!0,gg(a)&&(i=i.trees[bo.channelsTreeName],C(i!==void 0,510))}return{pkg:this.pkg,isRootDataStore:s,snapshot:i}})),this.initSnapshotValue=e.snapshotTree,this.baseGCDetailsP=new At(()=>y(this,null,function*(){var t;return(t=yield e.getBaseGCDetails())!==null&&t!==void 0?t:{}}))}getInitialSnapshotDetails(){return y(this,null,function*(){return this.initialSnapshotDetailsP})}getInitialGCSummaryDetails(){return y(this,null,function*(){return this.getBaseGCDetails()})}getBaseGCDetails(){return y(this,null,function*(){return this.baseGCDetailsP})}generateAttachMessage(){throw new Error("Cannot attach remote store")}},th=class extends g4{constructor(e){super(e,e.snapshotTree!==void 0,e.snapshotTree?nr.Bound:nr.NotBound,!0,e.makeLocallyVisibleFn),this.snapshotTree=e.snapshotTree,e.isRootDataStore===!0&&this.setInMemoryRoot(),this.createProps=e.createProps,this.attachListeners()}attachListeners(){this.once("attaching",()=>{C(this.attachState===se.Detached,333),this._attachState=se.Attaching}),this.once("attached",()=>{C(this.attachState===se.Attaching,334),this._attachState=se.Attached})}generateAttachMessage(){C(this.channel!==void 0,335),C(this.pkg!==void 0,336);let e=this.channel.getAttachSummary();this.disableIsolatedChannels||yo(e);let t=xg(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);dr(e,On,JSON.stringify(t));let n=fo(e.summary);return{id:this.id,snapshot:n,type:this.pkg[this.pkg.length-1]}}getInitialSnapshotDetails(){return y(this,null,function*(){var e;let t=this.snapshotTree,n,i=!1;return t!==void 0&&(n=yield p4(this.storage,t),gg(n)&&(t=t.trees[bo.channelsTreeName],C(t!==void 0,511)),this.pkg===void 0&&(this.pkg=JSON.parse(n.pkg),(!((e=n.isRootDataStore)!==null&&e!==void 0)||e)&&(i=!0,this.setInMemoryRoot()))),C(this.pkg!==void 0,338),{pkg:this.pkg,isRootDataStore:i,snapshot:t}})}getInitialGCSummaryDetails(){return y(this,null,function*(){return{}})}getBaseGCDetails(){return y(this,null,function*(){return{}})}},uc=class extends th{constructor(e){super(e)}},rh=class r extends th{constructor(e){super(e),this.detachedRuntimeCreation=!0}attachRuntime(e,t){return y(this,null,function*(){C(this.detachedRuntimeCreation,340),C(this.channelDeferred===void 0,341);let n=e.IFluidDataStoreFactory,i=yield this.factoryFromPackagePath(this.pkg);C(i.factory===n,342),C(this.registry===void 0,343),this.registry=i.registry,this.detachedRuntimeCreation=!1,this.channelDeferred=new Ee,qr(r.prototype,this,"bindRuntime").call(this,t),(yield this.isRoot())&&(t.makeVisibleAndAttachGraph!==void 0?t.makeVisibleAndAttachGraph():t.bindToContext())})}getInitialSnapshotDetails(){return y(this,null,function*(){if(this.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return qr(r.prototype,this,"getInitialSnapshotDetails").call(this)})}};te();Pt();xe();var nh=r=>typeof r?.internalId=="string"&&typeof r?.alias=="string",ih=(r,e,t,n,i)=>new Sg(r,e,t,n,i),Nn=function(r){return r.Aliased="Aliased",r.Aliasing="Aliasing",r.None="None",r}(Nn||{}),Sg=class{constructor(e,t,n,i,s){this.fluidDataStoreChannel=e,this.internalId=t,this.runtime=n,this.datastores=i,this.logger=s,this.aliasState=Nn.None}trySetAlias(e){return y(this,null,function*(){if(e.includes("/"))throw new ve(`The alias cannot contain slashes: '${e}'`);switch(this.aliasState){case Nn.Aliasing:return C(this.aliasResult!==void 0,790),yield this.aliasResult,this.alias===e?"Success":"AlreadyAliased";case Nn.Aliased:return this.alias===e?"Success":"AlreadyAliased";case Nn.None:break;default:ot(this.aliasState)}return this.aliasState=Nn.Aliasing,this.aliasResult=this.trySetAliasInternal(e),this.aliasResult})}trySetAliasInternal(e){return y(this,null,function*(){let t={internalId:this.internalId,alias:e};if(this.fluidDataStoreChannel.makeVisibleAndAttachGraph!==void 0?this.fluidDataStoreChannel.makeVisibleAndAttachGraph():this.fluidDataStoreChannel.bindToContext(),this.runtime.attachState===se.Detached){let i=this.datastores.processAliasMessageCore(t);return this.aliasState=Nn.Aliased,i?"Success":"Conflict"}return(yield this.ackBasedPromise(i=>{this.runtime.submitDataStoreAliasOp(t,i)}).then(i=>(this.aliasState=Nn.Aliased,i&&(this.alias=e),i)).catch(i=>(this.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:e,tag:Ne.UserData},internalId:{value:this.internalId,tag:Ne.PackageData}},i),this.aliasState=Nn.None,!1)))?"Success":"Conflict"})}request(e){return y(this,null,function*(){return this.fluidDataStoreChannel.request(e)})}get IFluidRouter(){return this.fluidDataStoreChannel}ackBasedPromise(e){return y(this,null,function*(){let t;return new Promise((n,i)=>{if(t=()=>i(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(n,i)}).finally(()=>{this.runtime.off("dispose",t)})})}};var sh=class{constructor(e,t,n,i,s,o,a,c,l,d,h=new Ju(o)){this.baseSnapshot=e,this.runtime=t,this.submitAttachFn=n,this.getCreateChildSummarizerNodeFn=i,this.deleteChildSummarizerNodeFn=s,this.gcNodeUpdated=c,this.aliasMap=l,this.writeGCDataAtRoot=d,this.contexts=h,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new lr(()=>this.contexts.dispose()),this.dataStoresSinceLastGC=[],this.dispose=()=>this.disposeOnce.value,this.logger=ue.create(o),this.containerRuntimeHandle=new kr(this.runtime,"/",this.runtime.IFluidHandleContext);let u=new At(()=>y(this,null,function*(){return a()})),f=b=>y(this,null,function*(){return(yield u).get(b)}),g=new Map;if(e)for(let[b,v]of Object.entries(e.trees))g.set(b,v);let m=0;for(let[b,v]of g){let x;if(v.unreferenced&&m++,this.runtime.attachState!==se.Detached)x=new lc({id:b,snapshotTree:v,getBaseGCDetails:()=>y(this,null,function*(){return f(b)}),runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(b,{type:xi.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});else{if(typeof v!="object")throw new Re("Snapshot should be there to load from!!");let _=v;x=new uc({id:b,pkg:void 0,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(b,{type:xi.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(b),snapshotTree:_,isRootDataStore:void 0,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels})}this.contexts.addBoundOrRemoted(x)}this.containerLoadStats={containerLoadDataStoreCount:g.size,referencedDataStoreCount:g.size-m}}aliases(){return this.aliasMap}processAttachMessage(e,t){var n,i;let s=e.contents;if(this.dataStoresSinceLastGC.push(s.id),t){C(this.pendingAttach.has(s.id),350),(n=this.contexts.get(s.id))===null||n===void 0||n.emit("attached"),this.pendingAttach.delete(s.id);return}if(this.alreadyProcessed(s.id))throw new qt("Duplicate DataStore created with existing id",Object.assign(Object.assign({},Wr(e)),{dataStoreId:{value:s.id,tag:Ne.PackageData}}));let o=new Map,a;s.snapshot&&(a=zl(s.snapshot.entries,o));let c=[s.type],l=new lc({id:s.id,snapshotTree:a,getBaseGCDetails:()=>y(this,null,function*(){return{}}),runtime:this.runtime,storage:new yl(this.runtime.storage,o),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(s.id,{type:xi.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:(i=s.snapshot)!==null&&i!==void 0?i:{entries:[m4(c,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:c});this.contexts.addBoundOrRemoted(l)}processAliasMessage(e,t,n){let i=e.contents;if(!nh(i))throw new qt("malformedDataStoreAliasMessage",Object.assign({},Wr(e)));let s=t,o=this.processAliasMessageCore(i);n&&s(o)}processAliasMessageCore(e){if(this.alreadyProcessed(e.alias))return!1;let t=this.contexts.get(e.internalId);if(t===void 0)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;let n=new kr(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,n),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}alreadyProcessed(e){return this.aliasMap.get(e)!==void 0||this.contexts.get(e)!==void 0}makeDataStoreLocallyVisible(e){let t=this.contexts.getUnbound(e);if(C(!!t,351),this.runtime.attachState!==se.Detached){t.emit("attaching");let n=t.generateAttachMessage();this.pendingAttach.set(e,n),this.submitAttachFn(n),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}createDetachedDataStoreCore(e,t,n=Te()){C(!n.includes("/"),780);let i=new rh({id:n,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(n,{type:xi.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(n),snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(i),i}_createFluidDataStoreContext(e,t,n,i){C(!t.includes("/"),781);let s=new uc({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:xi.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(t),snapshotTree:void 0,isRootDataStore:n,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:i});return this.contexts.addUnbound(s),s}get disposed(){return this.disposeOnce.evaluated}resubmitDataStoreOp(e,t){let n=e,i=this.contexts.get(n.address);C(!!i,352),i.reSubmit(n.contents,t)}rollbackDataStoreOp(e,t){let n=e,i=this.contexts.get(n.address);C(!!i,744),i.rollback(n.contents,t)}applyStashedOp(e){return y(this,null,function*(){let t=e,n=this.contexts.get(t.address);return C(!!n,353),n.applyStashedOp(t.contents)})}applyStashedAttachOp(e){return y(this,null,function*(){this.pendingAttach.set(e.id,e),this.processAttachMessage({contents:e},!1)})}processFluidDataStoreOp(e,t,n){let i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);C(!!o,354),o.process(s,t,n),this.gcNodeUpdated(`/${i.address}`,e.timestamp,o.isLoaded?o.packagePath:void 0)}getDataStore(e,t){return y(this,null,function*(){let n=yield this.contexts.getBoundOrRemoted(e,t);if(n===void 0){let i={url:e};throw gi(Et(i),i)}return n})}processSignal(e,t,n){let i=this.contexts.get(e);if(!i){C(!n,355),this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:Ne.PackageData}});return}i.processSignal(t,n)}setConnectionState(e,t){for(let[n,i]of this.contexts)try{i.setConnectionState(e,t)}catch(s){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:n},s)}}setAttachState(e){let t;e===se.Attaching?t="attaching":t="attached";for(let[,n]of this.contexts)this.contexts.isNotBound(n.id)||n.emit(t)}get size(){return this.contexts.size}summarize(e,t,n){return y(this,null,function*(){let i=new mt;return yield Promise.all(Array.from(this.contexts).filter(([s,o])=>(C(o.attachState!==se.Attaching,357),o.attachState===se.Attached)).map(a=>y(this,[a],function*([s,o]){let c=yield o.summarize(e,t,n);i.addWithStats(s,c)}))),i.getSummaryTree()})}createSummary(e){let t=new mt,n;do{let i=t.summary.tree;n=this.contexts.notBoundLength(),Array.from(this.contexts).filter(([s,o])=>!(this.contexts.isNotBound(s)||i[s]||this.attachOpFiredForDataStore.has(s))).map(([s,o])=>{let a;if(o.isLoaded){let c=o.generateAttachMessage().snapshot;a=uo(c,!0)}else C(!!this.baseSnapshot,358),a=ho(this.baseSnapshot.trees[s]);t.addWithStats(s,a)})}while(n!==this.contexts.notBoundLength());return t.getSummaryTree()}updateStateBeforeGC(){return y(this,null,function*(){for(let e of this.dataStoresSinceLastGC){let t=this.contexts.get(e);if(C(t!==void 0,694),yield t.isRoot()){let n=new kr(t,e,this.runtime.IFluidHandleContext);this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,n)}}this.dataStoresSinceLastGC=[]})}getGCData(e=!1){return y(this,null,function*(){let t=new vi;return yield Promise.all(Array.from(this.contexts).filter(([n,i])=>i.attachState===se.Attached).map(s=>y(this,[s],function*([n,i]){let o=yield i.getGCData(e);t.prefixAndAddNodes(n,o.gcNodes)}))),t.addNode("/",yield this.getOutboundRoutes()),t.getGCData()})}updateUsedRoutes(e,t){var n;let i=Tu(e);for(let[s]of i)C(this.contexts.has(s),359);for(let[s,o]of this.contexts)o.updateUsedRoutes((n=i.get(s))!==null&&n!==void 0?n:[],t)}deleteUnusedRoutes(e){for(let t of e){let n=t.split("/");if(n.length>2)continue;let i=n[1];C(this.contexts.has(i),727),this.contexts.delete(i),this.deleteChildSummarizerNodeFn(i)}}getOutboundRoutes(){return y(this,null,function*(){let e=[];for(let[t,n]of this.contexts)(yield n.isRoot())&&e.push(`/${t}`);return e})}getDataStorePackagePath(e){return y(this,null,function*(){var t;let n=this.contexts.get(e.split("/")[1]);return(t=yield n?.getInitialSnapshotDetails())===null||t===void 0?void 0:t.pkg})}getGCNodeType(e){let t=e.split("/");if(this.contexts.has(t[1]))return t.length===2?zt.DataStore:zt.SubDataStore}};function Zu(r,e){if(r)if(d4(e)){let t=r.trees[xi.channelsTreeName];return C(!!t,360),t}else{let t={};for(let[n,i]of Object.entries(r.trees))f4.includes(n)||(t[n]=i);return Object.assign(Object.assign({},r),{trees:t})}}te();var Si=function(r){return r[r.Local=0]="Local",r[r.Broadcast=1]="Broadcast",r[r.Acked=2]="Acked",r[r.Nacked=-1]="Nacked",r}(Si||{}),oh=class r{constructor(e,t){this.clientId=e,this.clientSequenceNumber=t,this.state=Si.Local,this.defSummaryOp=new Ee,this.defSummaryAck=new Ee}static createLocal(e,t){return new r(e,t)}static createFromOp(e){let t=new r(e.clientId,e.clientSequenceNumber);return t.broadcast(e),t}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}hasBeenAcked(){return this.state===Si.Acked}broadcast(e){return C(this.state===Si.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=Si.Broadcast,!0}ackNack(e){return C(this.state===Si.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===tt.SummaryAck?Si.Acked:Si.Nacked,!0}waitBroadcast(){return y(this,null,function*(){return yield this.defSummaryOp.promise,this._summaryOp})}waitAckNack(){return y(this,null,function*(){return yield this.defSummaryAck.promise,this._summaryAckNack})}},wg=class{constructor(e,t){this.clientId=e,this.summaryCollection=t,this.localSummaries=new Map,this._disposed=!1}get disposed(){return this._disposed}watchSummary(e){let t=this.localSummaries.get(e);return t||(t=oh.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(e){return this.localSummaries.get(e)}setSummary(e){this.localSummaries.set(e.clientSequenceNumber,e)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}},ah=class extends be{constructor(e,t){super(),this.deltaManager=e,this.logger=t,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new Ee,this.deltaManager.on("op",n=>this.handleOp(n))}get latestAck(){return this.lastAck}emit(e,...t){return super.emit(e,...t)}get opsSinceLastAck(){var e,t;return this.deltaManager.lastSequenceNumber-((t=(e=this.lastAck)===null||e===void 0?void 0:e.summaryAck.sequenceNumber)!==null&&t!==void 0?t:this.deltaManager.initialSequenceNumber)}addOpListener(e){this.deltaManager.on("op",e)}removeOpListener(e){this.deltaManager.off("op",e)}createWatcher(e){let t=new wg(e,this);return this.summaryWatchers.set(e,t),t}removeWatcher(e){this.summaryWatchers.delete(e)}setPendingAckTimerTimeoutCallback(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}waitFlushed(){return y(this,null,function*(){for(;this.pendingSummaries.size>0;){let e=Array.from(this.pendingSummaries,([,t])=>t.waitAckNack());yield Promise.all(e)}return this.lastAck})}waitSummaryAck(e){return y(this,null,function*(){for(;!this.lastAck||this.lastAck.summaryOp.referenceSequenceNumber<e;)yield this.refreshWaitNextAck.promise;return this.lastAck})}handleOp(e){var t;switch(e.type){case tt.Summarize:{this.handleSummaryOp(e);return}case tt.SummaryAck:{this.handleSummaryAck(e);return}case tt.SummaryNack:{this.handleSummaryNack(e);return}default:{let n=e.timestamp;this.lastSummaryTimestamp!==void 0&&this.maxAckWaitTime!==void 0&&n-this.lastSummaryTimestamp>=this.maxAckWaitTime&&((t=this.pendingAckTimerTimeoutCallback)===null||t===void 0||t.call(this)),this.emit("default",e);return}}}handleSummaryOp(e){let t,n=this.summaryWatchers.get(e.clientId);n&&(t=n.tryGetSummary(e.clientSequenceNumber),t&&t.broadcast(e)),t||(t=oh.createFromOp(e),n&&n.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(tt.Summarize,e)}handleSummaryAck(e){let t=e.contents.summaryProposal.summarySequenceNumber,n=this.pendingSummaries.get(t);if(!n||n.summaryOp===void 0){t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber});return}n.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:n.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new Ee,this.emit(tt.SummaryAck,e))}handleSummaryNack(e){let t=e.contents.summaryProposal.summarySequenceNumber,n=this.pendingSummaries.get(t);n&&(n.ackNack(e),this.pendingSummaries.delete(t),this.emit(tt.SummaryNack,e))}};te();xe();var ch=class extends be{constructor(e,t,n){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=ue.create(e,"OrderedClientCollection");let i=n.getMembers();for(let[s,o]of i)this.addClient(s,o);n.on("addMember",(s,o)=>{let a=this.addClient(s,o);this.emit("addClient",a,t.lastSequenceNumber)}),n.on("removeMember",s=>{let o=t.lastSequenceNumber,a=this.removeClient(s);a===void 0?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:s,sequenceNumber:o}):this.emit("removeClient",a,o)})}get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}addClient(e,t){C(t.sequenceNumber>-1,502);let n=this._youngestClient;for(;n.sequenceNumber>t.sequenceNumber;)C(n.olderClient!==void 0,503),n=n.olderClient;let i={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:n,youngerClient:n.youngerClient};return i.olderClient.youngerClient=i,i.youngerClient===void 0?this._youngestClient=i:i.youngerClient.olderClient=i,this.clientMap.set(e,i),i}removeClient(e){let t=this.clientMap.get(e);if(t!==void 0)return t.olderClient.youngerClient=t.youngerClient,t.youngerClient===void 0?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}getAllClients(){let e=[],t=this.rootNode;for(;t.youngerClient!==void 0;)e.push(t.youngerClient),t=t.youngerClient;return e}},lh=class extends be{constructor(e,t,n,i){super(),this.orderedClientCollection=t,this.isEligibleFn=i,this._eligibleCount=0;let s,o;for(let a of t.getAllClients())this.addClient(a,0),typeof n!="number"&&(a.clientId===n.electedClientId&&(s=a,n.electedParentId===void 0&&a.client.details.type!==Lt&&(o=a)),a.clientId===n.electedParentId&&(o=a));t.on("addClient",(a,c)=>this.addClient(a,c)),t.on("removeClient",(a,c)=>this.removeClient(a,c)),typeof n=="number"?this._electionSequenceNumber=n:(s?.clientId!==n.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:n.electionSequenceNumber,expectedClientId:n.electedClientId,electedClientId:s?.clientId,clientCount:t.count}):s!==void 0&&!i(s)&&(s=o=this.findFirstEligibleParent(o),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:n.electionSequenceNumber,expectedClientId:n.electedClientId,electedClientId:s?.clientId})),this._electedParent=o,this._electedClient=s,this._electionSequenceNumber=n.electionSequenceNumber)}get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}tryElectingClient(e,t){let n=!1,i=e?.client.details.type===Lt,s=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,n=!0),this._electedParent!==e&&!i&&(this._electedParent=e,n=!0),n&&this.emit("election",e,t,s)}tryElectingParent(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}findFirstEligibleParent(e){let t=e;for(;t!==void 0&&(!this.isEligibleFn(t)||t.client.details.type===Lt);)t=t.youngerClient;return t}addClient(e,t){var n;if(this.isEligibleFn(e)){this._eligibleCount++;let i=e.client.details.type===Lt,s=((n=this._electedClient)===null||n===void 0?void 0:n.client.details.type)===Lt;this._electedClient===void 0||!s&&i?this.tryElectingClient(e,t):this._electedParent===void 0&&!i&&this.tryElectingParent(e,t)}}removeClient(e,t){var n,i,s,o,a;if(this.isEligibleFn(e)){if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==Lt)throw new ve("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{let c=(i=this.findFirstEligibleParent((n=this._electedParent)===null||n===void 0?void 0:n.youngerClient))!==null&&i!==void 0?i:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(c,t)}else if(this._electedParent===e){if(((s=this._electedClient)===null||s===void 0?void 0:s.client.details.type)!==Lt)throw new ve("Elected client should be a summarizer client 2");let c=(a=this.findFirstEligibleParent((o=this._electedParent)===null||o===void 0?void 0:o.youngerClient))!==null&&a!==void 0?a:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(c,t)}}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}incrementElectedClient(e){var t,n;let i=(n=this.findFirstEligibleParent((t=this._electedParent)===null||t===void 0?void 0:t.youngerClient))!==null&&n!==void 0?n:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(i,e):this.tryElectingParent(i,e)}resetElectedClient(e){let t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}peekNextElectedClient(){var e,t;return(t=this.findFirstEligibleParent((e=this._electedParent)===null||e===void 0?void 0:e.youngerClient))!==null&&t!==void 0?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:(e=this.electedClient)===null||e===void 0?void 0:e.clientId,electedParentId:(t=this.electedParent)===null||t===void 0?void 0:t.clientId}}};var uh=class{constructor(e,t,n){this.delayWindowMs=e,this.maxDelayMs=t,this.delayFn=n,this.startTimes=[]}get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}getDelay(){let e=Date.now(),t=this.latestAttemptTime;if(t!==void 0){let i=t-e;i>0&&(this.startTimes=this.startTimes.map(s=>s-i))}this.startTimes=this.startTimes.filter(i=>e-i<this.delayWindowMs);let n=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(e),this.startTimes=this.startTimes.map(i=>i+n),n===this.maxDelayMs&&this.startTimes.shift(),n}},v4=({multiplier:r=2,coefficient:e=1,offset:t=0,initialDelay:n=void 0}={})=>i=>Math.max(0,i<=0&&n!==void 0?n:e*Math.pow(r,i)+t);te();var lne={cancelled:!1,waitCancelled:new Promise(()=>{})},hh=class r{constructor(e){this.runtime=e,this._cancelled=!1,this.stopDeferred=new Ee}get cancelled(){return this._cancelled||C(this.runtime.deltaManager.active,605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static create(e){return y(this,null,function*(){let t=new r(e);return yield t.waitStart(),t})}waitStart(){return y(this,null,function*(){if(this.runtime.disposed){this.stop("summarizerClientDisconnected");return}if(this.runtime.once("dispose",()=>this.stop("summarizerClientDisconnected")),!this.runtime.connected){let e=new Promise(t=>this.runtime.once("connected",t));yield Promise.race([e,this.waitCancelled])}this.runtime.once("disconnected",()=>this.stop("summarizerClientDisconnected"))})}stop(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}};te();xe();var Cg=class{constructor(e,t,n,i,s=()=>le.now()){this.batchEventEmitter=e,this.trackedBatchCount=0,this.logger=ue.create(t,"Batching"),this.batchEventEmitter.on("batchBegin",o=>{this.startBatchSequenceNumber=o.sequenceNumber,this.batchProcessingStartTimeStamp=s(),this.trackedBatchCount++}),this.batchEventEmitter.on("batchEnd",(o,a)=>{C(this.startBatchSequenceNumber!==void 0&&this.batchProcessingStartTimeStamp!==void 0,698);let c=a.sequenceNumber-this.startBatchSequenceNumber+1;c>=n&&this.logger.sendErrorEvent({eventName:"LengthTooBig",length:c,threshold:n,batchEndSequenceNumber:a.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp,batchError:o!==void 0}),this.trackedBatchCount%i===0&&this.logger.sendPerformanceEvent({eventName:"Length",length:c,samplingRate:i,batchEndSequenceNumber:a.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0})}},y4=(r,e,t=1e3,n=1e3)=>new Cg(r,e,t,n);te();var xo=class{constructor(e,t){this.storageGetter=e,this.blobs=t}static serializeTree(e,t){return y(this,null,function*(){let n={};return yield this.serializeTreeCore(e,n,t),n})}static serializeTreeCore(e,t,n){return y(this,null,function*(){let i=[];for(let s of Object.values(e.trees))i.push(this.serializeTreeCore(s,t,n));for(let s of Object.values(e.blobs)){let o=yield n.readBlob(s);t[s]=Gn(o,"utf8")}return Promise.all(i)})}static serializeTreeWithBlobContents(e){let t={};return this.serializeTreeWithBlobContentsCore(e,t),t}static serializeTreeWithBlobContentsCore(e,t){for(let n of Object.values(e.trees))this.serializeTreeWithBlobContentsCore(n,t);for(let n of Object.values(e.blobs)){let i=e.blobsContents[n];C(!!i,748),t[n]=Gn(i,"utf8")}}get storage(){return this._storage?this._storage:(this._storage=this.storageGetter(),this._storage)}get repositoryUrl(){return this.storage.repositoryUrl}readBlob(e){return y(this,null,function*(){return this.blobs[e]!==void 0?Er(this.blobs[e],"utf8"):this.storage.readBlob(e)})}getSnapshotTree(e){return y(this,null,function*(){return this.storage.getSnapshotTree(e)})}getVersions(e,t){return y(this,null,function*(){return this.storage.getVersions(e,t)})}createBlob(e){return y(this,null,function*(){return this.storage.createBlob(e)})}uploadSummaryWithContext(e,t){return y(this,null,function*(){return this.storage.uploadSummaryWithContext(e,t)})}downloadSummary(e){return y(this,null,function*(){return this.storage.downloadSummary(e)})}};var dh=class r{constructor(e,t){this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,!t&&(e.inbound.on("push",n=>{var i;let s=typeof n.contents=="string"?n.contents:(i=JSON.stringify(n.contents))!==null&&i!==void 0?i:"",o=r.messageHasData(n)?n.data:"";this.messageSize[r.messageId(n)]=s.length+o.length}),e.on("op",n=>{var i;this._nonSystemOpCount+=pi(n)?1:0;let s=r.messageId(n);this._opsSizeAccumulator+=(i=this.messageSize[s])!==null&&i!==void 0?i:0,this.messageSize.delete(s)}))}get nonSystemOpCount(){return this._nonSystemOpCount}get opsSizeAccumulator(){return this._opsSizeAccumulator}static messageId(e){return e.sequenceNumber}static messageHasData(e){return e.data!==void 0}reset(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}};var He=function(r){return r.FluidDataStoreOp="component",r.Attach="attach",r.ChunkedOp="chunkedOp",r.BlobAttach="blobAttach",r.Rejoin="rejoin",r.Alias="alias",r}(He||{}),b4={state:"enabled",idleTime:5e3*3,maxTime:5e3*12,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6*10*1e3,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1},pn=function(r){return r.wait="wait",r.externalRequest="externalRequest",r.viaHandle="viaHandle",r}(pn||{}),bq="Fluid.ContainerRuntime.UseDataStoreAliasing",xq="Fluid.ContainerRuntime.MaxConsecutiveReconnects",Sq="Fluid.ContainerRuntime.MaxOpSizeInBytes",wq=768e3,Cq="Fluid.ContainerRuntime.DisableOpTracking",Eq=Kr.FlushMode.TurnBased;function x4(r){if(r.type===tt.Operation){if(r.contents.address!==void 0&&r.contents.type===void 0)r.type=He.FluidDataStoreOp;else{let e=r.contents;C(e.type!==void 0,289),r.type=e.type,r.contents=e.contents}C(Xi(r),290)}return r}var Eg=class{constructor(e,t){this.deltaManager=e,this.logger=t,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",i=>{if(i.length===0)return;let s=i[0].metadata;if(!s?.batch)return;if(i.length===1){delete s.batch;return}let o=i[i.length-1];o.metadata=Object.assign(Object.assign({},o.metadata),{batch:!1})}),this.deltaManager.inbound.on("push",i=>{this.trackPending(i)}),C(!this.localPaused,659);let n=this.deltaManager.inbound.toArray();for(let i of n)this.trackPending(i);this.deltaManager.on("op",i=>this.afterOpProcessing(i.sequenceNumber))}afterOpProcessing(e){if(C(!this.localPaused,660),this.deltaManager.inbound.length===0){C(this.pauseSequenceNumber===void 0,661);return}this.pauseSequenceNumber!==void 0&&(C(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue())}pauseQueue(){C(!this.localPaused,663),this.localPaused=!0,this.timePaused=le.now(),this.deltaManager.inbound.pause()}resumeQueue(e,t){let n=t.sequenceNumber,i=this.localPaused?le.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3===1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:n,length:n-e+1,msnDistance:n-t.minimumSequenceNumber,duration:i,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,i!==void 0&&i>lg&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:i,sequenceNumber:n,length:n-e}),this.deltaManager.inbound.resume())}trackPending(e){C(this.deltaManager.inbound.length!==0,664),C(this.currentBatchClientId===void 0==(this.pauseSequenceNumber===void 0),665);let t=e.metadata,n=t?.batch;if(!Xi(e)){C(this.currentBatchClientId===void 0,666),C(n===void 0,667),C(!this.localPaused,668);return}if(this.currentBatchClientId===void 0&&n===void 0){C(!this.localPaused,669);return}if((this.currentBatchClientId!==void 0||n===!1)&&this.currentBatchClientId!==e.clientId)throw new qt("OpBatchIncomplete",Object.assign({runtimeVersion:ac,batchClientId:this.currentBatchClientId},Wr(e)));n?(C(this.currentBatchClientId===void 0,670),C(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,this.deltaManager.inbound.length===1&&this.pauseQueue()):n===!1?(C(this.pauseSequenceNumber!==void 0,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):C(this.currentBatchClientId!==void 0,673)}},fh=class{constructor(e,t,n){this.deltaManager=e,this.emitter=t,this.logger=n,this.hitError=!1,this.deltaScheduler=new r4(this.deltaManager,ue.create(this.logger,"DeltaScheduler")),new Eg(e,n)}beforeOpProcessing(e){var t;this.batchClientId!==e.clientId&&(C(this.batchClientId===void 0,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e),((t=e?.metadata)===null||t===void 0?void 0:t.batch)?this.batchClientId=e.clientId:this.batchClientId=void 0)}afterOpProcessing(e,t){var n;if(C(!this.hitError,675),e){this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),this.deltaScheduler.batchEnd(t);return}let i=(n=t?.metadata)===null||n===void 0?void 0:n.batch;if(this.batchClientId===void 0||i===!1){this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),this.deltaScheduler.batchEnd(t);return}}},_g="_scheduler";function _q(){try{if(typeof navigator=="object"&&navigator!==null)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch{}return{}}var hc=class r extends be{constructor(e,t,n,i,s,o,a,c,l,d,h,u,f,g){var m,b,v,x,_,A,D,O,M;g===void 0&&(g=Object.assign(Object.assign({},b4),(m=a.summaryOptions)===null||m===void 0?void 0:m.summaryConfigOverrides)),super(),this.context=e,this.registry=t,this.runtimeOptions=a,this.containerScope=c,this.logger=l,this._storage=u,this.requestHandler=f,this.summaryConfiguration=g,this.defaultMaxConsecutiveReconnects=15,this._orderSequentiallyCalls=0,this.needsFlush=!1,this.flushTrigger=!1,this.savedOps=[],this.consecutiveReconnects=0,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.defaultTelemetrySignalSampleCount=100,this._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},this.summarizeOnDemand=(...F)=>{if(this.clientDetails.type===Lt)return this.summarizer.summarizeOnDemand(...F);if(this.summaryManager!==void 0)return this.summaryManager.summarizeOnDemand(...F);throw new ve(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.enqueueSummarize=(...F)=>{if(this.clientDetails.type===Lt)return this.summarizer.enqueueSummarize(...F);if(this.summaryManager!==void 0)return this.summaryManager.enqueueSummarize(...F);throw new ve(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.messageAtLastSummary=n?.message,this.disableIsolatedChannels=(b=this.runtimeOptions.summaryOptions.disableIsolatedChannels)!==null&&b!==void 0?b:!1,this._connected=this.context.connected,this.chunkMap=new Map(s),this.handleContext=new Iu("",this),this.mc=ur(ue.create(this.logger,"ContainerRuntime")),this.summariesDisabled=this.isSummariesDisabled(),this.heuristicsDisabled=this.isHeuristicsDisabled(),this.summarizerClientElectionEnabled=this.isSummarizerClientElectionEnabled(),this.maxOpsSinceLastSummary=this.getMaxOpsSinceLastSummary(),this.initialSummarizerDelayMs=this.getInitialSummarizerDelayMs(),this._aliasingEnabled=((v=this.mc.config.getBoolean(bq))!==null&&v!==void 0?v:!1)||((x=a.useDataStoreAliasing)!==null&&x!==void 0?x:!1),this._maxOpSizeInBytes=(_=this.mc.config.getNumber(Sq))!==null&&_!==void 0?_:wq,this.maxConsecutiveReconnects=(A=this.mc.config.getNumber(xq))!==null&&A!==void 0?A:this.defaultMaxConsecutiveReconnects,this._flushMode=a.flushMode;let S=e.pendingLocalState,E=(D=S?.baseSnapshot)!==null&&D!==void 0?D:e.baseSnapshot;this.garbageCollector=Yu.create({runtime:this,gcOptions:this.runtimeOptions.gcOptions,baseSnapshot:E,baseLogger:this.mc.logger,existing:d,metadata:n,isSummarizerClient:this.context.clientDetails.type===Lt,getNodePackagePath:F=>y(this,null,function*(){return this.getGCNodePackagePath(F)}),getLastSummaryTimestampMs:()=>{var F;return(F=this.messageAtLastSummary)===null||F===void 0?void 0:F.timestamp},readAndParseBlob:F=>y(this,null,function*(){return We(this.storage,F)})});let w=this.deltaManager.initialSequenceNumber;if(this.summarizerNode=Au(ue.create(this.logger,"SummarizerNode"),(F,N,P)=>y(this,null,function*(){return this.summarizeInternal(F,N,P)}),w,E?w:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!this.garbageCollector.shouldRunGC}),E&&this.summarizerNode.loadBaseSummaryWithoutDifferential(E),this.dataStores=new sh(Zu(E,n),this,F=>this.submit(He.Attach,F),(F,N)=>(P,I,B)=>this.summarizerNode.createChild(P,F,N,void 0,I,B),F=>this.summarizerNode.deleteChild(F),this.mc.logger,()=>y(this,null,function*(){return this.garbageCollector.getBaseGCDetails()}),(F,N,P)=>this.garbageCollector.nodeUpdated(F,"Changed",N,P),new Map(o),this.garbageCollector.writeDataAtRoot),this.blobManager=new vo(this.handleContext,h,()=>this.storage,F=>this.submit(He.BlobAttach,void 0,void 0,{blobId:F}),F=>this.garbageCollector.nodeUpdated(F,"Loaded"),this,this.logger),this.scheduleManager=new fh(e.deltaManager,this,ue.create(this.logger,"ScheduleManager")),this.deltaSender=this.deltaManager,this.pendingStateManager=new Ku({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,close:this.closeFn,connected:()=>this.connected,flush:this.flush.bind(this),flushMode:()=>this.flushMode,reSubmit:this.reSubmit.bind(this),rollback:this.rollback.bind(this),setFlushMode:F=>this.setFlushMode(F)},this._flushMode,S?.pending),this.context.quorum.on("removeMember",F=>{this.clearPartialChunks(F)}),this.summaryCollection=new ah(this.deltaManager,this.logger),this.dirtyContainer=this.context.attachState!==se.Attached||this.pendingStateManager.hasPendingMessages(),this.context.updateDirtyContainerState(this.dirtyContainer),this.summariesDisabled)this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{let F=ue.create(this.logger,"OrderedClientElection"),N=new ch(F,this.context.deltaManager,this.context.quorum),P=new lh(F,N,i??this.context.deltaManager.lastSequenceNumber,Ou.isClientEligible);if(this.summarizerClientElection=new Ou(F,this.summaryCollection,P,this.maxOpsSinceLastSummary,this.summarizerClientElectionEnabled),this.context.clientDetails.type===Lt)this._summarizer=new Gu("/_summarizer",this,()=>this.summaryConfiguration,this,this.handleContext,this.summaryCollection,I=>y(this,null,function*(){return hh.create(I)}));else if(Ou.clientDetailsPermitElection(this.context.clientDetails)){let I=()=>{this.summaryCollection.opsSinceLastAck>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),this.summaryCollection.once(tt.SummaryAck,()=>{this.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),this.summaryCollection.on("default",I)}),this.summaryCollection.off("default",I))};this.summaryCollection.on("default",I),this.summaryManager=new t4(this.summarizerClientElection,this,this.summaryCollection,this.logger,this.formRequestSummarizerFn(this.context.loader),new uh(60*1e3,30*1e3,v4({coefficient:20,initialDelay:0})),{initialDelayMs:this.initialSummarizerDelayMs},this.heuristicsDisabled),this.summaryManager.start()}}this.deltaManager.on("readonly",F=>{C(F===this.deltaManager.readOnlyInfo.readonly,292),C(!F||!this.connected,293),this.replayPendingStates()}),l.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},_q()));let T;d?(this.createContainerMetadata={createContainerRuntimeVersion:n?.createContainerRuntimeVersion,createContainerTimestamp:n?.createContainerTimestamp},T=(M=(O=n?.summaryNumber)!==null&&O!==void 0?O:n?.summaryCount)!==null&&M!==void 0?M:0):(this.createContainerMetadata={createContainerRuntimeVersion:ac,createContainerTimestamp:Date.now()},T=0),this.nextSummaryNumber=T+1,this.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},this.createContainerMetadata),this.dataStores.containerLoadStats),{summaryNumber:T,summaryFormatVersion:n?.summaryFormatVersion,disableIsolatedChannels:n?.disableIsolatedChannels,gcVersion:n?.gcFeature})),n4(this.context.clientId,this.deltaManager,this.logger),y4(this,this.logger),this.opTracker=new dh(this.deltaManager,this.mc.config.getBoolean(Cq)===!0)}get IContainerRuntime(){return this}get IFluidRouter(){return this}static load(a,c,l){return y(this,arguments,function*(e,t,n,i={},s=e.scope,o){var d,h,u;let f=e,g=(d=f.taggedLogger)!==null&&d!==void 0?d:new Oa(f.logger),m=ue.create(g,void 0,{all:{runtimeVersion:ac}}),{summaryOptions:b={},gcOptions:v={},loadSequenceNumberVerification:x="close",useDataStoreAliasing:_=!1,flushMode:A=Eq,enableOfflineLoad:D=!1}=i,O=e.pendingLocalState,M=(h=O?.baseSnapshot)!==null&&h!==void 0?h:e.baseSnapshot,S=O?new xo(()=>e.storage,O.snapshotBlobs):e.storage,E=new Pn(t),w=V=>y(this,null,function*(){let W=M?.blobs[V];if(M&&W)return C(S!==void 0,501),We(S,W)}),[T,F,N,P]=yield Promise.all([w(yg),w(cc),w(bg),w(vg)]),I=o===!0||e.existing===!0,B=yield vo.load(M?.trees[eh],V=>y(this,null,function*(){return C(S!==void 0,598),We(S,V)})),q=(u=F?.message)===null||u===void 0?void 0:u.sequenceNumber;if(!O&&q!==void 0){let V=e.deltaManager.initialSequenceNumber;if(x!=="bypass"&&q!==V){let W=new qt("Summary metadata mismatch",{runtimeVersion:ac,runtimeSequenceNumber:q,protocolSequenceNumber:V});x==="log"?m.sendErrorEvent({eventName:"SequenceNumberMismatch"},W):e.closeFn(W)}}let z=new r(e,E,F,N,T??[],P??[],{summaryOptions:b,gcOptions:v,loadSequenceNumberVerification:x,useDataStoreAliasing:_,flushMode:A,enableOfflineLoad:D},s,m,I,B,S,n);return O&&(yield z.processSavedOps(O),O.savedOps=[]),yield z.getSnapshotBlobs(),z})}get options(){return this.context.options}get clientId(){return this.context.clientId}get clientDetails(){return this.context.clientDetails}get deltaManager(){return this.context.deltaManager}get storage(){return this._storage}get reSubmitFn(){return this.reSubmit}get closeFn(){return this.context.closeFn}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this.context.attachState}get IFluidHandleContext(){return this.handleContext}get connected(){return this._connected}get summarizerClientId(){var e;return(e=this.summarizerClientElection)===null||e===void 0?void 0:e.electedClientId}get disposed(){return this._disposed}get summarizer(){return C(this._summarizer!==void 0,599),this._summarizer}isSummariesDisabled(){return this.runtimeOptions.summaryOptions.disableSummaries===!0?!0:this.summaryConfiguration.state==="disabled"}isHeuristicsDisabled(){var e;return((e=this.runtimeOptions.summaryOptions.summarizerOptions)===null||e===void 0?void 0:e.disableHeuristics)===!0?!0:this.summaryConfiguration.state==="disableHeuristics"}isSummarizerClientElectionEnabled(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))!==null&&e!==void 0?e:!0:this.runtimeOptions.summaryOptions.summarizerClientElection===!0?!0:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.summarizerClientElection===!0:!1}getMaxOpsSinceLastSummary(){return this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary!==void 0?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.maxOpsSinceLastSummary:0}getInitialSummarizerDelayMs(){return this.runtimeOptions.summaryOptions.initialSummarizerDelayMs!==void 0?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.initialSummarizerDelayMs:0}dispose(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),this.summaryManager!==void 0&&this.summaryManager.dispose(),this.garbageCollector.dispose(),(t=this._summarizer)===null||t===void 0||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}get IFluidTokenProvider(){var e;if(!((e=this.options)===null||e===void 0)&&e.intelligence)return{intelligence:this.options.intelligence}}request(e){return y(this,null,function*(){try{let t=hr.create(e);return t.pathParts[0]==="_summarizer"&&t.pathParts.length===1?this._summarizer!==void 0?{status:200,mimeType:"fluid/object",value:this.summarizer}:Et(e):this.requestHandler!==void 0?this.requestHandler(t,this):Et(e)}catch(t){return mi(t)}})}resolveHandle(e){return y(this,null,function*(){try{let t=hr.create(e),n=t.pathParts[0];if(n==="_channels")return this.resolveHandle(t.createSubRequest(1));if(n===vo.basePath&&t.isLeaf(2)){let i=yield this.blobManager.getBlob(t.pathParts[1]);return i?{status:200,mimeType:"fluid/object",value:i.get()}:Et(e)}else if(t.pathParts.length>0){let i=yield this.getDataStoreFromRequest(n,e),s=t.createSubRequest(1);return C(s.url.startsWith("/"),294),i.IFluidRouter.request(s)}return Et(e)}catch(t){return mi(t)}})}internalId(e){var t;return(t=this.dataStores.aliases().get(e))!==null&&t!==void 0?t:e}getDataStoreFromRequest(e,t){return y(this,null,function*(){var n,i,s;let o=typeof((n=t.headers)===null||n===void 0?void 0:n[pn.wait])=="boolean"?(i=t.headers)===null||i===void 0?void 0:i[pn.wait]:!0,a=this.internalId(e),c=yield this.dataStores.getDataStore(a,o);if(!((s=t.headers)===null||s===void 0)&&s[pn.externalRequest]&&this.garbageCollector.shouldRunGC){let h=(yield c.getBaseGCDetails()).usedRoutes;if(!(h===void 0||h.includes("")||h.includes("/")))throw gi(Et(t),t)}let l=yield c.realize(),d=I_(t.url.split("?")[0]);return this.garbageCollector.nodeUpdated(`/${d}`,"Loaded",void 0,c.packagePath,t?.headers),l})}addMetadataToSummary(e){var t;let n=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:(t=h4(this.deltaManager.lastMessage))!==null&&t!==void 0?t:this.messageAtLastSummary});dr(e,cc,JSON.stringify(n))}addContainerStateToSummary(e,t,n,i){var s;if(this.addMetadataToSummary(e),this.chunkMap.size>0){let c=JSON.stringify([...this.chunkMap]);dr(e,yg,c)}let o=this.dataStores.aliases();if(o.size>0&&dr(e,vg,JSON.stringify([...o])),this.summarizerClientElection){let c=JSON.stringify((s=this.summarizerClientElection)===null||s===void 0?void 0:s.serialize());dr(e,bg,c)}let a=this.blobManager.summarize();if(Object.keys(a.summary.tree).length>0&&$m(e,eh,a),this.garbageCollector.writeDataAtRoot){let c=this.garbageCollector.summarize(t,n,i);c!==void 0&&Jm(e,fn,c)}}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0?!0:this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0)}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.canSendOps())return;let e=this.dirtyContainer;this.dirtyContainer=!1,C(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;let t;try{this.pendingStateManager.replayPendingStates()}finally{t=this.dirtyContainer,this.dirtyContainer=e,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(t)}applyStashedOp(e,t){return y(this,null,function*(){switch(e){case He.FluidDataStoreOp:return this.dataStores.applyStashedOp(t);case He.Attach:return this.dataStores.applyStashedAttachOp(t);case He.Alias:case He.BlobAttach:return;case He.ChunkedOp:throw new Error("chunkedOp not expected here");case He.Rejoin:throw new Error("rejoin not expected here");default:ot(e,`Unknown ContainerMessageType: ${e}`)}})}setConnectionState(e,t){this.verifyNotClosed();let n=this._connected!==e,i=n&&e;if(this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),i&&(this.consecutiveReconnects++,!this.shouldContinueReconnecting())){this.closeFn(gt.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}));return}n&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),Hi(this.mc.logger,this,e,t)}process(e,t){var n,i;if(this.verifyNotClosed(),!Xi(e))return;((n=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&n!==void 0?n:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);let s=Object.assign({},e);this.scheduleManager.beforeOpProcessing(s);try{s=x4(s),s=this.processRemoteChunkedMessage(s);let o;switch(t&&s.type!==He.ChunkedOp&&(o=this.pendingStateManager.processPendingLocalMessage(s)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),s.type){case He.Attach:this.dataStores.processAttachMessage(s,t);break;case He.Alias:this.processAliasMessage(s,o,t);break;case He.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(s,t,o);break;case He.BlobAttach:C((i=s?.metadata)===null||i===void 0?void 0:i.blobId,298),this.blobManager.processBlobAttachOp(s.metadata.blobId,t);break;default:}this.emit("op",s),this.scheduleManager.afterOpProcessing(void 0,s),t&&this.resetReconnectCount()}catch(o){throw this.scheduleManager.afterOpProcessing(o,s),o}}processAliasMessage(e,t,n){this.dataStores.processAliasMessage(e,t,n)}sendSignalTelemetryEvent(e){let t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}processSignal(e,t){let n=e.content,i={clientId:e.clientId,content:n.contents.content,type:n.contents.type};if(e.clientId===this.clientId&&this.connected&&(this._perfSignalData.trackingSignalSequenceNumber!==void 0&&n.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:n.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:n.clientSignalSequenceNumber})):n.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(n.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),n.address===void 0){this.emit("signal",i,t);return}this.dataStores.processSignal(n.address,i,t)}getRootDataStore(e,t=!0){return y(this,null,function*(){let n=this.internalId(e),i=yield this.dataStores.getDataStore(n,t);return C(yield i.isRoot(),299),i.realize()})}setFlushMode(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===Kr.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}flush(){if(C(this._orderSequentiallyCalls===0,588),!!this.deltaSender&&(this.pendingStateManager.onFlush(),!!this.needsFlush&&(this.needsFlush=!1,!!this.canSendOps())))return this.deltaSender.flush()}orderSequentially(e){if(this.flushMode===Kr.FlushMode.TurnBased){this.trackOrderSequentiallyCalls(e);return}let t=this.flushMode;this.setFlushMode(Kr.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}trackOrderSequentiallyCalls(e){let t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(n){throw t?t.rollback():this.closeFn(new ir("orderSequentially callback exception",n)),n}finally{this._orderSequentiallyCalls--}}createDataStore(e){return y(this,null,function*(){let t=Te();return ih(yield this._createDataStore(e,!1,t),t,this,this.dataStores,this.mc.logger)})}createRootDataStoreLegacy(e,t){return y(this,null,function*(){let n=yield this._createDataStore(e,!0,t);return n.makeVisibleAndAttachGraph!==void 0?n.makeVisibleAndAttachGraph():n.bindToContext(),n})}createRootDataStore(e,t){return y(this,null,function*(){if(t.includes("/"))throw new ve(`Id cannot contain slashes: '${t}'`);return this._aliasingEnabled===!0?this.createAndAliasDataStore(e,t):this.createRootDataStoreLegacy(e,t)})}createAndAliasDataStore(e,t,n){return y(this,null,function*(){let i=Te(),s=yield this._createDataStore(e,!1,i,n),o=ih(s,i,this,this.dataStores,this.mc.logger),a=yield o.trySetAlias(t);if(a!=="Success")throw new ir("dataStoreAliasFailure",void 0,{alias:{value:t,tag:Ne.UserData},internalId:{value:i,tag:Ne.PackageData},aliasResult:a});return o})}createDetachedRootDataStore(e,t){if(t.includes("/"))throw new ve(`Id cannot contain slashes: '${t}'`);return this.dataStores.createDetachedDataStoreCore(e,!0,t)}createDetachedDataStore(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}_createDataStoreWithPropsLegacy(s,o){return y(this,arguments,function*(e,t,n=Te(),i=!1){let a=yield this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],n,i,t).realize();return i&&(a.makeVisibleAndAttachGraph!==void 0?a.makeVisibleAndAttachGraph():a.bindToContext(),this.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:t!==void 0})),ih(a,n,this,this.dataStores,this.mc.logger)})}_createDataStoreWithProps(s,o){return y(this,arguments,function*(e,t,n=Te(),i=!1){return this._aliasingEnabled===!0&&i?this.createAndAliasDataStore(e,n,t):this._createDataStoreWithPropsLegacy(e,t,n,i)})}_createDataStore(s,o){return y(this,arguments,function*(e,t,n=Te(),i){return this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],n,t,i).realize()})}canSendOps(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}getQuorum(){return this.context.quorum}getAudience(){return this.context.audience}get isDirty(){return this.dirtyContainer}isContainerMessageDirtyable(e,t){if(e===He.Attach){if(t.id===_g)return!1}else if(e===He.FluidDataStoreOp&&t.address===_g)return!1;return!0}createNewSignalEnvelope(e,t,n){let i=++this._perfSignalData.signalSequenceNumber,s={address:e,clientSignalSequenceNumber:i,contents:{type:t,content:n}};return i%this.defaultTelemetrySignalSampleCount===1&&this._perfSignalData.trackingSignalSequenceNumber===void 0&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=i),s}submitSignal(e,t){this.verifyNotClosed();let n=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(n)}submitDataStoreSignal(e,t,n){let i=this.createNewSignalEnvelope(e,t,n);return this.context.submitSignalFn(i)}setAttachState(e){e===se.Attaching?C(this.attachState===se.Attaching,301):(C(this.attachState===se.Attached,302),this.emit("attached")),e===se.Attached&&!this.pendingStateManager.hasPendingMessages()&&this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}createSummary(e,t){e&&this.blobManager.setRedirectTable(e);let n=this.dataStores.createSummary(t);return this.disableIsolatedChannels||yo(n),this.addContainerStateToSummary(n,!0,!1,t),n.summary}getAbsoluteUrl(e){return y(this,null,function*(){if(this.context.getAbsoluteUrl===void 0)throw new Error("Driver does not implement getAbsoluteUrl");if(this.attachState===se.Attached)return this.context.getAbsoluteUrl(e)})}summarizeInternal(e,t,n){return y(this,null,function*(){let i=yield this.dataStores.summarize(e,t,n),s;return this.disableIsolatedChannels||(yo(i),s=[Kr.channelsTreeName]),this.addContainerStateToSummary(i,e,t,n),Object.assign(Object.assign({},i),{id:"",pathPartsForChildren:s})})}summarize(e){return y(this,null,function*(){this.verifyNotClosed();let{fullTree:t=!1,trackState:n=!0,summaryLogger:i=this.mc.logger,runGC:s=this.garbageCollector.shouldRunGC,runSweep:o,fullGC:a}=e,c;s&&(c=yield this.collectGarbage({logger:i,runSweep:o,fullGC:a}));let l=new Qa,{stats:d,summary:h}=yield this.summarizerNode.summarize(t,n,l);return this.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:l.serialize()}),C(h.type===dn.Tree,303),{stats:d,summary:h,gcStats:c}})}updateStateBeforeGC(){return y(this,null,function*(){return this.dataStores.updateStateBeforeGC()})}getGCData(e){return y(this,null,function*(){let t=new vi,n=yield this.dataStores.getGCData(e);t.addNodes(n.gcNodes);let i=this.blobManager.getGCData(e);return t.addNodes(i.gcNodes),t.getGCData()})}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""]);let n=[];for(let i of e)i.split("/")[1]!==vo.basePath&&n.push(i);return this.dataStores.updateUsedRoutes(n,t)}deleteUnusedRoutes(e){let t=[],n=[];for(let i of e)this.isBlobPath(i)?t.push(i):n.push(i);this.blobManager.deleteUnusedRoutes(t),this.dataStores.deleteUnusedRoutes(n)}getCurrentReferenceTimestampMs(){var e,t,n;return(t=(e=this.deltaManager.lastMessage)===null||e===void 0?void 0:e.timestamp)!==null&&t!==void 0?t:(n=this.messageAtLastSummary)===null||n===void 0?void 0:n.timestamp}getNodeType(e){var t;return this.isBlobPath(e)?zt.Blob:(t=this.dataStores.getGCNodeType(e))!==null&&t!==void 0?t:zt.Other}getGCNodePackagePath(e){return y(this,null,function*(){switch(this.getNodeType(e)){case zt.Blob:return["_blobs"];case zt.DataStore:case zt.SubDataStore:return this.dataStores.getDataStorePackagePath(e);default:C(!1,734)}})}isBlobPath(e){let t=e.split("/");return!(t.length<2||t[1]!==vo.basePath)}collectGarbage(e){return y(this,null,function*(){return this.garbageCollector.collectGarbage(e)})}addedGCOutboundReference(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}submitSummary(e){return y(this,null,function*(){var t,n,i;let{fullTree:s,refreshLatestAck:o,summaryLogger:a}=e,c=this.nextSummaryNumber,l=ue.create(a,void 0,{all:{summaryNumber:c}}),d;if(o){let h=yield this.refreshLatestSummaryAckFromServer(ue.create(l,void 0,{all:{safeSummary:!0}})),u=h.latestSnapshotRefSeq;d=h.latestSnapshotVersionId,u>this.deltaManager.lastSequenceNumber&&(yield ce.timedExecAsync(l,{eventName:"WaitingForSeq",lastSequenceNumber:this.deltaManager.lastSequenceNumber,targetSequenceNumber:u,lastKnownSeqNumber:this.deltaManager.lastKnownSeqNumber},()=>y(this,null,function*(){return Tq(this.deltaManager,u)}),{start:!0,end:!0,cancel:"error"}))}try{yield this.deltaManager.inbound.pause();let h=this.deltaManager.lastSequenceNumber,u=this.deltaManager.minimumSequenceNumber,f=`Summary @${h}:${this.deltaManager.minimumSequenceNumber}`;h!==((t=this.deltaManager.lastMessage)===null||t===void 0?void 0:t.sequenceNumber)&&l.sendErrorEvent({eventName:"LastSequenceMismatch",error:f}),this.summarizerNode.startSummary(h,l);let g=()=>e.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:(C(this.connected,600),this.deltaManager.lastSequenceNumber!==h?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${this.deltaManager.lastSequenceNumber} !== ${h}`}:{continue:!0}),m=g();if(!m.continue)return{stage:"base",referenceSequenceNumber:h,minimumSequenceNumber:u,error:m.error};let b=Rs.start(),v,x=this.garbageCollector.summaryStateNeedsReset;try{v=yield this.summarize({fullTree:s||x,trackState:!0,summaryLogger:l,runGC:this.garbageCollector.shouldRunGC})}catch(z){return{stage:"base",referenceSequenceNumber:h,minimumSequenceNumber:u,error:z}}let{summary:_,stats:A}=v;this.messageAtLastSummary=this.deltaManager.lastMessage;let D=this.disableIsolatedChannels?_:_.tree[Kr.channelsTreeName];C(D.type===dn.Tree,508);let O=Object.values(D.tree).filter(z=>z.type===dn.Handle).length,M=_.tree[fn]?Za(_.tree[fn]):void 0,S=Object.assign({dataStoreCount:this.dataStores.size,summarizedDataStoreCount:this.dataStores.size-O,gcStateUpdatedDataStoreCount:(n=v.gcStats)===null||n===void 0?void 0:n.updatedDataStoreCount,gcBlobNodeCount:M?.blobNodeCount,gcTotalBlobsSize:M?.totalBlobSize,opsSizesSinceLastSummary:this.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:this.opTracker.nonSystemOpCount,summaryNumber:c},A),E={referenceSequenceNumber:h,minimumSequenceNumber:u,summaryTree:_,summaryStats:S,generateDuration:b.trace().duration,forcedFullTree:x};if(m=g(),!m.continue)return Object.assign(Object.assign({stage:"generate"},E),{error:m.error});let w=this.summaryCollection.latestAck,T;w?.summaryAck.contents.handle!==d&&d!==void 0?T={proposalHandle:void 0,ackHandle:d,referenceSequenceNumber:h}:w===void 0?T={proposalHandle:void 0,ackHandle:(i=this.context.getLoadedFromVersion())===null||i===void 0?void 0:i.id,referenceSequenceNumber:h}:T={proposalHandle:w.summaryOp.contents.handle,ackHandle:w.summaryAck.contents.handle,referenceSequenceNumber:h};let F;try{F=yield this.storage.uploadSummaryWithContext(v.summary,T)}catch(z){return Object.assign(Object.assign({stage:"generate"},E),{error:z})}let N=T.ackHandle,P={handle:F,head:N,message:f,parents:N?[N]:[]},I=Object.assign(Object.assign({},E),{handle:F,uploadDuration:b.trace().duration});if(m=g(),!m.continue)return Object.assign(Object.assign({stage:"upload"},I),{error:m.error});let B;try{B=this.submitSystemMessage(tt.Summarize,P)}catch(z){return Object.assign(Object.assign({stage:"upload"},I),{error:z})}let q=Object.assign(Object.assign({stage:"submit"},I),{clientSequenceNumber:B,submitOpDuration:b.trace().duration});return this.summarizerNode.completeSummary(F),this.opTracker.reset(),q}finally{this.summarizerNode.clearSummary(),this.deltaManager.inbound.resume()}})}processRemoteChunkedMessage(e){if(e.type!==He.ChunkedOp)return e;let t=e.clientId,n=e.contents;if(this.addChunk(t,n),n.chunkId===n.totalChunks){let i=Object.assign({},e),s=this.chunkMap.get(t).join("");return i.contents=JSON.parse(s),i.type=n.originalType,this.clearPartialChunks(t),i}return e}addChunk(e,t){let n=this.chunkMap.get(e);n===void 0&&(n=[],this.chunkMap.set(e,n)),C(t.chunkId===n.length+1,305),n.push(t.contents)}clearPartialChunks(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}updateDocumentDirtyState(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}submitDataStoreOp(e,t,n=void 0){let i={address:e,contents:t};this.submit(He.FluidDataStoreOp,i,n)}submitDataStoreAliasOp(e,t){if(!nh(e))throw new ve("malformedDataStoreAliasMessage");this.submit(He.Alias,e,t)}uploadBlob(e){return y(this,null,function*(){return this.verifyNotClosed(),this.blobManager.createBlob(e)})}submit(e,t,n=void 0,i=void 0){this.verifyNotClosed(),C(this.attachState!==se.Detached,306);let s=-1,o=i;if(this.canSendOps()){let a=JSON.stringify(t),c=this.context.deltaManager.maxMessageSize;this.flushMode===Kr.FlushMode.TurnBased&&!this.needsFlush&&(o=Object.assign(Object.assign({},i),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then(()=>{this.flushTrigger=!1,this.flush()})),s=this.submitMaybeChunkedMessages(e,t,a,c,this._flushMode===Kr.FlushMode.TurnBased,o)}this.pendingStateManager.onSubmitMessage(e,s,this.deltaManager.lastSequenceNumber,t,n,o),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}submitMaybeChunkedMessages(e,t,n,i,s,o=void 0){return this._maxOpSizeInBytes>=0?!n||n.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,s,o):(this.closeFn(new ir("OpTooLarge",void 0,{length:{value:n.length,tag:Ne.PackageData},limit:{value:this._maxOpSizeInBytes,tag:Ne.PackageData}})),-1):!n||n.length<=i?this.submitRuntimeMessage(e,t,s,o):this.submitChunkedMessage(e,n,i)}submitChunkedMessage(e,t,n){let i=t.length,s=Math.floor((i-1)/n)+1,o=0,a=0;for(let c=1;c<=s;c=c+1){let l={chunkId:c,contents:t.substr(o,n),originalType:e,totalChunks:s};o+=n,a=this.submitRuntimeMessage(He.ChunkedOp,l,!1)}return a}submitSystemMessage(e,t){this.verifyNotClosed(),C(this.connected,307);let n=this.flushMode===Kr.FlushMode.TurnBased&&this.needsFlush;return n&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,n)}submitRuntimeMessage(e,t,n,i){this.verifyNotClosed(),C(this.connected,601);let s={type:e,contents:t};return this.context.submitFn(tt.Operation,s,n,i)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmit(e,t,n,i){switch(e){case He.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,n);break;case He.Attach:case He.Alias:this.submit(e,t,n);break;case He.ChunkedOp:throw new Error("chunkedOp not expected here");case He.BlobAttach:this.submit(e,t,n,i);break;case He.Rejoin:this.submit(e,t);break;default:ot(e,`Unknown ContainerMessageType: ${e}`)}}rollback(e,t,n){switch(e){case He.FluidDataStoreOp:this.dataStores.rollbackDataStoreOp(t,n);break;default:throw new Error(`Can't rollback ${e}`)}}refreshLatestSummaryAck(e,t,n,i){return y(this,null,function*(){let s=c=>y(this,null,function*(){return We(this.storage,c)}),{snapshotTree:o}=yield this.fetchSnapshotFromStorage(t,i,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:t,summaryRefSeq:n,fetchLatest:!1}),a=yield this.summarizerNode.refreshLatestSummary(e,n,()=>y(this,null,function*(){return o}),s,i);yield this.garbageCollector.latestSummaryStateRefreshed(a,s)})}refreshLatestSummaryAckFromServer(e){return y(this,null,function*(){let{snapshotTree:t,versionId:n}=yield this.fetchSnapshotFromStorage(null,e,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0}),i=a=>y(this,null,function*(){return We(this.storage,a)}),s=yield tg(t,i),o=yield this.summarizerNode.refreshLatestSummary(void 0,s,()=>y(this,null,function*(){return t}),i,e);return yield this.garbageCollector.latestSummaryStateRefreshed(o,i),{latestSnapshotRefSeq:s,latestSnapshotVersionId:n}})}fetchSnapshotFromStorage(e,t,n){return y(this,null,function*(){return ce.timedExecAsync(t,n,i=>y(this,null,function*(){let s={},o=Rs.start(),a=yield this.storage.getVersions(e,1);C(!!a&&!!a[0],311),s.getVersionDuration=o.trace().duration;let c=yield this.storage.getSnapshotTree(a[0]);return C(!!c,312),s.getSnapshotDuration=o.trace().duration,i.end(s),{snapshotTree:c,versionId:a[0].id}}))})}notifyAttaching(e){var t;((t=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&t!==void 0?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=xo.serializeTreeWithBlobContents(e))}getSnapshotBlobs(){return y(this,null,function*(){var e;!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad)||this.attachState!==se.Attached||this.context.pendingLocalState||(C(!!this.context.baseSnapshot,741),this.baseSnapshotBlobs=yield xo.serializeTree(this.context.baseSnapshot,this.storage))})}getPendingLocalState(){var e;if(!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad))throw new ve("can't get state when offline load disabled");let t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:(C(!!this.context.baseSnapshot,742),C(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}formRequestSummarizerFn(e){return()=>y(this,null,function*(){let t={headers:{[et.cache]:!1,[et.clientDetails]:{capabilities:{interactive:!1},type:Lt},[ai.summarizingClient]:!0,[et.reconnect]:!1},url:"/_summarizer"},i=(yield un(e,t)).ISummarizer;if(!i)throw new ve("Fluid object does not implement ISummarizer");return i})}processSavedOps(e){return y(this,null,function*(){for(let t of e.savedOps)this.process(t,!1),yield this.pendingStateManager.applyStashedOpsAt(t.sequenceNumber);yield this.pendingStateManager.applyStashedOpsAt()})}},Tq=(r,e)=>y(void 0,null,function*(){return new Promise((t,n)=>{r.on("closed",n);let i=s=>{s.sequenceNumber>=e&&(t(),r.off("op",i))};r.on("op",i)})});at();var ph=class{constructor(e,t){this.absolutePath=e,this.routeContext=t,this.isAttached=!0,C(e.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}get(){return y(this,null,function*(){if(this.objectP===void 0){let e={url:this.absolutePath,headers:{[pn.viaHandle]:!0}};this.objectP=this.routeContext.resolveHandle(e).then(t=>{if(t.mimeType==="fluid/object")return t.value;throw gi(t,e)})}return this.objectP})}attachGraph(){}bind(e){e.attachGraph()}request(e){return y(this,null,function*(){try{let n=(yield this.get()).IFluidRouter;return n!==void 0?n.request(e):Et(e)}catch(t){return mi(t)}})}};var Aq=r=>r?.type==="__fluid_handle__",So=class{constructor(e,t){for(this.context=e,this.handleParsedCb=t,this.encodeValue=(n,i)=>{let s=n?.IFluidHandle;return s!==void 0?this.serializeHandle(s,i):n},this.decodeValue=n=>{if(Aq(n)){let i=n.url.startsWith("/")?n.url:Vr(n.url,this.context),s=new ph(i,this.root);return this.handleParsedCb(s),s}else return n},this.root=this.context;this.root.routeContext!==void 0;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(e,t){return e&&typeof e=="object"?this.recursivelyReplace(e,this.encodeValue,t):e}decode(e){return e&&typeof e=="object"?this.recursivelyReplace(e,this.decodeValue):e}stringify(e,t){return JSON.stringify(e,(n,i)=>this.encodeValue(i,t))}parse(e){return JSON.parse(e,(t,n)=>this.decodeValue(n))}recursivelyReplace(e,t,n){let i=t(e,n);if(i!==e)return i;let s;for(let o of Object.keys(e)){let a=e[o];if(a&&typeof a=="object"){let c=this.recursivelyReplace(a,t,n);c!==a&&(s=s??(Array.isArray(e)?[...e]:Object.assign({},e)),s[o]=c)}}return s??e}serializeHandle(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}};Dt();te();Pt();var wo=ye(Tr());xe();var mh=class extends kr{get isAttached(){return this.value.isAttached()}constructor(e,t,n){super(e,t,n)}attachGraph(){this.value.bindToContext(),super.attachGraph()}};var gh=class extends So{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(e,t){return this.serializedRoutes.add(e.absolutePath),super.serializeHandle(e,t)}};var Tg=class extends _n{constructor(e,t,n){super((i,s)=>this.eventListenerErrorHandler(i,s)),this.id=e,this.runtime=t,this.attributes=n,this._connected=!1,this._isBoundToContext=!1,C(!e.includes("/"),772),this.handle=new mh(this,e,t.IFluidHandleContext),this.logger=ue.create(t.logger,void 0,{all:{sharedObjectId:Te(),ddsType:{value:this.attributes.type,tag:Ne.CodeArtifact}}}),this.mc=ur(this.logger),[this.opProcessingHelper,this.callbacksHelper]=this.setUpSampledTelemetryHelpers(),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}setUpSampledTelemetryHelpers(){var e,t;C(this.mc!==void 0&&this.logger!==void 0,"this.mc and/or this.logger has not been set");let n=new js({eventName:"ddsOpProcessing",category:"performance"},this.logger,(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))!==null&&e!==void 0?e:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),i=new js({eventName:"ddsEventCallbacks",category:"performance"},this.logger,(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))!==null&&t!==void 0?t:100,!0);return this.runtime.once("dispose",()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()}),[n,i]}closeWithError(e){this.closeError===void 0&&(this.closeError=e)}verifyNotClosed(){if(this.closeError!==void 0)throw this.closeError}eventListenerErrorHandler(e,t){let n=gt.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw n.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(n),n}attachListeners(){this.isAttached()||this.runtime.once("attaching",()=>{this.didAttach()})}load(e){return y(this,null,function*(){this.runtime.attachState!==se.Detached&&(this.services=e),yield this.loadCore(e.objectStorage),this.runtime.attachState!==se.Detached&&this.attachDeltaHandler()})}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(e){this.services=e,this.attachDeltaHandler()}isAttached(){return this.services!==void 0&&this.runtime.attachState!==se.Detached}handleDecoded(e){var t,n,i;this.isAttached()&&((i=(t=this.services)===null||t===void 0?void 0:(n=t.deltaConnection).addedGCOutboundReference)===null||i===void 0||i.call(n,this.handle,e))}initializeLocalCore(){}didAttach(){}submitLocalMessage(e,t=void 0){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(e,t){this.submitLocalMessage(e,t)}newAckBasedPromise(e){return y(this,null,function*(){let t;return new Promise((n,i)=>{if(t=()=>i(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(n,i)}).finally(()=>{this.runtime.off("dispose",t)})})}attachDeltaHandler(){C(this.services!==void 0,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(e,t,n)=>{this.process(e,t,n)},setConnectionState:e=>{this.setConnectionState(e)},reSubmit:(e,t)=>{this.reSubmit(e,t)},applyStashedOp:e=>this.applyStashedOp(e),rollback:(e,t)=>{this.rollback(e,t)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}process(e,t,n){this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure(()=>{this.processCore(e,t,n)},t?"local":"remote"),this.emitInternal("op",e,t,this)}reSubmit(e,t){this.reSubmitCore(e,t)}rollback(e,t){throw new Error("rollback not supported")}emit(e,...t){return this.callbacksHelper.measure(()=>super.emit(e,...t))}emitInternal(e,...t){return super.emit(e,...t)}},Co=class extends Tg{constructor(e,t,n,i){super(e,t,n),this.telemetryContextPrefix=i,this._isGCing=!1,this._serializer=new So(this.runtime.channelsRoutingContext,s=>this.handleDecoded(s))}get serializer(){return C(!this._isGCing,117),this._serializer}getAttachSummary(e=!1,t=!1,n){let i=this.summarizeCore(this.serializer,n);return this.incrementTelemetryMetric(wo.blobCountPropertyName,i.stats.blobNodeCount,n),this.incrementTelemetryMetric(wo.totalBlobSizePropertyName,i.stats.totalBlobSize,n),i}summarize(e=!1,t=!1,n){return y(this,null,function*(){let i=this.summarizeCore(this.serializer,n);return this.incrementTelemetryMetric(wo.blobCountPropertyName,i.stats.blobNodeCount,n),this.incrementTelemetryMetric(wo.totalBlobSizePropertyName,i.stats.totalBlobSize,n),i})}getGCData(e=!1){C(!this._isGCing,120),this._isGCing=!0;let t;try{let n=new gh(this.runtime.channelsRoutingContext,i=>this.handleDecoded(i));this.processGCDataCore(n),t={gcNodes:{"/":n.getSerializedRoutes()}},C(this._isGCing,121)}finally{this._isGCing=!1}return t}processGCDataCore(e){this.summarizeCore(e)}incrementTelemetryMetric(e,t,n){var i;let s=(i=n?.get(this.telemetryContextPrefix,e))!==null&&i!==void 0?i:0;n?.set(this.telemetryContextPrefix,e,s+t)}};function S4(r,e,t){return r!==void 0?e.stringify(r,t):r}function w4(r,e){return r!==void 0?e.parse(JSON.stringify(r)):r}var It=function(r){return r[r.Shared=0]="Shared",r[r.Plain=1]="Plain",r}(It||{});at();te();function dc(r,e,t){let n=r.makeSerialized(e,t);return{type:n.type,value:n.value&&JSON.parse(n.value)}}var vh=class{constructor(e){this.value=e}get type(){return It[It.Plain]}makeSerialized(e,t){let n=S4(this.value,e,t);return{type:this.type,value:n}}},Eo=class{constructor(e){this.serializer=e}fromSerializable(e){if(e.type===It[It.Shared]){e.type=It[It.Plain];let n={type:"__fluid_handle__",url:e.value};e.value=n}let t=w4(e.value,this.serializer);return new vh(t)}fromInMemory(e){return new vh(e)}};function Ag(r){return r!==void 0&&typeof r.pendingMessageId=="number"&&(r.type==="add"||r.type==="edit")}function C4(r){return r!==void 0&&r.type==="clear"&&typeof r.pendingMessageId=="number"}function Dq(r){return r!==void 0&&typeof r.pendingMessageId=="number"&&(r.type==="add"||r.type==="edit"||r.type==="clear")}var yh=class{constructor(e,t,n,i,s){this.serializer=e,this.handle=t,this.submitMessage=n,this.isAttached=i,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new Eo(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){let e=this.data.entries();return{next(){let n=e.next();return n.done?{value:void 0,done:!0}:{value:[n.value[0],n.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){let e=this.data.values();return{next(){let n=e.next();return n.done?{value:void 0,done:!0}:{value:n.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,n,i)=>{e(t.value,n,i)})}get(e){let t=this.data.get(e);return t===void 0?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(e==null)throw new Error("Undefined and null keys are not supported");let n=this.localValueMaker.fromInMemory(t),i=dc(n,this.serializer,this.handle),s=this.setCore(e,n,!0);if(!this.isAttached())return;let o={key:e,type:"set",value:i};this.submitMapKeyMessage(o,s)}delete(e){let t=this.deleteCore(e,!0);if(!this.isAttached())return t!==void 0;let n={key:e,type:"delete"};return this.submitMapKeyMessage(n,t),t!==void 0}clear(){let e=this.isAttached()?new Map(this.data):void 0;if(this.clearCore(!0),!this.isAttached())return;let t={type:"clear"};this.submitMapClearMessage(t,e)}getSerializedStorage(e){let t={};return this.data.forEach((n,i)=>{t[i]=n.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){let t={};return this.data.forEach((n,i)=>{t[i]=dc(n,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(let[t,n]of Object.entries(e)){let i={key:t,value:this.makeLocal(t,n)};this.data.set(i.key,i.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){let n=this.messageHandlers.get(e.type);return n===void 0?!1:(n.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){let t=this.messageHandlers.get(e.type);if(t===void 0)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,n){let i=this.messageHandlers.get(e.type);return i===void 0?!1:(i.process(e,t,n),!0)}rollback(e,t){if(!Dq(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){if(t.previousMap===void 0)throw new Error("Cannot rollback without previous map");t.previousMap.forEach((i,s)=>{this.setCore(s,i,!0)});let n=this.pendingClearMessageIds.pop();if(n===void 0||n!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if(e.type==="delete"||e.type==="set"){if(t.type==="add")this.deleteCore(e.key,!0);else if(t.type==="edit"&&t.previousValue!==void 0)this.setCore(e.key,t.previousValue,!0);else throw new Error("Cannot rollback without previous value");let n=this.pendingKeys.get(e.key),i=n?.pop();if(!n||i!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");n.length===0&&this.pendingKeys.delete(e.key)}else throw new Error("Unsupported op for rollback")}setCore(e,t,n){let i=this.data.get(e),s=i?.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:s},n,this.eventEmitter),i}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){let n=this.data.get(e),i=n?.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},t,this.eventEmitter),n}clearExceptPendingKeys(){let e=new Map;this.pendingKeys.forEach((t,n)=>{e.set(n,this.data.get(n))}),this.clearCore(!1),e.forEach((t,n)=>{this.setCore(n,t,!0)})}makeLocal(e,t){if(t.type===It[It.Plain]||t.type===It[It.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,n){if(this.pendingClearMessageIds.length>0)return t&&C(n!==void 0&&Ag(n)&&n.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){C(n!==void 0&&Ag(n),20);let s=this.pendingKeys.get(e.key);C(s!==void 0&&s[0]===n.pendingMessageId,762),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){let e=new Map;return e.set("clear",{process:(t,n,i)=>{if(n){C(C4(i),21);let s=this.pendingClearMessageIds.shift();C(s===i.pendingMessageId,763);return}if(this.pendingKeys.size!==0){this.clearExceptPendingKeys();return}this.clearCore(n)},submit:(t,n)=>{C(C4(n),764);let i=this.pendingClearMessageIds.shift();C(i===n.pendingMessageId,765),this.submitMapClearMessage(t,n.previousMap)},getStashedOpLocalMetadata:t=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(t,n,i)=>{this.needProcessKeyOperation(t,n,i)&&this.deleteCore(t.key,n)},submit:(t,n)=>{this.resubmitMapKeyMessage(t,n)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e.set("set",{process:(t,n,i)=>{if(!this.needProcessKeyOperation(t,n,i))return;let s=this.makeLocal(t.key,t.value);this.setCore(t.key,s,n)},submit:(t,n)=>{this.resubmitMapKeyMessage(t,n)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e}getMapClearMessageId(){let e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){let n={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,n)}getMapKeyMessageId(e){let t=++this.pendingMessageId,n=this.pendingKeys.get(e.key);return n!==void 0?n.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){let n=this.getMapKeyMessageId(e),i=t?{type:"edit",pendingMessageId:n,previousValue:t}:{type:"add",pendingMessageId:n};this.submitMessage(e,i)}resubmitMapKeyMessage(e,t){C(Ag(t),766);let n=this.pendingKeys.get(e.key);C(n!==void 0&&n[0]===t.pendingMessageId,767),n.shift(),n.length===0&&this.pendingKeys.delete(e.key);let i=this.getMapKeyMessageId(e),s=t.type==="edit"?{type:"edit",pendingMessageId:i,previousValue:t.previousValue}:{type:"add",pendingMessageId:i};this.submitMessage(e,s)}};var bh="1.4.0";var E4,_4="header",$r=class r{get type(){return r.Type}get attributes(){return r.Attributes}load(e,t,n,i){return y(this,null,function*(){let s=new wi(t,e,i);return yield s.load(n),s})}create(e,t){let n=new wi(t,e,r.Attributes);return n.initializeLocal(),n}};$r.Type="https://graph.microsoft.com/types/map";$r.Attributes={type:$r.Type,snapshotFormatVersion:"0.2",packageVersion:bh};var wi=class extends Co{constructor(e,t,n){super(e,t,n,"fluid_map_"),this[E4]="SharedMap",this.kernel=new yh(this.serializer,this.handle,(i,s)=>this.submitLocalMessage(i,s),()=>this.isAttached(),this)}static create(e,t){return e.createChannel(t,$r.Type)}static getFactory(){return new $r}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(E4=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let n=0,i=0,s={},o=[],a=new mt,c=this.kernel.getSerializedStorage(e),l=8*1024,d=16*1024;for(let u of Object.keys(c)){let f=c[u];if(f.value&&f.value.length>=l){let g=`blob${i}`;i++,o.push(g);let m={[u]:{type:f.type,value:JSON.parse(f.value)}};a.addBlob(g,JSON.stringify(m))}else{if(n+=f.type.length+21,f.value&&(n+=f.value.length),n>d){let g=`blob${i}`;i++,o.push(g),a.addBlob(g,JSON.stringify(s)),s={},n=0}s[u]={type:f.type,value:f.value===void 0?void 0:JSON.parse(f.value)}}}let h={blobs:o,content:s};return a.addBlob(_4,JSON.stringify(h)),a.getSummaryTree()}loadCore(e){return y(this,null,function*(){let t=yield We(e,_4),n=t;Array.isArray(n.blobs)?(this.kernel.populateFromSerializable(n.content),yield Promise.all(n.blobs.map(i=>y(this,null,function*(){let s=yield We(e,i);this.kernel.populateFromSerializable(s)})))):this.kernel.populateFromSerializable(t)})}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,n){e.type===Sa.Operation&&this.kernel.tryProcessMessage(e.contents,t,n)}rollback(e,t){this.kernel.rollback(e,t)}};te();at();var R4=ye(D4());var F4,P4,mr=R4.posix,I4="header",Rn=class r{get type(){return r.Type}get attributes(){return r.Attributes}load(e,t,n,i){return y(this,null,function*(){let s=new Ci(t,e,i);return yield s.load(n),s})}create(e,t){let n=new Ci(t,e,r.Attributes);return n.initializeLocal(),n}};Rn.Type="https://graph.microsoft.com/types/directory";Rn.Attributes={type:Rn.Type,snapshotFormatVersion:"0.1",packageVersion:bh};var Ci=class extends Co{constructor(e,t,n){super(e,t,n,"fluid_directory_"),this[F4]="SharedDirectory",this.root=new xh(this,this.runtime,this.serializer,mr.sep),this.messageHandlers=new Map,this.localValueMaker=new Eo(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",(i,s)=>{this.emit("containedValueChanged",i,s,this)}),this.root.on("subDirectoryCreated",(i,s)=>{this.emit("subDirectoryCreated",i,s,this)}),this.root.on("subDirectoryDeleted",(i,s)=>{this.emit("subDirectoryDeleted",i,s,this)})}static create(e,t){return e.createChannel(t,Rn.Type)}static getFactory(){return new Rn}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(F4=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){let t=this.makeAbsolute(e);if(t===mr.sep)return this.root;let n=this.root,i=t.substr(1).split(mr.sep);for(let s of i)if(n=n.getSubDirectory(s),!n)return;return n}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){let n=e,i=this.messageHandlers.get(n.type);C(i!==void 0,13),i.submit(n,t)}loadCore(e){return y(this,null,function*(){let t=yield We(e,I4),n=t;Array.isArray(n.blobs)?(this.populate(n.content),yield Promise.all(n.blobs.map(i=>y(this,null,function*(){let s=yield We(e,i);this.populate(s)})))):this.populate(t)})}populate(e){let t=[];for(t.push([this.root,e]);t.length>0;){let[n,i]=t.pop();if(i.subdirectories)for(let[s,o]of Object.entries(i.subdirectories)){let a=n.getSubDirectory(s);a||(a=new xh(this,this.runtime,this.serializer,mr.join(n.absolutePath,s)),n.populateSubDirectory(s,a)),t.push([a,o])}if(i.storage)for(let[s,o]of Object.entries(i.storage)){let a=this.makeLocal(s,n.absolutePath,o);n.populateStorage(s,a)}}}processCore(e,t,n){if(e.type===Sa.Operation){let i=e.contents,s=this.messageHandlers.get(i.type);C(s!==void 0,14),s.process(i,t,n)}}rollback(e,t){let n=e,i=this.getWorkingDirectory(n.path);i&&i.rollback(n,t)}makeAbsolute(e){return mr.resolve(mr.sep,e)}makeLocal(e,t,n){return C(n.type===It[It.Plain]||n.type===It[It.Shared],484),this.localValueMaker.fromSerializable(n)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,n)=>{let i=this.getWorkingDirectory(e.path);i&&i.processClearMessage(e,t,n)},submit:(e,t)=>{let n=this.getWorkingDirectory(e.path);n&&n.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,n)=>{let i=this.getWorkingDirectory(e.path);i&&i.processDeleteMessage(e,t,n)},submit:(e,t)=>{let n=this.getWorkingDirectory(e.path);n&&n.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,n)=>{let i=this.getWorkingDirectory(e.path);if(i){let s=t?void 0:this.makeLocal(e.key,e.path,e.value);i.processSetMessage(e,s,t,n)}},submit:(e,t)=>{let n=this.getWorkingDirectory(e.path);n&&n.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,n)=>{let i=this.getWorkingDirectory(e.path);i&&i.processCreateSubDirectoryMessage(e,t,n)},submit:(e,t)=>{let n=this.getWorkingDirectory(e.path);n&&n.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,n)=>{let i=this.getWorkingDirectory(e.path);i&&i.processDeleteSubDirectoryMessage(e,t,n)},submit:(e,t)=>{let n=this.getWorkingDirectory(e.path);n&&n.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,n){let s=new mt,o=0,a=[],c=[],l={};for(c.push([e,l]);c.length>0;){let[h,u]=c.pop();for(let[f,g]of h.getSerializedStorage(t)){u.storage||(u.storage={});let m={type:g.type,value:g.value&&JSON.parse(g.value)};if(g.value&&g.value.length>=8192){let b={},v=b;if(h.absolutePath!==mr.sep)for(let _ of h.absolutePath.substr(1).split(mr.sep)){let A={};v.subdirectories={[_]:A},v=A}v.storage={[f]:m};let x=`blob${o}`;o++,a.push(x),s.addBlob(x,JSON.stringify(b))}else u.storage[f]=m}for(let[f,g]of h.subdirectories()){u.subdirectories||(u.subdirectories={});let m={};u.subdirectories[f]=m,c.push([g,m])}}let d={blobs:a,content:l};return s.addBlob(I4,JSON.stringify(d)),s.getSummaryTree()}};function Dg(r){return r!==void 0&&typeof r.pendingMessageId=="number"&&r.type==="edit"}function O4(r){return r!==void 0&&r.type==="clear"&&typeof r.pendingMessageId=="number"&&typeof r.previousStorage=="object"}function N4(r){return r!==void 0&&typeof r.pendingMessageId=="number"&&(r.type==="createSubDir"&&typeof r.previouslyExisted=="boolean"||r.type==="deleteSubDir")}function Pq(r){return r!==void 0&&typeof r.pendingMessageId=="number"&&(r.type==="edit"||r.type==="deleteSubDir"||r.type==="clear"&&typeof r.previousStorage=="object"||r.type==="createSubDir"&&typeof r.previouslyExisted=="boolean")}var xh=class r extends be{constructor(e,t,n,i){super(),this.directory=e,this.runtime=t,this.serializer=n,this.absolutePath=i,this._deleted=!1,this[P4]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new ve("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),(t=this._storage.get(e))===null||t===void 0?void 0:t.value}set(e,t){if(this.throwIfDisposed(),e==null)throw new Error("Undefined and null keys are not supported");let n=this.directory.localValueMaker.fromInMemory(t),i=dc(n,this.serializer,this.directory.handle),s=this.setCore(e,n,!0);if(!this.directory.isAttached())return this;let o={key:e,path:this.absolutePath,type:"set",value:i};return this.submitKeyMessage(o,s),this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),e==null)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(mr.sep))throw new Error(`SubDirectory name may not contain ${mr.sep}`);let t=this.createSubDirectoryCore(e,!0),n=this._subdirectories.get(e);if(!this.directory.isAttached())return n;let i={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(i,!t),n}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();let t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return t!==void 0;let n={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(n,t),t!==void 0}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();let t=this.deleteCore(e,!0);if(!this.directory.isAttached())return t!==void 0;let n={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(n,t),t!==void 0}clear(){if(this.throwIfDisposed(),!this.directory.isAttached()){this.clearCore(!0);return}let e=new Map(this._storage);this.clearCore(!0);let t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}forEach(e){this.throwIfDisposed(),this._storage.forEach((t,n,i)=>{e(t.value,n,i)})}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();let e=this._storage.entries();return{next(){let n=e.next();return n.done?{value:void 0,done:!0}:{value:[n.value[0],n.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();let e=this._storage.values();return{next(){let n=e.next();return n.done?{value:void 0,done:!0}:{value:n.value.value,done:!1}},[Symbol.iterator](){return this}}}[(P4=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,n){if(this.throwIfDisposed(),t){C(O4(n),15);let i=this.pendingClearMessageIds.shift();C(i===n.pendingMessageId,810);return}this.clearExceptPendingKeys()}processDeleteMessage(e,t,n){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,n)&&this.deleteCore(e.key,t)}processSetMessage(e,t,n,i){this.throwIfDisposed(),this.needProcessStorageOperation(e,n,i)&&this.setCore(e.key,t,n)}processCreateSubDirectoryMessage(e,t,n){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,n)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,n){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,n)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();let n=++this.pendingMessageId;this.pendingClearMessageIds.push(n);let i={type:"clear",pendingMessageId:n,previousStorage:t};this.directory.submitDirectoryMessage(e,i)}resubmitClearMessage(e,t){C(O4(t),811);let n=this.pendingClearMessageIds.shift();C(n===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){let t=++this.pendingMessageId,n=this.pendingKeys.get(e.key);return n!==void 0?n.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();let i={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,i)}resubmitKeyMessage(e,t){C(Dg(t),813);let n=this.pendingKeys.get(e.key);C(n!==void 0&&n[0]===t.pendingMessageId,814),n.shift(),n.length===0&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){let t=++this.pendingMessageId,n=this.pendingSubDirectories.get(e.subdirName);return n!==void 0?n.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();let i={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,i)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();let i={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,i)}resubmitSubDirectoryMessage(e,t){C(N4(t),815);let n=this.pendingSubDirectories.get(e.subdirName);C(n!==void 0&&n[0]===t.pendingMessageId,816),n.shift(),n.length===0&&this.pendingSubDirectories.delete(e.subdirName),t.type==="createSubDir"?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(let[t,n]of this._storage){let i=n.makeSerialized(e,this.directory.handle);yield[t,i]}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,n){let i=e.get(t),s=i?.pop();if(!i||s!==n)throw new Error("Rollback op does not match last pending");i.length===0&&e.delete(t)}rollback(e,t){if(!Pq(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){t.previousStorage.forEach((i,s)=>{this.setCore(s,i,!0)});let n=this.pendingClearMessageIds.pop();if(n===void 0||n!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if((e.type==="delete"||e.type==="set")&&t.type==="edit")t.previousValue===void 0?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId);else if(e.type==="createSubDirectory"&&t.type==="createSubDir")t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else if(e.type==="deleteSubDirectory"&&t.type==="deleteSubDir")t.subDirectory!==void 0&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else throw new Error("Unsupported op for rollback")}makeAbsolute(e){return mr.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,n){if(this.pendingClearMessageIds.length>0)return t&&C(n!==void 0&&Dg(n)&&n.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){C(n!==void 0&&Dg(n),17);let s=this.pendingKeys.get(e.key);C(s!==void 0&&s[0]===n.pendingMessageId,817),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,n){if(this.pendingSubDirectories.get(e.subdirName)!==void 0){if(t){C(N4(n),18);let s=this.pendingSubDirectories.get(e.subdirName);C(s!==void 0&&s[0]===n.pendingMessageId,818),s.shift(),s.length===0&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){let e=new Map;this.pendingKeys.forEach((t,n,i)=>{e.set(n,this._storage.get(n))}),this.clearCore(!1),e.forEach((t,n,i)=>{this.setCore(n,t,!0)})}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){let n=this._storage.get(e),i=n?.value;if(this._storage.delete(e)){let o={key:e,path:this.absolutePath,previousValue:i};this.directory.emit("valueChanged",o,t,this.directory);let a={key:e,previousValue:i};this.emit("containedValueChanged",a,t,this)}return n}setCore(e,t,n){let i=this._storage.get(e),s=i?.value;this._storage.set(e,t);let o={key:e,path:this.absolutePath,previousValue:s};this.directory.emit("valueChanged",o,n,this.directory);let a={key:e,previousValue:s};return this.emit("containedValueChanged",a,n,this),i}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){let n=mr.join(this.absolutePath,e),i=new r(this.directory,this.runtime,this.serializer,n);return this.registerEventsOnSubDirectory(i,e),this._subdirectories.set(e,i),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",(n,i)=>{this.emit("subDirectoryCreated",mr.join(t,n),i,this)}),e.on("subDirectoryDeleted",(n,i)=>{this.emit("subDirectoryDeleted",mr.join(t,n),i,this)})}deleteSubDirectoryCore(e,t){let n=this._subdirectories.get(e);return n!==void 0&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(n),this.emit("subDirectoryDeleted",e,t,this)),n}disposeSubDirectoryTree(e){if(!e)return;let t=e.subdirectories();for(let[n,i]of t)this.disposeSubDirectoryTree(i);typeof e.dispose=="function"&&e.dispose()}undeleteSubDirectoryTree(e){for(let[t,n]of this._subdirectories.entries())this.undeleteSubDirectoryTree(n);e.undispose()}};var Fg="IFluidDependencySynthesizer";var To=class r{constructor(...e){this.providers=new Map,this.parents=e.filter(t=>t!==void 0)}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){let n={};return this.generateRequired(n,t),this.generateOptional(n,e),Object.defineProperty(n,Fg,{get:()=>this}),n}has(e,t){return this.providers.has(e)?!0:t!==!0?this.parents.some(n=>n.has(e)):!1}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(let t of this.parents){if(t instanceof r)return t.getProvider(e);{let n=t;if(n?.getProvider!==void 0)return n.getProvider(e)}}}}generateRequired(e,t){if(t!==void 0)for(let n of Object.keys(t)){let i=this.resolveProvider(n);if(i===void 0)throw new Error(`Object attempted to be created without registered required provider ${n}`);Object.defineProperty(e,n,i)}}generateOptional(e,t){var n;if(t!==void 0)for(let i of Object.keys(t)){let s=(n=this.resolveProvider(i))!==null&&n!==void 0?n:{get:()=>y(this,null,function*(){})};Object.defineProperty(e,i,s)}}resolveProvider(e){let t=this.providers.get(e);if(t===void 0){for(let n of this.parents){let i={[e]:e},s=n.synthesize(i,{}),o=Object.getOwnPropertyDescriptor(s,e);if(o!==void 0)return o}return}return typeof t=="function"?{get(){if(t&&typeof t=="function")return Promise.resolve(this[Fg]).then(n=>y(this,null,function*(){return t(n)})).then(n=>n?.[e])}}:{get(){if(t)return Promise.resolve(t).then(n=>{if(n)return n[e]})}}}};at();te();te();var Pg=class{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){C(!1,202)}get(){return y(this,null,function*(){let e=yield this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});if(e.status===200&&e.mimeType==="fluid/object")return e.value;throw new Error(`Failed to resolve container path ${this.absolutePath}`)})}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}};function k4(r,e){return new Pg(r,e)}at();var Ig=class{constructor(){this.handlers=[]}pushHandler(...e){e!==void 0&&this.handlers.push(...e)}handleRequest(e,t){return y(this,null,function*(){let n=hr.create(e);for(let i of this.handlers){let s=yield i(n,t);if(s!==void 0)return s}return Et(e)})}};function M4(...r){let e=new Ig;return e.pushHandler(...r),(t,n)=>y(this,null,function*(){return e.handleRequest(t,n)})}var B4="_services";at();var q4=r=>(e,t)=>y(void 0,null,function*(){let n=hr.create(e);if(n.pathParts.length===0)return t.IFluidHandleContext.resolveHandle({url:`/${r}${n.query}`,headers:e.headers})});function L4(r,e){return e.url===""||e.url==="/"||e.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:r}:Et(e)}var es=class extends Kn{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,C(this.runtime._dataObject===void 0,189),this.runtime._dataObject=this,this.innerHandle=new kr(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",()=>{this._disposed=!0,this.dispose()})}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static getDataObject(e){return y(this,null,function*(){let t=e._dataObject;return C(t!==void 0,188),yield t.finishInitialization(!0),t})}request(e){return y(this,null,function*(){return L4(this,e)})}finishInitialization(e){return y(this,null,function*(){return this.initializeP!==void 0?this.initializeP:(this.initializeP=this.initializeInternal(e),this.initializeP)})}initializeInternal(e){return y(this,null,function*(){var t;yield this.preInitialize(),e?(C(this.initProps===void 0,190),yield this.initializingFromExisting()):yield this.initializingFirstTime((t=this.context.createProps)!==null&&t!==void 0?t:this.initProps),yield this.hasInitialized()})}getFluidObjectFromDirectory(e,t,n){return y(this,null,function*(){let i=n?n(e,t):t.get(e),s=i?.IFluidHandle;if(s)return s.get()})}getService(e){return y(this,null,function*(){return k4(`/${B4}/${e}`,this.context.containerRuntime).get()})}preInitialize(){return y(this,null,function*(){})}initializingFirstTime(e){return y(this,null,function*(){})}initializingFromExisting(){return y(this,null,function*(){})}hasInitialized(){return y(this,null,function*(){})}dispose(){super.dispose()}};var ts=class r extends es{constructor(){super(...arguments),this.rootDirectoryId="root"}request(e){return y(this,null,function*(){let t=hr.create(e);if(t.pathParts[0]==="bigBlobs"){let i=this.root.get(t.pathParts.join("/"));return i===void 0?Et(t):{mimeType:"fluid/object",status:200,value:i}}else return qr(r.prototype,this,"request").call(this,t)})}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}initializeInternal(e){return y(this,null,function*(){e?(this.internalRoot=yield this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===$r.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=Ci.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),yield qr(r.prototype,this,"initializeInternal").call(this,e)})}getUninitializedErrorString(e){return`${e} must be initialized before being accessed.`}};function j4(r,e,t,n,i,s,o){return y(this,null,function*(){let a=i;a=X_((f,g)=>y(this,null,function*(){return(yield es.getDataObject(g)).request(f)}),a);let c=new a(e,t,s),l=e.scope,h=new To(l.IFluidDependencySynthesizer).synthesize(n,{}),u=new r({runtime:c,context:e,providers:h,initProps:o});return s||(yield u.finishInitialization(s)),{instance:u,runtime:c}})}var Sh=class{constructor(e,t,n,i,s,o=Zi){if(this.type=e,this.ctor=t,this.optionalProviders=i,this.runtimeClass=o,this.type==="")throw new Error("undefined type member");s!==void 0&&(this.registry=new Pn(s)),this.sharedObjectRegistry=new Map(n.map(a=>[a.type,a]))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}instantiateDataStore(e,t){return y(this,null,function*(){let{runtime:n}=yield j4(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,t);return n})}createChildInstance(e,t){return y(this,null,function*(){return this.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,this.type],t)})}createPeerInstance(e,t){return y(this,null,function*(){return this.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)})}createInstance(e,t){return y(this,null,function*(){return this.createNonRootInstanceCore(e,[this.type],t)})}createRootInstance(e,t,n){return y(this,null,function*(){let i=t.createDetachedRootDataStore([this.type],e);return this.createInstanceCore(i,n)})}createNonRootInstanceCore(e,t,n){return y(this,null,function*(){let i=e.createDetachedDataStore(t);return this.createInstanceCore(i,n)})}createInstanceCore(e,t){return y(this,null,function*(){let{instance:n,runtime:i}=yield j4(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,t);return yield e.attachRuntime(this,i),n})}};var Ao=class extends Sh{constructor(e,t,n=[],i,s,o=Zi){let a=[...n];n.find(c=>c.type===Rn.Type)||a.push(Ci.getFactory()),n.find(c=>c.type===$r.Type)||a.push(wi.getFactory()),super(e,t,a,i,s,o)}};var V4=ye(H4());at();var Ch=class extends Xa{constructor(e,t,n=[],i){super(),this.registryEntries=e,this.dependencyContainer=t,this.requestHandlers=n,this.runtimeOptions=i,this.registry=new Pn(e)}get IFluidDataStoreRegistry(){return this.registry}instantiateFirstTime(e){return y(this,null,function*(){yield this.containerInitializingFirstTime(e),yield this.containerHasInitialized(e)})}instantiateFromExisting(e){return y(this,null,function*(){yield this.containerHasInitialized(e)})}preInitialize(e,t){return y(this,null,function*(){let n=e.scope,i=new To(this.dependencyContainer,n.IFluidDependencySynthesizer);n.IFluidDependencySynthesizer=i;let s=yield hc.load(e,this.registryEntries,M4(...this.requestHandlers),this.runtimeOptions,n,t);return i.register(V4.IContainerRuntime,s),s})}containerInitializingFirstTime(e){return y(this,null,function*(){})}containerHasInitialized(e){return y(this,null,function*(){})}};var W4=ye(Tr());at();var Og=r=>r?.factory!==void 0,Ng=r=>r?.getFactory!==void 0,U4=r=>{var e;let t=new Set,n=new Set,i=o=>{if(Ng(o))n.add(o.getFactory());else if(Og(o))t.add([o.factory.type,Promise.resolve(o.factory)]);else throw new Error("Entry is neither a DataObject or a SharedObject")};if(new Set([...Object.values(r.initialObjects),...(e=r.dynamicObjectTypes)!==null&&e!==void 0?e:[]]).forEach(i),t.size===0&&n.size===0)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(t),Array.from(n)]};var Rg=class extends ts{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get initialObjectsDir(){let e=this.root.getSubDirectory(this.initialObjectsDirKey);if(e===void 0)throw new Error("InitialObjects sub-directory was not initialized");return e}initializingFirstTime(e){return y(this,null,function*(){this.root.createSubDirectory(this.initialObjectsDirKey);let t=[];Object.entries(e.initialObjects).forEach(([n,i])=>{let s=()=>y(this,null,function*(){let o=yield this.create(i);this.initialObjectsDir.set(n,o.handle)});t.push(s())}),yield Promise.all(t)})}hasInitialized(){return y(this,null,function*(){let e=[];for(let[t,n]of Array.from(this.initialObjectsDir.entries())){let i=()=>y(this,null,function*(){let s=yield n.get();Object.assign(this._initialObjects,{[t]:s})});e.push(i())}yield Promise.all(e)})}get initialObjects(){if(Object.keys(this._initialObjects).length===0)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}create(e){return y(this,null,function*(){if(Og(e))return this.createDataObject(e);if(Ng(e))return this.createSharedObject(e);throw new Error("Could not create new Fluid object because an unknown object was passed")})}createDataObject(e){return y(this,null,function*(){let t=e.factory,n=[...this.context.packagePath,t.type],i=yield this.context.containerRuntime.createDataStore(n);return un(i,"/")})}createSharedObject(e){let t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}},G4="rootDOId",Eh=class extends Ch{constructor(e){let[t,n]=U4(e),i=new Ao("rootDO",Rg,n,{},t);super([i.registryEntry],void 0,[q4(G4)],{flushMode:W4.FlushMode.Immediate}),this.rootDataObjectFactory=i,this.initialObjects=e.initialObjects}containerInitializingFirstTime(e){return y(this,null,function*(){yield this.rootDataObjectFactory.createRootInstance(G4,e,{initialObjects:this.initialObjects})})}};te();var _h=class extends be{constructor(e){super(),this.container=e,this.lastMembers=new Map,this.audience=e.audience,this.getMembers(),this.audience.on("addMember",(t,n)=>{if(this.shouldIncludeAsMember(n)){let i=this.getMember(t);this.emit("memberAdded",t,i),this.emit("membersChanged")}}),this.audience.on("removeMember",t=>{this.lastMembers.has(t)&&(this.emit("memberRemoved",t,this.lastMembers.get(t)),this.emit("membersChanged"))}),this.container.on("connected",()=>this.emit("membersChanged"))}getMembers(){let e=new Map,t=new Map;return this.audience.getMembers().forEach((n,i)=>{if(this.shouldIncludeAsMember(n)){let s=n.user.id,o=e.get(s);o===void 0&&(o=this.createServiceMember(n),e.set(s,o)),o.connections.push({id:i,mode:n.mode}),t.set(i,o)}}),this.lastMembers=t,e}getMyself(){let e=this.container.clientId;if(e!==void 0)return this.getMember(e)}getMember(e){let t=this.audience.getMember(e);if(t===void 0)return;let i=this.getMembers().get(t?.user.id);if(i===void 0)throw Error(`Attempted to fetch client ${e} that is not part of the current member list`);return i}shouldIncludeAsMember(e){return e.details.capabilities.interactive}};var Th=class extends _h{createServiceMember(e){let t=e.user;return ap(t?.name!==void 0,'Provided user was not an "AzureUser".'),{userId:e.user.id,userName:t.name,connections:[],additionalDetails:t.additionalDetails}}};Pt();var Oe=function(r){return r[r.Disconnected=0]="Disconnected",r[r.EstablishingConnection=3]="EstablishingConnection",r[r.Connecting=1]="Connecting",r[r.CatchingUp=1]="CatchingUp",r[r.Connected=2]="Connected",r}(Oe||{});var Y3=ye(B3());Dt();te();Pt();Tn();var sr=function(r){return r.NoOp="noop",r.ClientJoin="join",r.ClientLeave="leave",r.Propose="propose",r.Reject="reject",r.Summarize="summarize",r.SummaryAck="summaryAck",r.SummaryNack="summaryNack",r.Operation="op",r.RemoteHelp="remoteHelp",r.NoClient="noClient",r.RoundTrip="tripComplete",r.Control="control",r}(sr||{});var gr=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(gr||{});var Ah=function(r){return r.DocRead="doc:read",r.DocWrite="doc:write",r.SummaryWrite="summary:write",r}(Ah||{});xe();var q3=ye(Wn());var Dh=class extends q3.EventEmitter{constructor(){super(...arguments),this.members=new Map}on(e,t){return super.on(e,t)}addMember(e,t){this.members.set(e,t),this.emit("addMember",e,t)}removeMember(e){let t=this.members.get(e);return t!==void 0?(this.members.delete(e),this.emit("removeMember",e,t),!0):!1}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}clear(){let e=this.members.keys();for(let t of e)this.removeMember(t)}};te();Pt();xe();var X7="Code package does not implement IRuntimeFactory",Fh=class r{constructor(e,t,n,i,s,o,a,c,l,d,h,u,f,g,m){this.container=e,this.scope=t,this.codeLoader=n,this._codeDetails=i,this._baseSnapshot=s,this.deltaManager=o,this.loader=c,this.submitFn=l,this.submitSignalFn=d,this.closeFn=h,this.version=u,this.updateDirtyContainerState=f,this.existing=g,this.pendingLocalState=m,this._disposed=!1,this._quorum=a,this.taggedLogger=e.subLogger,this._fluidModuleP=new At(()=>y(this,null,function*(){return this.loadCodeModule(i)})),this.attachListener()}static createOrLoad(e,t,n,i,s,o,a,c,l,d,h,u,f,g,m){return y(this,null,function*(){let b=new r(e,t,n,i,s,o,a,c,l,d,h,u,f,g,m);return yield b.instantiateRuntime(g),b})}get clientId(){return this.container.clientId}get id(){let e=this.container.resolvedUrl;return Ga(e)?e.id:""}get clientDetails(){return this.container.clientDetails}get connected(){return this.container.connected}get canSummarize(){return"summarize"in this.runtime}get serviceConfiguration(){return this.container.serviceConfiguration}get audience(){return this.container.audience}get options(){return this.container.options}get baseSnapshot(){return this._baseSnapshot}get storage(){return this.container.storage}get runtime(){if(this._runtime===void 0)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get disposed(){return this._disposed}get codeDetails(){return this._codeDetails}get quorum(){return this._quorum}getSpecifiedCodeDetails(){var e;return(e=this._quorum.get("code"))!==null&&e!==void 0?e:this._quorum.get("code2")}dispose(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}getLoadedFromVersion(){return this.container.loadedFromVersion}get attachState(){return this.container.attachState}createSummary(e){return this.runtime.createSummary(e)}setConnectionState(e,t){let n=this.runtime;C(e===this.connected,222),n.setConnectionState(e,t)}process(e,t,n){this.runtime.process(e,t,n)}processSignal(e,t){this.runtime.processSignal(e,t)}request(e){return y(this,null,function*(){return this.runtime.request(e)})}getAbsoluteUrl(e){return y(this,null,function*(){return this.container.getAbsoluteUrl(e)})}getPendingLocalState(){return this.runtime.getPendingLocalState()}satisfies(e){return y(this,null,function*(){var t;let n=[],i=this.codeLoader;i.IFluidCodeDetailsComparer!==void 0&&n.push(i.IFluidCodeDetailsComparer);let s=yield this._fluidModuleP,o=(t=s.module)===null||t===void 0?void 0:t.fluidExport;if(o?.IFluidCodeDetailsComparer!==void 0&&n.push(o.IFluidCodeDetailsComparer),n.length===0)return!1;for(let a of n)if((yield a.satisfies(s.details,e))===!1)return!1;return!0})}notifyAttaching(e){var t,n;this._baseSnapshot=e,(n=(t=this.runtime).notifyAttaching)===null||n===void 0||n.call(t,e),this.runtime.setAttachState(se.Attaching)}getRuntimeFactory(){return y(this,null,function*(){var e;let t=(e=(yield this._fluidModuleP).module)===null||e===void 0?void 0:e.fluidExport,n=t?.IRuntimeFactory;if(n===void 0)throw new Error(X7);return n})}instantiateRuntime(e){return y(this,null,function*(){let t=yield this.getRuntimeFactory();this._runtime=yield t.instantiateRuntime(this,e)})}attachListener(){this.container.once("attached",()=>{this.runtime.setAttachState(se.Attached)})}loadCodeModule(e){return y(this,null,function*(){let t=yield ce.timedExecAsync(this.taggedLogger,{eventName:"CodeLoad"},()=>y(this,null,function*(){return this.codeLoader.load(e)}));if("module"in t){let{module:n,details:i}=t;return{module:n,details:i??e}}else return this.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),t})}};Pt();var Xt=function(r){return r.Never="Never",r.Disabled="Disabled",r.Enabled="Enabled",r}(Xt||{}),L3=r=>{let e;return r&&"name"in r?e=r:mo(r?.package)?e=r?.package.name:e=r?.package,{name:e}};var Lg=ye(qg());Dt();te();xe();te();var z3=ye(ug());var ns=class extends be{constructor(e){super(),this.worker=e,this.isDisposed=!1,this.q=new z3.default,this.pauseCount=1}get disposed(){return this.isDisposed}get paused(){return this.pauseCount!==0}get length(){return this.q.length}get idle(){return this.processingPromise===void 0&&this.q.length===0}waitTillProcessingDone(){return y(this,null,function*(){var e;return(e=this.processingPromise)!==null&&e!==void 0?e:{count:0,duration:0}})}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(t){this.emit("error",t)}}pause(){return y(this,null,function*(){this.pauseCount++,yield this.waitTillProcessingDone()})}resume(){C(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&this.processingPromise===void 0&&(this.processingPromise=Promise.resolve().then(()=>{C(this.processingPromise!==void 0,"reentrancy?");let e=this.processDeltas();return C(this.processingPromise!==void 0,"reentrancy?"),this.processingPromise=void 0,e}).catch(e=>(this.error=e,this.processingPromise=void 0,this.emit("error",e),{count:0,duration:0})),C(this.processingPromise!==void 0,"processDeltas() should run async"))}anythingToProcess(){return this.q.length!==0&&!this.paused&&this.error===void 0}processDeltas(){let e=le.now(),t=0;for(;this.anythingToProcess();){let i=this.q.shift();t++,this.worker(i),this.emit("op",i)}let n=le.now()-e;return this.q.length===0&&this.emit("idle",t,n),{count:t,duration:n}}};var Ih=class extends be{constructor(e,t,n,i){super(),this.serviceProvider=e,this.logger=t,this._active=n,this.pending=[],this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.baseTerm=0,this.opsSize=0,this.initSequenceNumber=0,this.closed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new Lg.default,this.deltaStorageDelayId=Te(),this.deltaStreamDelayId=Te(),this.messageBuffer=[];let s={incomingOpHandler:(o,a)=>{try{this.enqueueMessages(o,a)}catch(c){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},c),this.close($t(c))}},signalHandler:o=>this._inboundSignal.push(o),reconnectionDelayHandler:(o,a)=>this.emitDelayInfo(this.deltaStreamDelayId,o,a),closeHandler:o=>this.close(o),disconnectHandler:o=>this.disconnectHandler(o),connectHandler:o=>this.connectHandler(o),pongHandler:o=>this.emit("pong",o),readonlyChangeHandler:o=>Ep(this,this.logger,"readonly",o)};this.connectionManager=i(s),this._inbound=new ns(o=>{this.processInboundMessage(o)}),this._inbound.on("error",o=>{this.close(gt.wrapIfUnrecognized(o,"deltaManagerInboundErrorHandler",this.lastMessage))}),this._inboundSignal=new ns(o=>{if(this.handler===void 0)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({clientId:o.clientId,content:JSON.parse(o.content)})}),this._inboundSignal.on("error",o=>{this.close($t(o))})}get active(){return this._active()}get disposed(){return this.closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get referenceTerm(){return this.baseTerm}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return C(this.connectionManager.connected,223),this._checkpointSequenceNumber!==void 0}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(e,t,n=!1,i){let s={contents:JSON.stringify(t),metadata:i,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};n||this.flush();let o=this.connectionManager.prepareMessageToSend(s);return o===void 0?-1:(this.opsSize+=o.contents.length,this.messageBuffer.push(o),this.emit("submitOp",o),n||this.flush(),o.clientSequenceNumber)}submitSignal(e){return this.connectionManager.submitSignal(e)}flush(){this.messageBuffer.length!==0&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}get connectionProps(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}logConnectionIssue(e){var t;C(this.connectionManager.connected,568);let n=this.pending.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:(t=n[0])===null||t===void 0?void 0:t.sequenceNumber,haveHandler:this.handler!==void 0,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}connectHandler(e){this.refreshDelayInfo(this.deltaStreamDelayId);let t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;let n=e.checkpointSequenceNumber;this._checkpointSequenceNumber=n,n!==void 0&&this.updateLatestKnownOpSeqNumber(n),C(this.messageBuffer.length===0,233),this.opsSize=0,this.emit("connect",e,n!==void 0?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),n!==void 0?n>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):e.mode==="read"&&this.fetchMissingDeltas("AfterReadConnection")}dispose(){throw new Error("Not implemented.")}attachOpHandler(e,t,n,i,s="none"){return y(this,null,function*(){if(this.initSequenceNumber=t,this.lastProcessedSequenceNumber=t,this.baseTerm=n,this.minSequenceNumber=e,this.lastQueuedSequenceNumber=t,this.lastObservedSeqNumber=t,C(this.handler===void 0,226),this.handler=i,C(!!this.handler,227),C(this.fetchReason===void 0,616),!this.closed){if(this._inbound.resume(),this._inboundSignal.resume(),s!=="none"){let o=s==="cached";yield this.fetchMissingDeltasCore(`DocumentOpen_${s}`,o),o&&this.fetchMissingDeltas("PostDocumentOpen")}C(this.fetchReason!==void 0||this.pending.length===0,617)}})}connect(e){var t;let n=(t=e.fetchOpsFromStorage)!==null&&t!==void 0?t:!0;Tp(this.handler!==void 0||!n,this.logger,"CantFetchWithoutBaseline"),n&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}getDeltas(e,t,n,i,s){return y(this,null,function*(){let o=this.serviceProvider();if(o===void 0)throw new Error("Delta manager is not attached");this.deltaStorage===void 0&&(this.deltaStorage=yield o.connectToDeltaStorage());let a;if(t!==void 0){let h=t-1;if(this.lastQueuedSequenceNumber>=h){this.logger.sendPerformanceEvent(Object.assign({reason:n,eventName:"ExtraStorageCall",early:!0,from:e,to:t},this.connectionManager.connectionVerboseProps));return}a=u=>u.sequenceNumber>=h}else a=h=>h.sequenceNumber>=this.lastObservedSeqNumber;let c=new Lg.default,l=!1,d=h=>{C(h.sequenceNumber===this.lastQueuedSequenceNumber,570),!l&&a(h)&&(c.abort(),this._inbound.off("push",d))};try{this._inbound.on("push",d),C(this.closeAbortController.signal.onabort===null,488),this.closeAbortController.signal.onabort=()=>c.abort();let h=this.deltaStorage.fetchMessages(e,t,c.signal,s,n);for(;;){let u=yield h.read();if(u.done)break;try{l=!0,i(u.value)}finally{l=!1}}}finally{this.closeAbortController.signal.onabort=null,this._inbound.off("push",d),C(!l,649)}})}close(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}refreshDelayInfo(e){this.throttlingIdSet.delete(e),this.throttlingIdSet.size===0&&(this.timeTillThrottling=0)}disconnectHandler(e){this.messageBuffer.length=0,this.emit("disconnect",e)}emitDelayInfo(e,t,n){let i=Date.now();if(this.throttlingIdSet.add(e),t>0&&i+t>this.timeTillThrottling){this.timeTillThrottling=i+t;let s=Fu.wrap(n,t/1e3,this.logger);this.emit("throttled",s)}}comparableMessagePayload(e){return`${e.clientId}-${e.type}-${e.minimumSequenceNumber}-${e.referenceSequenceNumber}-${e.timestamp}`}enqueueMessages(e,t,n=!1){var i,s;if(this.handler===void 0){this.pending=this.pending.concat(e);return}if(C(this.pending.length===0||this.fetchReason!==void 0,489),e.length===0)return;let o=e[0].sequenceNumber,a=e[e.length-1].sequenceNumber;if(a>this.lastQueuedSequenceNumber){let l=o-1,d=l-this.lastQueuedSequenceNumber,h,u=0,f=0;for(let m of e)m.sequenceNumber===l?u++:m.sequenceNumber!==l+1&&(f++,h===void 0&&(h=l+1)),l=m.sequenceNumber;let g;u!==0||f!==0&&!n||d>0&&this.fetchReason===void 0?g="enqueueMessages":this.fetchReason!==void 0&&this.fetchReason!==t&&o<=this.lastQueuedSequenceNumber+1&&a>this.lastQueuedSequenceNumber&&(g="enqueueMessagesExtraFetch"),g!==void 0&&this.logger.sendPerformanceEvent(Object.assign({eventName:g,reason:t,previousReason:this.prevEnqueueMessagesReason,from:o,to:a+1,length:e.length,fetchReason:this.fetchReason,duplicate:u>0?u:void 0,initialGap:d!==0?d:void 0,gap:f>0?f:void 0,firstMissing:h,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);let c=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;C(c===void 0||c===this.lastQueuedSequenceNumber,236);for(let l of e)if(l.sequenceNumber<=this.lastQueuedSequenceNumber){if(((s=this.previouslyProcessedMessage)===null||s===void 0?void 0:s.sequenceNumber)===l.sequenceNumber){let d=this.comparableMessagePayload(this.previouslyProcessedMessage),h=this.comparableMessagePayload(l);if(d!==h){let u=new Fn("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",Bt.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:l.sequenceNumber,message1:d,message2:h,driverVersion:void 0});this.close(u)}}}else l.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(l),this.fetchMissingDeltas(t,l.sequenceNumber)):(this.lastQueuedSequenceNumber=l.sequenceNumber,this.previouslyProcessedMessage=l,this._inbound.push(l));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}processInboundMessage(e){let t=Date.now();if(this.lastProcessedMessage=e,C(e.clientId!==void 0||!YE(e),237),typeof e.contents=="string"&&e.contents!==""&&e.type!==sr.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new qt("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},Wr(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new qt("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},Wr(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,C(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),e.term===void 0&&(e.term=1),this.baseTerm=e.term,this.handler===void 0)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);let n=Date.now();this.emit("op",e,n-t)}fetchMissingDeltas(e,t){this.fetchMissingDeltasCore(e,!1,t).catch(n=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},n)})}fetchMissingDeltasCore(e,t,n){return y(this,null,function*(){var i;if(this.fetchReason===void 0){if(this.closed){this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:e});return}if(this.handler===void 0){C(this.lastQueuedSequenceNumber===0,619);return}try{let s=this.lastQueuedSequenceNumber+1,o=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;o!==void 0&&(C(o===this.lastQueuedSequenceNumber,242),C(s>1,243),s--);let a=`${e}_fetch`;this.fetchReason=a,yield this.getDeltas(s,n,a,c=>{this.refreshDelayInfo(this.deltaStorageDelayId),this.enqueueMessages(c,a)},t)}catch(s){this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},s),this.close($t(s))}finally{this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(e)}}})}processPendingOps(e){if(this.closed)return;C(this.handler!==void 0,620);let t=this.pending.sort((n,i)=>n.sequenceNumber-i.sequenceNumber);this.pending=[],this.enqueueMessages(t,`${e}_pending`,!0),this.fetchReason===void 0&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}};te();var fc=class extends Kn{constructor(e){super(e),this.queue=e}get paused(){return this.queue.paused}get length(){return this.queue.length}get idle(){return this.queue.idle}peek(){return this.queue.peek()}toArray(){return this.queue.toArray()}systemPause(){return y(this,null,function*(){return this.pause()})}pause(){return y(this,null,function*(){return this.queue.pause()})}systemResume(){return y(this,null,function*(){return this.resume()})}resume(){return y(this,null,function*(){this.queue.resume()})}waitTillProcessingDone(){return y(this,null,function*(){return this.queue.waitTillProcessingDone()})}},Oh=class extends Kn{constructor(e){super(e),this.deltaManager=e,this.inbound=new fc(e.inbound),this.outbound=new fc(e.outbound),this.inboundSignal=new fc(e.inboundSignal)}get IDeltaSender(){return this}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}dispose(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),super.dispose()}submitSignal(e){return this.deltaManager.submitSignal(e)}flush(){return this.deltaManager.flush()}};Dt();Pt();xe();var H3=ye(cm());Dt();te();xe();function Nh(r){var e;let t=(0,H3.parse)(r,!0);if(typeof t.pathname!="string")throw new Re("Failed to parse pathname");let n=(e=t.search)!==null&&e!==void 0?e:"",s=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(t.pathname);return s?.length===3?{id:s[1],path:s[2],query:n,version:t.query.version}:void 0}function V3(r){let e={blobs:{},blobsContents:{},trees:{},id:Te(),unreferenced:r.unreferenced},t=Object.keys(r.tree);for(let n of t){let i=r.tree[n];switch(i.type){case gr.Tree:{e.trees[n]=V3(i);break}case gr.Attachment:e.blobs[n]=i.id;break;case gr.Blob:{let s=Te();e.blobs[n]=s;let o=typeof i.content=="string"?Er(i.content,"utf8"):op(i.content);e.blobsContents[s]=o;break}case gr.Handle:throw new Re("No handles should be there in summary in detached container!!");default:ot(i,`Unknown tree type ${i.type}`)}}return e}function Q7(r,e){let t={type:gr.Tree,tree:Object.assign({},e.tree)};return t.tree[".protocol"]=r,V3(t)}var Rh=r=>{let e=r.tree[".protocol"],t=r.tree[".app"];return C(e!==void 0&&t!==void 0,480),Q7(e,t)};function jg(r){return".protocol"in r.trees?r.trees[".protocol"]:r}var kh="1.4.0";function U3(r){return r.headers===void 0?!0:r.headers[et.cache]!==!1}var mc=class{constructor(e,t){this.container=e,this.loader=t}get IFluidRouter(){return this}resolve(e){return y(this,null,function*(){var t,n,i,s,o;if(e.url.startsWith("/")){if(U3(e))return this.container;{let a=this.container.resolvedUrl;return rr(a),yield pc.load(this.loader,{canReconnect:(t=e.headers)===null||t===void 0?void 0:t[et.reconnect],clientDetailsOverride:(n=e.headers)===null||n===void 0?void 0:n[et.clientDetails],resolvedUrl:Object.assign({},a),version:(s=(i=e.headers)===null||i===void 0?void 0:i[et.version])!==null&&s!==void 0?s:void 0,loadMode:(o=e.headers)===null||o===void 0?void 0:o[et.loadMode]})}}if(this.loader===void 0)throw new Error("Cannot resolve external containers");return this.loader.resolve(e)})}request(e){return y(this,null,function*(){return e.url.startsWith("/")?(yield this.resolve(e)).request(e):this.loader===void 0?{status:404,value:"Cannot request external containers",mimeType:"plain/text"}:this.loader.request(e)})}};function Z7(r){let e=Object.create(r),t=new Map;return e.resolve=n=>y(this,null,function*(){return U3(n)?(t.has(n.url)||t.set(n.url,r.resolve(n)),t.get(n.url)):r.resolve(n)}),e}var gc=class{constructor(e){var t,n;this.containers=new Map;let i=Object.assign({},e.scope);((t=e.options)===null||t===void 0?void 0:t.provideScopeLoader)!==!1&&(i.ILoader=this);let s={loaderId:Te(),loaderVersion:kh},o=zi(Ra.mixinDebugLogger("fluid:telemetry",e.logger,{all:s}),Ca.value,e.configProvider);this.services={urlResolver:Z7(du.create(e.urlResolver)),documentServiceFactory:hu.create(e.documentServiceFactory),codeLoader:e.codeLoader,options:(n=e.options)!==null&&n!==void 0?n:{},scope:i,subLogger:o.logger,detachedBlobStorage:e.detachedBlobStorage},this.mc=ur(ue.create(this.services.subLogger,"Loader"))}get IFluidRouter(){return this}createDetachedContainer(e){return y(this,null,function*(){let t=yield pc.createDetached(this,e);return this.cachingEnabled&&t.once("attached",()=>{rr(t.resolvedUrl);let n=Nh(t.resolvedUrl.url);n!==void 0&&this.addToContainerCache(n.id,Promise.resolve(t))}),t})}rehydrateDetachedContainerFromSnapshot(e){return y(this,null,function*(){return pc.rehydrateDetachedFromSnapshot(this,e)})}resolve(e,t){return y(this,null,function*(){let n=t===void 0?"Resolve":"ResolveWithPendingState";return ce.timedExecAsync(this.mc.logger,{eventName:n},()=>y(this,null,function*(){return(yield this.resolveCore(e,t!==void 0?JSON.parse(t):void 0)).container}))})}request(e){return y(this,null,function*(){return ce.timedExecAsync(this.mc.logger,{eventName:"Request"},()=>y(this,null,function*(){let t=yield this.resolveCore(e);return t.container.request(Object.assign(Object.assign({},e),{url:`${t.parsed.path}${t.parsed.query}`}))}))})}getKeyForContainerCache(e,t){var n;return((n=e.headers)===null||n===void 0?void 0:n[et.version])!==void 0?`${t.id}@${e.headers[et.version]}`:t.id}addToContainerCache(e,t){this.containers.set(e,t),t.then(n=>{n.closed?this.containers.delete(e):n.once("closed",()=>{this.containers.delete(e)})}).catch(n=>{})}resolveCore(e,t){return y(this,null,function*(){let n=yield this.services.urlResolver.resolve(e);rr(n);let i=Nh(n.url);if(i===void 0)throw new Error(`Invalid URL ${n.url}`);if(t!==void 0){let l=Nh(t.url);if(l?.id!==i.id||l?.path.replace(/\/$/,"")!==i.path.replace(/\/$/,"")){let d=`URL ${n.url} does not match pending state URL ${t.url}`;throw new Error(d)}}let{canCache:s,fromSequenceNumber:o}=this.parseHeader(i,e),a=t!==void 0?!1:s,c;if(a){let l=this.getKeyForContainerCache(e,i),d=yield this.containers.get(l);if(d!==void 0)c=d;else{let h=this.loadContainer(e,n);this.addToContainerCache(l,h),c=yield h}}else c=yield this.loadContainer(e,n,t);return c.deltaManager.lastSequenceNumber<=o&&(yield new Promise((l,d)=>{function h(u){u.sequenceNumber>o&&(l(),c.removeListener("op",h))}c.on("op",h)})),{container:c,parsed:i}})}get cachingEnabled(){return this.services.options.cache!==!1}canCacheForRequest(e){return this.cachingEnabled&&e[et.cache]!==!1}parseHeader(e,t){var n,i;let s=-1;t.headers=(n=t.headers)!==null&&n!==void 0?n:{};let o=t.headers[et.sequenceNumber];return o!==void 0&&(s=o),t.headers[et.version]=(i=e.version)!==null&&i!==void 0?i:t.headers[et.version],{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:s}}loadContainer(e,t,n){return y(this,null,function*(){var i,s,o,a,c;return pc.load(this,{canReconnect:(i=e.headers)===null||i===void 0?void 0:i[et.reconnect],clientDetailsOverride:(s=e.headers)===null||s===void 0?void 0:s[et.clientDetails],resolvedUrl:t,version:(a=(o=e.headers)===null||o===void 0?void 0:o[et.version])!==null&&a!==void 0?a:void 0,loadMode:(c=e.headers)===null||c===void 0?void 0:c[et.loadMode]},n)})}};te();xe();var eL=45e3,Mh=class{constructor(e,t,n){var i;this.handler=e,this.logger=t,this._clientId=n,this._connectionState=Oe.Disconnected,this.prevClientLeftTimer=new Zt((i=this.handler.maxClientLeaveWaitTime)!==null&&i!==void 0?i:3e5,()=>{C(!this.connected,684),this.applyForConnectedState("timeout")}),this.joinOpTimer=new Zt(eL,()=>{var s;if(this.connectionState!==Oe.CatchingUp)return;let o=this.handler.quorumClients(),a={quorumInitialized:o!==void 0,hasPendingClientId:this.pendingClientId!==void 0,inQuorum:o?.getMember((s=this.pendingClientId)!==null&&s!==void 0?s:"")!==void 0,waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue("NoJoinOp",a)})}get connectionState(){return this._connectionState}get connected(){return this.connectionState===Oe.Connected}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}startJoinOpTimer(){C(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}stopJoinOpTimer(){C(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){C(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=ce.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(e){var t,n;let i=this.handler.quorumClients();C(i!==void 0,566),C(this.waitingForLeaveOp===!1||this.clientId!==void 0&&i.getMember(this.clientId)!==void 0,738),this.pendingClientId!==this.clientId&&this.pendingClientId!==void 0&&i.getMember(this.pendingClientId)!==void 0&&!this.waitingForLeaveOp?((t=this.waitEvent)===null||t===void 0||t.end({source:e}),this.setConnectionState(Oe.Connected)):this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:e==="timeout"?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:i?.getMember((n=this.pendingClientId)!==null&&n!==void 0?n:"")!==void 0})})}receivedRemoveMemberEvent(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(Oe.Disconnected,e)}receivedConnectEvent(e,t){let n=this._connectionState;this._connectionState=Oe.CatchingUp;let i=e==="write";C(i||!this.handler.shouldClientJoinWrite(),778),C(i||!this.waitingForLeaveOp,678);let s=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(Oe.CatchingUp,n),i&&s?.getMember(this._pendingClientId)===void 0?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(Oe.Connected)}setConnectionState(e,t){if(this.connectionState===e){this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e});return}let n=this._connectionState;this._connectionState=e;let i=this.handler.quorumClients(),s;this._clientId!==void 0&&(s=i?.getMember(this._clientId)),e===Oe.Connected?(C(n===Oe.CatchingUp,472),s!==void 0&&(s.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===Oe.Disconnected&&(this._pendingClientId=void 0,s!==void 0&&this.handler.shouldClientJoinWrite()&&this.prevClientLeftTimer.hasTimer===!1?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:s!==void 0,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,n,t),this.handler.connectionStateChanged()}initProtocol(e){e.quorum.on("addMember",(t,n)=>{this.receivedAddMemberEvent(t)}),e.quorum.on("removeMember",t=>{this.receivedRemoveMemberEvent(t)}),this.clientId!==void 0&&e.quorum.getMember(this.clientId)!==void 0&&this.prevClientLeftTimer.restart()}};te();var Bh=class{constructor(e,t){this.internalStorageService=e,this.logger=t,this._disposed=!1}get policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}dispose(){this._disposed=!0}get repositoryUrl(){return this.internalStorageService.repositoryUrl}getSnapshotTree(e,t){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalStorageService.getSnapshotTree(e,t)}),"storage_getSnapshotTree")})}readBlob(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalStorageService.readBlob(e)}),"storage_readBlob")})}getVersions(e,t,n){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalStorageService.getVersions(e,t,n)}),"storage_getVersions")})}uploadSummaryWithContext(e,t){return y(this,null,function*(){return C(t.referenceSequenceNumber===0==(t.ackHandle===void 0),593),t.referenceSequenceNumber!==0?this.internalStorageService.uploadSummaryWithContext(e,t):this.runWithRetry(()=>y(this,null,function*(){return this.internalStorageService.uploadSummaryWithContext(e,t)}),"storage_uploadSummaryWithContext")})}downloadSummary(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalStorageService.downloadSummary(e)}),"storage_downloadSummary")})}createBlob(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalStorageService.createBlob(e)}),"storage_createBlob")})}checkStorageDisposed(){if(this._disposed)throw new ir("Storage Service is disposed. Cannot retry",{canRetry:!1})}runWithRetry(e,t){return y(this,null,function*(){return co(e,t,this.logger,{onRetry:()=>this.checkStorageDisposed()})})}};var qh=class{constructor(e,t){this.internalStorageService=e,this.generateProtocolTree=t,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}get policies(){return this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}get disposed(){return this.internalStorageService.disposed}uploadSummaryWithContext(e,t){return y(this,null,function*(){return this.internalStorageService.uploadSummaryWithContext(ao(e,this.generateProtocolTree()),t)})}};var Lh=class{constructor(e){this.storageGetter=e,this.blobContents={}}loadSnapshotForRehydratingContainer(e){this.getBlobContents(e)}getBlobContents(e){for(let[t,n]of Object.entries(e.blobsContents))this.blobContents[t]=n;for(let[t,n]of Object.entries(e.trees))this.getBlobContents(n)}get policies(){try{return this.storageGetter().policies}catch{}}get repositoryUrl(){return this.storageGetter().repositoryUrl}getSnapshotTree(e,t){return y(this,null,function*(){return this.storageGetter().getSnapshotTree(e,t)})}readBlob(e){return y(this,null,function*(){let t=this.blobContents[e];return t!==void 0?t:this.storageGetter().readBlob(e)})}getVersions(e,t,n){return y(this,null,function*(){return this.storageGetter().getVersions(e,t,n)})}uploadSummaryWithContext(e,t){return y(this,null,function*(){return this.storageGetter().uploadSummaryWithContext(e,t)})}downloadSummary(e){return y(this,null,function*(){return this.storageGetter().downloadSummary(e)})}createBlob(e){return y(this,null,function*(){return this.storageGetter().createBlob(e)})}},jh=class{constructor(e,t){this.blobStorage=e,this.logger=t,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}createBlob(e){return y(this,null,function*(){return this.blobStorage.createBlob(e)})}readBlob(e){return y(this,null,function*(){return this.blobStorage.readBlob(e)})}get policies(){return this.notCalled()}get repositoryUrl(){return this.notCalled()}notCalled(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}};te();var zh=class extends Kn{constructor(e){super(e),super.setMaxListeners(50),this.propose=Bi(this,e.propose.bind(e)),this.has=Bi(this,e.has.bind(e)),this.get=Bi(this,e.get.bind(e)),this.getMembers=Bi(this,e.getMembers.bind(e)),this.getMember=Bi(this,e.getMember.bind(e))}};function G3(r){let t=new Map(r).get("code");return C(t!==void 0,732),t?.value}function zg(r){return[["code",{key:"code",value:r,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}te();var tL=2e3,rL=50,Hh=class{constructor(e,t=tL,n=rL){this.submit=e,this.NoopCountFrequency=n,this.opsCountSinceNoop=0,t!==1/0&&(this.timer=new Zt(t,()=>{this.opsCountSinceNoop!==0&&this.submitNoop(!1)}))}scheduleSequenceNumberUpdate(e,t){if(t){this.submitNoop(!0);return}if(pi(e)){if(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency){this.submitNoop(!1);return}this.timer!==void 0&&(this.opsCountSinceNoop===1&&this.timer.restart(),C(this.timer.hasTimer,578))}}submitNoop(e){this.submit(sr.NoOp,e?"":null),C(this.opsCountSinceNoop===0,579)}stopSequenceNumberUpdate(){this.opsCountSinceNoop=0}};var K3=ye(qg());te();xe();var nL=8e3,iL=1e3,sL=16*1024,W3={fatalConnectError:!0};function oL(r){let e=`Nack (${r.type}): ${r.message}`,t=r.code!==403,n=r.retryAfter!==void 0?r.retryAfter*1e3:void 0;return cn(e,{canRetry:t,retryAfterMs:n},{statusCode:r.code,driverVersion:void 0})}var vc=class extends be{constructor(){super(...arguments),this.clientId="storage-only client",this.claims={scopes:[Ah.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[],this.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(e){this.emit("nack",this.clientId,e.map(t=>({operation:t,content:{message:"Cannot submit with storage-only connection",code:403}})))}submitSignal(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}},Vh=class r{constructor(e,t,n,i,s){this.serviceProvider=e,this.client=t,this.logger=i,this.props=s,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=(o,a)=>{let c=Array.isArray(a)?a:[a];this.props.incomingOpHandler(c,"opHandler")},this.nackHandler=(o,a)=>{let c=a[0];if(this._readonlyPermissions===!0){this.props.closeHandler(WE("writeOnReadOnlyDocument",{driverVersion:void 0}));return}let l=oL(c.content);if(!l.canRetry){this.props.closeHandler(l);return}this.reconnectOnError("write",l)},this.disconnectHandlerInternal=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.errorHandler=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=n?Xt.Enabled:Xt.Never,this._outbound=new ns(o=>{if(this.connection===void 0)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(o)}),this._outbound.on("error",o=>{this.props.closeHandler($t(o))})}get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){var e,t;return(t=(e=this.connection)===null||e===void 0?void 0:e.mode)!==null&&t!==void 0?t:"read"}get connected(){return this.connection!==void 0}get clientId(){var e;return(e=this.connection)===null||e===void 0?void 0:e.clientId}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){var e,t,n;return(n=(t=(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration)===null||t===void 0?void 0:t.maxMessageSize)!==null&&n!==void 0?n:sL}get version(){if(this.connection===void 0)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){var e;return(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration}get scopes(){var e;return(e=this.connection)===null||e===void 0?void 0:e.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return this.connection!==void 0?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}shouldJoinWrite(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}get readonly(){return this._forceReadonly?!0:this._readonlyPermissions}get readOnlyInfo(){let e=this.connection!==void 0&&this.connection instanceof vc;return e||this._forceReadonly||this._readonlyPermissions===!0?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}static detailsFromConnection(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}dispose(e){if(this.closed)return;this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=Xt.Never,this._outbound.clear();let t=e!==void 0?`Closing DeltaManager (${e.message})`:"Closing DeltaManager";this.disconnectFromDeltaStream(t),this.set_readonlyPermissions(!0)}setAutoReconnect(e){C(e!==Xt.Never&&this._reconnectMode!==Xt.Never,632),this._reconnectMode=e,e!==Xt.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}forceReadonly(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});let t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===Xt.Never)throw new ve("API is not supported for non-connecting or closed container");let n=!1;this.readonly===!0&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),n=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),n&&this.triggerConnect("read")}}set_readonlyPermissions(e){let t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}connect(e){this.connectCore(e).catch(t=>{let n=$t(t,{props:W3});this.props.closeHandler(n)})}connectCore(e){return y(this,null,function*(){var t,n;if(C(!this.closed,618),this.connection!==void 0)return;let i;this.pendingConnection!==void 0&&(i=this.pendingConnection.connectionMode,this.cancelConnection(),C(this.pendingConnection===void 0,836));let s=(t=e??i)!==null&&t!==void 0?t:this.defaultReconnectionMode;this.shouldJoinWrite()&&(s="write");let o=this.serviceProvider();C(o!==void 0,679);let a;if(((n=o.policies)===null||n===void 0?void 0:n.storageOnly)===!0){a=new vc,this.setupNewSuccessfulConnection(a,"read"),C(this.pendingConnection===void 0,691);return}let c=iL,l=0,d=le.now(),h,u=new K3.default,f=u.signal;for(this.pendingConnection={abort:()=>{u.abort()},connectionMode:s};a===void 0;){if(this.closed)throw new Error("Attempting to connect a closed DeltaManager");if(f.aborted===!0){this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:l,duration:Qe.formatTick(le.now()-d),connectionEstablished:!1});return}l++;try{this.client.mode=s,a=yield o.connectToDeltaStream(Object.assign(Object.assign({},this.client),{mode:s})),a.disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),a=void 0)}catch(g){if(typeof g=="object"&&g!==null&&g?.errorType===Wa.errorType){a=new vc,s="read";break}if(!ln(g)){let b=$t(g,{props:W3});throw this.props.closeHandler(b),b}$a(this.logger,{attempts:l,delay:c,eventName:"DeltaConnectionFailureToConnect",duration:Qe.formatTick(le.now()-d)},g),h=g;let m=Ji(g);c=m??Math.min(c*2,nL),m!==void 0&&this.props.reconnectionDelayHandler(m,g),yield Ja(c)}}if(l>1&&$a(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:l,duration:Qe.formatTick(le.now()-d)},h),f.aborted===!0){a.dispose(),this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:l,duration:Qe.formatTick(le.now()-d),connectionEstablished:!0});return}this.setupNewSuccessfulConnection(a,s)})}triggerConnect(e){C(this.connection===void 0,569),this.reconnectMode===Xt.Enabled&&this.connect(e)}disconnectFromDeltaStream(e){if(this.pendingReconnect=!1,this.connection===void 0)return this.pendingConnection!==void 0?(this.cancelConnection(),!0):!1;C(this.pendingConnection===void 0,635);let t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}cancelConnection(){C(this.pendingConnection!==void 0,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}setupNewSuccessfulConnection(e,t){C(this.connection===void 0,230),C(!e.disposed,650),this.pendingConnection=void 0,this.connection=e;let n=!e.claims.scopes.includes(Ah.DocWrite);if(C(t==="read"||n===(this.connectionMode==="read"),231),C(!n||this.connectionMode==="read",232),this.set_readonlyPermissions(n),this.closed){this.disconnectFromDeltaStream("ConnectionManager already closed");return}this._outbound.resume(),e.on("op",this.opHandler),e.on("signal",this.props.signalHandler),e.on("nack",this.nackHandler),e.on("disconnect",this.disconnectHandlerInternal),e.on("error",this.errorHandler),e.on("pong",this.props.pongHandler);let i=e.initialMessages.sort((c,l)=>c.sequenceNumber-l.sequenceNumber),s=e.checkpointSequenceNumber;this._connectionVerboseProps={clientId:e.clientId,mode:e.mode},this._connectionProps={},e.relayServiceAgent!==void 0&&(this._connectionVerboseProps.relayServiceAgent=e.relayServiceAgent,this._connectionProps.relayServiceAgent=e.relayServiceAgent),this._connectionProps.socketDocumentId=e.claims.documentId,this._connectionProps.connectionMode=e.mode;let o=-1;if(i.length!==0&&(this._connectionVerboseProps.connectionInitialOpsFrom=i[0].sequenceNumber,o=i[i.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=o+1,(s===void 0||s<o)&&(s=o)),this.props.incomingOpHandler(i,this.connectFirstConnection?"InitialOps":"ReconnectOps"),e.initialSignals!==void 0)for(let c of e.initialSignals)this.props.signalHandler(c);let a=r.detailsFromConnection(e);a.checkpointSequenceNumber=s,this.props.connectHandler(a),this.connectFirstConnection=!1}reconnectOnError(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}reconnect(e,t,n){return y(this,null,function*(){if(C(this.connection!==void 0,235),this.disconnectFromDeltaStream(t),n!==void 0&&!n.canRetry&&this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},n),this.reconnectMode===Xt.Never&&this.props.closeHandler(),this.closed||this.reconnectMode!==Xt.Enabled)return;let i=Ji(n);n!==void 0&&i!==void 0&&(this.props.reconnectionDelayHandler(i,n),yield Ja(i)),this.triggerConnect(e)})}prepareMessageToSend(e){var t,n;if(this.readonly===!0){C(this.readOnlyInfo.readonly===!0,496);let i=new ir("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(i);return}return C(!!this.connection,228),this.lastSubmittedClientId!==((t=this.connection)===null||t===void 0?void 0:t.clientId)&&(this.lastSubmittedClientId=(n=this.connection)===null||n===void 0?void 0:n.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===sr.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber})}submitSignal(e){this.connection!==void 0?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}sendMessages(e){if(C(this.connected,692),this.connectionMode==="read"){this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then(()=>y(this,null,function*(){this.pendingReconnect&&(yield this.reconnect("write","Switch to write"))})).catch(()=>{}));return}C(!this.pendingReconnect,693),this._outbound.push(e)}beforeProcessingIncomingOp(e){if(C(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),this.lastSubmittedClientId!==void 0&&this.lastSubmittedClientId===e.clientId){let t=e.clientSequenceNumber;C(this.clientSequenceNumberObserved<t,239),C(t<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=t}e.type===sr.ClientLeave&&JSON.parse(e.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch(i=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},i)}))}};var aL=0,$3="dirty",Hg="saved";var cL=r=>{var e;return(e=r.get("code"))!==null&&e!==void 0?e:r.get("code2")};function J3(r,e,t){return y(this,null,function*(){let n=ce.start(r,{eventName:e}),i=yield t();n.duration>1e3&&n.end(i)})}var X3="summarizer",pc=(()=>{class r extends _n{constructor(t,n){var i,s;super((h,u)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:typeof h=="string"?h:void 0},u)}),this.loader=t,this._canReconnect=!0,this._lifecycleState="loading",this._attachState=se.Detached,this.inboundQueuePausedFromInit=!0,this.firstConnection=!0,this.connectionTransitionTimes=[],this.messageCountAfterDisconnection=0,this.attachStarted=!1,this._dirtyContainer=!1,this.setAutoReconnectTime=le.now(),this._audience=new Dh,this.clientDetailsOverride=n.clientDetailsOverride,this._resolvedUrl=n.resolvedUrl,n.canReconnect!==void 0&&(this._canReconnect=n.canReconnect);let o=this.client.details.type,c=`${this.client.details.capabilities.interactive?"interactive":"noninteractive"}${o!==void 0&&o!==""?`/${o}`:""}`;this.subLogger=ue.create(t.services.subLogger,void 0,{all:{clientType:c,containerId:Te(),docId:()=>{var h,u;return(u=(h=this._resolvedUrl)===null||h===void 0?void 0:h.id)!==null&&u!==void 0?u:void 0},containerAttachState:()=>this._attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>Oe[this.connectionState],serializedContainer:n.serializedContainerState!==void 0},error:{dmInitialSeqNumber:()=>{var h;return(h=this._deltaManager)===null||h===void 0?void 0:h.initialSequenceNumber},dmLastProcessedSeqNumber:()=>{var h;return(h=this._deltaManager)===null||h===void 0?void 0:h.lastSequenceNumber},dmLastKnownSeqNumber:()=>{var h;return(h=this._deltaManager)===null||h===void 0?void 0:h.lastKnownSeqNumber},containerLoadedFromVersionId:()=>{var h;return(h=this.loadedFromVersion)===null||h===void 0?void 0:h.id},containerLoadedFromVersionDate:()=>{var h;return(h=this.loadedFromVersion)===null||h===void 0?void 0:h.date},dmLastMsqSeqNumber:()=>{var h,u;return(u=(h=this.deltaManager)===null||h===void 0?void 0:h.lastMessage)===null||u===void 0?void 0:u.sequenceNumber},dmLastMsqSeqTimestamp:()=>{var h,u;return(u=(h=this.deltaManager)===null||h===void 0?void 0:h.lastMessage)===null||u===void 0?void 0:u.timestamp},dmLastMsqSeqClientId:()=>{var h,u;return(u=(h=this.deltaManager)===null||h===void 0?void 0:h.lastMessage)===null||u===void 0?void 0:u.clientId},connectionStateDuration:()=>le.now()-this.connectionTransitionTimes[this.connectionState]}}),this.mc=ur(ue.create(this.subLogger,"Container"));let l=(i=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))!==null&&i!==void 0?i:this.loader.services.options.summarizeProtocolTree;this.options=Object.assign(Object.assign({},this.loader.services.options),{summarizeProtocolTree:l}),this.connectionStateHandler=new Mh({quorumClients:()=>{var h;return(h=this._protocolHandler)===null||h===void 0?void 0:h.quorum},logConnectionStateChangeTelemetry:(h,u,f)=>this.logConnectionStateChangeTelemetry(h,u,f),shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:this.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:(h,u)=>{this._deltaManager.logConnectionIssue(Object.assign({eventName:h,duration:le.now()-this.connectionTransitionTimes[Oe.CatchingUp]},u===void 0?{}:{details:JSON.stringify(u)}))},connectionStateChanged:()=>{this._lifecycleState==="loaded"&&this.propagateConnectionState()}},this.mc.logger,(s=n.serializedContainerState)===null||s===void 0?void 0:s.clientId),this.on(Hg,()=>{this.connectionStateHandler.containerSaved()}),this._deltaManager=this.createDeltaManager(),this._storage=new Lh(()=>{if(this.attachState!==se.Attached){if(this.loader.services.detachedBlobStorage!==void 0)return new jh(this.loader.services.detachedBlobStorage,this.mc.logger);throw this.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return this.storageService}),typeof document=="object"&&document!==null&&typeof document.addEventListener=="function"&&document.addEventListener!==null&&(this.lastVisible=document.hidden?le.now():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=le.now():setTimeout(()=>{this.lastVisible=void 0},0)},document.addEventListener("visibilitychange",this.visibilityEventHandler)),this.on("newListener",(h,u)=>{Promise.resolve().then(()=>{switch(h){case $3:this._dirtyContainer&&u();break;case Hg:this._dirtyContainer||u();break;case Ol:this.connected&&u(this.clientId);break;case Nl:this.connected||u();break;default:}}).catch(f=>{this.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},f)})})}static load(t,n,i){return y(this,null,function*(){let s=new r(t,{clientDetailsOverride:n.clientDetailsOverride,resolvedUrl:n.resolvedUrl,canReconnect:n.canReconnect,serializedContainerState:i});return ce.timedExecAsync(s.mc.logger,{eventName:"Load"},o=>y(this,null,function*(){return new Promise((a,c)=>{var l,d;let h=n.version,u={opsBeforeReturn:"cached"},f=i?Object.assign(Object.assign({},(l=n.loadMode)!==null&&l!==void 0?l:u),{opsBeforeReturn:void 0}):(d=n.loadMode)!==null&&d!==void 0?d:u,g=m=>{c(m??new ir("Container closed without error during load"))};s.on("closed",g),s.load(h,f,i).finally(()=>{s.removeListener("closed",g)}).then(m=>{o.end(Object.assign(Object.assign({},m),n.loadMode)),a(s)},m=>{let b=$t(m);s.close(b),g(b)})})}),{start:!0,end:!0,cancel:"generic"})})}static createDetached(t,n){return y(this,null,function*(){let i=new r(t,{});return ce.timedExecAsync(i.mc.logger,{eventName:"CreateDetached"},s=>y(this,null,function*(){return yield i.createDetached(n),i}),{start:!0,end:!0,cancel:"generic"})})}static rehydrateDetachedFromSnapshot(t,n){return y(this,null,function*(){let i=new r(t,{});return ce.timedExecAsync(i.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},s=>y(this,null,function*(){let o=JSON.parse(n);return yield i.rehydrateDetachedFromSnapshot(o),i}),{start:!0,end:!0,cancel:"generic"})})}setLoaded(){this._lifecycleState==="loading"&&(this.propagateConnectionState(),this._lifecycleState="loaded")}get closed(){return this._lifecycleState==="closing"||this._lifecycleState==="closed"}get storage(){return this._storage}get storageService(){if(this._storageService===void 0)throw new Error("Attempted to access storageService before it was defined");return this._storageService}get context(){if(this._context===void 0)throw new ir("Attempted to access context before it was defined");return this._context}get protocolHandler(){if(this._protocolHandler===void 0)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get IFluidRouter(){return this}get resolvedUrl(){return this._resolvedUrl}get loadedFromVersion(){return this._loadedFromVersion}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get closeSignal(){return this._deltaManager.closeAbortController.signal}forceReadonly(t){this._deltaManager.connectionManager.forceReadonly(t)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connected}get serviceConfiguration(){return this._deltaManager.serviceConfiguration}get clientId(){return this.connectionStateHandler.clientId}get scopes(){return this._deltaManager.connectionManager.scopes}get clientDetails(){return this._deltaManager.clientDetails}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){var t;return(t=this._context)===null||t===void 0?void 0:t.codeDetails}get audience(){return this._audience}get isDirty(){return this._dirtyContainer}get serviceFactory(){return this.loader.services.documentServiceFactory}get urlResolver(){return this.loader.services.urlResolver}get scope(){return this.loader.services.scope}get codeLoader(){return this.loader.services.codeLoader}getQuorum(){return this.protocolHandler.quorum}close(t){this._deltaManager.close(t),C(this.connectionState===Oe.Disconnected,207),C(this._lifecycleState==="closed",788)}closeCore(t){var n,i,s,o;C(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:t===void 0?"generic":"error"},t),this._lifecycleState="closing",(n=this._protocolHandler)===null||n===void 0||n.close(),this.connectionStateHandler.dispose(),(i=this._context)===null||i===void 0||i.dispose(t!==void 0?new Error(t.message):void 0),(s=this._storageService)===null||s===void 0||s.dispose(),(o=this.service)===null||o===void 0||o.dispose(t)}catch(a){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},a)}this.emit("closed",t),this.removeAllListeners(),this.visibilityEventHandler!==void 0&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}closeAndGetPendingLocalState(){C(this.attachState===se.Attached,209),C(this.resolvedUrl!==void 0&&this.resolvedUrl.type==="fluid",210),C(!!this._protocolHandler,739),C(this._protocolHandler.attributes.term!==void 0,779);let t={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(t)}get attachState(){return this._attachState}serialize(){C(this.attachState===se.Detached,211);let t=this.context.createSummary(),n=this.captureProtocolSummary(),i=ao(t,n);return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(i.tree[".hasAttachmentBlobs"]={type:gr.Blob,content:"true"}),JSON.stringify(i)}attach(t){return y(this,null,function*(){yield ce.timedExecAsync(this.mc.logger,{eventName:"Attach"},()=>y(this,null,function*(){if(this._lifecycleState!=="loaded")throw new ve(`The Container is not in a valid state for attach [${this._lifecycleState}]`);C(this._attachState===se.Detached&&!this.attachStarted,517),this.attachStarted=!0;let n=this.loader.services.detachedBlobStorage!==void 0&&this.loader.services.detachedBlobStorage.size>0;try{C(this.deltaManager.inbound.length===0,214);let i;if(!n){let a=this.context.createSummary(),c=this.captureProtocolSummary();i=ao(a,c),this._attachState=se.Attaching,this.context.notifyAttaching(Rh(i))}let s=yield this.urlResolver.resolve(t);rr(s),this.service===void 0&&(C(this.client.details.type!==X3,708),this.service=yield co(()=>y(this,null,function*(){return this.serviceFactory.createContainer(i,s,this.subLogger,!1)}),"containerAttach",this.mc.logger,{cancel:this.closeSignal}));let o=this.service.resolvedUrl;if(rr(o),this._resolvedUrl=o,yield this.connectStorageService(),n){C(!!this.loader.services.detachedBlobStorage,590);let a=new Map;for(;a.size<this.loader.services.detachedBlobStorage.size;){let d=this.loader.services.detachedBlobStorage.getBlobIds().filter(h=>!a.has(h));for(let h of d){let u=yield this.loader.services.detachedBlobStorage.readBlob(h),f=yield this.storageService.createBlob(u);a.set(h,f.id)}}let c=this.context.createSummary(a),l=this.captureProtocolSummary();i=ao(c,l),this._attachState=se.Attaching,this.context.notifyAttaching(Rh(i)),yield this.storageService.uploadSummaryWithContext(i,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0})}this._attachState=se.Attached,this.emit("attached"),this.propagateConnectionState(),this.closed||this.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"})}catch(i){let s=$t(i),o=this.resolvedUrl;throw Ga(o)&&s.addTelemetryProperties({resolvedUrl:o.url}),this.close(s),s}}),{start:!0,end:!0,cancel:"generic"})})}request(t){return y(this,null,function*(){return ce.timedExecAsync(this.mc.logger,{eventName:"Request"},()=>y(this,null,function*(){return this.context.request(t)}),{end:!0,cancel:"error"})})}setAutoReconnectInternal(t){if(this._deltaManager.connectionManager.reconnectMode===t)return;let i=le.now(),s=i-this.setAutoReconnectTime;this.setAutoReconnectTime=i,this.mc.logger.sendTelemetryEvent({eventName:t===Xt.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:Oe[this.connectionState],duration:s}),this._deltaManager.connectionManager.setAutoReconnect(t)}connect(){if(this.closed)throw new ve("The Container is closed and cannot be connected");if(this._attachState!==se.Attached)throw new ve("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}connectInternal(t){C(!this.closed,709),C(this._attachState===se.Attached,710),this.resumeInternal(t);let n=Xt.Enabled;this.setAutoReconnectInternal(n)}disconnect(){if(this.closed)throw new ve("The Container is closed and cannot be disconnected");this.disconnectInternal()}disconnectInternal(){C(!this.closed,711);let t=Xt.Disabled;this.setAutoReconnectInternal(t)}resumeInternal(t){C(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(t)}getAbsoluteUrl(t){return y(this,null,function*(){var n;if(this.resolvedUrl!==void 0)return this.urlResolver.getAbsoluteUrl(this.resolvedUrl,t,L3((n=this._context)===null||n===void 0?void 0:n.codeDetails))})}proposeCodeDetails(t){return y(this,null,function*(){if(!Du(t))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(this.codeLoader.IFluidCodeDetailsComparer){let n=yield this.codeLoader.IFluidCodeDetailsComparer.compare(t,this.getCodeDetailsFromQuorum());if(n!==void 0&&n<=0)throw new Error("Proposed code details should be greater than the current")}return this.protocolHandler.quorum.propose("code",t).then(()=>!0).catch(()=>!1)})}processCodeProposal(){return y(this,null,function*(){let t=this.getCodeDetailsFromQuorum();if(yield Promise.all([this.deltaManager.inbound.pause(),this.deltaManager.inboundSignal.pause()]),(yield this.context.satisfies(t))===!0){this.deltaManager.inbound.resume(),this.deltaManager.inboundSignal.resume();return}this.close(new ir("Existing context does not satisfy incoming proposal"))})}getVersion(t){return y(this,null,function*(){return(yield this.storageService.getVersions(t,1))[0]})}recordConnectStartTime(){this.connectionTransitionTimes[Oe.Disconnected]===void 0&&(this.connectionTransitionTimes[Oe.Disconnected]=le.now())}connectToDeltaStream(t){this.recordConnectStartTime(),(!this._canReconnect||!this.client.details.capabilities.interactive)&&(t.mode="write"),this._deltaManager.connect(t)}load(t,n,i){return y(this,null,function*(){if(this._resolvedUrl===void 0)throw new Error("Attempting to load without a resolved url");this.service=yield this.serviceFactory.createDocumentService(this._resolvedUrl,this.subLogger,this.client.details.type===X3);let s={reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1};n.deltaConnection===void 0&&this.connectToDeltaStream(s),i?this.connectStorageService().catch(h=>this.close(h)):yield this.connectStorageService(),this._attachState=se.Attached;let{snapshot:o,versionId:a}=i===void 0?yield this.fetchSnapshotTree(t):{snapshot:void 0,versionId:void 0};C(o!==void 0||i!==void 0,567);let c=i===void 0?yield this.getDocumentAttributes(this.storageService,o):{sequenceNumber:i.protocol.sequenceNumber,minimumSequenceNumber:i.protocol.minimumSequenceNumber,term:i.term},l;switch(n.opsBeforeReturn){case void 0:this.attachDeltaManagerOpHandler(c,n.deltaConnection!=="none"?"all":"none");break;case"cached":l=this.attachDeltaManagerOpHandler(c,"cached");break;case"all":l=this.attachDeltaManagerOpHandler(c,"all");break;default:ot(n.opsBeforeReturn)}this._protocolHandler=i===void 0?yield this.initializeProtocolStateFromSnapshot(c,this.storageService,o):yield this.initializeProtocolState(c,i.protocol.members,i.protocol.proposals,i.protocol.values);let d=this.getCodeDetailsFromQuorum();if(yield this.instantiateContext(!0,d,o,i?.pendingRuntimeState),!this.closed)switch(l!==void 0&&(this._deltaManager.inbound.resume(),yield J3(this.mc.logger,"WaitOps",()=>y(this,null,function*(){return yield l,{}})),yield J3(this.mc.logger,"WaitOpProcessing",()=>y(this,null,function*(){return this._deltaManager.inbound.waitTillProcessingDone()})),this._deltaManager.inbound.pause()),n.deltaConnection){case void 0:case"delayed":C(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();break;case"none":break;default:ot(n.deltaConnection)}if(this.closed)throw new Error("Container was closed while load()");return this.setLoaded(),{sequenceNumber:c.sequenceNumber,version:a,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber}})}createDetached(t){return y(this,null,function*(){let n={sequenceNumber:aL,term:1,minimumSequenceNumber:0};yield this.attachDeltaManagerOpHandler(n);let i=zg(t);this._protocolHandler=yield this.initializeProtocolState(n,[],[],i),yield this.instantiateContextDetached(!1),this.setLoaded()})}rehydrateDetachedFromSnapshot(t){return y(this,null,function*(){t.tree[".hasAttachmentBlobs"]!==void 0&&(C(!!this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0,592),delete t.tree[".hasAttachmentBlobs"]);let n=Rh(t);this._storage.loadSnapshotForRehydratingContainer(n);let i=yield this.getDocumentAttributes(this._storage,n);yield this.attachDeltaManagerOpHandler(i);let s=jg(n),o=yield We(this._storage,s.blobs.quorumValues),a=G3(o);this._protocolHandler=yield this.initializeProtocolState(i,[],[],a!==void 0?zg(a):[]),yield this.instantiateContextDetached(!0,n),this.setLoaded()})}connectStorageService(){return y(this,null,function*(){var t,n;if(this._storageService!==void 0)return;C(this.service!==void 0,495);let i=yield this.service.connectToStorage();this._storageService=new Bh(i,this.mc.logger),this.options.summarizeProtocolTree===!0&&(this.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this._storageService=new qh(this._storageService,()=>this.captureProtocolSummary())),C(((t=i.policies)===null||t===void 0?void 0:t.minBlobSize)===((n=this.storageService.policies)===null||n===void 0?void 0:n.minBlobSize),224)})}getDocumentAttributes(t,n){return y(this,null,function*(){if(n===void 0)return{minimumSequenceNumber:0,sequenceNumber:0,term:1};let i=".protocol"in n.trees?n.trees[".protocol"].blobs.attributes:n.blobs[".attributes"],s=yield We(t,i);return s.term===void 0&&(s.term=1),s})}initializeProtocolStateFromSnapshot(t,n,i){return y(this,null,function*(){let s=[],o=[],a=[];if(i!==void 0){let l=jg(i);[s,o,a]=yield Promise.all([We(n,l.blobs.quorumMembers),We(n,l.blobs.quorumProposals),We(n,l.blobs.quorumValues)])}return yield this.initializeProtocolState(t,s,o,a)})}initializeProtocolState(t,n,i,s){return y(this,null,function*(){let o=new jl(t.minimumSequenceNumber,t.sequenceNumber,t.term,n,i,s,(c,l)=>this.submitMessage(sr.Propose,{key:c,value:l})),a=ue.create(this.subLogger,"ProtocolHandler");return o.quorum.on("error",c=>{a.sendErrorEvent(c)}),this.connectionStateHandler.initProtocol(o),o.quorum.on("addProposal",c=>{(c.key==="code"||c.key==="code2")&&this.emit("codeDetailsProposed",c.value,c)}),o.quorum.on("approveProposal",(c,l,d)=>{(l==="code"||l==="code2")&&(Du(d)||this.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),this.processCodeProposal().catch(h=>{throw this.close($t(h)),h}))}),o})}captureProtocolSummary(){let t=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:gr.Blob},quorumMembers:{content:JSON.stringify(t.members),type:gr.Blob},quorumProposals:{content:JSON.stringify(t.proposals),type:gr.Blob},quorumValues:{content:JSON.stringify(t.values),type:gr.Blob}},type:gr.Tree}}getCodeDetailsFromQuorum(){let t=this.protocolHandler.quorum;return cL(t)}get client(){var t;let n=((t=this.options)===null||t===void 0?void 0:t.client)!==void 0?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return this.clientDetailsOverride!==void 0&&(0,Y3.default)(n.details,this.clientDetailsOverride),n.details.environment=[n.details.environment,` loaderVersion:${kh}`].join(";"),n}activeConnection(){return this.connectionState===Oe.Connected&&this.connectionMode==="write"}createDeltaManager(){let t=()=>this.service,n=new Ih(t,ue.create(this.subLogger,"DeltaManager"),()=>this.activeConnection(),i=>new Vh(t,this.client,this._canReconnect,ue.create(this.subLogger,"ConnectionManager"),i));return n.inbound.pause(),n.inboundSignal.pause(),n.on("connect",(i,s)=>{var o;this._audience.clear();for(let a of(o=i.initialClients)!==null&&o!==void 0?o:[])this._audience.addMember(a.clientId,a.client);this.connectionStateHandler.receivedConnectEvent(this.connectionMode,i)}),n.on("disconnect",i=>{var s;(s=this.collabWindowTracker)===null||s===void 0||s.stopSequenceNumberUpdate(),this.connectionStateHandler.receivedDisconnectEvent(i)}),n.on("throttled",i=>{let s=i;s.logged!==!0&&this.logContainerError(s),this.emit("warning",s)}),n.on("readonly",i=>{this.emit("readonly",i)}),n.on("closed",i=>{this.closeCore(i)}),n}attachDeltaManagerOpHandler(t,n){return y(this,null,function*(){var i;return this._deltaManager.attachOpHandler(t.minimumSequenceNumber,t.sequenceNumber,(i=t.term)!==null&&i!==void 0?i:1,{process:s=>this.processRemoteMessage(s),processSignal:s=>{this.processSignal(s)}},n)})}logConnectionStateChangeTelemetry(t,n,i){var s;let o=le.now();this.connectionTransitionTimes[t]=o;let a=o-this.connectionTransitionTimes[n],c,l,d,h,u;t===Oe.Disconnected?d=this._deltaManager.connectionManager.reconnectMode:(t===Oe.Connected?(c=o-this.connectionTransitionTimes[Oe.Disconnected],c=Qe.formatTick(c)):(h=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(u=h-this.deltaManager.lastSequenceNumber)),this.firstConnection?l="InitialConnect":l="AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:`ConnectionStateChange_${Oe[t]}`,from:Oe[n],duration:a,durationFromDisconnected:c,reason:i,connectionInitiationReason:l,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:d,opsBehind:u,online:Dn[Ka()],lastVisible:this.lastVisible!==void 0?le.now()-this.lastVisible:void 0,checkpointSequenceNumber:h,quorumSize:(s=this._protocolHandler)===null||s===void 0?void 0:s.quorum.getMembers().size},this._deltaManager.connectionProps)),t===Oe.Connected&&(this.firstConnection=!1)}propagateConnectionState(){var t;let n=this.connectionState===Oe.Connected&&!this.firstConnection&&this.connectionMode==="write";n&&(this.messageCountAfterDisconnection=0);let i=this.connectionState===Oe.Connected;((t=this._context)===null||t===void 0?void 0:t.disposed)===!1&&this.context.setConnectionState(i,this.clientId),this.protocolHandler.setConnectionState(i,this.clientId),Hi(this.mc.logger,this,i,this.clientId),n&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}submitContainerMessage(t,n,i,s){switch(t){case sr.Operation:case sr.RemoteHelp:break;case sr.Summarize:{let a=n;a.details===void 0&&(a.details={}),a.details.includesProtocolTree=this.options.summarizeProtocolTree===!0;break}default:return this.close(new ir("invalidContainerSubmitOpType",void 0,{messageType:t})),-1}return this.submitMessage(t,n,i,s)}submitMessage(t,n,i,s){var o;return this.connectionState!==Oe.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:t}),-1):(this.messageCountAfterDisconnection+=1,(o=this.collabWindowTracker)===null||o===void 0||o.stopSequenceNumberUpdate(),this._deltaManager.submit(t,n,i,s))}processRemoteMessage(t){let n=this.clientId===t.clientId,i={immediateNoOp:!1};try{i=this.protocolHandler.processMessage(t,n)}catch(s){this.close(ti(s,o=>new qt(o,Wr(t))))}return Xi(t)&&!pi(t)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:t.type}),(pi(t)||Xi(t))&&this.context.process(t,n,void 0),this.activeConnection()&&(this.collabWindowTracker===void 0&&(C(this.serviceConfiguration!==void 0,740),this.collabWindowTracker=new Hh((s,o)=>{C(this.activeConnection(),577),this.submitMessage(s,o)},this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(t,i.immediateNoOp===!0)),this.emit("op",t),i}submitSignal(t){this._deltaManager.submitSignal(JSON.stringify(t))}processSignal(t){if(t.clientId===null){let n=t.content;if(n.type===sr.ClientJoin){let i=n.content;this._audience.addMember(i.clientId,i.client)}else if(n.type===sr.ClientLeave){let i=n.content;this._audience.removeMember(i)}}else{let n=this.clientId===t.clientId;this.context.processSignal(t,n)}}fetchSnapshotTree(t){return y(this,null,function*(){var n;let i=yield this.getVersion(t??null);i===void 0&&t!==void 0&&this.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:t}),this._loadedFromVersion=i;let s=(n=yield this.storageService.getSnapshotTree(i))!==null&&n!==void 0?n:void 0;return s===void 0&&i!==void 0&&this.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:i.id}),{snapshot:s,versionId:i?.id}})}instantiateContextDetached(t,n){return y(this,null,function*(){let i=this.getCodeDetailsFromQuorum();if(i===void 0)throw new Error("pkg should be provided in create flow!!");yield this.instantiateContext(t,i,n)})}instantiateContext(t,n,i,s){return y(this,null,function*(){var o;C(((o=this._context)===null||o===void 0?void 0:o.disposed)!==!1,221);let a=new mc(this,this.loader);this._context=yield Fh.createOrLoad(this,this.scope,this.codeLoader,n,i,new Oh(this._deltaManager),new zh(this.protocolHandler.quorum),a,(c,l,d,h)=>this.submitContainerMessage(c,l,d,h),c=>this.submitSignal(c),c=>this.close(c),r.version,c=>this.updateDirtyContainerState(c),t,s),this.emit("contextChanged",n)})}updateDirtyContainerState(t){this._dirtyContainer!==t&&(this._dirtyContainer=t,this.emit(t?$3:Hg))}logContainerError(t){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},t)}}return r.version="^0.1.0",r})();var yc=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(yc||{});te();xe();var lL=2e3,Uh=class{constructor(e,t,n,i){this.tenantId=e,this.id=t,this.deltaStorageService=n,this.documentStorageService=i,this.logtailSha=this.documentStorageService.logTailSha}fetchMessages(e,t,n,i,s){return i?XE:JE(this.getCore.bind(this),1,e,t,lL,new ia,n,s)}getCore(e,t){return y(this,null,function*(){let n=this.logtailSha?yield We(this.documentStorageService,this.logtailSha):[];if(this.logtailSha=void 0,n.length>0){let i=n.filter(s=>s.sequenceNumber>=e);if(i.length>0)return{messages:i,partialResult:!0}}return this.deltaStorageService.get(this.tenantId,this.id,e,t)})}},Gh=class{constructor(e,t,n,i=()=>y(this,null,function*(){return this.restWrapper}),s=()=>this.url){this.url=e,this.restWrapper=t,this.logger=n,this.getRestWrapper=i,this.getDeltaStorageUrl=s}get(e,t,n,i){return y(this,null,function*(){return{messages:yield ce.timedExecAsync(this.logger,{eventName:"getDeltas",from:n,to:i},o=>y(this,null,function*(){let a=yield this.getRestWrapper(),c=this.getDeltaStorageUrl(),l=yield a.get(c,{from:n-1,to:i});return o.end({count:l.length}),l})),partialResult:!1}})}};te();var Ti=class extends Error{constructor(e,t,n,i,s){super(t),this.code=e,this.canRetry=n,this.isFatal=i,this.retryAfterMs=s,this.name="NetworkError",this.retryAfter=s!==void 0?s/1e3:void 0}get details(){return this.canRetry===void 0&&this.isFatal===void 0&&this.retryAfterMs===void 0?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}};function sd(r,e){var t;let n,i,s,o;switch(e&&typeof e=="object"?(n=(t=e.message)!==null&&t!==void 0?t:"Unknown Error",i=e.canRetry,s=e.isFatal,o=e.retryAfter):e&&typeof e=="string"?n=e:n="Unknown Error",r){case 401:case 403:case 404:return new Ti(r,n,!1,!1);case 413:case 422:return new Ti(r,n,i??!1,s??!1,i?o:void 0);case 429:return new Ti(r,n,!0,!1,o);case 500:return new Ti(r,n,i??!0,s??!1,i?o:void 0);case 502:case 503:case 504:return new Ti(r,n,!0,!1,o);default:return new Ti(r,n,!1,!0)}}var od="x-correlation-id";te();Tn();var o0=function(r){return r.File="100644",r.Executable="100755",r.Directory="040000",r.Symlink="120000",r}(o0||{}),os=function(r){return r.Blob="Blob",r.Tree="Tree",r.Attachment="Attachment",r}(os||{});var Fr=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(Fr||{});var ET=ye(cp());var wT="@fluidframework/server-services-client",CT="0.1036.5002";var qn=(0,ET.debug)("fluid:services-client");qn(`Package: ${wT} - Version: ${CT}`);var Ec=class{constructor(e){this.historian=e,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}getHeader(e,t){return y(this,null,function*(){let n=yield this.historian.getHeader(t);for(let i of n.blobs)this.blobCache.set(i.sha,i);return Hs(n.tree)})}getFullTree(e){return y(this,null,function*(){return this.historian.getFullTree(e)})}getCommit(e){return y(this,null,function*(){return this.commitCache.has(e)?(qn(`Cache hit on ${e}`),this.commitCache.get(e)):this.historian.getCommit(e)})}getCommits(e,t){return y(this,null,function*(){let n=e;if(this.refCache.has(e)&&(qn(`Commit cache hit on ${e}`),n=this.refCache.get(e),this.refCache.delete(e),!n))return[];if(this.commitCache.has(n)){let i=this.commitCache.get(n);return[{commit:{author:i.author,committer:i.committer,message:i.message,tree:i.tree,url:i.url},parents:i.parents,sha:i.sha,url:i.url}]}return this.historian.getCommits(n,t)})}getTree(e,t=!0){return y(this,null,function*(){return this.treeCache.has(e)?(qn(`Tree cache hit on ${e}`),this.treeCache.get(e)):this.historian.getTree(e,t)})}getBlob(e){return y(this,null,function*(){return this.blobCache.has(e)?(qn(`Blob cache hit on ${e}`),this.blobCache.get(e)):this.historian.getBlob(e)})}getRawUrl(e){return`${this.historian.endpoint}/git/blobs/raw/${e}`}getContent(e,t){return y(this,null,function*(){return this.historian.getContent(t,e)})}createBlob(e,t){return y(this,null,function*(){let n={content:e,encoding:t};return this.historian.createBlob(n)})}createGitTree(e){return y(this,null,function*(){return this.historian.createTree(e)})}createTree(e){return y(this,null,function*(){return this.createTreeCore(e,0)})}createCommit(e){return y(this,null,function*(){return this.historian.createCommit(e)})}createSummary(e){return y(this,null,function*(){return this.historian.createSummary(e)})}deleteSummary(e){return y(this,null,function*(){return this.historian.deleteSummary(e)})}getSummary(e){return y(this,null,function*(){return this.historian.getSummary(e)})}getRef(e){return y(this,null,function*(){return this.historian.getRef(`heads/${e}`).catch(t=>{if(t===400||t===404)return null;throw t})})}createRef(e,t){return y(this,null,function*(){let n={ref:`refs/heads/${e}`,sha:t,config:{enabled:!0}};return this.historian.createRef(n)})}upsertRef(e,t){return y(this,null,function*(){let n={force:!0,sha:t,config:{enabled:!0}};return this.historian.updateRef(`heads/${e}`,n)})}addRef(e,t){this.refCache.set(e,t)}addCommit(e){this.commitCache.set(e.sha,e)}addTree(e){this.treeCache.set(e.sha,e)}addBlob(e){this.blobCache.set(e.sha,e)}write(e,t,n,i){return y(this,null,function*(){let s=yield this.createTree(t),o={author:{date:new Date().toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:i,parents:n,tree:s.sha},a=yield this.historian.createCommit(o);return(yield this.getRef(e))?yield this.upsertRef(e,a.sha):yield this.createRef(e,a.sha),a})}createTreeCore(e,t){return y(this,null,function*(){if(e.id)return this.getTree(e.id);let n=[];for(let c of e.entries)switch(os[c.type]){case os.Blob:{let l=c.value;c.mode===o0.Symlink&&(l.contents=this.translateSymlink(l.contents,t));let d=this.createBlob(l.contents,l.encoding);n.push(d);break}case os.Tree:{let l=c.value,d=this.createTreeCore(l,t+1);n.push(d);break}default:throw new Error("Unknown entry type")}let i=yield Promise.all(n),s=[];C(i.length===e.entries.length,"File entries length is not correct");for(let c=0;c<e.entries.length;c++){let l=e.entries[c].type===os.Tree?"tree":e.entries[c].type===os.Blob?"blob":"commit";s.push({mode:e.entries[c].mode,path:e.entries[c].path,sha:i[c].sha,type:l})}let o={tree:s};return this.historian.createTree(o)})}translateSymlink(e,t){let n="";for(let i=0;i<=t;i++)n+="../";return`${n}${e}`}};te();var OT=ye(FT()),NT=ye(c0()),RT=ye(UE());Dt();var Ac=class{constructor(e,t={},n=1e3*1024*1024,i=1e3*1024*1024){this.baseurl=e,this.defaultQueryString=t,this.maxBodyLength=n,this.maxContentLength=i}get(e,t,n){return y(this,null,function*(){let i={baseURL:this.baseurl,headers:n,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:`${e}${this.generateQueryString(t)}`};return this.request(i,200)})}post(e,t,n,i){return y(this,null,function*(){let s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:`${e}${this.generateQueryString(n)}`};return this.request(s,201)})}delete(e,t,n){return y(this,null,function*(){let i={baseURL:this.baseurl,headers:n,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:`${e}${this.generateQueryString(t)}`};return this.request(i,204)})}patch(e,t,n,i){return y(this,null,function*(){let s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:`${e}${this.generateQueryString(n)}`};return this.request(s,200)})}generateQueryString(e){if(this.defaultQueryString||e){let t=Object.assign(Object.assign({},this.defaultQueryString),e),n=OT.stringify(t);if(n!=="")return`?${n}`}return""}},ad=class extends Ac{constructor(e,t={},n=1e3*1024*1024,i=1e3*1024*1024,s={},o=RT.default,a,c,l){super(e,t,n,i),this.defaultHeaders=s,this.axios=o,this.refreshDefaultQueryString=a,this.refreshDefaultHeaders=c,this.getCorrelationId=l}request(e,t,n=!0){return y(this,null,function*(){var i,s;let o=Object.assign({},e);return o.headers=this.generateHeaders(o.headers,(s=(i=this.getCorrelationId)===null||i===void 0?void 0:i.call(this))!==null&&s!==void 0?s:Te()),new Promise((a,c)=>{this.axios.request(o).then(l=>{a(l.data)}).catch(l=>{var d,h,u,f,g,m,b,v,x,_,A,D,O,M;if(((d=l?.response)===null||d===void 0?void 0:d.status)===t&&a((h=l?.response)===null||h===void 0?void 0:h.data),l?.config?qn(`[${l.config.method}] request to [${(u=l.config.baseURL)!==null&&u!==void 0?u:""}${(f=l.config.url)!==null&&f!==void 0?f:""}] failed with [${(g=l.response)===null||g===void 0?void 0:g.status}] [${(0,NT.default)((m=l.response)===null||m===void 0?void 0:m.data,void 0,2)}]`):qn(`request to ${o.url} failed ${l?l.message:""}`),((b=l?.response)===null||b===void 0?void 0:b.status)===429&&((x=(v=l?.response)===null||v===void 0?void 0:v.data)===null||x===void 0?void 0:x.retryAfter)>0&&n)setTimeout(()=>{this.request(o,t).then(a).catch(c)},l.response.data.retryAfter*1e3);else if(((_=l?.response)===null||_===void 0?void 0:_.status)===401&&n&&this.refreshOnAuthError()){let S=Object.assign({},e);S.headers=this.generateHeaders(S.headers,o.headers[od]),this.request(S,t,!1).then(a).catch(c)}else if(l?.response)c(sd((A=l?.response)===null||A===void 0?void 0:A.status,(D=l?.response)===null||D===void 0?void 0:D.data));else if(l?.request)c(sd(502,`Network Error: ${(O=l?.message)!==null&&O!==void 0?O:"undefined"}`));else{let S={canRetry:!1,isFatal:!1,message:(M=l?.message)!==null&&M!==void 0?M:"Unknown Error"};c(sd(500,S))}})})})}generateHeaders(e,t){let n=e??{};return this.defaultHeaders&&(n=Object.assign(Object.assign({},this.defaultHeaders),e)),n[od]?n:Object.assign({[od]:t},n)}refreshOnAuthError(){return this.refreshDefaultQueryString===void 0&&this.refreshDefaultHeaders===void 0?!1:(this.refreshDefaultHeaders!==void 0&&(this.defaultHeaders=this.refreshDefaultHeaders()),this.refreshDefaultQueryString!==void 0&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}};function iH(r,e){for(let t of e)if(r.endsWith(t))return!0;return!1}var kT=r=>`Basic ${ra(`${r.user}:${r.password}`)}`,Dc=class{constructor(e,t,n,i){this.endpoint=e,this.historianApi=t,this.restWrapper=i,this.defaultQueryString={},n&&this.historianApi?(this.defaultQueryString.disableCache=n,this.cacheBust=!1):this.cacheBust=n,this.restWrapper===void 0&&(this.restWrapper=new ad(this.endpoint))}getHeader(e){return y(this,null,function*(){return this.historianApi?this.restWrapper.get(`/headers/${encodeURIComponent(e)}`,this.getQueryString()):this.getHeaderDirect(e)})}getFullTree(e){return y(this,null,function*(){return this.restWrapper.get(`/tree/${encodeURIComponent(e)}`,this.getQueryString())})}getBlob(e){return y(this,null,function*(){return this.restWrapper.get(`/git/blobs/${encodeURIComponent(e)}`,this.getQueryString())})}createBlob(e){return y(this,null,function*(){return this.restWrapper.post("/git/blobs",e,this.getQueryString())})}getContent(e,t){return y(this,null,function*(){return this.restWrapper.get(`/contents/${e}`,this.getQueryString({ref:t}))})}getCommits(e,t){return y(this,null,function*(){return this.restWrapper.get("/commits",this.getQueryString({count:t,sha:e})).catch(n=>n===400||n===404?[]:Promise.reject(n))})}getCommit(e){return y(this,null,function*(){return this.restWrapper.get(`/git/commits/${encodeURIComponent(e)}`,this.getQueryString())})}createCommit(e){return y(this,null,function*(){return this.restWrapper.post("/git/commits",e,this.getQueryString())})}getRefs(){return y(this,null,function*(){return this.restWrapper.get("/git/refs",this.getQueryString())})}getRef(e){return y(this,null,function*(){return this.restWrapper.get(`/git/refs/${e}`,this.getQueryString())})}createRef(e){return y(this,null,function*(){return this.restWrapper.post("/git/refs",e,this.getQueryString())})}updateRef(e,t){return y(this,null,function*(){return this.restWrapper.patch(`/git/refs/${e}`,t,this.getQueryString())})}deleteRef(e){return y(this,null,function*(){yield this.restWrapper.delete(`/git/refs/${e}`,this.getQueryString())})}createTag(e){return y(this,null,function*(){return this.restWrapper.post("/git/tags",e,this.getQueryString())})}getTag(e){return y(this,null,function*(){return this.restWrapper.get(`/git/tags/${e}`,this.getQueryString())})}createTree(e){return y(this,null,function*(){return this.restWrapper.post("/git/trees",e,this.getQueryString())})}getTree(e,t){return y(this,null,function*(){return this.restWrapper.get(`/git/trees/${encodeURIComponent(e)}`,this.getQueryString({recursive:t?1:0}))})}createSummary(e){return y(this,null,function*(){return this.restWrapper.post("/git/summaries",e,this.getQueryString())})}deleteSummary(e){return y(this,null,function*(){let t={"Soft-Delete":e};return this.restWrapper.delete("/git/summaries",this.getQueryString(),t)})}getSummary(e){return y(this,null,function*(){return this.restWrapper.get(`/git/summaries/${e}`,this.getQueryString())})}getHeaderDirect(e){return y(this,null,function*(){let t=yield this.getTree(e,!0),n=[".attributes",".blobs",".messages","header"],i=[];for(let o of t.tree)if(o.type==="blob"&&iH(o.path,n)){let a=this.getBlob(o.sha);i.push(a)}return{blobs:yield Promise.all(i),tree:t}})}getQueryString(e){return this.cacheBust?Object.assign(Object.assign({cacheBust:Date.now()},this.defaultQueryString),e):Object.assign(Object.assign({},this.defaultQueryString),e)}};var cd=function(r){return r.Method="method",r.Header="header",r.Body="body",r}(cd||{}),sH=(r,e)=>`${r}: ${e}`,ld=class{translate(e){var t,n;let i=Object.assign({},e),s=new URLSearchParams;if(s.append(cd.Method,(t=i.method)!==null&&t!==void 0?t:"GET"),i.headers)for(let[o,a]of Object.entries(i.headers)){let c=sH(o,a);s.append(cd.Header,c)}if(i.data&&["post","put","patch"].includes((n=i.method)===null||n===void 0?void 0:n.toLowerCase())){let o=JSON.stringify(i.data);s.append(cd.Body,o)}return i.data=s.toString(),i.method="POST",i.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},i}};te();Tn();var l0=(...r)=>r.map(e=>e.replace(/^\//,"").replace(/\/$/,"")).filter(e=>!!e).join("/");function u0(r,e,t="",n=""){let i={type:"tree",entries:[]},s=Object.keys(e.tree);for(let o of s){let a=e.tree[o],c,l,d,h=l0(t===""?n:t,o);switch(a.type){case Fr.Tree:{l=u0(r,a,h,n),d=a.unreferenced||void 0;break}case Fr.Blob:{typeof a.content=="string"?l={type:"blob",content:a.content,encoding:"utf-8"}:l={type:"blob",content:cr(a.content,"base64"),encoding:"base64"};break}case Fr.Handle:{if(a.embedded)c=a.handle;else{if(!r)throw Error("Parent summary does not exist to reference by handle.");c=l0(r,n,a.handle)}break}case Fr.Attachment:{c=a.id;break}default:ot(a,`Unknown type: ${a.type}`)}let u={path:encodeURIComponent(o),type:Ml(a)},f;if(l)C(c===void 0,173),f=Object.assign({value:l,unreferenced:d},u);else if(c)f=Object.assign(Object.assign({},u),{id:c});else throw new Error(`Invalid tree entry for ${a.type}`);i.entries.push(f)}return i}function oH(r,e){let t={},n={id:r.id,blobs:{},trees:{}};t[""]=n;for(let i of r.entries){let s=i.path.replace(new RegExp(`^${e}/`),""),o=s.lastIndexOf("/"),a=s.slice(0,Math.max(0,o)),c=s.slice(o+1),l=t[a];if(i.type==="tree"){let d={blobs:{},trees:{},unreferenced:i.unreferenced};l.trees[decodeURIComponent(c)]=d,t[s]=d}else if(i.type==="blob")l.blobs[decodeURIComponent(c)]=i.id;else throw new Error("Unknown entry type!!")}return n}function h0(r,e=".app"){var t;let n=new Map;r.blobs&&r.blobs.forEach(a=>{var c;n.set(a.id,Er(a.content,(c=a.encoding)!==null&&c!==void 0?c:"utf-8"))});let i=(t=r.trees)===null||t===void 0?void 0:t[0],s=i?.sequenceNumber,o=oH(i,e);return{blobs:n,snapshotTree:o,sequenceNumber:s}}te();Tn();var ud=class{constructor(e,t,n){this.manager=e,this.blobsShaCache=t,this.getPreviousFullSnapshot=n}writeSummaryTree(e,t,n,i){return y(this,null,function*(){let s=yield this.getPreviousFullSnapshot(t);return this.writeSummaryTreeCore(e,s??void 0)})}writeSummaryTreeCore(e,t){return y(this,null,function*(){let n=yield Promise.all(Object.keys(e.tree).map(s=>y(this,null,function*(){let o=e.tree[s],a=yield this.writeSummaryTreeObject(o,t);return{mode:yw(o),path:encodeURIComponent(s),sha:a,type:Ml(o)}})));return(yield this.manager.createGitTree({tree:n})).sha})}writeSummaryTreeObject(e,t){return y(this,null,function*(){switch(e.type){case Fr.Blob:return this.writeSummaryBlob(e.content);case Fr.Handle:{if(t===void 0)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(e.handleType,e.handle,t)}case Fr.Tree:return this.writeSummaryTreeCore(e,t);case Fr.Attachment:return e.id;default:ot(e,`Unknown type: ${e.type}`)}})}writeSummaryBlob(e){return y(this,null,function*(){let{parsedContent:t,encoding:n}=typeof e=="string"?{parsedContent:e,encoding:"utf-8"}:{parsedContent:cr(e,"base64"),encoding:"base64"},i=yield Sf(kt.from(t,n));if(!this.blobsShaCache.has(i)){this.blobsShaCache.set(i,"");let s=yield this.manager.createBlob(t,n);C(i===s.sha,182)}return i})}getIdFromPath(e,t,n){let i=t.split("/").map(s=>decodeURIComponent(s));return i[0]===""&&i.shift(),i.length===0?n.id:this.getIdFromPathCore(e,i,n)}getIdFromPathCore(e,t,n){var i;C(t.length>0,179);let s=t[0];if(t.length===1)switch(e){case Fr.Blob:{let o=n.blobs[s];return C(!!o,180),o}case Fr.Tree:{let o=(i=n.trees[s])===null||i===void 0?void 0:i.id;return C(!!o,181),o}default:throw Error(`Unexpected handle summary object type: "${e}".`)}return this.getIdFromPathCore(e,t.slice(1),n.trees[s])}};var hd=class{constructor(e){this.manager=e}writeSummaryTree(e,t,n,i){return y(this,null,function*(){let s=yield this.writeSummaryTreeCore(t,e,n,i??0);if(!s)throw new Error("Failed to write summary tree");return s})}writeSummaryTreeCore(e,t,n,i){return y(this,null,function*(){let o={entries:u0(e,t,"",n==="channel"?".app":"").entries,message:void 0,sequenceNumber:i,type:n};return this.manager.createSummary(o).then(a=>a.id)})}};var Xr=Object.create(null);Xr.open="0";Xr.close="1";Xr.ping="2";Xr.pong="3";Xr.message="4";Xr.upgrade="5";Xr.noop="6";var Fc=Object.create(null);Object.keys(Xr).forEach(r=>{Fc[Xr[r]]=r});var Pc={type:"error",data:"parser error"};var qT=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",LT=typeof ArrayBuffer=="function",jT=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Ic=({type:r,data:e},t,n)=>qT&&e instanceof Blob?t?n(e):MT(e,n):LT&&(e instanceof ArrayBuffer||jT(e))?t?n(e):MT(new Blob([e]),n):n(Xr[r]+(e||"")),MT=(r,e)=>{let t=new FileReader;return t.onload=function(){let n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)};function BT(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}var d0;function zT(r,e){if(qT&&r.data instanceof Blob)return r.data.arrayBuffer().then(BT).then(e);if(LT&&(r.data instanceof ArrayBuffer||jT(r.data)))return e(BT(r.data));Ic(r,!1,t=>{d0||(d0=new TextEncoder),e(d0.encode(t))})}var HT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Oc=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<HT.length;r++)Oc[HT.charCodeAt(r)]=r;var VT=r=>{let e=r.length*.75,t=r.length,n,i=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);let l=new ArrayBuffer(e),d=new Uint8Array(l);for(n=0;n<t;n+=4)s=Oc[r.charCodeAt(n)],o=Oc[r.charCodeAt(n+1)],a=Oc[r.charCodeAt(n+2)],c=Oc[r.charCodeAt(n+3)],d[i++]=s<<2|o>>4,d[i++]=(o&15)<<4|a>>2,d[i++]=(a&3)<<6|c&63;return l};var aH=typeof ArrayBuffer=="function",Nc=(r,e)=>{if(typeof r!="string")return{type:"message",data:UT(r,e)};let t=r.charAt(0);return t==="b"?{type:"message",data:cH(r.substring(1),e)}:Fc[t]?r.length>1?{type:Fc[t],data:r.substring(1)}:{type:Fc[t]}:Pc},cH=(r,e)=>{if(aH){let t=VT(r);return UT(t,e)}else return{base64:!0,data:r}},UT=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}};var GT="",WT=(r,e)=>{let t=r.length,n=new Array(t),i=0;r.forEach((s,o)=>{Ic(s,!1,a=>{n[o]=a,++i===t&&e(n.join(GT))})})},KT=(r,e)=>{let t=r.split(GT),n=[];for(let i=0;i<t.length;i++){let s=Nc(t[i],e);if(n.push(s),s.type==="error")break}return n};function $T(){return new TransformStream({transform(r,e){zT(r,t=>{let n=t.length,i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);let s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,n)}else{i=new Uint8Array(9);let s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(n))}r.data&&typeof r.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}var f0;function dd(r){return r.reduce((e,t)=>e+t.length,0)}function fd(r,e){if(r[0].length===e)return r.shift();let t=new Uint8Array(e),n=0;for(let i=0;i<e;i++)t[i]=r[0][n++],n===r[0].length&&(r.shift(),n=0);return r.length&&n<r[0].length&&(r[0]=r[0].slice(n)),t}function JT(r,e){f0||(f0=new TextDecoder);let t=[],n=0,i=-1,s=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(n===0){if(dd(t)<1)break;let c=fd(t,1);s=(c[0]&128)===128,i=c[0]&127,i<126?n=3:i===126?n=1:n=2}else if(n===1){if(dd(t)<2)break;let c=fd(t,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),n=3}else if(n===2){if(dd(t)<8)break;let c=fd(t,8),l=new DataView(c.buffer,c.byteOffset,c.length),d=l.getUint32(0);if(d>Math.pow(2,21)-1){a.enqueue(Pc);break}i=d*Math.pow(2,32)+l.getUint32(4),n=3}else{if(dd(t)<i)break;let c=fd(t,i);a.enqueue(Nc(s?c:f0.decode(c),e)),n=0}if(i===0||i>r){a.enqueue(Pc);break}}}})}var p0=4;function rt(r){if(r)return lH(r)}function lH(r){for(var e in rt.prototype)r[e]=rt.prototype[e];return r}rt.prototype.on=rt.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};rt.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};rt.prototype.off=rt.prototype.removeListener=rt.prototype.removeAllListeners=rt.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};rt.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};rt.prototype.emitReserved=rt.prototype.emit;rt.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};rt.prototype.hasListeners=function(r){return!!this.listeners(r).length};var Qt=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function pd(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}var uH=Qt.setTimeout,hH=Qt.clearTimeout;function Ln(r,e){e.useNativeTimers?(r.setTimeoutFn=uH.bind(Qt),r.clearTimeoutFn=hH.bind(Qt)):(r.setTimeoutFn=Qt.setTimeout.bind(Qt),r.clearTimeoutFn=Qt.clearTimeout.bind(Qt))}var dH=1.33;function XT(r){return typeof r=="string"?fH(r):Math.ceil((r.byteLength||r.size)*dH)}function fH(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}function YT(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function QT(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let s=t[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}var md=class extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}},jn=class extends rt{constructor(e){super(),this.writable=!1,Ln(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new md(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=Nc(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){let t=YT(e);return t.length?"?"+t:""}};var r5="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),m0=64,pH={},ZT=0,gd=0,e5;function t5(r){let e="";do e=r5[r%m0]+e,r=Math.floor(r/m0);while(r>0);return e}function vd(){let r=t5(+new Date);return r!==e5?(ZT=0,e5=r):r+"."+t5(ZT++)}for(;gd<m0;gd++)pH[r5[gd]]=gd;var n5=!1;try{n5=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var i5=n5;function g0(r){let e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||i5))return new XMLHttpRequest}catch{}if(!e)try{return new Qt[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function mH(){}var gH=function(){return new g0({xdomain:!1}).responseType!=null}(),bd=class extends jn{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){let n=location.protocol==="https:",i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}let t=e&&e.forceBase64;this.supportsBinary=gH&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};KT(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,WT(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=vd()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new yd(this.uri(),e)}doWrite(e,t){let n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}},yd=(()=>{class r extends rt{constructor(t,n){super(),Ln(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.data=n.data!==void 0?n.data:null,this.create()}create(){var t;let n=pd(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;let i=this.xhr=new g0(n);try{i.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&i.setRequestHeader(s,this.opts.extraHeaders[s])}}catch{}if(this.method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(t=this.opts.cookieJar)===null||t===void 0||t.addCookies(i),"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{var s;i.readyState===3&&((s=this.opts.cookieJar)===null||s===void 0||s.parseCookies(i)),i.readyState===4&&(i.status===200||i.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof i.status=="number"?i.status:0)},0))},i.send(this.data)}catch(s){this.setTimeoutFn(()=>{this.onError(s)},0);return}typeof document<"u"&&(this.index=r.requestsCount++,r.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=mH,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete r.requests[this.index],this.xhr=null}}onLoad(){let t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return r.requestsCount=0,r.requests={},r})();if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",s5);else if(typeof addEventListener=="function"){let r="onpagehide"in Qt?"pagehide":"unload";addEventListener(r,s5,!1)}}function s5(){for(let r in yd.requests)yd.requests.hasOwnProperty(r)&&yd.requests[r].abort()}var as=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Rc=Qt.WebSocket||Qt.MozWebSocket,xd=!0,o5="arraybuffer";var a5=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",Sd=class extends jn{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,n=a5?{}:pd(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=xd&&!a5?t?new Rc(e,t):new Rc(e):new Rc(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],i=t===e.length-1;Ic(n,this.supportsBinary,s=>{let o={};xd||(n.options&&(o.compress=n.options.compress),this.opts.perMessageDeflate&&(typeof s=="string"?Buffer.byteLength(s):s.length)<this.opts.perMessageDeflate.threshold&&(o.compress=!1));try{xd?this.ws.send(s):this.ws.send(s,o)}catch{}i&&as(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=vd()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!Rc}};var wd=class extends jn{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{let t=JT(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=$T();i.readable.pipeTo(e.writable),this.writer=i.writable.getWriter();let s=()=>{n.read().then(({done:a,value:c})=>{a||(this.onPacket(c),s())}).catch(a=>{})};s();let o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],i=t===e.length-1;this.writer.write(n).then(()=>{i&&as(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}};var v0={websocket:Sd,webtransport:wd,polling:bd};var vH=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,yH=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ko(r){if(r.length>2e3)throw"URI too long";let e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=vH.exec(r||""),s={},o=14;for(;o--;)s[yH[o]]=i[o]||"";return t!=-1&&n!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=bH(s,s.path),s.queryKey=xH(s,s.query),s}function bH(r,e){let t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function xH(r,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(t[i]=s)}),t}var Cd=(()=>{class r extends rt{constructor(t,n={}){super(),this.binaryType=o5,this.writeBuffer=[],t&&typeof t=="object"&&(n=t,t=null),t?(t=ko(t),n.hostname=t.host,n.secure=t.protocol==="https"||t.protocol==="wss",n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=ko(n.host).host),Ln(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=QT(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){let n=Object.assign({},this.opts.query);n.EIO=p0,n.transport=t,this.id&&(n.sid=this.id);let i=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new v0[t](i)}open(){let t;if(this.opts.rememberUpgrade&&r.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),i=!1;r.priorWebsocketSuccess=!1;let s=()=>{i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",u=>{if(!i)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;r.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{let f=new Error("probe error");f.transport=n.name,this.emitReserved("upgradeError",f)}}))};function o(){i||(i=!0,h(),n.close(),n=null)}let a=u=>{let f=new Error("probe error: "+u);f.transport=n.name,o(),this.emitReserved("upgradeError",f)};function c(){a("transport closed")}function l(){a("socket closed")}function d(u){n&&u.name!==n.name&&o()}let h=()=>{n.removeListener("open",s),n.removeListener("error",a),n.removeListener("close",c),this.off("close",l),this.off("upgrading",d)};n.once("open",s),n.once("error",a),n.once("close",c),this.once("close",l),this.once("upgrading",d),this.upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{i||n.open()},200):n.open()}onOpen(){if(this.readyState="open",r.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0,n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let i=0;i<this.writeBuffer.length;i++){let s=this.writeBuffer[i].data;if(s&&(n+=XT(s)),i>0&&n>this.maxPayload)return this.writeBuffer.slice(0,i);n+=2}return this.writeBuffer}write(t,n,i){return this.sendPacket("message",t,n,i),this}send(t,n,i){return this.sendPacket("message",t,n,i),this}sendPacket(t,n,i,s){if(typeof n=="function"&&(s=n,n=void 0),typeof i=="function"&&(s=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;let o={type:t,data:n,options:i};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),s&&this.once("flush",s),this.flush()}close(){let t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},i=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():t()}):this.upgrading?i():t()),this}onError(t){r.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){let n=[],i=0,s=t.length;for(;i<s;i++)~this.transports.indexOf(t[i])&&n.push(t[i]);return n}}return r.protocol=p0,r})();var wue=Cd.protocol;function c5(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=ko(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let s=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}var C0={};Pi(C0,{Decoder:()=>S0,Encoder:()=>x0,PacketType:()=>Fe,protocol:()=>f5});var SH=typeof ArrayBuffer=="function",wH=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,l5=Object.prototype.toString,CH=typeof Blob=="function"||typeof Blob<"u"&&l5.call(Blob)==="[object BlobConstructor]",EH=typeof File=="function"||typeof File<"u"&&l5.call(File)==="[object FileConstructor]";function Mc(r){return SH&&(r instanceof ArrayBuffer||wH(r))||CH&&r instanceof Blob||EH&&r instanceof File}function kc(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(kc(r[t]))return!0;return!1}if(Mc(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return kc(r.toJSON(),!0);for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&kc(r[t]))return!0;return!1}function u5(r){let e=[],t=r.data,n=r;return n.data=y0(t,e),n.attachments=e.length,{packet:n,buffers:e}}function y0(r,e){if(!r)return r;if(Mc(r)){let t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=y0(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){let t={};for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=y0(r[n],e));return t}return r}function h5(r,e){return r.data=b0(r.data,e),delete r.attachments,r}function b0(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=b0(r[t],e);else if(typeof r=="object")for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=b0(r[t],e));return r}var _H=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],f5=5,Fe=function(r){return r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK",r}(Fe||{}),x0=class{constructor(e){this.replacer=e}encode(e){return(e.type===Fe.EVENT||e.type===Fe.ACK)&&kc(e)?this.encodeAsBinary({type:e.type===Fe.EVENT?Fe.BINARY_EVENT:Fe.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Fe.BINARY_EVENT||e.type===Fe.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=u5(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}};function d5(r){return Object.prototype.toString.call(r)==="[object Object]"}var S0=class r extends rt{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let n=t.type===Fe.BINARY_EVENT;n||t.type===Fe.BINARY_ACK?(t.type=n?Fe.EVENT:Fe.ACK,this.reconstructor=new w0(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Mc(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,n={type:Number(e.charAt(0))};if(Fe[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===Fe.BINARY_EVENT||n.type===Fe.BINARY_ACK){let s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){let s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(s,t)}else n.nsp="/";let i=e.charAt(t+1);if(i!==""&&Number(i)==i){let s=t+1;for(;++t;){let o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){let s=this.tryParse(e.substr(t));if(r.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case Fe.CONNECT:return d5(t);case Fe.DISCONNECT:return t===void 0;case Fe.CONNECT_ERROR:return typeof t=="string"||d5(t);case Fe.EVENT:case Fe.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&_H.indexOf(t[0])===-1);case Fe.ACK:case Fe.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},w0=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=h5(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function Pr(r,e,t){return r.on(e,t),function(){r.off(e,t)}}var TH=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Mo=class extends rt{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[Pr(e,"open",this.onopen.bind(this)),Pr(e,"packet",this.onpacket.bind(this)),Pr(e,"error",this.onerror.bind(this)),Pr(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(TH.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let n={type:Fe.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let o=this.ids++,a=t.pop();this._registerAckCallback(o,a),n.id=o}let i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;let i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}let s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(s),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((n,i)=>{let s=(o,a)=>o?i(o):n(a);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Fe.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){let n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Fe.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Fe.EVENT:case Fe.BINARY_EVENT:this.onevent(e);break;case Fe.ACK:case Fe.BINARY_ACK:this.onack(e);break;case Fe.DISCONNECT:this.ondisconnect();break;case Fe.CONNECT_ERROR:this.destroy();let n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,n=!1;return function(...i){n||(n=!0,t.packet({type:Fe.ACK,id:e,data:i}))}}onack(e){let t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Fe.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let n of t)n.apply(this,e.data)}}};function cs(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}cs.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};cs.prototype.reset=function(){this.attempts=0};cs.prototype.setMin=function(r){this.ms=r};cs.prototype.setMax=function(r){this.max=r};cs.prototype.setJitter=function(r){this.jitter=r};var Bo=class extends rt{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Ln(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new cs({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let i=t.parser||C0;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Cd(this.uri,this.opts);let t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;let i=Pr(t,"open",function(){n.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=Pr(t,"error",s);if(this._timeout!==!1){let a=this._timeout,c=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),t.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(Pr(e,"ping",this.onping.bind(this)),Pr(e,"data",this.ondata.bind(this)),Pr(e,"error",this.onerror.bind(this)),Pr(e,"close",this.onclose.bind(this)),Pr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){as(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Mo(this,e,t),this.nsps[e]=n),n}_destroy(e){let t=Object.keys(this.nsps);for(let n of t)if(this.nsps[n].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var Bc={};function qc(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};let t=c5(r,e.path||"/socket.io"),n=t.source,i=t.id,s=t.path,o=Bc[i]&&s in Bc[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o,c;return a?c=new Bo(n,e):(Bc[i]||(Bc[i]=new Bo(n,e)),c=Bc[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(qc,{Manager:Bo,Socket:Mo,io:qc,connect:qc});xe();te();xe();var Yr=class{constructor(){this.cache=new Map}get(e){return y(this,null,function*(){return this.cache.get(e)})}put(e,t){return y(this,null,function*(){this.cache.set(e,t)})}};var p5="latest",Ed=class{constructor(e,t,n,i={},s,o=new Yr,a=new Yr,c,l=d=>y(this,null,function*(){return d&&this.noCacheGitManager!==void 0?this.noCacheGitManager:this.manager})){this.id=e,this.manager=t,this.logger=n,this.policies=i,this.driverPolicies=s,this.blobCache=o,this.snapshotTreeCache=a,this.noCacheGitManager=c,this.getStorageManager=l,this.firstVersionsCall=!0}get repositoryUrl(){return""}getSummaryUploadManager(){return y(this,null,function*(){let e=yield this.getStorageManager();return new hd(e)})}getVersions(e,t){return y(this,null,function*(){var n;if(e!==this.id&&e!==null)return[{id:e,treeId:void 0}];if(this.firstVersionsCall&&t===1){this.firstVersionsCall=!1;let{id:o,snapshotTree:a}=!((n=this.driverPolicies)===null||n===void 0)&&n.enableDiscovery?yield this.fetchAndCacheSnapshotTree(p5,!0):yield this.fetchAndCacheSnapshotTree(p5,!1);return[{id:o,treeId:a.id}]}let i=e||this.id;return(yield ce.timedExecAsync(this.logger,{eventName:"getVersions",versionId:i,count:t},()=>y(this,null,function*(){return(yield this.getStorageManager()).getCommits(i,t)}))).map(o=>({date:o.commit.author.date,id:o.sha,treeId:o.commit.tree.sha}))})}getSnapshotTree(e){return y(this,null,function*(){let t=e;if(!t){let n=yield this.getVersions(this.id,1);if(n.length===0)return null;t=n[0]}return(yield this.fetchAndCacheSnapshotTree(t.id)).snapshotTree})}readBlob(e){return y(this,null,function*(){let t=yield this.blobCache.get(this.getCacheKey(e));if(t!==void 0)return t;let n=yield ce.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},s=>y(this,null,function*(){let a=yield(yield this.getStorageManager()).getBlob(e);return s.end({size:a.size}),a})),i=Er(n.content,n.encoding);return yield this.blobCache.put(this.getCacheKey(n.sha),i),i})}uploadSummaryWithContext(e,t){return y(this,null,function*(){return yield ce.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},()=>y(this,null,function*(){var i;return(yield this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")}))})}downloadSummary(e){return y(this,null,function*(){let t=yield ce.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e.handle},s=>y(this,null,function*(){var o;let c=yield(yield this.getStorageManager()).getSummary(e.handle);return s.end({size:(o=c.trees[0])===null||o===void 0?void 0:o.entries.length}),c})),{blobs:n,snapshotTree:i}=h0(t,"");return Gm(i,n)})}createBlob(e){return y(this,null,function*(){let t=new Uint8Array(e);return ce.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},n=>y(this,null,function*(){let s=yield(yield this.getStorageManager()).createBlob(cr(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return n.end({blobId:s.id}),s}))})}fetchAndCacheSnapshotTree(e,t){return y(this,null,function*(){let n=yield this.snapshotTreeCache.get(this.getCacheKey(e));if(n!==void 0)return{id:n.id,snapshotTree:n.snapshotTree};let i=yield ce.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e},d=>y(this,null,function*(){var h;let f=yield(yield this.getStorageManager(t)).getSummary(e);return d.end({size:(h=f.trees[0])===null||h===void 0?void 0:h.entries.length}),f})),s=h0(i),o=i.id,a=s.snapshotTree.id;C(a!==void 0,629);let c={id:o,snapshotTree:s.snapshotTree},l=[this.snapshotTreeCache.put(this.getCacheKey(a),c),this.initBlobCache(s.blobs)];return a!==e&&l.push(this.snapshotTreeCache.put(this.getCacheKey(e),c)),yield Promise.all(l),c})}initBlobCache(e){return y(this,null,function*(){let t=[];e.forEach((n,i)=>{let s=this.getCacheKey(i);t.push(this.blobCache.put(s,n))}),yield Promise.all(t)})}getCacheKey(e){return`${this.id}:${e}`}};te();Tn();xe();var _d=class{constructor(e,t){this.internalGitManager=e,this.logger=t}getHeader(e,t){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.getHeader(e,t)}),"gitManager_getHeader")})}getFullTree(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.getFullTree(e)}),"gitManager_getFullTree")})}getCommit(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.getCommit(e)}),"gitManager_getCommit")})}getCommits(e,t){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.getCommits(e,t)}),"gitManager_getCommits")})}getTree(e,t){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.getTree(e,t)}),"gitManager_getTree")})}getBlob(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.getBlob(e)}),"gitManager_getBlob")})}getRawUrl(e){return this.internalGitManager.getRawUrl(e)}getContent(e,t){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.getContent(e,t)}),"gitManager_getContent")})}createBlob(e,t){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.createBlob(e,t)}),"gitManager_createBlob")})}createGitTree(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.createGitTree(e)}),"gitManager_createGitTree")})}createTree(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.createTree(e)}),"gitManager_createTree")})}createCommit(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.createCommit(e)}),"gitManager_createCommit")})}getRef(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.getRef(e)}),"gitManager_getRef")})}createRef(e,t){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.createRef(e,t)}),"gitManager_createRef")})}upsertRef(e,t){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.upsertRef(e,t)}),"gitManager_upsertRef")})}write(e,t,n,i){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.write(e,t,n,i)}),"gitManager_write")})}createSummary(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.createSummary(e)}),"gitManager_createSummary")})}deleteSummary(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.deleteSummary(e)}),"gitManager_deleteSummary")})}getSummary(e){return y(this,null,function*(){return this.runWithRetry(()=>y(this,null,function*(){return this.internalGitManager.getSummary(e)}),"gitManager_getSummary")})}runWithRetry(e,t){return y(this,null,function*(){return co(e,t,this.logger,{})})}};var AH=typeof window>"u",Td=class{constructor(e,t,n,i={},s,o,a,c=()=>y(this,null,function*(){return this.manager})){this.id=e,this.manager=t,this.logger=n,this.policies=i,this.getStorageManager=c,this.blobsShaCache=new Map,(s?.enableRestLess===!0||AH)&&(this.blobCache=o??new Yr,this.snapshotTreeCache=a??new Yr)}get repositoryUrl(){return""}getSummaryUploadManager(){return y(this,null,function*(){let e=yield this.getStorageManager();return new ud(new _d(e,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this))})}getVersions(e,t){return y(this,null,function*(){let n=e||this.id;return(yield ce.timedExecAsync(this.logger,{eventName:"getVersions",versionId:n,count:t},()=>y(this,null,function*(){return(yield this.getStorageManager()).getCommits(n,t)}))).map(s=>({date:s.commit.author.date,id:s.sha,treeId:s.commit.tree.sha}))})}getSnapshotTree(e){return y(this,null,function*(){var t,n;let i=e;if(!i){let c=yield this.getVersions(this.id,1);if(c.length===0)return null;i=c[0]}let s=yield(t=this.snapshotTreeCache)===null||t===void 0?void 0:t.get(this.getCacheKey(i.treeId));if(s)return s.snapshotTree;let o=yield ce.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:i.treeId},c=>y(this,null,function*(){let d=yield(yield this.getStorageManager()).getTree(i.treeId);return c.end({size:d.tree.length}),d})),a=Hs(o,this.blobsShaCache,!0);return yield(n=this.snapshotTreeCache)===null||n===void 0?void 0:n.put(this.getCacheKey(a.id),{id:i.id,snapshotTree:a}),a})}readBlob(e){return y(this,null,function*(){var t,n;let i=yield(t=this.blobCache)===null||t===void 0?void 0:t.get(this.getCacheKey(e));if(i)return i;let s=yield ce.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},a=>y(this,null,function*(){let l=yield(yield this.getStorageManager()).getBlob(e);return a.end({size:l.size}),l}));this.blobsShaCache.set(s.sha,"");let o=Er(s.content,s.encoding);return yield(n=this.blobCache)===null||n===void 0?void 0:n.put(this.getCacheKey(s.sha),o),o})}uploadSummaryWithContext(e,t){return y(this,null,function*(){return yield ce.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},()=>y(this,null,function*(){var i;return(yield this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")}))})}downloadSummary(e){return y(this,null,function*(){throw new Error("NOT IMPLEMENTED!")})}createBlob(e){return y(this,null,function*(){let t=new Uint8Array(e);return ce.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},n=>y(this,null,function*(){let s=yield(yield this.getStorageManager()).createBlob(cr(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return n.end({blobId:s.id}),s}))})}getPreviousFullSnapshot(e){return y(this,null,function*(){return e?this.getVersions(e,1).then(t=>y(this,null,function*(){return this.blobsShaCache.clear(),this.getSnapshotTree(t[0])})):void 0})}getCacheKey(e){return`${this.id}:${e}`}};var Ad=class r extends Xn{constructor(e,t,n,i={},s,o,a,c,l){super(r.loadInternalDocumentStorageService(e,t,n,i,s,o,a,c,l)),this.id=e,this.manager=t,this.noCacheGitManager=c,this._logTailSha=void 0}get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(e,t,n,i,s,o,a,c,l){let d=s?.enableWholeSummaryUpload?new Ed(e,t,n,i,s,o,a,c,l):new Td(e,t,n,i,s,o,a,l);return!s?.enableWholeSummaryUpload&&i.caching===oi.Prefetch?new mu(d):d}getSnapshotTree(e){return y(this,null,function*(){let t=yield this.internalStorageService.getSnapshotTree(e);return t!==null&&(this._logTailSha=".logTail"in t.trees?t.trees[".logTail"].blobs.logTail:void 0),t})}};te();var E0=function(r){return r.DocRead="doc:read",r.DocWrite="doc:write",r.SummaryWrite="summary:write",r}(E0||{});xe();var _0="1.4.0";var m5=(()=>{class r extends _n{constructor(t,n,i,s=!1){super((o,a)=>{i.sendErrorEvent({eventName:"DeltaConnection:EventException",name:o},a)}),this.socket=t,this.documentId=n,this.enableLongPollingDowngrades=s,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(o,a)=>{this.queuedMessages.push(...a)},this.earlySignalHandler=o=>{this.queuedSignals.push(o)},this.mc=ur(ue.create(i,"DeltaConnection")),this.on("newListener",(o,a)=>{if(C(!this.disposed,522),r.eventsAlwaysForwarded.includes(o)){C(this.trackedListeners.has(o),581);return}if(!r.eventsToForward.includes(o))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${o}`);C(this.listeners(o).length!==0===this.trackedListeners.has(o),523),this.trackedListeners.has(o)||this.addTrackedListener(o,(...c)=>{this.emit(o,...c)})})}get hasDetails(){return!!this._details}get disposed(){return C(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotClosed(){C(!this.disposed,524)}get initialMessages(){return this.checkNotClosed(),C(this.earlyOpHandlerAttached,142),C(this.listeners("op").length!==0,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort((t,n)=>t.sequenceNumber-n.sequenceNumber),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotClosed(),C(this.listeners("signal").length!==0,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotClosed(),this.details.initialClients}emitMessages(t,n){this.disposed||this.socket.emit(t,this.clientId,n)}submitCore(t,n){this.emitMessages(t,[n])}submit(t){this.checkNotClosed(),this.submitCore("submitOp",t)}submitSignal(t){this.checkNotClosed(),this.submitCore("submitSignal",[t])}dispose(){this.disposeCore(!1,cn("Client closing delta connection",{canRetry:!0},{driverVersion:_0}))}disposeCore(t,n){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(t,n))}disconnect(t,n){this.socket.disconnect()}initialize(t,n){return y(this,null,function*(){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0;let i=0,s=()=>this.socket.io.reconnection(),o=()=>s()?this.socket.io.reconnectionAttempts():0,a=()=>o()+1;this._details=yield new Promise((c,l)=>{let d=(h,u)=>{this.disposeCore(h,u),l(u)};this.addConnectionListener("connect_error",h=>{var u;i++;let f=!1;try{let g=h?.description;g&&typeof g=="object"&&(h.type==="TransportError"&&(f=!0),g.target=void 0)}catch{}f&&this.enableLongPollingDowngrades&&((u=this.socket.io.opts.transports)===null||u===void 0?void 0:u[0])!=="polling"&&(this.socket.io.opts.transports=["polling","websocket"],s()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),!(s()&&i<a())&&d(!0,this.createErrorObject("connect_error",h))}),this.addConnectionListener("connect_timeout",()=>{d(!0,this.createErrorObject("connect_timeout"))}),this.addConnectionListener("connect_document_success",h=>{if(t.nonce!==void 0&&h.nonce!==void 0&&h.nonce!==t.nonce)return;let u=t.mode,f=h.mode;if(h.claims.scopes.includes(E0.DocWrite)){if(f!==u){d(!1,this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1));return}}else if(f==="write"){d(!1,this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));return}this.checkpointSequenceNumber=h.checkpointSequenceNumber,this.removeConnectionListeners(),c(h)}),this.addTrackedListener("disconnect",h=>{let u=this.createErrorObject("disconnect",h);this.emit("disconnect",u),d(!0,u)}),this.addTrackedListener("error",h=>{let u=this.createErrorObject("error",h,h!=="Invalid namespace");this.emit("error",u),d(!0,u)}),this.addConnectionListener("connect_document_error",h=>{t.nonce!==void 0&&h.nonce!==void 0&&h.nonce!==t.nonce||d(!1,this.createErrorObject("connect_document_error",h))}),this.socket.emit("connect_document",t),this.socketConnectionTimeout=setTimeout(()=>{d(!1,this.createErrorObject("orderingServiceHandshakeTimeout"))},n+2e3)}),C(!this.disposed,582)})}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(t,n){C(!r.eventsAlwaysForwarded.includes(t),583),C(!r.eventsToForward.includes(t),584),this.socket.on(t,n),C(!this.connectionListeners.has(t),525),this.connectionListeners.set(t,n)}addTrackedListener(t,n){this.socket.on(t,n),C(!this.trackedListeners.has(t),526),this.trackedListeners.set(t,n)}removeTrackedListeners(){for(let[t,n]of this.trackedListeners.entries())this.socket.off(t,n);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){this.socketConnectionTimeout!==void 0&&clearTimeout(this.socketConnectionTimeout);for(let[t,n]of this.connectionListeners.entries())this.socket.off(t,n);this.connectionListeners.clear()}createErrorObject(t,n,i=!0){let s;return n?.type==="TransportError"?s=`${n?.message!==void 0?`${n.message}: `:""}${JSON.stringify(n,xp())}`:s=Af(n).message,cn(`socket.io (${t}): ${s}`,{canRetry:i},{driverVersion:_0})}}return r.eventsToForward=["nack","op","signal","pong"],r.eventsAlwaysForwarded=["disconnect","error"],r})();var Ai="1.4.0";var g5=function(r){return r.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",r}(g5||{});function v5(r,e,t){let n={statusCode:e,driverVersion:Ai};switch(e){case void 0:return new oo(r,r.startsWith("NetworkError"),n);case 401:case 403:return new fu(r,void 0,void 0,n);case 404:let i=g5.fileNotFoundOrAccessDeniedError;return new Fn(r,i,n);case 429:return cn(r,{canRetry:!0,retryAfterMs:t},n);case 500:case 502:return new oo(r,!0,n);default:return cn(r,{canRetry:t!==void 0,retryAfterMs:t},n)}}function T0(r,e,t){throw v5(r,e,t)}function y5(r,e){let t=`R11s socket error (${e}): ${r.message}`;return v5(t,r.code,r.retryAfterMs)}var DH=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"],Dd=class r extends m5{static create(e,t,n,i,s,o,a,c=2e4){return y(this,null,function*(){let l=i(o,{query:{documentId:t,tenantId:e},reconnection:!1,transports:["websocket"],timeout:c}),d={client:s,id:t,mode:s.mode,tenantId:e,token:n,versions:DH,relayUserAgent:[s.details.environment,` driverVersion:${Ai}`].join(";")},h=!0,u=new r(l,t,a,h);return yield u.initialize(d,c),u})}createErrorObject(e,t,n=!0){return n&&Number.isInteger(t?.code)&&typeof t?.message=="string"?y5(t,e):super.createErrorObject(e,t,n)}};var Fd=class{get repositoryUrl(){throw new Error("Invalid operation")}getSnapshotTree(e){return y(this,null,function*(){return e?Promise.reject(new Error("Invalid operation")):null})}getVersions(e,t){return y(this,null,function*(){return[]})}uploadSummaryWithContext(e,t){return y(this,null,function*(){return Promise.reject(new Error("Invalid operation"))})}downloadSummary(e){return y(this,null,function*(){return Promise.reject(new Error("Invalid operation"))})}createBlob(e){return y(this,null,function*(){return Promise.reject(new Error("Null blob storage can not create blob"))})}readBlob(e){return y(this,null,function*(){return Promise.reject(new Error("Null blob storage can not read blob"))})}};te();xe();var w5=ye(S5()),A0=ye(c0());Dt();var FH=r=>{var e,t;let n=r.baseURL!==void 0?`${r.baseURL}${(e=r.url)!==null&&e!==void 0?e:""}`:(t=r.url)!==null&&t!==void 0?t:"",i={method:r.method,headers:r.headers,body:r.data};return[n,i]},Id=class extends Ac{constructor(e,t,n,i,s,o={}){super(s,o),this.rateLimiter=t,this.getAuthorizationHeader=n,this.useRestLess=i,this.restLess=new ld}load(){return y(this,null,function*(){this.authorizationHeader=yield this.getAuthorizationHeader()})}request(e,t,n=!0){return y(this,null,function*(){var i;let s=Object.assign(Object.assign({},e),{headers:this.generateHeaders(e.headers)}),o=this.useRestLess?this.restLess.translate(s):s,a=FH(o),c=yield this.rateLimiter.schedule(()=>y(this,null,function*(){return(0,w5.default)(...a).catch(h=>y(this,null,function*(){let u=["TypeError","FetchError"].includes(h?.name);T0(u?`NetworkError: ${h.message}`:(0,A0.default)(h))}))})),l=!((i=c.headers.get("content-type"))===null||i===void 0)&&i.includes("application/json")?yield c.json():yield c.text();if(c.ok||c.status===t)return l;if(c.status===401&&n)return this.authorizationHeader=yield this.getAuthorizationHeader(!0),this.request(s,t,!1);if(c.status===429&&l?.retryAfter>0)return new Promise((h,u)=>setTimeout(()=>{this.request(s,t).then(h).catch(u)},l.retryAfter*1e3));let d=l!==void 0?typeof l=="string"?l:(0,A0.default)(l):c.statusText;T0(`R11s fetch error: ${d}`,c.status,l?.retryAfter)})}generateHeaders(e){let t=e?.["x-correlation-id"]||Te();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":Ai,Authorization:this.authorizationHeader})}},Od=class r extends Id{constructor(e,t,n,i,s,o={}){super(e,t,n,i,s,o)}static load(e,t,n,i,s,o,a){return y(this,null,function*(){let c={token:`${ra(e)}`},l=h=>y(this,null,function*(){return ce.timedExecAsync(i,{eventName:"FetchStorageToken",docId:t},()=>y(this,null,function*(){let f={password:(yield n.fetchStorageToken(e,t,h)).jwt,user:e};return kT(f)}))}),d=new r(i,s,l,o,a,c);try{yield d.load()}catch(h){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},h),yield d.load()}return d})}},ls=class r extends Id{constructor(e,t,n,i,s,o={}){super(e,t,n,i,s,o)}static load(e,t,n,i,s,o,a){return y(this,null,function*(){let c=d=>y(this,null,function*(){return ce.timedExecAsync(i,{eventName:"FetchOrdererToken",docId:t},()=>y(this,null,function*(){return`Basic ${(yield n.fetchOrdererToken(e,t,d)).jwt}`}))}),l=new r(i,s,c,o,a);try{yield l.load()}catch(d){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},d),yield l.load()}return l})}};var PH=5*6e4,Nd=class{constructor(e,t,n,i,s,o,a,c,l,d,h,u){this._resolvedUrl=e,this.ordererUrl=t,this.deltaStorageUrl=n,this.storageUrl=i,this.logger=s,this.tokenProvider=o,this.tenantId=a,this.documentId=c,this.driverPolicies=l,this.blobCache=d,this.snapshotTreeCache=h,this.discoverFluidResolvedUrl=u,this.lastDiscoveredAt=Date.now()}get resolvedUrl(){return this._resolvedUrl}dispose(){}connectToStorage(){return y(this,null,function*(){if(this.documentStorageService!==void 0)return this.documentStorageService;if(this.storageUrl===void 0)return new Fd;let e=s=>y(this,null,function*(){let o=this.shouldUpdateDiscoveredSessionInfo();if(o&&(yield this.refreshDiscovery()),!this.storageManager||!this.noCacheStorageManager||o){let a=new fi(this.driverPolicies.maxConcurrentStorageRequests),c=yield Od.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,a,this.driverPolicies.enableRestLess,this.storageUrl),l=new Dc(this.storageUrl,!0,!1,c);this.storageManager=new Ec(l);let d=new Dc(this.storageUrl,!0,!0,c);this.noCacheStorageManager=new Ec(d)}return s?this.noCacheStorageManager:this.storageManager}),t=yield e(),n=yield e(!0),i={caching:this.driverPolicies.enablePrefetch?oi.Prefetch:oi.NoCaching,minBlobSize:this.driverPolicies.aggregateBlobsSmallerThanBytes};return this.documentStorageService=new Ad(this.documentId,t,this.logger,i,this.driverPolicies,this.blobCache,this.snapshotTreeCache,n,e),this.documentStorageService})}connectToDeltaStorage(){return y(this,null,function*(){yield this.connectToStorage(),C(!!this.documentStorageService,177);let e=()=>y(this,null,function*(){let i=this.shouldUpdateDiscoveredSessionInfo();if(i&&(yield this.refreshDiscovery()),!this.ordererRestWrapper||i){let s=new fi(this.driverPolicies.maxConcurrentOrdererRequests);this.ordererRestWrapper=yield ls.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,s,this.driverPolicies.enableRestLess)}return this.ordererRestWrapper}),t=yield e(),n=new Gh(this.deltaStorageUrl,t,this.logger,e,()=>this.deltaStorageUrl);return new Uh(this.tenantId,this.documentId,n,this.documentStorageService)})}connectToDeltaStream(e){return y(this,null,function*(){let t=n=>y(this,null,function*(){this.shouldUpdateDiscoveredSessionInfo()&&(yield this.refreshDiscovery());let i=yield ce.timedExecAsync(this.logger,{eventName:"GetDeltaStreamToken",docId:this.documentId,details:JSON.stringify({refreshToken:n})},()=>y(this,null,function*(){return this.tokenProvider.fetchOrdererToken(this.tenantId,this.documentId,n)}));return ce.timedExecAsync(this.logger,{eventName:"ConnectToDeltaStream",docId:this.documentId},()=>y(this,null,function*(){return Dd.create(this.tenantId,this.documentId,i.jwt,qc,e,this.ordererUrl,this.logger)}))});try{return yield t()}catch(n){if(n?.statusCode===401)return t(!0);throw n}})}refreshDiscovery(){return y(this,null,function*(){return this.discoverP||(this.discoverP=ce.timedExecAsync(this.logger,{eventName:"RefreshDiscovery"},()=>y(this,null,function*(){return this.refreshDiscoveryCore()}))),this.discoverP})}refreshDiscoveryCore(){return y(this,null,function*(){let e=yield this.discoverFluidResolvedUrl();this._resolvedUrl=e,this.storageUrl=e.endpoints.storageUrl,this.ordererUrl=e.endpoints.ordererUrl,this.deltaStorageUrl=e.endpoints.deltaStorageUrl})}shouldUpdateDiscoveredSessionInfo(){if(!this.driverPolicies.enableDiscovery)return!1;let t=Date.now()-this.lastDiscoveredAt>PH;return t&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch(()=>{this.lastDiscoveredAt=0})),t}};te();xe();te();var Lc=function(r){return r.Tree=1,r.Blob=2,r.Handle=3,r.Attachment=4,r}(Lc||{});function D0(r){let e=Object.keys(r.tree);for(let t of e){let n=r.tree[t];switch(n.type){case Lc.Tree:{r.tree[t]=D0(n);break}case Lc.Blob:{n.content=typeof n.content=="string"?n.content:cr(n.content,"utf8");break}case Lc.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error(`Unknown tree type ${n.type}`)}}return r}var us=ye(k5());var jc=r=>new us.default(r,!0),O0=(r,e)=>r.split("/").slice(0,-1).concat([e]).join("/"),N0=(r,e)=>{if(e){let t=new us.default(e.ordererUrl),n=new us.default(r.endpoints.deltaStorageUrl);n.set("host",t.host);let i=new us.default(e.historianUrl),s=new us.default(r.endpoints.storageUrl);s.set("host",i.host);let o=jc(r.url);return{endpoints:{deltaStorageUrl:n.toString(),ordererUrl:e.ordererUrl,storageUrl:s.toString()},id:r.id,tokens:r.tokens,type:r.type,url:new us.default(`fluid://${t.host}${o.pathname}`).toString()}}else return r};var HH={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0},kd=class{constructor(e,t={}){this.tokenProvider=e,this.protocolName="fluid:",this.blobCache=new Yr,this.snapshotTreeCache=new Yr,this.driverPolicies=Object.assign(Object.assign({},HH),t)}createContainer(e,t,n,i){return y(this,null,function*(){if(rr(t),e===void 0)throw new Error("Empty file summary creation isn't supported in this driver.");C(!!t.endpoints.ordererUrl,178);let s=jc(t.url);if(!s.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");let[,o]=s.pathname.split("/"),a=e.tree[".protocol"],c=e.tree[".app"];if(!(a&&c))throw new Error("Protocol and App Summary required in the full summary");let l=KE(a),d=$E(a),h=ue.create(n,"RouterliciousDriver"),u=new fi(this.driverPolicies.maxConcurrentOrdererRequests),f=yield ls.load(o,void 0,this.tokenProvider,h,u,this.driverPolicies.enableRestLess,t.endpoints.ordererUrl),g=yield ce.timedExecAsync(h,{eventName:"CreateNew",details:JSON.stringify({enableDiscovery:this.driverPolicies.enableDiscovery,sequenceNumber:l.sequenceNumber})},A=>y(this,null,function*(){let D=yield f.post(`/documents/${o}`,{summary:D0(c),sequenceNumber:l.sequenceNumber,values:d,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:this.tokenProvider.documentPostCreateCallback!==void 0});return A.end({docId:typeof D=="string"?D:D.id}),D})),m,b,v;typeof g=="string"?m=g:(m=g.id,b=g.token,v=this.driverPolicies.enableDiscovery?g.session:void 0),s=jc(t.url);try{yield ce.timedExecAsync(h,{eventName:"DocPostCreateCallback",docId:m},()=>y(this,null,function*(){if(b&&this.tokenProvider.documentPostCreateCallback!==void 0)return this.tokenProvider.documentPostCreateCallback(m,b)}))}catch(A){throw new R0(A)}s.set("pathname",O0(s.pathname,m));let x=t.endpoints.deltaStorageUrl;if(!x)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${x}]`);let _=new URL(x);return _.pathname=O0(_.pathname,m),this.createDocumentService(Object.assign(Object.assign({},t),{url:s.toString(),id:m,endpoints:Object.assign(Object.assign({},t.endpoints),{deltaStorageUrl:_.toString()})}),n,i,v)})}createDocumentService(e,t,n,i){return y(this,null,function*(){rr(e);let s=jc(e.url),[,o,a]=s.pathname.split("/");if(!a||!o)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${a}][tenantId:${o}]`);let c=ue.create(t,"RouterliciousDriver",{all:{driverVersion:Ai}}),l=()=>y(this,null,function*(){if(!this.driverPolicies.enableDiscovery)return e;let g=new fi(this.driverPolicies.maxConcurrentOrdererRequests),m=yield ls.load(o,a,this.tokenProvider,c,g,this.driverPolicies.enableRestLess,e.endpoints.ordererUrl),b=yield ce.timedExecAsync(c,{eventName:"DiscoverSession",docId:a},()=>y(this,null,function*(){return m.get(`/documents/${o}/session/${a}`)}));return N0(e,b)}),d=i!==void 0?N0(e,i):yield l(),h=d.endpoints.storageUrl,u=d.endpoints.ordererUrl,f=d.endpoints.deltaStorageUrl;if(!u||!f)throw new Error(`All endpoints urls must be provided. [ordererUrl:${u}][deltaStorageUrl:${f}]`);return new Nd(d,u,f,h,c,this.tokenProvider,o,a,this.driverPolicies,this.blobCache,this.snapshotTreeCache,l)})}},R0=class extends Error{constructor(e){super(e.message),this.innerError=e,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}};at();var Md=class{constructor(){}resolve(e){return y(this,null,function*(){let{ordererUrl:t,storageUrl:n,tenantId:i,containerId:s}=VH(e.url);if(e.headers&&e.headers[ai.createNew]===!0)return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/new`,ordererUrl:t,storageUrl:`${n}/repos/${i}`},id:"",tokens:{},type:"fluid",url:`${t}/${i}/new`};if(s===void 0)throw new Error("Azure URL did not contain containerId");let o=`${t}/${i}/${s}`;return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/${s}`,ordererUrl:t,storageUrl:`${n}/repos/${i}`},id:s,tokens:{},type:"fluid",url:o}})}getAbsoluteUrl(e,t){return y(this,null,function*(){if(e.type!=="fluid")throw new Error("Invalid Resolved Url");return`${e.url}/${t}`})}};function VH(r){let e=new URL(r),t=e.origin,n=e.searchParams,i=n.get("storage");if(i===null)throw new Error("Azure URL did not contain a storage URL");let s=n.get("tenantId");if(s===null)throw new Error("Azure URL did not contain a tenant ID");let o=decodeURIComponent(i),a=decodeURIComponent(s),c=n.get("containerId"),l=c!==null?decodeURIComponent(c):void 0;return{ordererUrl:t,storageUrl:o,tenantId:a,containerId:l}}var M5=(r,e)=>{let t=new URL(r);return t.searchParams.append("storage",encodeURIComponent(r)),t.searchParams.append("tenantId",encodeURIComponent(e)),{url:t.href,headers:{[ai.createNew]:!0}}};function k0(r){return r.type==="remote"}var UH="local",Bd=r=>k0(r)?r.tenantId:UH,GH=5,zc=class{constructor(e){this.props=e,e.connection.endpoint=e.connection.endpoint.replace(/\/$/,""),this.urlResolver=new Md;let t=k0(this.props.connection);this.documentServiceFactory=new kd(this.props.connection.tokenProvider,{enableWholeSummaryUpload:t,enableDiscovery:t})}createContainer(e){return y(this,null,function*(){let n=yield this.createLoader(e).createDetachedContainer({package:"no-dynamic-package",config:{}}),i=yield this.createFluidContainer(n,this.props.connection),s=this.getContainerServices(n);return{container:i,services:s}})}copyContainer(e,t,n){return y(this,null,function*(){var i;let s=this.createLoader(t),o=new URL(this.props.connection.endpoint);o.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),o.searchParams.append("tenantId",encodeURIComponent(Bd(this.props.connection))),o.searchParams.append("containerId",encodeURIComponent(e));let a=yield s.resolve({url:o.href});if(a.resolvedUrl===void 0)throw new Error("Source container cannot resolve URL.");let l=yield(yield this.documentServiceFactory.createDocumentService(a.resolvedUrl)).connectToStorage(),d={type:yc.Handle,handleType:yc.Tree,handle:(i=n?.id)!==null&&i!==void 0?i:"latest"},h=yield l.downloadSummary(d),u=yield s.rehydrateDetachedContainerFromSnapshot(JSON.stringify(h)),f=yield this.createFluidContainer(u,this.props.connection),g=this.getContainerServices(u);return{container:f,services:g}})}getContainer(e,t){return y(this,null,function*(){let n=this.createLoader(t),i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Bd(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));let s=yield n.resolve({url:i.href}),o=yield un(s,"/"),a=new xa(s,o),c=this.getContainerServices(s);return{container:a,services:c}})}getContainerVersions(e,t){return y(this,null,function*(){var n;let i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Bd(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));let s=yield this.urlResolver.resolve({url:i.href});if(!s)throw new Error("Unable to resolved URL");return(yield(yield(yield this.documentServiceFactory.createDocumentService(s)).connectToStorage()).getVersions(null,(n=t?.maxCount)!==null&&n!==void 0?n:GH)).map(l=>({id:l.id,date:l.date}))})}getContainerServices(e){return{audience:new Th(e)}}createLoader(e){let t=new Eh(e),i={load:()=>y(this,null,function*(){return{module:{fluidExport:t},details:{package:"no-dynamic-package",config:{}}}})},s={details:{capabilities:{interactive:!0}},permission:[],scopes:[],user:{id:""},mode:"write"};return new gc({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:i,logger:this.props.logger,options:{client:s}})}createFluidContainer(e,t){return y(this,null,function*(){let n=M5(t.endpoint,Bd(t)),i=yield un(e,"/"),s=()=>y(this,null,function*(){if(e.attachState!==se.Detached)throw new Error("Cannot attach container. Container is not in detached state");yield e.attach(n);let a=e.resolvedUrl;return rr(a),a.id}),o=new xa(e,i);return o.attach=s,o})}};var rv=ye(mA());var gA=ye(Wn());te();var tv=class extends be{constructor(e,t){super(),this.signaler=e,this.emitter=new gA.EventEmitter,this.emitter.on("error",n=>{this.emit("error",n)}),this.managerId=t?`#${t}`:void 0,this.signaler.on("signal",(n,i)=>{let s=n.clientId;this.signaler.connected&&s!==null&&this.emitter.emit(n.type,s,i,n.content)})}getManagerSignalName(e){return this.managerId?`${e}${this.managerId}`:e}onSignal(e,t){let n=this.getManagerSignalName(e);return this.emitter.on(n,t),this}offSignal(e,t){let n=this.getManagerSignalName(e);return this.emitter.off(n,t),this}submitSignal(e,t){let n=this.getManagerSignalName(e);this.signaler.connected&&this.signaler.submitSignal(n,t)}},hs=class extends ts{get manager(){return C(this._manager!==void 0,587),this._manager}static get Name(){return"@fluid-example/signal-manager"}hasInitialized(){return y(this,null,function*(){this._manager=new tv(this.runtime),this.manager.on("error",e=>{this.emit("error",e)})})}onSignal(e,t){return this.manager.onSignal(e,t),this}offSignal(e,t){return this.manager.offSignal(e,t),this}submitSignal(e,t){this.manager.submitSignal(e,t)}};hs.factory=new Ao(hs.Name,hs,[],{});Dt();var vA=(()=>{let e=class e{constructor(){this.userConfig={id:Te(),name:localStorage.getItem("userName")??this.getRandomName(),additionalDetails:{color:this.getRandomColor()}},this.remoteConnectionConfig={tenantId:process.env.NG_APP_TENANT_ID,type:"remote",tokenProvider:new rv.InsecureTokenProvider(process.env.NG_APP_PRIMARY_KEY,this.userConfig),endpoint:process.env.NG_APP_ENDPOINT_URL},this.localConnectionConfig={type:"local",tokenProvider:new rv.InsecureTokenProvider("",this.userConfig),endpoint:"http://localhost:7070"},this.useAzure=process.env.NG_APP_USE_AZURE,this.connectionConfig={connection:this.useAzure==="true"?this.remoteConnectionConfig:this.localConnectionConfig}}getFluidData(){return y(this,null,function*(){let n,i,s="",o={initialObjects:{map:wi,signaler:hs}},a=new zc(this.connectionConfig);return!location.hash?({container:n,services:i}=yield a.createContainer(o),s=yield n.attach(),location.hash=s):(s=location.hash.substring(1),{container:n,services:i}=yield a.getContainer(s,o)),n.connectionState!==Oe.Connected&&(yield new Promise(l=>{n.once("connected",()=>{l()})})),{container:n,services:i,sharedMap:n.initialObjects.map,signaler:n.initialObjects.signaler}})}getRandomName(){let n=["Alice","Bob","Charlie","David","Eve","Frank","George","Hannah","Irene","Jack","Karen","Linda","Molly","Nancy","Olivia","Peter","Quelle","Richard","Susan","Tina","Ursula","Vicky","Wendy","Xavier","Yvonne","Zoe"];return n[Math.floor(Math.random()*n.length)]}getRandomColor(){let n=["red","green","blue","orange","purple","brown","chocolate","coral","cyan","darkblue","darkgreen","darkred","darkyellow","darkorange","darkpurple","darkpink","darkbrown","darkchocolate","darkcoral","darkcyan","cornflowerblue"];return n[Math.floor(Math.random()*n.length)]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=en({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var yA=(()=>{let e=class e{constructor(n){this.fluidContainerService=n,this.behaviorSubject$=new Vc({elementToBeDrawn:[]}),this.elementToBeDrawn=[],this.behaviorSubjectObservable$=this.behaviorSubject$.asObservable()}initFluid(){return y(this,null,function*(){this.whiteBoardSharedMap||(this.fluidData=yield this.fluidContainerService.getFluidData(),this.whiteBoardSharedMap=this.fluidData.sharedMap,this.syncWhiteboardData(),this.mouseTracker=new ES(this.fluidData.container,this.fluidData.services.audience,this.fluidData.container.initialObjects.signaler))})}updatewhiteBoardSharedMap(n){this.whiteBoardSharedMap&&this.whiteBoardSharedMap.set("elementToBeDrawn",n)}syncWhiteboardData(){this.whiteBoardSharedMap&&(this.syncSharedMap=()=>{this.elementToBeDrawn=this.whiteBoardSharedMap.get("elementToBeDrawn")??[],this.behaviorSubject$.next({elementToBeDrawn:this.elementToBeDrawn})},this.syncSharedMap(),this.whiteBoardSharedMap.on("valueChanged",this.syncSharedMap))}};e.\u0275fac=function(i){return new(i||e)(fs(vA))},e.\u0275prov=en({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var iV=["workarea"],sV=["whiteboard"],oV=["mouseTrackerDiv"];function aV(r,e){if(r&1){let t=$e();lt(0),k(1,"div",134)(2,"h4"),re(3,"Path"),j(),k(4,"div",112)(5,"label",113),X("mousedown",function(){K(t);let i=ae(7),s=G(2);return $(s.onDragDown(i,s.selectedElement,"x"))}),k(6,"input",135,8),X("input",function(){K(t);let i=ae(7),s=G(2);return $(s.setNumberValue(s.selectedElement,"x",+i.value))}),j(),k(8,"span"),re(9,"X"),j()(),k(10,"label",113),X("mousedown",function(){K(t);let i=ae(12),s=G(2);return $(s.onDragDown(i,s.selectedElement,"y"))}),k(11,"input",135,9),X("input",function(){K(t);let i=ae(12),s=G(2);return $(s.setNumberValue(s.selectedElement,"y",+i.value))}),j(),k(13,"span"),re(14,"Y"),j()()()(),ut()}if(r&2){let t=G(2);H(6),Y("value",t.selectedElement.x),H(5),Y("value",t.selectedElement.y)}}function cV(r,e){if(r&1){let t=$e();lt(0),k(1,"div",136)(2,"h4"),re(3,"Rectangle"),j(),k(4,"div",112)(5,"label",113),X("mousedown",function(){K(t);let i=ae(7),s=G(2);return $(s.onDragDown(i,s.selectedElement,"x"))}),k(6,"input",135,10),X("input",function(){K(t);let i=ae(7),s=G(2);return $(s.setNumberValue(s.selectedElement,"x",+i.value))}),j(),k(8,"span"),re(9,"X"),j()(),k(10,"label",113),X("mousedown",function(){K(t);let i=ae(12),s=G(2);return $(s.onDragDown(i,s.selectedElement,"y"))}),k(11,"input",135,11),X("input",function(){K(t);let i=ae(12),s=G(2);return $(s.setNumberValue(s.selectedElement,"y",+i.value))}),j(),k(13,"span"),re(14,"Y"),j()(),k(15,"label",113),X("mousedown",function(){K(t);let i=ae(17),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"width"))}),k(16,"input",135,12),X("input",function(){K(t);let i=ae(17),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"width",+i.value))}),j(),k(18,"span",115),re(19,"Width"),j()(),k(20,"label",113),X("mousedown",function(){K(t);let i=ae(22),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"height"))}),k(21,"input",135,13),X("input",function(){K(t);let i=ae(22),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"height",+i.value))}),j(),k(23,"span",115),re(24,"Height"),j()()()(),ut()}if(r&2){let t=G(2);H(6),Y("value",t.selectedElement.x),H(5),Y("value",t.selectedElement.y),H(5),Y("value",t.selectedElement.options.width),H(5),Y("value",t.selectedElement.options.height)}}function lV(r,e){if(r&1){let t=$e();lt(0),k(1,"div",137)(2,"h4"),re(3,"Image"),j(),k(4,"div",112)(5,"label",113),X("mousedown",function(){K(t);let i=ae(7),s=G(2);return $(s.onDragDown(i,s.selectedElement,"x"))}),k(6,"input",138,14),X("input",function(){K(t);let i=ae(7),s=G(2);return $(s.setNumberValue(s.selectedElement,"x",+i.value))}),j(),k(8,"span"),re(9,"X"),j()(),k(10,"label",113),X("mousedown",function(){K(t);let i=ae(12),s=G(2);return $(s.onDragDown(i,s.selectedElement,"y"))}),k(11,"input",139,15),X("input",function(){K(t);let i=ae(12),s=G(2);return $(s.setNumberValue(s.selectedElement,"y",+i.value))}),j(),k(13,"span"),re(14,"Y"),j()(),k(15,"label",113),X("mousedown",function(){K(t);let i=ae(17),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"width"))}),k(16,"input",135,16),X("input",function(){K(t);let i=ae(17),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"width",+i.value))}),j(),k(18,"span",115),re(19,"Width"),j()(),k(20,"label",113),X("mousedown",function(){K(t);let i=ae(22),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"height"))}),k(21,"input",135,17),X("input",function(){K(t);let i=ae(22),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"height",+i.value))}),j(),k(23,"span",115),re(24,"Height"),j()()()(),ut()}if(r&2){let t=G(2);H(6),Y("value",t.selectedElement.x),H(5),Y("value",t.selectedElement.y),H(5),Y("value",t.selectedElement.options.width),H(5),Y("value",t.selectedElement.options.height)}}function uV(r,e){if(r&1){let t=$e();lt(0),k(1,"div",140)(2,"h4"),re(3,"Ellipse"),j(),k(4,"div",112)(5,"label",141),X("mousedown",function(){K(t);let i=ae(7),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"cx"))}),k(6,"input",142,18),X("input",function(){K(t);let i=ae(7),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"cx",+i.value))}),j(),k(8,"span"),re(9,"X"),j()(),k(10,"label",113),X("mousedown",function(){K(t);let i=ae(12),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"cy"))}),k(11,"input",143,19),X("input",function(){K(t);let i=ae(12),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"cy",+i.value))}),j(),k(13,"span"),re(14,"Y"),j()(),k(15,"label",113),X("mousedown",function(){K(t);let i=ae(17),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"rx"))}),k(16,"input",144,20),X("input",function(){K(t);let i=ae(17),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"rx",+i.value))}),j(),k(18,"span"),re(19,"Radius X"),j()(),k(20,"label",113),X("mousedown",function(){K(t);let i=ae(22),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"ry"))}),k(21,"input",145,21),X("input",function(){K(t);let i=ae(22),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"ry",+i.value))}),j(),k(23,"span"),re(24,"Radius Y"),j()()()(),ut()}if(r&2){let t=G(2);H(6),Y("value",t.selectedElement.options.cx),H(5),Y("value",t.selectedElement.options.cy),H(5),Y("value",t.selectedElement.options.rx),H(5),Y("value",t.selectedElement.options.ry)}}function hV(r,e){if(r&1){let t=$e();lt(0),k(1,"div",146)(2,"h4"),re(3,"Line"),j(),k(4,"div",112)(5,"label",113),X("mousedown",function(){K(t);let i=ae(7),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"x1"))}),k(6,"input",147,22),X("input",function(){K(t);let i=ae(7),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"x1",+i.value))}),j(),k(8,"span"),re(9,"Start X"),j()(),k(10,"label",113),X("mousedown",function(){K(t);let i=ae(12),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"y1"))}),k(11,"input",148,23),X("input",function(){K(t);let i=ae(12),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"y1",+i.value))}),j(),k(13,"span"),re(14,"Start Y"),j()(),k(15,"label",113),X("mousedown",function(){K(t);let i=ae(17),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"x2"))}),k(16,"input",149,24),X("input",function(){K(t);let i=ae(17),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"x2",+i.value))}),j(),k(18,"span"),re(19,"End X"),j()(),k(20,"label",113),X("mousedown",function(){K(t);let i=ae(22),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"y2"))}),k(21,"input",150,25),X("input",function(){K(t);let i=ae(22),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"y2",+i.value))}),j(),k(23,"span"),re(24,"End Y"),j()()()(),ut()}if(r&2){let t=G(2);H(6),Y("value",t.selectedElement.options.x1),H(5),Y("value",t.selectedElement.options.y1),H(5),Y("value",t.selectedElement.options.x2),H(5),Y("value",t.selectedElement.options.y2)}}function dV(r,e){if(r&1){let t=$e();lt(0),k(1,"div",151)(2,"h4"),re(3,"Text"),j(),k(4,"div",112)(5,"label",152)(6,"input",153,26),X("input",function(){K(t);let i=ae(7),s=G(2);return $(s.selectedElement.value=i.value)}),j(),k(8,"span"),re(9,"Content"),j()(),k(10,"label",113),X("mousedown",function(){K(t);let i=ae(12),s=G(2);return $(s.onDragDown(i,s.selectedElement,"x"))}),k(11,"input",154,27),X("input",function(){K(t);let i=ae(12),s=G(2);return $(s.setNumberValue(s.selectedElement,"x",+i.value))}),j(),k(13,"span"),re(14,"X"),j()(),k(15,"label",113),X("mousedown",function(){K(t);let i=ae(17),s=G(2);return $(s.onDragDown(i,s.selectedElement,"y"))}),k(16,"input",155,28),X("input",function(){K(t);let i=ae(17),s=G(2);return $(s.setNumberValue(s.selectedElement,"y",+i.value))}),j(),k(18,"span"),re(19,"Y"),j()(),k(20,"div",156)(21,"span"),re(22,"Font"),j(),k(23,"div",157),re(24),j(),oe(25,"div",130)(26,"input",158),k(27,"select",159,29),X("change",function(){K(t);let i=ae(28),s=G(2);return $(s.selectedElement.options.fontFamily=i.value)}),k(29,"option",160),re(30,"Arial"),j(),k(31,"option",161),re(32,"Arial Black"),j(),k(33,"option",162),re(34,"Comic Sans MS"),j(),k(35,"option",163),re(36,"Courier New"),j(),k(37,"option",164),re(38,"Georgia"),j(),k(39,"option",165),re(40,"Impact"),j(),k(41,"option",166),re(42,"Lucida Console"),j(),k(43,"option",167),re(44,"Lucida Sans Unicode"),j(),k(45,"option",168),re(46,"Monospace"),j(),k(47,"option",169),re(48,"Palatino Linotype"),j(),k(49,"option",170),re(50,"Sans-serif"),j(),k(51,"option",171),re(52,"Serif"),j(),k(53,"option",172),re(54,"Tahoma"),j(),k(55,"option",173),re(56,"Times New Roman"),j(),k(57,"option",174),re(58,"Trebuchet MS"),j(),k(59,"option",175),re(60,"Verdana"),j()()(),k(61,"div",176)(62,"span"),re(63,"Font Style"),j(),k(64,"div",177),X("click",function(){K(t);let i=G(2);return $(i.toggleFontWeight())}),re(65," B "),j(),k(66,"div",178),X("click",function(){K(t);let i=G(2);return $(i.toggleFontStyle())}),re(67," i "),j()(),k(68,"label",179),X("mousedown",function(){K(t);let i=ae(70),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"fontSize"))}),k(69,"input",180,30),X("input",function(){K(t);let i=ae(70),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"fontSize",+i.value))}),j(),k(71,"span",181),re(72,"Font Size"),j()()()(),ut()}if(r&2){let t=G(2);H(6),Y("value",t.selectedElement.value),H(5),Y("value",t.selectedElement.x),H(5),Y("value",t.selectedElement.y),H(7),Vt("font-family",t.selectedElement.options.fontFamily),H(),Oi(" ",t.selectedElement.options.fontFamily," "),H(3),Y("value",t.selectedElement.options.fontFamily),H(37),Rt("active",t.selectedElement.options.fontWeight==="bold"),H(2),Rt("active",t.selectedElement.options.fontStyle==="italic"),H(3),Y("value",t.selectedElement.options.fontSize)}}function fV(r,e){if(r&1){let t=$e();lt(0),k(1,"label",113),X("mousedown",function(){K(t);let i=ae(3),s=G(2);return $(s.onDragDown(i,s.selectedElement.options,"rx"))}),k(2,"input",182,31),X("input",function(){K(t);let i=ae(3),s=G(2);return $(s.setNumberValue(s.selectedElement.options,"rx",+i.value))}),j(),k(4,"span",115),re(5,"Roundness"),j(),oe(6,"div",183),j(),ut()}if(r&2){let t=G(2);H(2),Y("value",t.selectedElement.options.rx)}}function pV(r,e){r&1&&(lt(0),re(1,"\xB7\xB7\xB7"),ut())}function mV(r,e){r&1&&(lt(0),re(1,"- -"),ut())}function gV(r,e){r&1&&(lt(0),re(1,"-\xB7-"),ut())}function vV(r,e){r&1&&(lt(0),re(1,"-\xB7\xB7-"),ut())}function yV(r,e){r&1&&(lt(0),re(1,"\u2014"),ut())}function bV(r,e){if(r&1){let t=$e();lt(0)(1,109),ft(2,aV,15,2,"ng-container",110)(3,cV,25,4,"ng-container",110)(4,lV,25,4,"ng-container",110)(5,uV,25,4,"ng-container",110)(6,hV,25,4,"ng-container",110)(7,dV,73,12,"ng-container",110),k(8,"div",111)(9,"div",112)(10,"label",113),X("mousedown",function(){K(t);let i=ae(12),s=G();return $(s.onDragDown(i,s.selectedElement,"rotation"))}),k(11,"input",114,4),X("input",function(){K(t);let i=ae(12),s=G();return $(s.setNumberValue(s.selectedElement,"rotation",+i.value))}),j(),k(13,"span",115),re(14,"Rotation"),j(),k(15,"div",116),oe(16,"div",117),j()(),k(17,"label",113),X("mousedown",function(){K(t);let i=ae(19),s=G();return $(s.onDragDown(i,s.selectedElement,"opacity"))}),k(18,"input",118,5),X("input",function(){K(t);let i=ae(19),s=G();return $(s.setNumberValue(s.selectedElement,"opacity",+i.value))}),j(),k(20,"span",119),re(21,"Opacity"),j()(),ft(22,fV,7,1,"ng-container",110),j()(),k(23,"div",120)(24,"h4"),re(25,"Stroke"),j(),k(26,"div",112)(27,"label",113),X("mousedown",function(){K(t);let i=ae(29),s=G();return $(s.onDragDown(i,s.selectedElement.options,"strokeWidth"))}),k(28,"input",121,6),X("input",function(){K(t);let i=ae(29),s=G();return $(s.setNumberValue(s.selectedElement.options,"strokeWidth",+i.value))}),j(),k(30,"span",115),re(31,"Width"),j(),oe(32,"div",122),j(),k(33,"div",123)(34,"span"),re(35,"Dash"),j(),k(36,"select",124,7),X("change",function(){K(t);let i=ae(37),s=G();return $(s.selectedElement.options.dasharray=i.value)}),k(38,"option",125),re(39,"\u2014"),j(),k(40,"option",126),re(41,"\xB7\xB7\xB7"),j(),k(42,"option",127),re(43,"- -"),j(),k(44,"option",128),re(45,"-\xB7-"),j(),k(46,"option",129),re(47,"-\xB7\xB7-"),j()(),oe(48,"div",130),k(49,"label",131),lt(50,109),ft(51,pV,2,0,"ng-container",110)(52,mV,2,0,"ng-container",110)(53,gV,2,0,"ng-container",110)(54,vV,2,0,"ng-container",110)(55,yV,2,0,"ng-container",132),ut(),j()(),k(56,"label",133)(57,"span",115),re(58,"Stroke Join"),j()(),k(59,"label",133)(60,"span",115),re(61,"Stroke Cap"),j()()()(),ut()()}if(r&2){let t=G();H(),Y("ngSwitch",t.selectedElement.type),H(),Y("ngSwitchCase",t.elementTypeEnum.BRUSH),H(),Y("ngSwitchCase",t.elementTypeEnum.RECT),H(),Y("ngSwitchCase",t.elementTypeEnum.IMAGE),H(),Y("ngSwitchCase",t.elementTypeEnum.ELLIPSE),H(),Y("ngSwitchCase",t.elementTypeEnum.LINE),H(),Y("ngSwitchCase",t.elementTypeEnum.TEXT),H(4),Y("value",t.selectedElement.rotation),H(4),Gc("transform: rotate("+t.selectedElement.rotation+"deg);"),H(3),Y("value",t.selectedElement.opacity),H(4),Y("ngSwitchCase",t.elementTypeEnum.RECT),H(6),Y("value",t.selectedElement.options.strokeWidth),H(8),Y("value",t.selectedElement.options.dasharray),H(14),Y("ngSwitch",t.selectedElement.options.dasharray),H(),Y("ngSwitchCase","2,2"),H(),Y("ngSwitchCase","5,5"),H(),Y("ngSwitchCase","5,2,2,2"),H(),Y("ngSwitchCase","5,2,2,2,2,2")}}function xV(r,e){if(r&1&&(k(0,"option",184),re(1),j()),r&2){let t=e.$implicit;Y("value",t)("selected",t===100),H(),ms(t+"%")}}var Kfe=(()=>{let e=class e{constructor(n,i){this._whiteboardService=n,this.fluidService=i,this.toolsEnum=Je,this.elementTypeEnum=yt,this.selectedTool=Je.BRUSH,this.selectedElement=null,this.whiteBoardZoomOptions=ty,this.options={strokeColor:"#ff0",strokeWidth:5,fill:"#000",backgroundColor:"#fff",canvasHeight:1400,canvasWidth:1400,dasharray:""},this.formatTypes=ki,this.outerWidth=1200,this.outerHeight=750,this.zoom=1,this.x=0,this.y=0,this.savedImage="",this.mouseTrackerDiv={}}handleDeleteKeyboardEvent(n){n.key==="Delete"||n.key==="Backspace"?this.deleteSelectedElement():n.getModifierState&&n.getModifierState("Control")&&(console.log(n.key),n.key==="z"?this.undoSelectedElement():n.key==="y"&&this.redoSelectedElement())}ngOnInit(){return y(this,null,function*(){yield this.fluidService.initFluid(),this.myself=yield this.fluidService.fluidData?.services.audience.getMyself(),this.fluidService.behaviorSubjectObservable$.subscribe(n=>{this.triggeredFromBehaviouSubject=!0,this.whiteboard.data=n.elementToBeDrawn}),ry(this.fluidService.mouseTracker,this.mouseTrackerDiv.nativeElement,this.myself)})}ngAfterViewInit(){setTimeout(()=>{this.whiteboard.dataChange.subscribe(()=>{})},0)}calculateSize(){let n=this.workarea.nativeElement,i={w:this.options.canvasWidth,h:this.options.canvasHeight},s=n.clientWidth,o=n.clientHeight,a=s,c=o,l=this.zoom,d=2;s=Math.max(a,i.w*l*d),o=Math.max(c,i.h*l*d);let h=s/2-a/2,u=o/2-c/2;this.outerWidth=s,this.outerHeight=o,this.updateSize(i.w,i.h),setTimeout(()=>{n.scrollLeft=h,n.scrollTop=u},0)}updateSize(n,i){this.options.canvasWidth=n,this.options.canvasHeight=i;let s=this.zoom,o=this.outerWidth,a=this.outerHeight,c=o/2-n*s/2,l=a/2-i*s/2;setTimeout(()=>{this.x=c,this.y=l},0)}zoomWheel(n){let i=n;if(i.altKey||i.ctrlKey){n.preventDefault();let s=this.zoom*100;this.setZoom(Math.trunc(s-i.deltaY/100*(i.altKey?10:5)))}}setZoom(n){let i=this.zoom,s=+n/100;s<.001&&(s=.1);let o={w:this.options.canvasWidth,h:this.options.canvasHeight},a=null;a!=null&&window.cancelAnimationFrame(a);let c=Date.now(),l=500,d=s-i,h=()=>{let f=(Date.now()-c)/l;f=Math.pow(f-1,3)+1,this.zoom=i+d*f,this.updateSize(o.w,o.h),f<1&&f>-.9?a=requestAnimationFrame(h):(this.zoom=s,this.updateSize(o.w,o.h))};h()}dataChanged(n){this.fluidService.updatewhiteBoardSharedMap(this.whiteboard.data)}deleteSelectedElement(){let n=this.whiteboard.data.findIndex(i=>i.id===this.selectedElement.id);n>-1&&this.whiteboard.data.splice(n,1)}undoSelectedElement(){this._whiteboardService.undo()}redoSelectedElement(){this._whiteboardService.redo()}setSizeResolution(n){let i=this.options.canvasWidth,s=this.options.canvasHeight,o=[];if(o[0]=parseInt(n.split("x")[0]),o[1]=parseInt(n.split("x")[1]),n=="Custom")return;n=="content"&&(o[0]=100,o[1]=100);let a=o[0]-i,c=o[1]-s,l=null;l!=null&&window.cancelAnimationFrame(l);let d=Date.now(),h=500,u=()=>{let g=(Date.now()-d)/h;g=Math.pow(g-1,3)+1,i=parseInt((o[0]-a+g*a).toFixed(0)),s=parseInt((o[1]-c+g*c).toFixed(0)),this.updateSize(i,s),g<1&&g>-.9?l=requestAnimationFrame(u):this.updateSize(i,s)};u()}onDragDown(n,i,s){let o=n.min?parseInt(n.min,10):null,a=n.max?parseInt(n.max,10):null,c=parseInt(n.step,10),l=200;o&&a&&(l=a-o>0?(a-o)/c:200);let d=l/70*c,h=0,u=parseInt(n.value,10),f=m=>{h===0&&(h=m.pageY);let b=(m.pageY-h)*-1;h=m.pageY;let v=b*d*1,x=c<1?1:0;v.toFixed(x),v=Math.floor(Number(u)+Number(v)),a!==null&&(v=Math.min(v,a)),o!==null&&(v=Math.max(v,o)),u=v,i[s]=u,n.value=u.toString()},g=()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",g)}setNumberValue(n,i,s){isNaN(s)||(n[i]=s)}toggleFontWeight(){this.selectedElement&&(this.selectedElement.options.fontWeight==="normal"?this.selectedElement.options.fontWeight="bold":this.selectedElement.options.fontWeight="normal")}toggleFontStyle(){this.selectedElement&&(this.selectedElement.options.fontStyle==="normal"?this.selectedElement.options.fontStyle="italic":this.selectedElement.options.fontStyle="normal")}newDocument(){this._whiteboardService.erase()}saveAs(n){this._whiteboardService.save(n)}addImage(n){if(n){let i=n.files;if(i){let s=new FileReader;s.onload=o=>{let a=o.target.result;this._whiteboardService.addImage(a)},s.readAsDataURL(i[0])}}}undo(){this._whiteboardService.undo()}redo(){this._whiteboardService.redo()}colorChange(n,i){this.selectedElement?this.selectedElement.options[n]=i:(this.options[n]=i,this.options=this.options,this.updateOptions())}swapColors(){[this.options.fill,this.options.strokeColor]=[this.options.strokeColor,this.options.fill],this.updateOptions()}updateOptions(){this.options=Object.assign({},this.options)}setSelectedElement(n){this.selectedElement=n}onSave(n){let i=navigator.clipboard;i&&i.writeText(n)}};e.\u0275fac=function(i){return new(i||e)(Ie(Zo),Ie(yA))},e.\u0275cmp=Sn({type:e,selectors:[["app-whiteboard-component"]],viewQuery:function(i,s){if(i&1&&(Sr(iV,5),Sr(sV,5),Sr(oV,7)),i&2){let o;wr(o=Cr())&&(s.workarea=o.first),wr(o=Cr())&&(s.whiteboard=o.first),wr(o=Cr())&&(s.mouseTrackerDiv=o.first)}},hostBindings:function(i,s){i&1&&X("keyup",function(a){return s.handleDeleteKeyboardEvent(a)},!1,Wo)},standalone:!0,features:[gs([Zo]),Wc],decls:103,vars:32,consts:[["workarea",""],["whiteboard",""],["zoomSelect",""],["mouseTrackerDiv",""],["angle",""],["group_opacity",""],["stroke_width",""],["dasharray",""],["path_x",""],["path_y",""],["rect_x",""],["rect_y",""],["rect_width",""],["rect_height",""],["image_x",""],["image_y",""],["image_width",""],["image_height",""],["ellipse_cx",""],["ellipse_cy",""],["ellipse_rx",""],["ellipse_ry",""],["line_x1",""],["line_y1",""],["line_x2",""],["line_y2",""],["text",""],["text_x",""],["text_y",""],["font_family",""],["font_size",""],["rect_rx",""],[1,"whiteboard-container"],[1,"editor"],["id","rulers"],["id","ruler_corner"],["id","ruler_x"],["id","ruler_y"],["id","workarea",1,"select",2,"overflow","scroll",3,"mousewheel"],["id","svgcanvas"],[3,"selectElement","save","toolChanged","undo","redo","click","drag","drop","mousemove","selectedTool","options","strokeWidth","zoom","canvasHeight","canvasWidth","center","fullScreen","strokeColor","fill","backgroundColor"],["id","menu_bar",1,"active"],[1,"menu"],["matTooltip","New document",1,"menu_title",3,"click"],["viewBox","0 0 16 16","width","20","height","20"],["fill","#565a66","d","m9.5 1.1l3.4 3.5l.1.4v2h-1V6H8V2H3v11h4v1H2.5l-.5-.5v-12l.5-.5h6.7l.3.1zM9 2v3h2.9L9 2zm4 14h-1v-3H9v-1h3V9h1v3h3v1h-3v3z"],["title","Save Board",1,"menu_title"],["viewBox","0 0 20 20","width","20","height","20"],["d","M12.984 12.656l2.625-2.578 1.406 1.406-5.016 5.016-5.016-5.016 1.406-1.406 2.625 2.578v-9.656h1.969v9.656zM18.984 12h2.016v6.984q0 0.797-0.609 1.406t-1.406 0.609h-13.969q-0.797 0-1.406-0.609t-0.609-1.406v-6.984h2.016v6.984h13.969v-6.984z","fill","#565a66"],["id","file_menu",1,"menu_list","inverted-undo"],[1,"menu_item",3,"click"],["matTooltip","Add image",1,"menu_title"],["fill","#565a66","d","M4 5h13v7h2V5c0-1.103-.897-2-2-2H4c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h8v-2H4V5z"],["fill","#565a66","d","m8 11l-3 4h11l-4-6l-3 4z"],["fill","#565a66","d","M19 14h-2v3h-3v2h3v3h2v-3h3v-2h-3z"],["type","file","accept","image/png, image/gif, image/jpeg",1,"file-input",3,"change"],["matTooltip","Undo(ctrl + z)","title","Undo",1,"menu_title",3,"click"],["fill","#565a66","d","M9 10h6c1.654 0 3 1.346 3 3s-1.346 3-3 3h-3v2h3c2.757 0 5-2.243 5-5s-2.243-5-5-5H9V5L4 9l5 4v-3z"],["matTooltip","Redo(ctrl + y)","title","Redo",1,"menu_title",3,"click"],["fill","#565a66","d","M9 18h3v-2H9c-1.654 0-3-1.346-3-3s1.346-3 3-3h6v3l5-4l-5-4v3H9c-2.757 0-5 2.243-5 5s2.243 5 5 5z"],["id","panels",1,"tools_panel"],[4,"ngIf"],["id","tools_left",1,"tools_panel"],["matTooltip","Select Tool",1,"tool_button",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["d","M17.15 20.76l-2.94 1.5-3.68-6-4.41 3V1.24l12.5 12.01-4.41 1.5 2.94 6z"],["matTooltip","Brush Tool",1,"tool_button",3,"click"],["xmlns","http://www.w3.org/2000/svg","height","24","viewBox","0 0 24 24","width","24",2,"transform","scale(-1, 1)"],["d","M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"],["matTooltip","Image Tool",1,"tool_button",3,"click"],["xmlns","http://www.w3.org/2000/svg","height","24","viewBox","0 0 24 24","width","24"],["d","M0 0h24v24H0z","fill","none"],["d","M17 7l-5 5 5 5V7zm-2 9.17L12.83 12 15 9.83 17.17 12 15 14.17zM3 3v18h18V3H3zm16 16H5V5h14v14z"],["matTooltip","Line Tool",1,"tool_button",3,"click"],["viewBox","0 0 27 27","xmlns","http://www.w3.org/2000/svg","width","24","height","24"],["d","M 3 1 L 26 24 L 24 26 L 1 3 L 3 1 Z"],["matTooltip","Square/Rect Tool",1,"tool_button",3,"click"],["d","M 0 8 L 0 24 L 24 24 L 25 8 L 0 8 Z"],["matTooltip","Ellipse/Circle Tool",1,"tool_button",3,"click"],["cx","13","cy","13","rx","13","ry","9"],["matTooltip","Text Tool",1,"tool_button",3,"click"],["xmlns","http://www.w3.org/2000/svg","height","24","viewBox","2 2 20 20","width","27","height","27"],["d","M5 4v3h5.5v12h3V7H19V4z"],["matTooltip","Eraser Tool",1,"tool_button",3,"click"],["d","M19 13H5v-2h14v2z"],["id","color_tools"],["id","tool_switch","matTooltip","Switch stroke and fill colors [X]",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 11 11"],["d","M3.01 2A6 6 0 019 8h1.83l-2.91 2.91L5 8h2a4 4 0 00-3.99-4v1.93L.1 3.02 3.01.1V2z"],["id","tool_fill","ngx-colors-trigger","",1,"color_tool","active",3,"change"],["title","Change fill color",1,"icon_label"],[1,"color_block"],["id","fill_bg"],["id","fill_color",1,"color_block"],["xmlns","http://www.w3.org/2000/svg","width","100%"],["width","100%","height","100%","opacity","1"],["id","tool_stroke","ngx-colors-trigger","",1,"color_tool",3,"change"],["title","Change stroke color",1,"icon_label"],["id","stroke_bg"],["id","stroke_color","title","Change stroke color",1,"color_block"],["id","tools_bottom",1,"tools_panel"],["id","zoom_select",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["id","zoom_panel","title","Change zoom level",1,"toolset"],["id","zoom_label",1,"select-input"],["id","zoomLabel",1,"zoom_tool","icon_label"],["xmlns","http://www.w3.org/2000/svg","height","24","viewBox","2 2 20 20","width","27"],["d","M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"],["id","zoom","type","text","readonly","readonly",3,"value"],[3,"ngSwitch"],[4,"ngSwitchCase"],["id","selected_panel",1,"context_panel",2,"display","block"],[1,"draginputs"],[1,"draginput",3,"mousedown"],["step","2","min","-180","max","180","type","text",1,"attr_changer",3,"input","value"],[1,"icon_label"],["id","tool_angle_indicator",1,"angle"],["id","tool_angle_indicator_cursor",1,"angle-cursor"],["step","5","min","0","max","100","type","text",1,"attr_changer",3,"input","value"],["id","group_opacityLabel",1,"icon_label"],["id","stroke_panel",1,"context_panel",2,"display","block"],["size","2","value","1","data-attr","stroke-width","min","0","max","99","step","1",3,"input","value"],[1,"draginput_cursor",2,"top","68.9394px"],[1,"stroke_tool","draginput"],["id","stroke_style",3,"change","value"],["selected","selected","value","none"],["value","2,2"],["value","5,5"],["value","5,2,2,2"],["value","5,2,2,2,2,2"],[1,"caret"],["id","stroke_style_label"],[4,"ngSwitchDefault"],[2,"display","none"],["id","path_panel",1,"context_panel","clearfix",2,"display","block"],["type","text","min","","max","","step","1",1,"attr_changer",3,"input","value"],["id","rect_panel",1,"context_panel",2,"display","block"],["id","image_panel",1,"context_panel","clearfix",2,"display","block"],["title","Change X coordinate","type","text","min","","max","","step","1",1,"attr_changer",3,"input","value"],["title","Change Y coordinate","type","text","min","","max","","step","1",1,"attr_changer",3,"input","value"],["id","ellipse_panel",1,"context_panel",2,"display","block"],["id","tool_ellipse_cx",1,"draginput",3,"mousedown"],["title","Change ellipse's cx coordinate","type","text","min","","max","","step","1",1,"attr_changer",3,"input","value"],["title","Change ellipse's cy coordinate","type","text","min","","max","","step","1",1,"attr_changer",3,"input","value"],["title","Change ellipse's x radius","type","text","min","","max","","step","1",1,"attr_changer",3,"input","value"],["title","Change ellipse's y radius","type","text","min","","max","","step","1",1,"attr_changer",3,"input","value"],["id","line_panel",1,"context_panel","clearfix",2,"display","block"],["type","text","min","","max","","step","1","title","Change line's starting x coordinate",1,"attr_changer",3,"input","value"],["type","text","min","","max","","step","1","title","Change line's starting y coordinate",1,"attr_changer",3,"input","value"],["type","text","min","","max","","step","1","title","Change line's ending x coordinate",1,"attr_changer",3,"input","value"],["type","text","min","","max","","step","1","title","Change line's ending y coordinate",1,"attr_changer",3,"input","value"],["id","text_panel",1,"context_panel",2,"display","block"],["data-title","Change Content",1,"draginput","twocol","textcontent"],["id","text","type","text",3,"input","value"],["type","text","min","","max","","step","1","title","Change text x coordinate",1,"attr_changer",3,"input","value"],["type","text","min","","max","","step","1","title","Change text y coordinate",1,"attr_changer",3,"input","value"],["id","tool_font_family",1,"toolset","draginput","twocol"],["id","preview_font"],["id","font_family","data-title","Change Font Family","size","12","type","hidden"],["id","font_family_dropdown",3,"change","value"],["value","Arial"],["value","Arial Black"],["value","Comic Sans MS"],["value","Courier New"],["value","Georgia"],["value","Impact"],["value","Lucida Console"],["value","Lucida Sans Unicode"],["value","monospace","selected",""],["value","Palatino Linotype"],["value","sans-serif","selected",""],["value","serif","selected",""],["value","Tahoma"],["value","Times New Roman"],["value","Trebuchet MS"],["value","Verdana"],[1,"draginput","font_style"],["id","tool_bold","data-title","Bold Text [B]",3,"click"],["id","tool_italic","data-title","Italic Text [I]",3,"click"],["id","tool_font_size","data-title","Change Font Size",1,"draginput",3,"mousedown"],["type","text","min","0","max","","step","1","title","Change text font size",1,"attr_changer",3,"input","value"],["id","font_sizeLabel",1,"icon_label"],["type","text","step","5","min","0","max","100",1,"attr_changer",3,"input","value"],[1,"draginput_cursor",2,"top","70px"],[3,"value","selected"]],template:function(i,s){if(i&1){let o=$e();k(0,"div",32)(1,"div",33)(2,"div",34),oe(3,"div",35)(4,"div",36)(5,"div",37),j(),k(6,"div",38,0),X("mousewheel",function(c){return K(o),$(s.zoomWheel(c))}),k(8,"div",39)(9,"ng-whiteboard",40,1),X("selectElement",function(c){return K(o),$(s.setSelectedElement(c))})("save",function(c){return K(o),$(s.onSave(c))})("toolChanged",function(c){return K(o),$(s.selectedTool=c)})("selectElement",function(c){return K(o),$(s.dataChanged(c))})("undo",function(c){return K(o),$(s.dataChanged(c))})("redo",function(c){return K(o),$(s.dataChanged(c))})("click",function(c){return K(o),$(s.dataChanged(c))})("drag",function(c){return K(o),$(s.dataChanged(c))})("drop",function(c){return K(o),$(s.dataChanged(c))})("drag",function(c){return K(o),$(s.dataChanged(c))})("mousemove",function(c){return K(o),$(s.dataChanged(c))}),j()()(),k(11,"div",41)(12,"div",42)(13,"div",43),X("click",function(){return K(o),$(s.newDocument())}),ge(),k(14,"svg",44),oe(15,"path",45),j()()(),vt(),k(16,"div",42)(17,"div",46),ge(),k(18,"svg",47),oe(19,"path",48),j()(),vt(),k(20,"div",49)(21,"div",50),X("click",function(){return K(o),$(s.saveAs(s.formatTypes.Png))}),re(22,"Save as PNG"),j(),k(23,"div",50),X("click",function(){return K(o),$(s.saveAs(s.formatTypes.Jpeg))}),re(24,"Save as JPEG"),j(),k(25,"div",50),X("click",function(){return K(o),$(s.saveAs(s.formatTypes.Svg))}),re(26,"Save as SVG"),j(),k(27,"div",50),X("click",function(){return K(o),$(s.saveAs(s.formatTypes.Base64))}),re(28,"Copy Base-64"),j()()(),k(29,"div",42)(30,"label",51),ge(),k(31,"svg",47),oe(32,"path",52)(33,"path",53)(34,"path",54),j(),vt(),k(35,"input",55),X("change",function(c){return K(o),$(s.addImage(c.target))}),j()()(),k(36,"div",42)(37,"div",56),X("click",function(){return K(o),$(s.undo())}),ge(),k(38,"svg",47),oe(39,"path",57),j()()(),vt(),k(40,"div",42)(41,"div",58),X("click",function(){return K(o),$(s.redo())}),ge(),k(42,"svg",47),oe(43,"path",59),j()()()(),vt(),k(44,"div",60),ft(45,bV,62,19,"ng-container",61),j(),k(46,"div",62)(47,"div",63),X("click",function(){return K(o),$(s.selectedTool=s.toolsEnum.SELECT)}),ge(),k(48,"svg",64),oe(49,"path",65),j()(),vt(),k(50,"div",66),X("click",function(){return K(o),$(s.selectedTool=s.toolsEnum.BRUSH)}),ge(),k(51,"svg",67),oe(52,"path",68),j()(),vt(),k(53,"div",69),X("click",function(){return K(o),$(s.selectedTool=s.toolsEnum.IMAGE)}),ge(),k(54,"svg",70),oe(55,"path",71)(56,"path",72),j()(),vt(),k(57,"div",73),X("click",function(){return K(o),$(s.selectedTool=s.toolsEnum.LINE)}),ge(),k(58,"svg",74),oe(59,"path",75),j()(),vt(),k(60,"div",76),X("click",function(){return K(o),$(s.selectedTool=s.toolsEnum.RECT)}),ge(),k(61,"svg",74),oe(62,"path",77),j()(),vt(),k(63,"div",78),X("click",function(){return K(o),$(s.selectedTool=s.toolsEnum.ELLIPSE)}),ge(),k(64,"svg",74),oe(65,"ellipse",79),j()(),vt(),k(66,"div",80),X("click",function(){return K(o),$(s.selectedTool=s.toolsEnum.TEXT)}),ge(),k(67,"svg",81),oe(68,"path",82),j()(),vt(),k(69,"div",83),X("click",function(){return K(o),$(s.selectedTool=s.toolsEnum.ERASER)}),ge(),k(70,"svg",70),oe(71,"path",71)(72,"path",84),j()(),vt(),k(73,"div",85)(74,"div",86),X("click",function(){return K(o),$(s.swapColors())}),ge(),k(75,"svg",87),oe(76,"path",88),j()(),vt(),k(77,"div",89),X("change",function(c){return K(o),$(s.colorChange("fill",c))}),oe(78,"label",90),k(79,"div",91),oe(80,"div",92),k(81,"div",93),ge(),k(82,"svg",94),oe(83,"rect",95),j()()()(),vt(),k(84,"div",96),X("change",function(c){return K(o),$(s.colorChange("strokeColor",c))}),oe(85,"label",97),k(86,"div",91),oe(87,"div",98),k(88,"div",99),ge(),k(89,"svg",94),oe(90,"rect",95),j()()()()()(),vt(),k(91,"div",100)(92,"select",101,2),X("change",function(){K(o);let c=ae(93);return $(s.setZoom(c.value))}),ft(94,xV,2,3,"option",102),j(),k(95,"div",103)(96,"div",104)(97,"span",105),ge(),k(98,"svg",106),oe(99,"path",107),j()(),vt(),oe(100,"input",108),j()()()()(),oe(101,"div",null,3)}i&2&&(H(9),Y("selectedTool",s.selectedTool)("options",s.options)("strokeWidth",s.options.strokeWidth)("zoom",s.zoom)("canvasHeight",s.options.canvasHeight)("canvasWidth",s.options.canvasWidth)("center",!0)("fullScreen",!1)("strokeColor",s.options.strokeColor)("fill",s.options.fill)("backgroundColor",s.options.backgroundColor),H(36),Y("ngIf",s.selectedElement),H(2),Rt("active",s.selectedTool===s.toolsEnum.SELECT),H(3),Rt("active",s.selectedTool===s.toolsEnum.BRUSH),H(3),Rt("active",s.selectedTool===s.toolsEnum.IMAGE),H(4),Rt("active",s.selectedTool===s.toolsEnum.LINE),H(3),Rt("active",s.selectedTool===s.toolsEnum.RECT),H(3),Rt("active",s.selectedTool===s.toolsEnum.ELLIPSE),H(3),Rt("active",s.selectedTool===s.toolsEnum.TEXT),H(3),Rt("active",s.selectedTool===s.toolsEnum.ERASER),H(14),Ce("fill",s.options.fill),H(7),Ce("fill",s.options.strokeColor),H(4),Y("ngForOf",s.whiteBoardZoomOptions),H(6),Y("value",s.zoom*100+"%"))},dependencies:[Un,vs,Ri,Kc,$c,Jc,Jv,$v,jv,Lv,ey,Zv],styles:[`@charset "UTF-8";.editor{--z0: #111827;--z1: #1e2433;--a1: #421f24;--b1: #45322a;--c1: #1c3b3b;--z2: #2b313f;--z3: #393e4c;--z4: #474c59;--z5: #565a66;--z6: #656974;--z7: #747782;--a7: #d4100b;--z8: #848790;--z9: #94969f;--z10: #a4a6ae;--z12: #c5c7cc;--z13: #d6d8db;--z14: #e7e9eb;--z15: #f9fafb;--d0: #152239;--d1: #1a3050;--d4: #1e5a9d;--d6: #1779d4;--d7: #0b89f0;--d8: #3797ff;--d9: #62a3ff;--d13: #c3d4fd;--d14: #d7e2fd;--d15: #eaeffc;-webkit-font-smoothing:antialiased;--shadow-bg: 0 var(--x2) var(--x4) var(--z0);--shadow: 0 var(--x1) var(--x8) rgba(0, 0, 0, .4);--accent1: var(--d1);--accent4: var(--d4);--accent6: var(--d6);--accent7: var(--d7);--accent8: var(--d8);--accent9: var(--d9);--accent13: var(--d13);--accent14: var(--d14);--accent15: var(--d15);--x1: 4px;--x2: 8px;--x3: 12px;--x4: 16px;--x5: 20px;--x6: 24px;--x7: 28px;--x8: 32px;--x9: 36px;--x10: 40px;--x12: 48px;--x13: 52px;--x16: 64px;--mono-font: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;--panel-width: calc(var(--x10) * 2 * 2 + var(--x1));--transition-duration: .2s;--transition: all var(--transition-duration) ease}.whiteboard-container{width:100%;height:768px;border:2px dashed #ccc;background:#fff;overflow:hidden;position:relative}.editor{background:var(--z1);font:14px/120% -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin:0;padding:.5rem 0}::selection{background:#000;color:#fff}::-moz-selection{background:#000;color:#fff}.editor{overscroll-behavior-x:none;overflow:hidden;width:100%;height:100%}::-webkit-scrollbar{width:var(--x1);height:var(--x1);background:transparent;position:absolute}::-webkit-scrollbar-track{border-radius:10px;background:transparent}::-webkit-scrollbar-thumb{border-radius:10px;background:var(--z3)}::-webkit-scrollbar-corner{background:transparent}input[type=submit],input[type=button],button{background:var(--accent7);color:var(--z15);border-radius:var(--x1);padding:var(--x2) var(--x4);border:none;line-height:140%;font-size:16px;font-weight:550;cursor:pointer}input[type=submit]:hover,input[type=button]:hover,button:hover{background:var(--accent9)}input[type=submit]:active,input[type=button]:active,button:active{box-shadow:0 0 0 var(--x1) var(--accent14);outline:none}input[type=submit]:focus,input[type=button]:focus,button:focus{outline:none}button.cancel,input.Cancel,input.cancel,input.jGraduate_Cancel{-webkit-appearance:none;background-color:var(--z12);color:var(--z3);margin:0}#canvas_panel{display:block}#tool_bold span,#tool_italic span{position:absolute;width:100%;height:100%;top:0;left:0;background:#ccc;opacity:0}#tools_bottom{position:absolute;left:var(--x12);right:0;bottom:0;height:var(--x10);overflow:visible}.clearfix:before,.clearfix:after{content:"";display:table}.clearfix:after{clear:both}#color_canvas_tools,#fill_bg,#stroke_bg{background:var(--z15) url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMAQMAAABsu86kAAAAA3NCSVQICAjb4U/gAAAABlBMVEXu7u7///8o06qaAAAACXBIWXMAAAsSAAALEgHS3X78AAAAFXRFWHRDcmVhdGlvbiBUaW1lADcvMjIvMTL7FNdCAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M1cbXjNgAAABFJREFUCJljYP7AgIb+MKAhAM8/C5vWL6zSAAAAAElFTkSuQmCC) top left repeat}#color_canvas_tools{width:60px;height:40px;margin:23px 5px 5px;position:relative;overflow:hidden}#color_canvas_tools{display:block}#stroke_style_label{font-size:30px;margin-top:33px;letter-spacing:-1px}.stroke_tool .caret{top:60%}.draginputs{display:flex;flex-direction:row;justify-content:flex-start;flex-wrap:wrap}.draginput{background-color:var(--z2);border-radius:var(--x1);width:calc(50% - var(--x2));height:calc(var(--x9) * 2);display:block;position:relative;margin:0 var(--x2) var(--x2) 0;overflow:hidden;transition:var(--transition);box-shadow:none}.dragging .draginput{pointer-events:none}.dragging .draginput.active{pointer-events:all;box-shadow:none}.draginput:hover{background-color:var(--z3);transition:none;box-shadow:var(--shadow-bg)}.draginput:hover span,.draginput.active span{color:var(--z15)}.draginput:hover input,.draginput.active input{color:var(--accent8)}.draginput.active,.draginput.active:hover{background-color:var(--z0)}.draginput.active:hover{transition:none}.draginput .caret{border:solid transparent 5px;border-top-color:var(--z9);position:absolute;width:0;height:0;right:5px;margin-top:-2px;top:50%}.draginput label{margin:28px 10px 0 5px;font-size:14px;color:var(--z15);font-weight:700}.draginput label#resolution_label,.draginput label#seg_type_label{font:700 12px/110% sans-serif;position:absolute;left:auto;right:10px;z-index:0;text-align:right}.draginput label#seg_type_label{margin-top:40px}.draginput label#seg_type_label .caret{top:66%}.draginput label#resolution_label .pull{position:relative;left:-15px}.draginput label#resolution_label span{right:-13px;left:auto;font-size:16px;top:2px;font-weight:700;color:#fff}.draginput input{border:none;background:transparent;font:24px/normal sans-serif;text-align:center;color:var(--accent7);padding:30px 0 16px;width:100%;height:24px;position:relative;z-index:2}.draginput input::selection{background:var(--accent9)}.draginput.text-input input,.draginput.text-input input:hover,.draginput.text-input input:active{cursor:text}.draginput.text-input input{text-align:left;text-indent:var(--x2)}.draginput.textcontent input{cursor:text;text-align:left;text-indent:var(--x2)}.draginput.textcontent input,.draginput.textcontent input:hover,.draginput.textcontent input:active{cursor:text}.draginput input,.draginput input:hover,.draginput input:active{cursor:grab;cursor:-webkit-grab;cursor:-moz-grab}.draginput input[type=checkbox],.draginput input[type=checkbox]:hover,.draginput input[type=checkbox]:active{cursor:pointer}.draginput input:invalid{color:var(--a7)}.draginput span{font:12px/130% sans-serif;color:var(--z8);display:block;position:absolute;top:5px;left:5px;text-align:left;white-space:nowrap;z-index:1}.draginput select{-webkit-appearance:none;opacity:0;display:block;position:absolute;height:100%;width:100%;margin:0;z-index:1;top:0;left:0;cursor:pointer}.draginput:hover .draginput_cursor{border-color:var(--accent6)}.draginput_cursor{position:absolute;top:50%;width:100%;border-top:solid var(--accent4) 1px;z-index:0}.draginput input[readonly=readonly]{-webkit-appearance:none;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.draginput input:focus{background:var(--accent7);color:var(--accent15);outline:none;box-shadow:0 0 5px 2px var(--accent7)}.draginput input:focus+span{z-index:10;color:var(--z15)}.draginput .push_bottom{bottom:0;position:absolute}.draginput .angle{width:var(--x12);height:var(--x12);border-radius:var(--x12);background-color:var(--z3);position:absolute;bottom:var(--x1);left:14px}.editor.dragging .draginput .angle{background-color:var(--z1)}.draginput:hover .angle{background:var(--z4)}.draginput .angle-cursor{width:4px;height:25px;border-top:solid var(--accent7) 3px;position:absolute;margin:0 0 0 23px;transform-origin:50% 0}#menu_bar{padding:0 0 1rem var(--x12);position:relative;z-index:2;height:var(--x8);display:flex}#menu_bar .menu:hover .menu_list{display:block}.menu{position:relative;z-index:5;color:var(--z3);display:inline-block}.menu_title{cursor:pointer;display:inline-block;z-index:10;color:var(--z15);position:relative;line-height:var(--x8);padding:0 var(--x3);vertical-align:top}.menu .menu_title:hover{background:var(--z2)}.menu_list .separator{margin:var(--x1) 0;border-top:solid var(--z14) 1px}.menu_list{position:absolute;left:0;top:var(--x8);white-space:nowrap;background:var(--z15);padding:var(--x2) 0;border-radius:0 var(--x2) var(--x2) var(--x2);box-shadow:var(--shadow)}#menu_bar.active .menu.open .menu_title{background:var(--z15);color:var(--z1)}.menu .menu_list{display:none;position:absolute}.menu_list .menu_item{position:relative;overflow:hidden;line-height:var(--x6);padding:var(--x1) var(--x16) var(--x1) var(--x6);cursor:pointer;color:var(--z3)}.file-input{-webkit-appearance:none;position:absolute;opacity:0;cursor:pointer;inset:0;display:block;background:red;z-index:100}.menu_list .menu_item.tool_button{background:transparent;border:none;margin:0;padding:var(--x1) var(--x16) var(--x1) var(--x6);height:auto;width:auto}.menu_list .menu_item.push_button_pressed:before{content:"\\2714";position:absolute;display:block;left:6px;top:var(--x1)}.menu_list .menu_item:hover,.menu_list .menu_item.push_button_pressed:hover{background:var(--accent15);color:#000}.menu_list .menu_item.disabled:hover,.menu_list .menu_item.push_button_pressed.disabled:hover{background:transparent;color:var(--z3)}.menu_list .menu_item.push_button_pressed{background:transparent;border:none;width:auto;height:auto;margin:0}.menu_list .menu_item span{display:block;position:absolute;right:var(--x2);padding:0 var(--x2);background:var(--z14);top:50%;transform:translateY(-50%);text-align:center;font-size:12px;line-height:var(--x6);border-radius:var(--x1);font-weight:600}.menu_list .menu_item:not(.disabled):hover span{background:var(--accent13)}.menu-right button:hover svg{fill:var(--z12)}.menu-right svg{fill:var(--z5)}#logo svg{pointer-events:none;margin-top:var(--x2);fill:var(--z7)}#logo svg path:last-child{fill:var(--z13)}#logo:hover svg{fill:var(--z9)}#logo svg path:last-child{fill:var(--z15)}#rulers>div{position:absolute;background:var(--z2);z-index:1;overflow:hidden;-webkit-font-smoothing:none}#rulers #ruler_corner{top:var(--x8);left:var(--x12);width:var(--x4);height:var(--x4);z-index:2;border-radius:var(--x2) 0 0 0}#ruler_x{height:var(--x4);top:var(--x8);left:var(--x12);right:calc(var(--panel-width) + var(--x4));overflow:hidden;border-radius:var(--x2)}#ruler_y{width:var(--x4);top:var(--x8);left:var(--x12);bottom:var(--x10);overflow:hidden;border-radius:var(--x2)}#ruler_x>div,#ruler_y>div{overflow:hidden}#stroke_color:after{content:"";position:absolute;display:block;left:var(--x1);right:var(--x1);top:var(--x1);bottom:var(--x1);background:var(--z1);box-shadow:0 0 0 1px var(--z13)}#tool_switch{cursor:pointer;width:11px;height:11px;position:absolute;top:-5px;right:0;cursor:nwse-resize}#tool_switch svg{fill:var(--z6)}#tool_switch:hover svg{fill:var(--z15)}.color_block{width:var(--x5);height:var(--x5);overflow:hidden;border:solid var(--z12) 1px;cursor:pointer}.color_block svg{width:22px;height:22px}#tool_stroke .color_block>div{position:absolute;bottom:0;right:0}#color_tools{position:relative;width:48px;height:48px;margin:12px 6px 0}#color_tools{width:auto;height:auto}#tool_fill{position:absolute;top:0;left:0;z-index:1}#tool_stroke{top:14px;left:14px}#tool_fill,#tool_stroke,#tool_canvas{box-shadow:0 0 0 1px var(--z0);position:absolute}#tool_canvas .color_block{width:58px;height:38px}#tool_canvas .color_block svg{width:auto;height:auto}#shape_cats>div{padding:0 var(--x4);background:var(--z14);color:var(--z6);height:var(--x7);line-height:var(--x7);transition:background-color .1s ease}#svgcanvas{background-color:var(--z2);display:block;width:100%;height:100%}#workarea{display:block;position:absolute;top:var(--x8);left:var(--x12);bottom:var(--x10);right:calc(var(--panel-width) + var(--x4));background-color:var(--z2);overflow:auto;align-items:center;justify-content:center;transition:transform .5s cubic-bezier(.13,.66,.24,.92);border-radius:var(--x2);box-shadow:var(--shadow-bg)}#tools_left{position:absolute;border-right:none;width:var(--x12);top:var(--x8);bottom:0;left:0;z-index:4}.tool_button{height:var(--x12);width:var(--x12);cursor:pointer;line-height:60px;text-align:center;transform:scale(.8)}.tool_button:hover{transform:scale(1)}.tool_button:hover svg{fill:var(--z13)}.tool_button.active{transform:scale(1.4)}.tool_button svg{vertical-align:center;fill:var(--z5)}.tool_button.active svg{fill:var(--accent8)}.tool_button.active svg{fill:var(--accent7)}.tool_button.disabled svg{background-color:#aaa;cursor:not-allowed;fill:var(--z3);pointer-events:none}#tool_rect svg{position:relative;top:-1px;left:1px}#tool_ellipse svg{position:relative;top:2px;left:1px}.select-input{margin:var(--x2) 0;position:relative}.select-input:after{content:"\\2193";font-weight:700;position:absolute;right:var(--x6);top:50%;color:var(--z7);transform:translateY(-50%)}.select-input select{-webkit-appearance:none;background-color:var(--z3);color:var(--z14);height:var(--x8);display:block;width:calc(100% - var(--x2));padding:0 var(--x4);border:none;border-radius:var(--x1)}.select-input select:focus{outline:none;box-shadow:0 0 0 1px var(--accent7)}#panels{position:absolute;box-sizing:border-box;width:var(--panel-width);right:var(--x1);top:var(--x5);bottom:0;border-bottom:none;overflow:auto;padding:0}.context_panel{display:none}.context_panel h4{color:var(--z15);font-weight:400;margin:0;padding:10px 0 5px}.context_panel label{display:block;color:var(--z13);white-space:nowrap}#align_tools{display:none}.align_buttons{margin-bottom:var(--x2)}.align_button,.align_button *{transition:var(--transition)}.align_button:hover,.align_button:hover *{transition:none}.align_button{float:left;height:var(--x13);width:var(--x13);line-height:var(--x16);text-align:center;cursor:pointer;position:relative}.align_button:hover{background-color:var(--z0);border-color:var(--z3)}.align_button svg{fill:var(--z10)}.align_button:hover svg{fill:var(--z15);transition:none}.align_button:nth-child(1){border-radius:var(--x1) 0 0 0}.align_button:nth-child(3){border-radius:0 var(--x1) 0 0}.align_button:nth-child(4){border-radius:0 0 0 var(--x1)}.align_button:nth-child(6){border-radius:0 0 var(--x1) 0}.align_buttons .push_button{display:block;float:left}#tool_bold,#tool_italic{font:700 20px/35px serif;text-align:center;position:absolute;padding:0;color:var(--z13);background:transparent;border:none;margin:0;width:50%;top:var(--x8);line-height:var(--x10);bottom:0;border-top:solid var(--z1) 2px;cursor:pointer}#tool_bold{right:0}#tool_italic{border-right:solid var(--z1) 2px;line-height:var(--x9);left:0;font-weight:700;font-style:italic;font-size:24px}#tool_bold:hover,#tool_italic:hover{color:var(--z15);background-color:var(--z3)}#tool_bold.disabled,#tool_italic.disabled{opacity:1;color:var(--z4);pointer-events:none}#tool_bold.active,#tool_italic.active{color:#50a0ff}#preview_font{color:var(--z15);font-size:2em;line-height:80px;padding:0 var(--x2);white-space:nowrap}#preview_font+.caret{right:var(--x2)}.draginput:hover #preview_font:after{border-right-color:var(--z3);background:linear-gradient(to right,rgba(0,0,0,0),var(--z3))}#preview_font:after{content:"";position:absolute;right:0;top:3px;bottom:3px;width:15px;border-right:solid var(--z2) 10px;background:linear-gradient(to right,rgba(0,0,0,0),var(--z2))}#zoom_panel,#zoom_select{padding:var(--x2) 0;right:calc(var(--panel-width) + var(--x2));position:absolute;cursor:pointer;width:100px}#zoom_label:after{content:""}#zoom_select{opacity:0;z-index:100}#zoom_select:hover+div{opacity:1}#zoom_label{position:absolute;background:transparent;width:100%;margin:0}#zoom_panel .caret{margin-top:-5px}#zoom_label img,#zoom_label svg{width:var(--x4);height:var(--x4)}#zoomLabel{width:var(--x4);height:var(--x4);cursor:pointer}#zoomLabel svg{fill:var(--z10);position:relative;top:2px}#zoom_label input{-webkit-appearance:none;color:var(--z10);font-size:13px;height:auto;width:var(--x12);padding:0;cursor:default;position:absolute;background:transparent;border:none;top:2px;left:var(--x6);pointer-events:none}#zoom_label select{-webkit-appearance:none;position:absolute;inset:0}#zoom_label span{top:0;left:0}
`],encapsulation:3});let r=e;return r})();export{Kfe as WhiteBoardComponent};
